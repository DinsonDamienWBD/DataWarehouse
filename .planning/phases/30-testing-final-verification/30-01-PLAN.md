---
phase: 30-testing-final-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/**/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompliance/**/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateInterface/**/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateKeyManagement/**/*.cs
  - Plugins/DataWarehouse.Plugins.TamperProof/**/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateServerless/**/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateStreamingData/**/*.cs
autonomous: true

must_haves:
  truths:
    - "Full solution builds with zero errors from v2.0 work (pre-existing upstream errors documented)"
    - "All 1,039+ existing tests pass with zero failures"
    - "Roslyn analyzers produce zero new warnings (TreatWarningsAsErrors is active)"
    - "Test count is >= 1,039 (no regressions)"
  artifacts:
    - path: "DataWarehouse.Tests/bin/"
      provides: "Compiled test assembly"
    - path: ".planning/phases/30-testing-final-verification/30-01-SUMMARY.md"
      provides: "Build fix record and test baseline"
  key_links:
    - from: "DataWarehouse.Tests/DataWarehouse.Tests.csproj"
      to: "All 13 referenced plugin projects"
      via: "ProjectReference"
      pattern: "<ProjectReference"
    - from: "Directory.Build.props"
      to: "All projects"
      via: "TreatWarningsAsErrors=true"
      pattern: "TreatWarningsAsErrors"
---

<objective>
Fix all v2.0-caused compilation errors across the solution, run the full existing test suite, and establish the regression baseline.

Purpose: Phase 30 is the final verification gate. Nothing else in this phase can execute until the solution builds clean and existing tests pass. This plan addresses TEST-01 (zero build errors), TEST-04 (1,039+ tests pass), and TEST-06 (Roslyn analyzer clean pass).

Output: A building solution, passing test suite with recorded count, and documented pre-existing upstream errors.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/30-testing-final-verification/30-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix all v2.0-caused compilation errors and build full solution</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/**/*.cs
    Plugins/DataWarehouse.Plugins.UltimateCompliance/**/*.cs
    Plugins/DataWarehouse.Plugins.UltimateInterface/**/*.cs
    Plugins/DataWarehouse.Plugins.UltimateKeyManagement/**/*.cs
    Plugins/DataWarehouse.Plugins.TamperProof/**/*.cs
    Plugins/DataWarehouse.Plugins.UltimateServerless/**/*.cs
    Plugins/DataWarehouse.Plugins.UltimateStreamingData/**/*.cs
  </files>
  <action>
    Run `dotnet build DataWarehouse.slnx` and categorize ALL errors into two buckets:

    **Bucket A -- v2.0-caused errors (MUST FIX):**
    Research identified these specific errors from Phase 27+ incomplete work:
    - UltimateAccessControl: CS0534 missing PluginBase.Category.get (2 errors) -- add abstract `Category` property override returning the appropriate PluginCategory
    - UltimateCompliance: CS0534 missing PluginBase.Category.get (2 errors) -- same fix as AccessControl
    - UltimateInterface: CS0115/CS0534/CS0103 InterfaceProtocol + missing methods (6 errors) -- fix InterfaceProtocol references, implement missing abstract members from the new base class hierarchy
    - UltimateKeyManagement: CS0115 KeyStoreType override mismatch (1 error) -- fix the override signature to match the new base class definition
    - TamperProof: CS0234 IntegrityHash missing (2 errors) -- fix namespace reference (type may have been moved during Phase 24-26 refactoring)
    - UltimateServerless: CS0534/CS0115 ComputePluginBase abstract members (4 errors) -- implement missing abstract members from ComputePluginBase
    - UltimateStreamingData: CS1038 #endregion mismatch (2 errors) -- fix mismatched region directives

    For each plugin error:
    1. Read the error output to understand the exact issue
    2. Check the current base class definition in SDK to see what abstract members are required
    3. Implement the minimum fix (add missing overrides, fix namespaces, fix region directives)
    4. Do NOT change plugin behavior -- only satisfy compilation contracts (AD-08 zero regression)

    **Bucket B -- Pre-existing upstream errors (DOCUMENT ONLY):**
    - UltimateCompression: CS1729 BZip2Stream/LzmaStream constructor mismatch (12 errors) -- upstream SharpCompress API change, NOT from v2.0 work. Document in SUMMARY.
    - AedsCore: CS0234 MQTTnet.Client namespace missing (2 errors) -- upstream MQTTnet API change, NOT from v2.0 work. Document in SUMMARY.

    After fixing Bucket A, rebuild with `dotnet build DataWarehouse.slnx`. Goal: zero Bucket A errors remaining. Bucket B errors are acceptable and documented.

    Also verify TEST-06: Since TreatWarningsAsErrors is globally enabled via Directory.Build.props, a successful build means zero warnings. Verify no new `#pragma warning disable` directives were added during v2.0 work by checking recent git history of modified files. Verify .globalconfig has not been weakened.
  </action>
  <verify>
    Run `dotnet build DataWarehouse.slnx 2>&1` and confirm:
    - Zero errors from v2.0-modified plugins (Bucket A all fixed)
    - Only pre-existing upstream errors remain (UltimateCompression + AedsCore)
    - Zero warnings (TreatWarningsAsErrors active)
    If the test project still cannot build due to broken plugin references (UltimateCompression has 12 pre-existing errors and IS referenced by the test project), temporarily comment out that ProjectReference in DataWarehouse.Tests.csproj for Bucket B plugins ONLY, with a `<!-- TODO: Restore when upstream SharpCompress/MQTTnet APIs are updated -->` comment.
  </verify>
  <done>
    All v2.0-caused errors are fixed. The test project compiles. Pre-existing upstream errors (SharpCompress, MQTTnet) are documented with justification. Zero new warnings.
  </done>
</task>

<task type="auto">
  <name>Task 2: Run full existing test suite and establish regression baseline</name>
  <files>
    DataWarehouse.Tests/DataWarehouse.Tests.csproj
  </files>
  <action>
    With the test project now building clean (Task 1 complete):

    1. Run the full test suite: `dotnet test DataWarehouse.Tests/DataWarehouse.Tests.csproj --logger "console;verbosity=detailed" --results-directory TestResults`
    2. Capture exact counts: total tests discovered, passed, failed, skipped
    3. If any tests FAIL:
       - Categorize each failure: is it caused by v2.0 hierarchy changes (renamed types, changed inheritance, removed members) or a pre-existing issue?
       - Fix v2.0-caused failures by updating test expectations to match the new hierarchy (e.g., if a test checks `typeof(X).BaseType == typeof(Y)` and the base changed, update the test)
       - Do NOT change the test's intent -- only update to reflect the legitimate structural changes
       - Re-run until all tests pass
    4. Record the final test count. It MUST be >= 1,039 (the v1.0 baseline from Phase 16)
    5. If any tests were REMOVED (not just updated), document why and confirm the functionality is still tested elsewhere

    If the UltimateCompression ProjectReference was commented out in Task 1, count how many tests were in Compression-related test files to understand the delta. Those tests are blocked by upstream API changes, not by v2.0 work.
  </action>
  <verify>
    `dotnet test DataWarehouse.Tests/DataWarehouse.Tests.csproj` exits with code 0 (all tests pass).
    Capture and record: "X tests passed, 0 failed, Y skipped. Baseline: >= 1,039."
  </verify>
  <done>
    All existing tests pass. Test count >= 1,039 confirmed. Any failures were v2.0-caused and fixed without changing test intent. Regression baseline established for TEST-04.
  </done>
</task>

</tasks>

<verification>
- `dotnet build DataWarehouse.slnx` succeeds with zero v2.0 errors (TEST-01)
- `dotnet test` passes all existing tests (TEST-04)
- Zero new compiler warnings (TEST-06 partial -- full build verification)
- Pre-existing upstream errors documented with justification
</verification>

<success_criteria>
- TEST-01: Full solution builds with zero v2.0 errors
- TEST-04: All 1,039+ existing tests pass
- TEST-06: Roslyn analyzer clean pass (zero warnings, no new suppressions)
- Pre-existing upstream errors (SharpCompress 12, MQTTnet 2) documented as non-v2.0
</success_criteria>

<output>
After completion, create `.planning/phases/30-testing-final-verification/30-01-SUMMARY.md`
</output>
