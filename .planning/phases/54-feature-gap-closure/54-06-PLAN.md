---
phase: 54-feature-gap-closure
plan: 06
type: execute
wave: 2
depends_on: [54-02]
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateEncryption/Strategies/**
  - Plugins/DataWarehouse.Plugins.UltimateKeyManagement/Strategies/**
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/**
  - Plugins/DataWarehouse.Plugins.UltimateBlockchain/Strategies/**
  - Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/**
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/**
autonomous: true

must_haves:
  truths:
    - "Post-quantum crypto (CRYSTALS-Kyber, Dilithium, SPHINCS+) fully implemented"
    - "Advanced key management (HSM rotation, key derivation, QKD) fully operational"
    - "Policy engines (XACML, OPA, Cedar) production-ready"
    - "GPU acceleration and AI processing features complete"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateEncryption/Strategies/"
      provides: "Post-quantum and advanced encryption at 100%"
    - path: "Plugins/DataWarehouse.Plugins.UltimateKeyManagement/Strategies/"
      provides: "Advanced key management at 100%"
  key_links:
    - from: "UltimateEncryption post-quantum"
      to: "encryption.* bus topics"
      via: "crypto-agility engine"
      pattern: "CryptoAgility|PostQuantum"
---

<objective>
Medium Effort: Domain 3-4 features at 50-79% — Security (108 features) + Media (28 features) = ~136 features.

Purpose: Complete the significant-work security and media features. Post-quantum crypto, advanced key management, and policy engines are critical for military/government (Tier 6) and regulated (Tier 5) deployments. GPU acceleration and AI processing are needed for real-time (Tier 4) use cases.

Output: ~136 features moved from 50-79% to 100% across encryption, key management, access control, blockchain, media, and data format plugins.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/PLUGIN-CATALOG.md
@.planning/phases/42-feature-verification-matrix/significant-items-triage.md
@.planning/phases/54-feature-gap-closure/54-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Security — Post-Quantum Crypto, Key Management, Policy Engines (108 features)</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateEncryption/Strategies/**
    Plugins/DataWarehouse.Plugins.UltimateKeyManagement/Strategies/**
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/**
    Plugins/DataWarehouse.Plugins.UltimateBlockchain/Strategies/**
  </files>
  <action>
Complete all Domain 3 features at 50-79%.

**Post-Quantum Cryptography (10 strategies at 55-60%)**:
- CRYSTALS-Kyber (60%): Integrate BouncyCastle's Kyber implementation (already a dependency). Implement key encapsulation (KEM): KeyGen, Encapsulate, Decapsulate. Support parameter sets: Kyber512, Kyber768, Kyber1024. Add key serialization, hybrid mode (Kyber + X25519 for transition).
- CRYSTALS-Dilithium (60%): Integrate BouncyCastle's Dilithium. Implement digital signatures: KeyGen, Sign, Verify. Support parameter sets: Dilithium2, Dilithium3, Dilithium5. Add deterministic and hedged signing modes.
- SPHINCS+ (55%): Integrate BouncyCastle's SPHINCS+. Hash-based signatures: KeyGen, Sign, Verify. Support SHA-256 and SHAKE-256 instantiations. Small vs fast parameter trade-off.
- NTRU (55%): Integrate BouncyCastle's NTRU. KEM operations, parameter sets (HPS2048509, HPS2048677, HRSS701).
- Remaining PQC (6): McEliece, BIKE, HQC, FrodoKEM, SABER, Classic McEliece — implement where BouncyCastle provides support, stub with proper UnsupportedAlgorithmException where not.

**Advanced Key Management (15 strategies at 60-70%)**:
- HSM key rotation (70%): Automated rotation scheduling with configurable intervals, key versioning, old-key retention policy, rotation audit trail, emergency rotation trigger
- Key derivation advanced (65%): HKDF-SHA256/SHA384/SHA512, HKDF-Extract and HKDF-Expand separately, application-specific info parameter, salt management
- QKD integration (55%): Quantum Key Distribution protocol abstraction, BB84/E91/B92 protocol interfaces, key rate monitoring, quantum bit error rate tracking. Note: actual QKD requires hardware — implement protocol layer with simulation fallback.
- TPM 2.0 advanced (60%): Platform Configuration Register (PCR) measurement, sealed key operations, attestation key management, secure boot chain verification
- Remaining key management (11): Complete key escrow, key archival, key recovery, key agreement (ECDH/X25519), key wrapping (AES-KWP, RSA-OAEP)

**Policy Engines (78 remaining at 50-70%)**:
- XACML engine (60%): Complete policy evaluation (target matching, rule combining algorithms — deny-overrides, permit-overrides, first-applicable), attribute retrieval from PIP, obligation/advice handling
- OPA integration (55%): Rego policy evaluation via OPA REST API, policy bundle management, decision logging, partial evaluation for complex policies
- Cedar integration (50%): AWS Cedar policy language parsing, entity-based authorization, schema validation
- Remaining policies: Attribute-based access control evaluation caching, role hierarchy traversal optimization, permission delegation chains

**Blockchain Optimization (5 strategies at 60-65%)**:
- L2 anchoring optimization: Batch anchoring (group multiple proofs into single transaction), Merkle root anchoring, gas estimation and optimization, rollup-style compression
- Chain selection: Ethereum, Hyperledger, custom chain — runtime selection based on cost/finality/throughput trade-offs

Pattern: PQC strategies should use BouncyCastle where available. All crypto operations MUST be in UltimateEncryption — no inline crypto elsewhere. Key management operations MUST be in UltimateKeyManagement.
  </action>
  <verify>
dotnet build DataWarehouse.slnx — zero errors
PQC algorithms: KeyGen, Encrypt/Sign, Decrypt/Verify all functional
Key rotation: scheduling, versioning, audit trail operational
Policy engines: policy evaluation returns allow/deny with explanation
  </verify>
  <done>All 108 Domain 3 features at 50-79% brought to 100%</done>
</task>

<task type="auto">
  <name>Task 2: Media — GPU Acceleration, AI Processing, Advanced Video (28 features)</name>
  <files>
    Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/**
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/**
  </files>
  <action>
Complete all Domain 4 features at 50-79%.

**GPU Acceleration (3 strategies at 50-60%)**:
- CUDA detection/fallback (60%): nvidia-smi detection with caching, GPU memory check before model loading, multi-GPU selection (least-utilized), graceful CPU fallback with logging, GPU health monitoring
- NVENC/QuickSync/AMF detection (55%): Hardware encoder capability detection via FFmpeg device enumeration, fallback chain (NVENC -> QSV -> AMF -> CPU), encoder preset mapping per hardware
- GPU memory management (55%): Allocation tracking with configurable limits, OOM prevention with early warning, shared GPU context management, memory pool with defragmentation

**AI Processing (5 strategies at 50-60%)**:
- ONNX model loading (60%): Model inference pipeline — load model, validate input shape, run inference, post-process output. Support CPU and GPU execution providers. Model versioning and hot-swap. Memory-mapped model loading for large models.
- AI upscaling (55%): Super-resolution via ONNX model, configurable scale factors (2x, 4x), input image preprocessing (normalize, pad to model input size), output post-processing (de-normalize, crop)
- Object detection (50%): YOLO-style detection via ONNX, non-max suppression, confidence thresholds, bounding box output, class label mapping
- Face detection (50%): RetinaFace or MTCNN via ONNX, face bounding boxes, landmark detection, face alignment for recognition
- Speech-to-text (50%): Whisper model via ONNX, audio preprocessing (resample to 16kHz, mono), token decoding, language detection

**Advanced Video (6 strategies at 20-60%)**:
- 3D video (30%): Side-by-side and top-bottom stereoscopic, frame packing, depth map extraction
- 360-degree video (25%): Equirectangular projection, cubemap conversion, viewport extraction
- VR video (20%): Head-tracked viewport rendering, foveated encoding regions, motion-to-photon latency tracking
- HDR to SDR tone mapping (55%): Reinhard, Hable, ACES tone mapping operators, peak luminance detection, gamut mapping (BT.2020 -> BT.709)
- Point cloud processing (40%): PLY/PCD format parsing, voxel grid downsampling, nearest-neighbor search, normal estimation
- Process mining (35%): Event log parsing (XES format), directly-follows graph, process model discovery (Alpha algorithm)

**Audio/Image (14 remaining)**:
- RAW format processing: Bayer pattern demosaicing, white balance, exposure compensation
- HDR image merging: Exposure fusion, ghost removal, tone mapping

Pattern: All AI/ML features should use ONNX Runtime for inference. Model files should be loaded from configurable paths, not bundled. GPU features need graceful CPU fallback.
  </action>
  <verify>
dotnet build DataWarehouse.slnx — zero errors
GPU strategies: detection works, CPU fallback verified
AI strategies: ONNX model loading path configurable, inference pipeline complete
Video strategies: format conversion produces valid output
  </verify>
  <done>All 28 Domain 4 features at 50-79% brought to 100%</done>
</task>

</tasks>

<verification>
- dotnet build DataWarehouse.slnx succeeds with 0 errors, 0 warnings
- dotnet test passes all existing tests
- All crypto operations in owning plugins only (AD-11)
</verification>

<success_criteria>
- ~136 features (108 Domain 3 + 28 Domain 4) moved from 50-79% to 100%
- Zero build errors or warnings
</success_criteria>

<output>
After completion, create `.planning/phases/54-feature-gap-closure/54-06-SUMMARY.md`
</output>
