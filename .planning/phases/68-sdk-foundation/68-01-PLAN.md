---
phase: 68-sdk-foundation
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - DataWarehouse.SDK/Contracts/Policy/PolicyTypes.cs
  - DataWarehouse.SDK/Contracts/Policy/PolicyEnums.cs
  - DataWarehouse.SDK/Contracts/Policy/MetadataResidencyTypes.cs
autonomous: true
user_setup: []

must_haves:
  truths:
    - "PolicyLevel enum has exactly 5 values: Block, Chunk, Object, Container, VDE"
    - "CascadeStrategy enum has exactly 5 values: MostRestrictive, Enforce, Inherit, Override, Merge"
    - "AiAutonomyLevel enum has exactly 5 values: ManualOnly, Suggest, SuggestExplain, AutoNotify, AutoSilent"
    - "OperationalProfile record has 5 named presets: Speed, Balanced, Standard, Strict, Paranoid plus support for custom profiles"
    - "QuorumAction enum defines all 7 required actions"
    - "MetadataResidencyMode enum has 3 values: VdeOnly, VdePrimary, PluginOnly"
    - "WriteStrategy enum has 3 values: Atomic, VdeFirstSync, VdeFirstLazy"
    - "ReadStrategy enum has 2 values: VdeFallback, VdeStrict"
    - "CorruptionAction enum has 4 values: FallbackAndRepair, FallbackOnly, FailAndAlert, Quarantine"
    - "All types compile with zero errors and zero warnings"
  artifacts:
    - path: "DataWarehouse.SDK/Contracts/Policy/PolicyTypes.cs"
      provides: "FeaturePolicy, PolicyResolutionContext, AuthorityChain, QuorumPolicy, OperationalProfile models"
      contains: "class FeaturePolicy"
    - path: "DataWarehouse.SDK/Contracts/Policy/PolicyEnums.cs"
      provides: "PolicyLevel, CascadeStrategy, AiAutonomyLevel, QuorumAction enums"
      contains: "enum PolicyLevel"
    - path: "DataWarehouse.SDK/Contracts/Policy/MetadataResidencyTypes.cs"
      provides: "MetadataResidencyMode, WriteStrategy, ReadStrategy, CorruptionAction enums"
      contains: "enum MetadataResidencyMode"
  key_links: []
---

<objective>
Create all policy model types, enums, and metadata residency types for the v6.0 Policy Engine SDK foundation.

Purpose: These types are the building blocks referenced by every subsequent v6.0 phase. Every interface, every plugin extension, every cascade algorithm depends on these type definitions existing first.

Output: Three files in `DataWarehouse.SDK/Contracts/Policy/` containing all enums and record/class types needed by SDKF-02 through SDKF-09 and MRES-01 through MRES-04.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@DataWarehouse.SDK/Contracts/PluginBase.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Policy enums and model types</name>
  <files>
    DataWarehouse.SDK/Contracts/Policy/PolicyEnums.cs
    DataWarehouse.SDK/Contracts/Policy/PolicyTypes.cs
  </files>
  <action>
Create directory `DataWarehouse.SDK/Contracts/Policy/`.

**PolicyEnums.cs** — namespace `DataWarehouse.SDK.Contracts.Policy`:

1. `PolicyLevel` enum (SDKF-03): `Block = 0, Chunk = 1, Object = 2, Container = 3, VDE = 4`. XML doc each value describing what granularity it controls. Add `[Description]` attributes.

2. `CascadeStrategy` enum (SDKF-04): `MostRestrictive = 0, Enforce = 1, Inherit = 2, Override = 3, Merge = 4`. XML doc: MostRestrictive picks the tightest policy in the chain; Enforce at higher level always wins over Override at lower; Inherit copies parent unchanged; Override replaces parent entirely; Merge combines policies per-key.

3. `AiAutonomyLevel` enum (SDKF-05): `ManualOnly = 0, Suggest = 1, SuggestExplain = 2, AutoNotify = 3, AutoSilent = 4`. XML doc each level describing the AI's permission to act.

4. `QuorumAction` enum (SDKF-08): `OverrideAi = 0, ChangeSecurityPolicy = 1, DisableAi = 2, ModifyQuorum = 3, DeleteVde = 4, ExportKeys = 5, DisableAudit = 6`. XML doc each action.

5. `OperationalProfilePreset` enum (SDKF-06): `Speed = 0, Balanced = 1, Standard = 2, Strict = 3, Paranoid = 4, Custom = 5`. Represents the named presets.

**PolicyTypes.cs** — namespace `DataWarehouse.SDK.Contracts.Policy`:

1. `FeaturePolicy` sealed record (SDKF-02):
   - `string FeatureId` (e.g., "compression", "encryption", "replication")
   - `PolicyLevel Level` — at which granularity this policy applies
   - `int IntensityLevel` — 0-100 feature intensity
   - `CascadeStrategy Cascade` — how this policy cascades
   - `AiAutonomyLevel AiAutonomy` — AI permission for this feature
   - `Dictionary<string, string>? CustomParameters` — arbitrary config
   - XML docs on every property.

2. `PolicyResolutionContext` sealed record (SDKF-09):
   - `string Path` — VDE path being resolved (e.g., "/container1/object2/chunk3")
   - `string? UserId` — current user
   - `string? TenantId` — tenant context
   - `HardwareContext? Hardware` — hardware info
   - `SecurityContext? Security` — security info
   - `DateTimeOffset Timestamp` — resolution time

3. `HardwareContext` sealed record: `long AvailableMemoryBytes`, `int CpuCoreCount`, `string? StorageType` (SSD/HDD/NVMe), `bool HasHardwareAcceleration`, `double? ThermalThrottlePercent`.

4. `SecurityContext` sealed record: `string? ClearanceLevel`, `bool IsFipsMode`, `bool IsAirGapped`, `string[]? ActiveComplianceFrameworks`.

5. `AuthorityChain` sealed record (SDKF-07):
   - `AuthorityLevel[] Levels` — ordered from highest to lowest authority
   - Static factory `Default()` returning the standard chain: Quorum -> AiEmergency -> Admin -> SystemDefaults.

6. `AuthorityLevel` sealed record: `string Name`, `int Priority` (lower = higher authority), `bool RequiresQuorum`.

7. `QuorumPolicy` sealed record (SDKF-08):
   - `int RequiredApprovals` — e.g., 3 for 3-of-5
   - `int TotalMembers` — e.g., 5
   - `TimeSpan ApprovalWindow` — time limit for gathering approvals
   - `QuorumAction[] ProtectedActions` — which actions require quorum
   - XML docs on every property.

8. `OperationalProfile` sealed record (SDKF-06):
   - `OperationalProfilePreset Preset`
   - `string Name` — human-readable name
   - `Dictionary<string, FeaturePolicy> FeaturePolicies` — per-feature overrides
   - Static factory methods: `Speed()`, `Balanced()`, `Standard()`, `Strict()`, `Paranoid()` each returning a profile with sensible defaults (Speed has low security/high performance; Paranoid has max security/min AI autonomy).

Use file-scoped namespaces where the codebase uses block-scoped namespaces with braces (check existing files — most use block-scoped). Follow the existing pattern.
  </action>
  <verify>
Run `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj --no-restore` and confirm zero errors from these files. Grep for all enum values and record types to confirm presence.
  </verify>
  <done>
All 5 enums (PolicyLevel, CascadeStrategy, AiAutonomyLevel, QuorumAction, OperationalProfilePreset) present with all specified values. All 8 record/class types (FeaturePolicy, PolicyResolutionContext, HardwareContext, SecurityContext, AuthorityChain, AuthorityLevel, QuorumPolicy, OperationalProfile) present with all specified properties. Every type has XML documentation. Compiles clean.
  </done>
</task>

<task type="auto">
  <name>Task 2: Metadata residency types</name>
  <files>
    DataWarehouse.SDK/Contracts/Policy/MetadataResidencyTypes.cs
  </files>
  <action>
**MetadataResidencyTypes.cs** — namespace `DataWarehouse.SDK.Contracts.Policy`:

1. `MetadataResidencyMode` enum (MRES-01): `VdeOnly = 0, VdePrimary = 1, PluginOnly = 2`. XML doc:
   - VdeOnly: metadata lives exclusively in VDE inode fields; no plugin fallback.
   - VdePrimary: metadata lives in VDE with plugin as Tier 2 fallback on corruption.
   - PluginOnly: metadata managed entirely by plugin (e.g., hardware-backed keys in HSM); VDE inode fields remain empty for this feature.

2. `WriteStrategy` enum (MRES-02): `Atomic = 0, VdeFirstSync = 1, VdeFirstLazy = 2`. XML doc:
   - Atomic: write to VDE and plugin in same transaction; rollback both on failure.
   - VdeFirstSync: write VDE first, then synchronously write plugin copy.
   - VdeFirstLazy: write VDE immediately, plugin copy flushed on configurable interval.

3. `ReadStrategy` enum (MRES-03): `VdeFallback = 0, VdeStrict = 1`. XML doc:
   - VdeFallback: read VDE first; on corruption or empty field, fall back to plugin metadata.
   - VdeStrict: read VDE only; fail if VDE metadata is corrupt or missing (no fallback).

4. `CorruptionAction` enum (MRES-04 / MRES-09): `FallbackAndRepair = 0, FallbackOnly = 1, FailAndAlert = 2, Quarantine = 3`. XML doc:
   - FallbackAndRepair: fall back to plugin metadata, auto-repair VDE copy, emit CorruptionDetected bus event.
   - FallbackOnly: fall back to plugin metadata, log discrepancy, do not auto-repair.
   - FailAndAlert: fail the operation, emit alert, require manual intervention.
   - Quarantine: isolate the corrupt object, prevent further reads/writes until repaired.

5. `MetadataResidencyConfig` sealed record:
   - `MetadataResidencyMode Mode`
   - `WriteStrategy Write`
   - `ReadStrategy Read`
   - `CorruptionAction OnCorruption`
   - `TimeSpan? LazyFlushInterval` — only used when Write is VdeFirstLazy (default 30s)
   - Static factory `Default()` returning VdePrimary + VdeFirstSync + VdeFallback + FallbackAndRepair.

6. `FieldResidencyOverride` sealed record (MRES-10 — per-field fallback within single inode):
   - `string FieldName` — inode field identifier
   - `MetadataResidencyMode Mode` — override mode for this specific field
   - XML doc explaining that this enables mixed-state inodes where some fields are Tier 1 (VDE) and others are Tier 2 (plugin).

All enums use `[Description]` attributes matching the XML doc summaries.
  </action>
  <verify>
Run `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj --no-restore` and confirm zero errors. Verify all 4 enums and 2 records exist with correct values.
  </verify>
  <done>
MetadataResidencyMode (3 values), WriteStrategy (3 values), ReadStrategy (2 values), CorruptionAction (4 values) all present with XML docs and Description attributes. MetadataResidencyConfig and FieldResidencyOverride records present. Compiles clean.
  </done>
</task>

</tasks>

<verification>
- `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` completes with 0 errors, 0 warnings from new files
- All enum values match REQUIREMENTS.md exactly (SDKF-03, SDKF-04, SDKF-05, SDKF-06, SDKF-08, MRES-01, MRES-02, MRES-03, MRES-04)
- Every public type has XML documentation
- Namespace is `DataWarehouse.SDK.Contracts.Policy`
</verification>

<success_criteria>
9 enums and 10 record/class types compile cleanly in the SDK. All values documented. Ready for Plan 02 to reference these types in interface definitions.
</success_criteria>

<output>
After completion, create `.planning/phases/68-sdk-foundation/68-01-SUMMARY.md`
</output>
