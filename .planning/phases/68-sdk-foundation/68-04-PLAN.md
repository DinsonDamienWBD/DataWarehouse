---
phase: 68-sdk-foundation
plan: 04
type: execute
wave: 4
depends_on: ["68-01", "68-02", "68-03"]
files_modified: []
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Full solution builds with 0 errors and 0 warnings after all Phase 68 SDK changes"
    - "UltimateIntelligencePlugin does NOT inherit from IntelligenceAwarePluginBase (analyzer confirmed)"
    - "All 53 plugins compile without any modifications (PolicyContext inherited automatically)"
    - "No SDK file references anything outside DataWarehouse.SDK (SDK-only dependency check)"
    - "All 9 enums have all specified values present"
    - "All 5 interfaces have all specified methods present"
  artifacts: []
  key_links:
    - from: "DataWarehouse.SDK/Contracts/PluginBase.cs"
      to: "DataWarehouse.SDK/Contracts/Policy/PolicyContext.cs"
      via: "PolicyContext property"
      pattern: "PolicyContext"
    - from: "DataWarehouse.SDK/Contracts/IntelligenceAware/IntelligenceAwarePluginBase.cs"
      to: "DataWarehouse.SDK/Contracts/Policy/IAiHook.cs"
      via: "implements IAiHook"
      pattern: "IAiHook"
    - from: "DataWarehouse.SDK/Contracts/Policy/IPolicyEngine.cs"
      to: "DataWarehouse.SDK/Contracts/Policy/PolicyTypes.cs"
      via: "method parameters and return types"
      pattern: "FeaturePolicy|PolicyResolutionContext|OperationalProfile"
    - from: "DataWarehouse.SDK/Contracts/Policy/IMetadataResidencyResolver.cs"
      to: "DataWarehouse.SDK/Contracts/Policy/MetadataResidencyTypes.cs"
      via: "method parameters and return types"
      pattern: "MetadataResidencyConfig|FieldResidencyOverride"
---

<objective>
Verify the complete Phase 68 SDK Foundation: full solution build, UltimateIntelligence isolation check, SDK-only dependency audit, and comprehensive type/interface inventory.

Purpose: This is the quality gate ensuring all Phase 68 deliverables are correct before downstream phases (69-95) build on these contracts. A single compilation error here would cascade into every subsequent phase.

Output: Verification report confirming all 8 success criteria from the Phase 68 roadmap entry.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/REQUIREMENTS.md
@.planning/phases/68-sdk-foundation/68-01-SUMMARY.md
@.planning/phases/68-sdk-foundation/68-02-SUMMARY.md
@.planning/phases/68-sdk-foundation/68-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Full solution build and comprehensive verification</name>
  <files></files>
  <action>
Run a complete verification covering all 8 Phase 68 success criteria:

**1. Full solution build (Success Criterion 8):**
```bash
dotnet build DataWarehouse.sln --configuration Release 2>&1
```
Must produce 0 errors and 0 warnings from any Phase 68 files. If there are pre-existing warnings from other files, note them but do not count them as Phase 68 failures.

**2. IPolicyEngine, IEffectivePolicy, IPolicyStore, IPolicyPersistence compile (SC 1):**
Grep each interface file to confirm it exists and contains the interface declaration. Count methods/properties per interface.

**3. PluginBase PolicyContext (SC 2):**
Grep `PluginBase.cs` for `PolicyContext` property. Verify it defaults to `PolicyContext.Empty`. Verify all 53 plugins compile without changes â€” the full solution build in step 1 covers this.

**4. IntelligenceAwarePluginBase AI hooks (SC 3):**
Grep `IntelligenceAwarePluginBase.cs` for `IAiHook`, `ObservationEmitter`, `RecommendationReceiver`. All three must be present.

**5. UltimateIntelligence isolation (SC 4):**
```bash
grep -n "class UltimateIntelligencePlugin" Plugins/DataWarehouse.Plugins.UltimateIntelligence/UltimateIntelligencePlugin.cs
```
Must show inheritance from `DataTransformationPluginBase` (or another PluginBase descendant), NOT `IntelligenceAwarePluginBase`.

Additionally, verify no plugin in the Intelligence folder implements IAiHook directly:
```bash
grep -r "IAiHook" Plugins/DataWarehouse.Plugins.UltimateIntelligence/ --include="*.cs"
```
Must return 0 results.

**6. All 5 policy enums (SC 5):**
Grep for each enum and verify values:
- `PolicyLevel`: Block, Chunk, Object, Container, VDE (5 values)
- `CascadeStrategy`: MostRestrictive, Enforce, Inherit, Override, Merge (5 values)
- `AiAutonomyLevel`: ManualOnly, Suggest, SuggestExplain, AutoNotify, AutoSilent (5 values)
- `OperationalProfilePreset`: Speed, Balanced, Standard, Strict, Paranoid, Custom (6 values)
- `QuorumAction`: OverrideAi, ChangeSecurityPolicy, DisableAi, ModifyQuorum, DeleteVde, ExportKeys, DisableAudit (7 values)

**7. All 4 metadata residency enums (SC 6):**
- `MetadataResidencyMode`: VdeOnly, VdePrimary, PluginOnly (3 values)
- `WriteStrategy`: Atomic, VdeFirstSync, VdeFirstLazy (3 values)
- `ReadStrategy`: VdeFallback, VdeStrict (2 values)
- `CorruptionAction`: FallbackAndRepair, FallbackOnly, FailAndAlert, Quarantine (4 values)

**8. IMetadataResidencyResolver per-field (SC 7):**
Grep for `IMetadataResidencyResolver` and verify:
- `ResolveAsync` method exists (per-feature, per-metadata-type)
- `ResolveFieldOverridesAsync` method exists (per-field fallback)
- `ShouldFallbackToPlugin` method exists (hot-path per-field check)

**9. SDK-only dependency check:**
```bash
grep -r "ProjectReference" DataWarehouse.SDK/DataWarehouse.SDK.csproj
```
Must NOT reference any plugin project. SDK must be self-contained.

Produce a verification report table:

| # | Criterion | Status | Evidence |
|---|-----------|--------|----------|
| 1 | Interfaces compile (IPolicyEngine, IEffectivePolicy, IPolicyStore, IPolicyPersistence) | PASS/FAIL | ... |
| 2 | PluginBase has PolicyContext | PASS/FAIL | ... |
| 3 | IntelligenceAwarePluginBase has IAiHook + ObservationEmitter + RecommendationReceiver | PASS/FAIL | ... |
| 4 | UltimateIntelligence inherits PluginBase chain, NOT IntelligenceAwarePluginBase | PASS/FAIL | ... |
| 5 | All 5 policy enums present with all values | PASS/FAIL | ... |
| 6 | All 4 MRES enums present with all values | PASS/FAIL | ... |
| 7 | IMetadataResidencyResolver with per-field fallback | PASS/FAIL | ... |
| 8 | Full solution builds 0 errors 0 warnings | PASS/FAIL | ... |

If ANY criterion fails, fix it immediately (this plan has permission to modify any Phase 68 file to fix issues). Re-run verification after fixes until all 8 pass.
  </action>
  <verify>
All 8 rows in the verification table show PASS. `dotnet build DataWarehouse.sln` exits with code 0.
  </verify>
  <done>
All 8 Phase 68 success criteria verified: interfaces compile (SDKF-01), PolicyContext on PluginBase (SDKF-10), IAiHook on IntelligenceAwarePluginBase (SDKF-11), UltimateIntelligence isolation confirmed (SDKF-12), all policy enums present (SDKF-03/04/05/06/08), all MRES enums present (MRES-01/02/03/04), IMetadataResidencyResolver with per-field fallback (MRES-02/10), full solution builds clean. Phase 68 COMPLETE.
  </done>
</task>

</tasks>

<verification>
- Full solution `dotnet build DataWarehouse.sln --configuration Release` exits 0
- Verification report table shows 8/8 PASS
- No regression in existing tests (run `dotnet test` if test projects exist)
</verification>

<success_criteria>
Phase 68 SDK Foundation verified complete. All contracts defined, all plugins policy-aware, UltimateIntelligence isolated, solution builds clean. Ready for Phase 69 (Policy Persistence) and Phase 70 (Cascade Engine).
</success_criteria>

<output>
After completion, create `.planning/phases/68-sdk-foundation/68-04-SUMMARY.md`
</output>
