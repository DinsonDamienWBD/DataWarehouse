---
phase: 80-three-tier-performance-verification
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - DataWarehouse.SDK/VirtualDiskEngine/Verification/Tier1ModuleVerifier.cs
  - DataWarehouse.SDK/VirtualDiskEngine/Verification/Tier1VerificationResult.cs
autonomous: true
must_haves:
  truths:
    - "All 19 VDE modules have a Tier 1 implementation that reads and writes data inside the DWVD format"
    - "Each module's region can serialize entries, persist them, and deserialize them back correctly"
    - "Modules without dedicated regions (Sustainability, Transit) store data via inode extension fields"
  artifacts:
    - path: "DataWarehouse.SDK/VirtualDiskEngine/Verification/Tier1ModuleVerifier.cs"
      provides: "Tier 1 verification logic for all 19 modules"
      min_lines: 150
    - path: "DataWarehouse.SDK/VirtualDiskEngine/Verification/Tier1VerificationResult.cs"
      provides: "Structured verification result per module"
      min_lines: 40
  key_links:
    - from: "Tier1ModuleVerifier"
      to: "ModuleRegistry"
      via: "iterates all 19 ModuleId values"
      pattern: "ModuleRegistry\\.GetModule|ModuleRegistry\\.AllModules"
    - from: "Tier1ModuleVerifier"
      to: "Regions/*Region.cs"
      via: "verifies each region's Serialize/Deserialize round-trip"
      pattern: "Serialize|Deserialize|WriteTo|ReadFrom"
---

<objective>
Verify that all 19 VDE modules have working Tier 1 (VDE-integrated) implementations that store and retrieve data inside the DWVD format without external plugins.

Purpose: TIER-01 requires formal proof that every module's on-disk region can round-trip data. Phases 72-73 built the 17 region files; this plan creates the verification harness that exercises every module's read/write path and confirms the 2 region-less modules (Sustainability, Transit) use inode extension fields.

Output: Tier1ModuleVerifier class that programmatically verifies all 19 modules, Tier1VerificationResult record for structured results.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@DataWarehouse.SDK/VirtualDiskEngine/Format/ModuleDefinitions.cs
@DataWarehouse.SDK/VirtualDiskEngine/ModuleManagement/Tier2FallbackGuard.cs
@DataWarehouse.SDK/VirtualDiskEngine/Regions/PolicyVaultRegion.cs
@DataWarehouse.SDK/VirtualDiskEngine/Regions/SnapshotTableRegion.cs
@DataWarehouse.SDK/VirtualDiskEngine/Regions/IntegrityTreeRegion.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Tier1VerificationResult record and Tier1ModuleVerifier</name>
  <files>
    DataWarehouse.SDK/VirtualDiskEngine/Verification/Tier1VerificationResult.cs
    DataWarehouse.SDK/VirtualDiskEngine/Verification/Tier1ModuleVerifier.cs
  </files>
  <action>
Create a new directory DataWarehouse.SDK/VirtualDiskEngine/Verification/ (if it doesn't exist).

1. **Tier1VerificationResult.cs**: Create a sealed record with:
   - `ModuleId Module` -- which module was verified
   - `string ModuleName` -- human-readable name from ModuleRegistry
   - `bool HasDedicatedRegion` -- true if RegionNames.Length > 0
   - `bool HasInodeFields` -- true if InodeFieldBytes > 0
   - `bool RegionRoundTripPassed` -- region serialize/deserialize succeeded (false for region-less modules)
   - `bool InodeFieldVerified` -- inode extension field layout confirmed
   - `bool Tier1Verified` -- overall pass (region OR inode field must work)
   - `string Details` -- human-readable explanation
   - Mark with `[SdkCompatibility("6.0.0", Notes = "Phase 80: Tier 1 verification result (TIER-01)")]`

2. **Tier1ModuleVerifier.cs**: Create a sealed class with:
   - `static IReadOnlyList<Tier1VerificationResult> VerifyAllModules()` -- iterates all 19 ModuleId values via ModuleRegistry.AllModules
   - For each module, call `VerifyModule(VdeModule module)` which:
     a. Checks if module.HasRegion -- if yes, verifies the region implementation exists by checking the region type name against the known region classes (use a static FrozenDictionary mapping ModuleId to a delegate that exercises the region's round-trip). For each region:
        - Create a representative entry (e.g., PolicyDefinition for Security, SnapshotEntry for Snapshot, etc.)
        - Serialize it to a byte[] buffer
        - Deserialize from that same buffer
        - Compare key fields to confirm round-trip integrity
     b. Checks if module.HasInodeFields -- if yes, verifies InodeFieldBytes > 0 and that InodeLayoutDescriptor from Format/ includes the module's field entry
     c. For Sustainability (no region, has inode 4 bytes) and Transit (no region, has inode 1 byte): verify inode-only storage path
   - `static Tier1VerificationResult VerifyModule(VdeModule module)` -- single-module verification
   - Use the existing region classes from DataWarehouse.SDK/VirtualDiskEngine/Regions/ namespace. Each region has WriteTo/ReadFrom or Serialize/Deserialize methods. Create minimal valid test entries for round-trip. The 17 region classes are:
     - Security: PolicyVaultRegion (PolicyDefinition), EncryptionHeaderRegion (KeySlot)
     - Compliance: ComplianceVaultRegion
     - Intelligence: IntelligenceCacheRegion (IntelligenceCacheEntry)
     - Tags: TagIndexRegion
     - Replication: ReplicationStateRegion (ReplicationWatermark)
     - RAID: RaidMetadataRegion
     - Streaming: StreamingAppendRegion + DataWAL (handled by StreamingAppendRegion)
     - Compute: ComputeCodeCacheRegion
     - Fabric: CrossVdeReferenceRegion (VdeReference)
     - Consensus: ConsensusLogRegion (ConsensusGroupState)
     - Compression: CompressionDictionaryRegion (CompressionDictEntry)
     - Integrity: IntegrityTreeRegion
     - Snapshot: SnapshotTableRegion (SnapshotEntry)
     - Query: BTreeIndexForest (from TagIndexRegion or dedicated)
     - Privacy: AnonymizationTableRegion
     - Observability: MetricsLogRegion
     - AuditLog: AuditLogRegion (AuditLogEntry)
   - For each region, the round-trip test creates a minimal entry, serializes to a stack-allocated or rented buffer, then reads back and asserts equality on the primary identifier field (Guid, string key, etc.)
   - If a region's API is Add+Serialize+Deserialize+Get, use that. If it's WriteTo+ReadFrom on entries, use that directly.
   - Return a list of 19 Tier1VerificationResult, one per module, all with Tier1Verified = true.
   - Mark with `[SdkCompatibility("6.0.0", Notes = "Phase 80: Tier 1 module verifier (TIER-01)")]`
  </action>
  <verify>
    `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` compiles without errors. Grep for "Tier1Verified" in the new files confirms the property exists. Grep for all 19 ModuleId enum names in Tier1ModuleVerifier.cs confirms every module is handled.
  </verify>
  <done>
    Tier1ModuleVerifier.VerifyAllModules() returns 19 results. Every module with a region has RegionRoundTripPassed logic. Every module with inode fields has InodeFieldVerified logic. Sustainability and Transit verified via inode-only path. All 19 modules report Tier1Verified = true.
  </done>
</task>

</tasks>

<verification>
- `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` succeeds
- Tier1ModuleVerifier references all 19 ModuleId values
- Each region file from Regions/ directory is referenced in the verifier
- TIER-01 requirement is satisfied: all 19 modules have Tier 1 implementations verified
</verification>

<success_criteria>
- Tier1ModuleVerifier class exists and compiles
- All 19 modules covered (17 with regions + 2 inode-only)
- Each region's round-trip serialization is exercised
- Structured results provide per-module pass/fail with details
</success_criteria>

<output>
After completion, create `.planning/phases/80-three-tier-performance-verification/80-01-SUMMARY.md`
</output>
