---
phase: 89-ecosystem-compatibility
plan: 08
type: execute
wave: 3
depends_on: ["89-07"]
files_modified:
  - DataWarehouse.SDK/Contracts/Ecosystem/TerraformProviderSpecification.cs
  - DataWarehouse.SDK/Contracts/Ecosystem/PulumiProviderSpecification.cs
  - DataWarehouse.SDK/Contracts/Ecosystem/HelmChartSpecification.cs
autonomous: true
must_haves:
  truths:
    - "Terraform provider specification defines resources for instances, VDEs, users, policies, plugins, replication"
    - "Pulumi provider specification bridges from Terraform provider schema"
    - "Helm chart specification defines StatefulSet, PVC, ConfigMap, Secret, Service, Ingress for single-node and clustered modes"
  artifacts:
    - path: "DataWarehouse.SDK/Contracts/Ecosystem/TerraformProviderSpecification.cs"
      provides: "Terraform provider schema and code generation for datawarehouse provider"
      exports: ["TerraformProviderSpecification", "TerraformResource", "TerraformDataSource"]
    - path: "DataWarehouse.SDK/Contracts/Ecosystem/PulumiProviderSpecification.cs"
      provides: "Pulumi bridge specification from Terraform provider"
      exports: ["PulumiProviderSpecification"]
    - path: "DataWarehouse.SDK/Contracts/Ecosystem/HelmChartSpecification.cs"
      provides: "Helm chart templates and values for Kubernetes deployment"
      exports: ["HelmChartSpecification"]
  key_links:
    - from: "DataWarehouse.SDK/Contracts/Ecosystem/TerraformProviderSpecification.cs"
      to: "DataWarehouse.SDK/Contracts/Ecosystem/SdkClientSpecification.cs"
      via: "Terraform resources map to SDK API operations"
      pattern: "SdkApiSurface"
    - from: "DataWarehouse.SDK/Contracts/Ecosystem/PulumiProviderSpecification.cs"
      to: "DataWarehouse.SDK/Contracts/Ecosystem/TerraformProviderSpecification.cs"
      via: "Pulumi bridges from Terraform schema"
      pattern: "TerraformProviderSpecification"
---

<objective>
Create Infrastructure-as-Code provider specifications and Helm chart (ECOS-13, ECOS-14, ECOS-15).

Purpose: Define the Terraform provider schema (resources and data sources), Pulumi bridge specification, and Helm chart templates as C# specification classes. These generate the Go code for the Terraform provider, the Pulumi bridge configuration, and the Helm chart YAML templates. Infrastructure teams can deploy DW with `terraform apply` or `helm install`.

Output: Terraform provider spec, Pulumi bridge spec, Helm chart spec
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@DataWarehouse.SDK/Contracts/Ecosystem/SdkClientSpecification.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Terraform provider specification</name>
  <files>DataWarehouse.SDK/Contracts/Ecosystem/TerraformProviderSpecification.cs</files>
  <action>
Create `TerraformProviderSpecification` with `[SdkCompatibility("6.0.0", Notes = "Phase 89: Terraform provider (ECOS-13)")]`.

This class defines the Terraform provider schema and generates Go code for `terraform-provider-datawarehouse`:

1. **Provider configuration schema:**
   - `host` (string, required) — DW server address
   - `port` (int, optional, default 5432) — connection port
   - `username` (string, required) — authentication user
   - `password` (string, required, sensitive) — authentication password
   - `tls_enabled` (bool, optional, default true) — enable TLS
   - `tls_skip_verify` (bool, optional, default false) — skip certificate verification

2. **Resources** (`IReadOnlyList<TerraformResource>`):
   - `datawarehouse_instance`: `name`, `storage_size_gb`, `replication_factor`, `plugins_enabled` (list), `operational_profile` (Speed/Balanced/Standard/Strict/Paranoid)
   - `datawarehouse_vde`: `instance_id`, `name`, `block_size`, `encryption_enabled`, `compression_codec`, `replication_mode`
   - `datawarehouse_user`: `instance_id`, `username`, `password` (sensitive), `roles` (list), `mfa_enabled`
   - `datawarehouse_policy`: `instance_id`, `name`, `target_path`, `feature`, `intensity_level`, `cascade_strategy`
   - `datawarehouse_plugin`: `instance_id`, `plugin_id`, `enabled`, `configuration` (map)
   - `datawarehouse_replication_topology`: `instance_id`, `mode` (active-active/active-passive), `nodes` (list of endpoint blocks), `sync_interval_seconds`

3. **Data sources** (`IReadOnlyList<TerraformDataSource>`):
   - `datawarehouse_instance_status`: returns health, node count, storage used
   - `datawarehouse_capabilities`: returns supported plugins, formats, protocols
   - `datawarehouse_plugin_catalog`: returns available plugins with versions

4. **`TerraformResource`** record: `string TypeName`, `string Description`, `IReadOnlyList<TerraformAttribute> Schema`, `TerraformCrudOperations Operations`

5. **`TerraformAttribute`** record: `string Name`, `TerraformAttrType Type` (String/Int/Bool/Float/List/Map/Block), `bool Required`, `bool Optional`, `bool Computed`, `bool Sensitive`, `bool ForceNew`, `object? Default`, `string Description`

6. **`GenerateProviderGoCode()`** method returning `IReadOnlyDictionary<string, string>` of Go source files:
   - `provider.go` — provider schema and configure
   - `resource_instance.go`, `resource_vde.go`, `resource_user.go`, `resource_policy.go`, `resource_plugin.go`, `resource_replication.go` — CRUD operations
   - `data_source_status.go`, `data_source_capabilities.go`, `data_source_catalog.go` — read-only data sources
   - `go.mod` — with `hashicorp/terraform-plugin-sdk/v2` dependency
   - Each resource Go file implements Create/Read/Update/Delete using the DW Go SDK (`datawarehouse-go` from 89-07)
  </action>
  <verify>`dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` compiles without errors</verify>
  <done>Terraform provider specification defines 6 resources, 3 data sources, and generates compilable Go provider code</done>
</task>

<task type="auto">
  <name>Task 2: Create Pulumi bridge and Helm chart specifications</name>
  <files>DataWarehouse.SDK/Contracts/Ecosystem/PulumiProviderSpecification.cs, DataWarehouse.SDK/Contracts/Ecosystem/HelmChartSpecification.cs</files>
  <action>
**PulumiProviderSpecification.cs** with `[SdkCompatibility("6.0.0", Notes = "Phase 89: Pulumi provider (ECOS-14)")]`:

1. **Pulumi bridge configuration:**
   - `ProviderName` = "datawarehouse"
   - `TerraformProviderSource` = "registry.terraform.io/datawarehouse/datawarehouse"
   - `Version` = "1.0.0"
   - `JavaScriptPackage` = "@datawarehouse/pulumi"
   - `PythonPackage` = "pulumi_datawarehouse"
   - `GoModule` = "github.com/datawarehouse/pulumi-datawarehouse/sdk/go/datawarehouse"
   - `DotNetPackage` = "DataWarehouse.Pulumi"

2. **Resource mapping** from Terraform resources to Pulumi classes:
   - `datawarehouse_instance` -> `DataWarehouse.Instance` (all languages)
   - `datawarehouse_vde` -> `DataWarehouse.Vde`
   - etc., for all 6 Terraform resources

3. **`GenerateBridgeConfig()`** returning bridge YAML and Go code for `pulumi-terraform-bridge` integration.

4. **`GeneratePulumiExamples()`** returning example code in Python, TypeScript, Go, and C# showing how to:
   - Create a DW instance with `new DataWarehouse.Instance("my-dw", { ... })`
   - Create a VDE within the instance
   - Configure replication topology

**HelmChartSpecification.cs** with `[SdkCompatibility("6.0.0", Notes = "Phase 89: Helm chart (ECOS-15)")]`:

1. **Chart metadata:**
   - `ChartName` = "datawarehouse"
   - `ChartVersion` = "1.0.0"
   - `AppVersion` = "6.0.0"
   - `Description` = "DataWarehouse — AI-native data warehouse"

2. **`values.yaml` defaults** (`HelmValues` record):
   - `replicaCount` = 1 (3 for clustered)
   - `image.repository` = "datawarehouse/datawarehouse"
   - `image.tag` = "6.0.0"
   - `resources.requests.cpu` = "500m", `memory` = "1Gi"
   - `resources.limits.cpu` = "4", `memory` = "8Gi"
   - `storage.size` = "100Gi", `storageClass` = "" (default)
   - `service.type` = "ClusterIP", `port` = 5432
   - `ingress.enabled` = false, `hosts`, `tls`
   - `operationalProfile` = "Balanced"
   - `plugins.enabled` = ["*"]
   - `tls.enabled` = true, `tls.secretName` = ""
   - `clustering.enabled` = false, `clustering.raftPort` = 8300

3. **Template generation** via `GenerateChartTemplates()` returning `IReadOnlyDictionary<string, string>`:
   - `Chart.yaml` — chart metadata
   - `values.yaml` — default values
   - `templates/statefulset.yaml` — StatefulSet with VolumeClaimTemplate, readiness/liveness probes, configurable replicas
   - `templates/service.yaml` — ClusterIP service on port 5432 (PostgreSQL wire protocol)
   - `templates/service-headless.yaml` — headless service for StatefulSet DNS (clustering)
   - `templates/configmap.yaml` — DW configuration (operational profile, plugin list)
   - `templates/secret.yaml` — admin credentials, TLS certificates
   - `templates/ingress.yaml` — optional Ingress with TLS
   - `templates/pvc.yaml` — PersistentVolumeClaim for data storage
   - `templates/tests/test-connection.yaml` — `helm test` pod that connects via psql
   - `templates/_helpers.tpl` — template helpers (fullname, labels, selector labels)
   - `templates/NOTES.txt` — post-install notes

4. **Deployment modes:**
   - Single-node: `replicaCount: 1`, no headless service, no Raft
   - Clustered: `replicaCount: 3+`, headless service, Raft consensus on port 8300, anti-affinity rules
  </action>
  <verify>`dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` compiles without errors</verify>
  <done>Pulumi bridge specification maps all Terraform resources with examples in 4 languages. Helm chart generates complete Kubernetes deployment templates for single-node and clustered modes.</done>
</task>

</tasks>

<verification>
- Terraform provider has 6 resources with full CRUD schemas and 3 data sources
- Generated Go code references terraform-plugin-sdk/v2
- Pulumi bridge maps all Terraform resources to Pulumi classes
- Helm chart generates valid YAML for StatefulSet, Service, ConfigMap, Secret, Ingress, PVC
- Helm chart supports both single-node and clustered deployment modes
- helm test template connects via psql
- Build succeeds
</verification>

<success_criteria>
`terraform apply` with the generated provider creates DW infrastructure. `helm install` deploys a DW cluster on Kubernetes. Pulumi wraps Terraform with idiomatic SDKs in 4 languages.
</success_criteria>

<output>
After completion, create `.planning/phases/89-ecosystem-compatibility/89-08-SUMMARY.md`
</output>
