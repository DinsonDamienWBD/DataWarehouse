---
phase: 89-ecosystem-compatibility
plan: 07
type: execute
wave: 2
depends_on: ["89-01"]
files_modified:
  - DataWarehouse.SDK/Contracts/Ecosystem/SdkContractGenerator.cs
  - DataWarehouse.SDK/Contracts/Ecosystem/SdkLanguageTemplates.cs
  - DataWarehouse.SDK/Contracts/Ecosystem/SdkClientSpecification.cs
autonomous: true
must_haves:
  truths:
    - "SDK contract specification defines idiomatic API surface for Python, Java, Go, Rust, and JavaScript/TypeScript"
    - "Code generator produces language-specific client stubs from proto definitions"
    - "Each language SDK specification includes connect, store, retrieve, query, tag, search, stream operations"
  artifacts:
    - path: "DataWarehouse.SDK/Contracts/Ecosystem/SdkContractGenerator.cs"
      provides: "Code generation engine producing multi-language SDK client code from proto definitions"
      exports: ["SdkContractGenerator"]
    - path: "DataWarehouse.SDK/Contracts/Ecosystem/SdkLanguageTemplates.cs"
      provides: "Language-specific templates for Python, Java, Go, Rust, JS/TS"
      exports: ["PythonTemplate", "JavaTemplate", "GoTemplate", "RustTemplate", "TypeScriptTemplate"]
    - path: "DataWarehouse.SDK/Contracts/Ecosystem/SdkClientSpecification.cs"
      provides: "SDK API specification defining idiomatic wrappers per language"
      exports: ["SdkClientSpecification"]
  key_links:
    - from: "DataWarehouse.SDK/Contracts/Ecosystem/SdkContractGenerator.cs"
      to: "DataWarehouse.SDK/Contracts/Ecosystem/ProtoServiceDefinitions.cs"
      via: "Reads proto mirror types to generate SDK code"
      pattern: "ProtoServiceDefinitions"
---

<objective>
Create multi-language SDK contract definitions and code generator (ECOS-07 through ECOS-11).

Purpose: Rather than writing actual Python/Java/Go/Rust/JS code, this plan creates the C# code generation engine that produces idiomatic client SDK code from the proto definitions (89-01). Each generated SDK wraps gRPC calls with language-idiomatic patterns (Python context managers, Go context.Context, Rust Result types, etc.). The generator is production-ready C# that outputs complete, compilable SDK source code.

Output: Code generator engine, language templates, SDK API specifications
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/89-ecosystem-compatibility/89-01-PLAN.md
@DataWarehouse.SDK/Contracts/Ecosystem/ProtoServiceDefinitions.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SDK API specification and client contract</name>
  <files>DataWarehouse.SDK/Contracts/Ecosystem/SdkClientSpecification.cs</files>
  <action>
Create `SdkClientSpecification` with `[SdkCompatibility("6.0.0", Notes = "Phase 89: Multi-language SDK specification (ECOS-07 through ECOS-11)")]`.

This class defines the canonical SDK API surface that every language SDK must implement, independent of language:

1. **`SdkApiSurface`** record containing:
   - `IReadOnlyList<SdkMethod> Methods` — all SDK methods
   - `IReadOnlyList<SdkType> Types` — all SDK types
   - `IReadOnlyList<SdkEnum> Enums` — all SDK enums

2. **`SdkMethod`** record: `string Name`, `string Description`, `string ServiceName`, `string RpcMethod`, `SdkType InputType`, `SdkType OutputType`, `bool IsStreaming`, `bool IsClientStreaming`

3. **`SdkType`** record: `string Name`, `IReadOnlyList<SdkField> Fields`
   **`SdkField`** record: `string Name`, `string Type`, `bool Nullable`, `string Description`
   **`SdkEnum`** record: `string Name`, `IReadOnlyList<(string Name, int Value)> Values`

4. **`SdkLanguageBinding`** record per language:
   - `SdkLanguage Language` (enum: Python, Java, Go, Rust, TypeScript)
   - `string PackageName` (e.g., "datawarehouse" for Python, "com.datawarehouse.sdk" for Java)
   - `string PackageVersion` = "1.0.0"
   - `IReadOnlyList<SdkIdiom> Idioms` — language-specific patterns

5. **`SdkIdiom`** record: `string Pattern`, `string Description`
   Idioms per language:
   - Python: context managers (`with dw.connect() as client:`), generators for streaming, type hints, pandas DataFrame integration
   - Java: Builder pattern, CompletableFuture for async, AutoCloseable, Maven coordinates
   - Go: `context.Context` first parameter, error returns (no exceptions), module path
   - Rust: `Result<T, Error>` return types, `impl Drop` for cleanup, `tokio::spawn` for async, crate name
   - TypeScript: Promise-based async, typed generics, npm package, ESM+CJS dual output

6. **`static SdkApiSurface BuildApiSurface()`** method that constructs the full API surface from the proto service definitions, mapping each RPC method to an SDK method with the canonical operations:
   - `connect(host, port, options)` -> connection handle
   - `store(key, data, metadata, tags)` -> store response
   - `retrieve(key)` -> data stream
   - `query(sql)` -> result iterator
   - `tag(key, tags)` -> tag response
   - `search(query, options)` -> result iterator
   - `stream_store(key, data_stream)` -> store response (streaming upload)
   - `subscribe(topic, filter)` -> event stream
   - `health()` -> health status
   - `capabilities()` -> capability list
  </action>
  <verify>`dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` compiles without errors</verify>
  <done>SDK API specification defines all operations with language-specific idioms for Python, Java, Go, Rust, and TypeScript</done>
</task>

<task type="auto">
  <name>Task 2: Create code generator engine and language templates</name>
  <files>DataWarehouse.SDK/Contracts/Ecosystem/SdkContractGenerator.cs, DataWarehouse.SDK/Contracts/Ecosystem/SdkLanguageTemplates.cs</files>
  <action>
**SdkContractGenerator.cs** with `[SdkCompatibility("6.0.0")]`:

Code generation engine that produces complete SDK client source code:

1. **`GenerateSdk(SdkLanguage language, SdkApiSurface surface, SdkLanguageBinding binding)`** returns `GeneratedSdkOutput`:
   - `IReadOnlyDictionary<string, string> Files` — filename -> content mapping
   - `string BuildFile` — package manifest (setup.py, pom.xml, go.mod, Cargo.toml, package.json)
   - `string ReadmeContent` — generated README with usage examples

2. **Generation pipeline:**
   - Maps `SdkApiSurface` methods to language-specific method signatures
   - Generates client class wrapping gRPC channel
   - Generates type definitions from `SdkType`
   - Generates enum definitions from `SdkEnum`
   - Generates connection factory with options
   - Generates streaming helpers (iterators/generators)
   - Applies language idioms from `SdkLanguageBinding`

3. **`GenerateAllSdks(SdkApiSurface surface)`** — convenience method generating all 5 languages.

**SdkLanguageTemplates.cs** with `[SdkCompatibility("6.0.0")]`:

Template definitions per language (using StringBuilder-based code generation, NOT string interpolation with user data):

1. **`PythonTemplate`**: Generates `client.py` (main client class with context manager), `types.py` (dataclasses), `__init__.py`, `setup.py` (PyPI package), `py.typed` (PEP 561). Client class uses `grpcio` for transport. Includes type hints throughout. Adds `to_dataframe()` on query results for pandas integration.

2. **`JavaTemplate`**: Generates `DataWarehouseClient.java` (AutoCloseable), `DataWarehouseTypes.java` (POJOs with builders), `pom.xml` (Maven, grpc-java dependency). Uses `CompletableFuture` for async operations. Includes JDBC driver class `DataWarehouseJdbcDriver` wrapping PostgreSQL wire protocol.

3. **`GoTemplate`**: Generates `client.go` (Client struct with methods), `types.go` (structs), `go.mod`. First parameter is always `ctx context.Context`. Returns `(T, error)`. Module path `github.com/datawarehouse/datawarehouse-go`.

4. **`RustTemplate`**: Generates `client.rs` (Client impl), `types.rs` (structs), `error.rs` (Error enum), `lib.rs`, `Cargo.toml` (tonic dependency). Returns `Result<T, DataWarehouseError>`. Implements `Drop` for cleanup.

5. **`TypeScriptTemplate`**: Generates `client.ts` (class with async methods), `types.ts` (interfaces), `index.ts`, `package.json` (grpc-js or grpc-web). Uses `Promise<T>` for async. Generates `.d.ts` type definitions. Supports both Node.js (grpc-js) and browser (grpc-web) targets.

Each template class implements `ILanguageTemplate` interface with `GenerateClient(SdkApiSurface, SdkLanguageBinding)`, `GenerateTypes(...)`, `GenerateBuildFile(...)`, `GenerateReadme(...)`.
  </action>
  <verify>`dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` compiles without errors</verify>
  <done>Code generator produces complete, idiomatic SDK source code for all 5 languages from proto definitions. Each generated SDK includes client, types, build file, and README.</done>
</task>

</tasks>

<verification>
- SdkApiSurface covers all 10+ canonical operations (connect, store, retrieve, query, tag, search, stream_store, subscribe, health, capabilities)
- Each language template generates syntactically correct code patterns
- Python template includes context managers and pandas integration
- Java template includes JDBC driver class and CompletableFuture
- Go template uses context.Context and error returns
- Rust template uses Result types and Drop
- TypeScript template supports both Node.js and browser targets
- Build succeeds
</verification>

<success_criteria>
Multi-language SDK code generator is production-ready. Running `GenerateAllSdks()` produces complete, idiomatic client SDK packages for Python, Java, Go, Rust, and TypeScript with proper packaging metadata.
</success_criteria>

<output>
After completion, create `.planning/phases/89-ecosystem-compatibility/89-07-SUMMARY.md`
</output>
