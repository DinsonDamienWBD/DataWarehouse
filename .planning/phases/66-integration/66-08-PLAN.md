---
phase: 66-integration
plan: 08
type: execute
wave: 4
depends_on: ["66-05", "66-06", "66-07"]
files_modified:
  - DataWarehouse.Tests/Integration/PerformanceRegressionTests.cs
  - .planning/phases/66-integration/INTEGRATION-FINAL-REPORT.md
autonomous: true

must_haves:
  truths:
    - "No performance regressions from v4.5 baseline after v5.0 feature additions"
    - "All integration tests pass in a single test run"
    - "Integration report confirms overall system health"
  artifacts:
    - path: "DataWarehouse.Tests/Integration/PerformanceRegressionTests.cs"
      provides: "Performance regression detection tests"
      min_lines: 80
    - path: ".planning/phases/66-integration/INTEGRATION-FINAL-REPORT.md"
      provides: "Comprehensive integration report"
      min_lines: 100
  key_links:
    - from: "All integration tests"
      to: "Final report"
      via: "Test results aggregation"
      pattern: "dotnet test.*Integration"
---

<objective>
Run performance regression checks and produce the final integration report summarizing all Phase 66 findings.

Purpose: This is the integration gate. If this plan passes, the system is ready for Phase 67 (Audit and Certification). If it fails, remediation plans are needed.
Output: Performance regression tests and comprehensive integration report.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/66-integration/66-01-SUMMARY.md
@.planning/phases/66-integration/66-02-SUMMARY.md
@.planning/phases/66-integration/66-03-SUMMARY.md
@.planning/phases/66-integration/66-04-SUMMARY.md
@.planning/phases/66-integration/66-05-SUMMARY.md
@.planning/phases/66-integration/66-06-SUMMARY.md
@.planning/phases/66-integration/66-07-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Performance regression tests</name>
  <files>DataWarehouse.Tests/Integration/PerformanceRegressionTests.cs</files>
  <action>
  Create PerformanceRegressionTests.cs with tests that detect performance regressions:

  1. SolutionBuildTimeRegression: time `dotnet build DataWarehouse.slnx` and assert it completes within a reasonable threshold (capture baseline, fail if >2x baseline). Use Stopwatch.
  2. TestSuiteExecutionTimeRegression: time `dotnet test` for the full test suite and assert within threshold
  3. PluginLoadTimeRegression: measure time to instantiate each plugin class (via reflection) and assert <100ms per plugin. This catches plugins with expensive constructors.
  4. MessageBusPublishLatency: using the IntegrationTestHarness TracingMessageBus, publish 1000 messages and measure average latency. Assert <1ms average.
  5. MemoryFootprintCheck: after loading all plugin types via reflection, measure GC.GetTotalMemory and assert reasonable bounds (not an absolute number but relative -- total memory should scale linearly with plugin count, not exponentially)
  6. AssemblyCountCheck: count loaded assemblies and assert the count has not exploded (heuristic: should be <200 assemblies for the solution)

  Use xUnit. These are heuristic tests -- set generous thresholds to catch regressions without false positives. Document threshold rationale in comments.

  Note: These are NOT benchmarks (Phase 46 does that). These are regression guards that catch obvious problems like O(n^2) initialization or memory leaks.
  </action>
  <verify>Run `dotnet test DataWarehouse.Tests/DataWarehouse.Tests.csproj --filter "FullyQualifiedName~PerformanceRegression"` -- all tests pass</verify>
  <done>Performance regression tests pass, no regressions detected</done>
</task>

<task type="auto">
  <name>Task 2: Final integration report</name>
  <files>.planning/phases/66-integration/INTEGRATION-FINAL-REPORT.md</files>
  <action>
  Produce INTEGRATION-FINAL-REPORT.md that aggregates all Phase 66 findings:

  1. Run `dotnet test DataWarehouse.Tests/DataWarehouse.Tests.csproj --filter "Namespace~Integration" --logger "console;verbosity=detailed"` and capture results

  2. Write report with these sections:
     **Executive Summary**: overall pass/fail, total tests, total passed, total failed, total skipped

     **Build Health (Plan 01)**: projects in solution, build errors, warnings, plugin isolation status

     **Message Bus Topology (Plan 02)**: total topics, publishers, subscribers, dead topics, orphans. Reference MESSAGE-BUS-TOPOLOGY-REPORT.md

     **Strategy Registry (Plan 03)**: total strategies, registered, orphaned, domain distribution. Reference STRATEGY-REGISTRY-REPORT.md

     **Configuration Hierarchy (Plan 04)**: feature coverage %, missing config items, AllowUserToOverride compliance. Reference CONFIGURATION-AUDIT-REPORT.md

     **Security Posture (Plan 05)**: pentest findings status (X/50 resolved), new regressions, v5.0 security compliance. Reference SECURITY-REGRESSION-REPORT.md

     **End-to-End Lifecycle (Plan 06)**: pipeline stages verified, handoff status, dead ends found

     **Cross-Feature Orchestration (Plan 07)**: interaction paths verified, moonshot wiring status, circular dependencies

     **Performance (Plan 08)**: build time, test time, memory footprint, regression status

     **Overall Score**: X/8 plans PASS, Y WARN, Z FAIL

     **Remediation Required**: list of any issues that must be fixed before Phase 67 (Certification)

     **Recommendation**: PROCEED to Phase 67 / REMEDIATE first (with specific gap closure plans needed)

  3. If any FAIL items exist, outline what a gap closure plan would need to fix
  </action>
  <verify>Report exists with all 8 sections populated and overall recommendation</verify>
  <done>Comprehensive integration report produced with clear proceed/remediate recommendation</done>
</task>

</tasks>

<verification>
- All performance regression tests pass
- INTEGRATION-FINAL-REPORT.md covers all 8 plan areas
- Report has clear proceed/remediate recommendation
- `dotnet test --filter "Namespace~Integration"` runs all integration tests
</verification>

<success_criteria>
All integration tests pass (or skip gracefully). Performance within acceptable bounds. Final report recommends PROCEED to Phase 67 or identifies specific remediation needed.
</success_criteria>

<output>
After completion, create `.planning/phases/66-integration/66-08-SUMMARY.md`
</output>
