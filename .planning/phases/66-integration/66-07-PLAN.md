---
phase: 66-integration
plan: 07
type: execute
wave: 3
depends_on: ["66-02", "66-03"]
files_modified:
  - DataWarehouse.Tests/Integration/CrossFeatureOrchestrationTests.cs
  - DataWarehouse.Tests/Integration/MoonshotIntegrationTests.cs
autonomous: true

must_haves:
  truths:
    - "Tags from Phase 55 flow into compliance passports from Phase 57"
    - "Carbon-aware tiering from Phase 62 uses tag metadata for placement decisions"
    - "Chaos vaccination from Phase 61 can inject faults without corrupting data protected by crypto time-locks from Phase 59"
    - "Semantic sync from Phase 60 respects sovereignty zones from Phase 57"
  artifacts:
    - path: "DataWarehouse.Tests/Integration/CrossFeatureOrchestrationTests.cs"
      provides: "Cross-feature interaction verification tests"
      min_lines: 180
    - path: "DataWarehouse.Tests/Integration/MoonshotIntegrationTests.cs"
      provides: "Moonshot feature interaction tests"
      min_lines: 120
  key_links:
    - from: "Universal Tags (Phase 55)"
      to: "Compliance Passports (Phase 57)"
      via: "Tag metadata feeds passport evaluation"
      pattern: "tag\\..*passport|TagCollection.*CompliancePassport"
    - from: "Carbon-Aware (Phase 62)"
      to: "Universal Fabric (Phase 63)"
      via: "Green scoring influences placement"
      pattern: "carbon\\.score.*placement|GreenPlacement.*BackendDescriptor"
    - from: "Semantic Sync (Phase 60)"
      to: "Sovereignty Mesh (Phase 57)"
      via: "Sync respects sovereignty zone boundaries"
      pattern: "sovereignty\\.zone.*sync|SyncFidelity.*SovereigntyZone"
---

<objective>
Verify cross-feature interactions between the 10 moonshot features (Phases 55-63). Features are not isolated -- they must orchestrate together.

Purpose: Individual moonshots work alone, but the real value is in their interactions. Tags feed passports. Carbon scoring influences placement. Sovereignty zones constrain sync. This plan verifies those cross-cutting interactions work.
Output: Cross-feature orchestration tests and moonshot interaction tests.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/PLUGIN-CATALOG.md
@.planning/phases/66-integration/66-02-SUMMARY.md
@.planning/phases/66-integration/66-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Cross-feature orchestration tests</name>
  <files>DataWarehouse.Tests/Integration/CrossFeatureOrchestrationTests.cs</files>
  <action>
  Create CrossFeatureOrchestrationTests.cs verifying the key cross-feature interaction paths:

  **Tags -> Passports (55 -> 57):**
  1. TagsFlowIntoPassportEvaluation: verify that when tag.assigned events are published, the compliance passport evaluation subscribes to them. Statically verify the passport plugin subscribes to tag-related topics.
  2. PassportRequiresTagMetadata: verify CompliancePassport types reference TagCollection or tag-related types (import check).

  **Tags -> Carbon Placement (55 -> 62 -> 63):**
  3. CarbonScoringUsesTagMetadata: verify carbon-aware placement can read tag metadata (e.g., data classification tags influence carbon budget allocation)
  4. PlacementOptimizerConsidersCarbonScore: verify UniversalFabric's placement optimizer references carbon scoring types or subscribes to carbon-related topics

  **Sovereignty -> Sync (57 -> 60):**
  5. SemanticSyncRespectsSovereigntyZones: verify the semantic sync plugin references sovereignty types or subscribes to sovereignty.zone topics
  6. CrossBorderTransferRequiresPassport: verify cross-border data transfer logic checks compliance passport status

  **Chaos -> Time-Locks (61 -> 59):**
  7. ChaosInjectionDoesNotBypassTimeLocks: verify chaos vaccination fault injection does not directly modify time-locked data (no direct storage bypass)
  8. TimeLockProtectsAgainstChaos: verify time-lock status is checked before any destructive chaos operation

  **Data Consciousness -> Tags -> Archive (56 -> 55 -> storage):**
  9. ConsciousnessScoringUsesTagData: verify data consciousness scoring references tag metadata
  10. AutoArchiveTriggeredByScore: verify low-value scoring triggers archive/tier-down events

  **Zero-Gravity -> Fabric (58 -> 63):**
  11. CrushPlacementIntegratesWithFabric: verify CRUSH placement algorithm references or is referenced by UniversalFabric backend selection

  For each test: use static analysis of source files (grep for type references, topic subscriptions, using statements). If the relevant plugins do not exist, skip gracefully.
  </action>
  <verify>Run `dotnet test DataWarehouse.Tests/DataWarehouse.Tests.csproj --filter "FullyQualifiedName~CrossFeatureOrchestration"` -- tests pass or skip</verify>
  <done>All cross-feature interaction paths verified via static analysis of type references and topic subscriptions</done>
</task>

<task type="auto">
  <name>Task 2: Moonshot integration wiring tests</name>
  <files>DataWarehouse.Tests/Integration/MoonshotIntegrationTests.cs</files>
  <action>
  Create MoonshotIntegrationTests.cs verifying each moonshot plugin is properly wired:

  For each moonshot plugin (Tags, DataConsciousness, CompliancePassport, ZeroGravity, CryptoTimeLock, SemanticSync, ChaosVaccination, CarbonAware, UniversalFabric):
  1. PluginExistsAndCompiles: verify the plugin directory exists and contains a .csproj file
  2. PluginRegistersCapabilities: verify the plugin class contains capability registration code (RegisterCapabilities, RegisterKnowledge, or similar)
  3. PluginSubscribesToBus: verify the plugin subscribes to at least one message bus topic
  4. PluginPublishesToBus: verify the plugin publishes at least one message bus topic
  5. PluginReferencesOnlySDK: verify the .csproj references only DataWarehouse.SDK (no other plugin references)

  Additionally:
  6. AllMoonshotsInSolution: verify all moonshot plugin .csproj files are in DataWarehouse.slnx
  7. NoCircularTopicDependencies: using the message bus topology from Plan 02, verify no circular publish->subscribe->publish loops that could cause infinite message storms
  8. AllMoonshotsHaveHealthCheck: verify each moonshot plugin implements or references IHealthCheck

  Use xUnit with [Theory] and [InlineData] for the per-plugin tests to reduce repetition. Skip gracefully for not-yet-implemented plugins.
  </action>
  <verify>Run `dotnet test DataWarehouse.Tests/DataWarehouse.Tests.csproj --filter "FullyQualifiedName~MoonshotIntegration"` -- tests pass or skip</verify>
  <done>All moonshot plugins verified as properly wired into the system</done>
</task>

</tasks>

<verification>
- CrossFeatureOrchestration tests verify 11 interaction paths
- MoonshotIntegration tests verify all moonshot plugins are wired
- No circular dependencies, no orphaned plugins
</verification>

<success_criteria>
All cross-feature interactions verified. Tags flow into passports. Carbon scoring influences placement. Sovereignty constrains sync. No circular message storms.
</success_criteria>

<output>
After completion, create `.planning/phases/66-integration/66-07-SUMMARY.md`
</output>
