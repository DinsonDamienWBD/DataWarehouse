---
phase: 65.4-comprehensive-strategy-dispatch-migration
plan: 10
type: execute
wave: 5
depends_on: ["65.4-05", "65.4-06", "65.4-07", "65.4-08", "65.4-09"]
files_modified: []
autonomous: true

must_haves:
  truths:
    - "Full solution builds with 0 errors 0 warnings"
    - "All ~1062+ tests pass"
    - "No plugin has a non-obsolete standalone registry that duplicates StrategyRegistry<T>"
    - "All ~15 plugin bases have typed strategy dispatch infrastructure"
  artifacts: []
  key_links: []
---

<objective>
Full solution build verification and cleanup. Ensures the entire migration is consistent, builds clean, and tests pass.

Purpose: Final gate before phase completion. Catches any cross-plugin compilation issues or broken references from the migration.
Output: Clean build with 0 errors 0 warnings, all tests passing.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/phases/65.4-comprehensive-strategy-dispatch-migration/65.4-05-SUMMARY.md
@.planning/phases/65.4-comprehensive-strategy-dispatch-migration/65.4-08-SUMMARY.md
@.planning/phases/65.4-comprehensive-strategy-dispatch-migration/65.4-09-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Full solution build and test verification</name>
  <files></files>
  <action>
1. Run full solution build: `dotnet build DataWarehouse.slnx --no-restore`
   - Must pass with 0 errors, 0 warnings (TreatWarningsAsErrors is enabled)
   - If any errors, fix them. Common issues:
     - Missing using statements in migrated plugins
     - Type mismatches between custom registry interface and StrategyRegistry<T>
     - Ambiguous references between old and new registry methods
     - [Obsolete] warnings on calls to deprecated registries -- update callers to use new methods

2. Run all tests: `dotnet test DataWarehouse.Tests/DataWarehouse.Tests.csproj --no-restore --verbosity normal`
   - All ~1062+ tests must pass
   - If any test fails, investigate: the failure is likely a regression from migration
   - Fix by ensuring migrated code behaves identically to pre-migration

3. Verify no non-obsolete duplicates remain:
   - Grep across all Plugin directories for `BoundedDictionary<string,` that stores strategies and is NOT marked `[Obsolete]`
   - Grep for `new.*StrategyRegistry()` instantiations in plugin files (should only be in [Obsolete] code)
   - Any remaining custom registries should either be [Obsolete] or in the UNIQUE category (dual-index/cross-index preserved intentionally)

4. Verify all bases have dispatch:
   - Grep `DataWarehouse.SDK/Contracts/Hierarchy/` for `StrategyRegistry<` -- should appear in every *PluginBase.cs file (except possibly ones that use PluginBase.StrategyRegistry directly)
   - Grep for `WithStrategyAsync` -- should appear in every *PluginBase.cs file

5. If build warnings exist from [Obsolete] attributes on registry classes, suppress them in plugin .csproj files with:
   `<NoWarn>$(NoWarn);CS0612;CS0618</NoWarn>` -- BUT only if the warnings are from calling [Obsolete] code that the plugin itself deprecated. Do NOT suppress warnings in SDK projects.

6. Run the audit script one final time: `python Metadata/audit_custom_registries.py` to verify all DUPLICATE registries are now marked ALREADY_MIGRATED or [Obsolete].
  </action>
  <verify>
`dotnet build DataWarehouse.slnx --no-restore` -- 0 errors 0 warnings.
`dotnet test DataWarehouse.Tests/DataWarehouse.Tests.csproj --no-restore` -- all tests pass.
`python Metadata/audit_custom_registries.py` -- DUPLICATE count should be 0 (all migrated or obsoleted).
  </verify>
  <done>Full solution builds clean. All tests pass. Audit confirms no remaining non-obsolete duplicate registries. Phase 65.4 migration complete.</done>
</task>

</tasks>

<verification>
- `dotnet build DataWarehouse.slnx --no-restore` produces 0 errors 0 warnings
- `dotnet test` passes all tests
- Python audit shows 0 non-obsolete DUPLICATE registries
</verification>

<success_criteria>
Full solution is clean. The comprehensive strategy dispatch migration is verified complete. All ~15 bases have typed dispatch, all ~25 plugins with custom registries are migrated (DUPLICATE -> base class, UNIQUE -> hybrid with secondary indexes preserved).
</success_criteria>

<output>
After completion, create `.planning/phases/65.4-comprehensive-strategy-dispatch-migration/65.4-10-SUMMARY.md`
</output>
