---
phase: 65.4-comprehensive-strategy-dispatch-migration
plan: 04
type: execute
wave: 2
depends_on: ["65.4-02"]
files_modified:
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/ResiliencePluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/DataManagementPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/FormatPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/InterfacePluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/OrchestrationPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/PlatformPluginBase.cs
autonomous: true

must_haves:
  truths:
    - "ResiliencePluginBase has strategy dispatch for resilience policies"
    - "DataManagementPluginBase has strategy dispatch for data management operations"
    - "FormatPluginBase has typed StrategyRegistry<IDataFormatStrategy> and SerializeWithStrategyAsync/DeserializeWithStrategyAsync"
    - "InterfacePluginBase has typed StrategyRegistry<IInterfaceStrategy> and HandleRequestWithStrategyAsync"
    - "OrchestrationPluginBase and PlatformPluginBase have strategy dispatch"
  artifacts:
    - path: "DataWarehouse.SDK/Contracts/Hierarchy/Feature/ResiliencePluginBase.cs"
      provides: "Resilience strategy dispatch"
      contains: "DispatchResilienceStrategyAsync"
    - path: "DataWarehouse.SDK/Contracts/Hierarchy/Feature/FormatPluginBase.cs"
      provides: "Format strategy dispatch"
      contains: "StrategyRegistry<IDataFormatStrategy>"
    - path: "DataWarehouse.SDK/Contracts/Hierarchy/Feature/InterfacePluginBase.cs"
      provides: "Interface strategy dispatch"
      contains: "StrategyRegistry<IInterfaceStrategy>"
  key_links:
    - from: "DataWarehouse.SDK/Contracts/Hierarchy/Feature/FormatPluginBase.cs"
      to: "DataWarehouse.SDK/Contracts/DataFormat/DataFormatStrategy.cs"
      via: "IDataFormatStrategy type reference"
      pattern: "IDataFormatStrategy"
---

<objective>
Add typed strategy registries and domain operations to Feature branch bases batch 2: Resilience, DataManagement, Format, Interface, Orchestration, Platform.

Purpose: Completes the base class infrastructure. After this plan, ALL plugin bases have strategy dispatch.
Output: Six updated base classes with strategy dispatch.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/EncryptionPluginBase.cs
@DataWarehouse.SDK/Contracts/StrategyRegistry.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add strategy dispatch to ResiliencePluginBase, DataManagementPluginBase, and FormatPluginBase</name>
  <files>
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/ResiliencePluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/DataManagementPluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/FormatPluginBase.cs
  </files>
  <action>
**ResiliencePluginBase** (uses `IResilienceStrategy` -- check if exists at `DataWarehouse.SDK/Contracts/Resilience/`):

If `IResilienceStrategy` exists in SDK, use it. If not, check what interface the UltimateResilience plugin uses (grep for `IResilienceStrategy` in SDK). If it truly doesn't exist, use `IStrategy` from PluginBase and provide convenience domain ops only.

Add before `#region Metadata`:
1. Typed registry if IResilienceStrategy exists, OR convenience wrappers if not
2. `RegisterResilienceStrategy(...)` method
3. `DispatchResilienceStrategyAsync<TResult>(...)` method
4. `ExecuteWithPolicyAndStrategyAsync<T>(Func<CancellationToken, Task<T>> action, string? strategyId, CommandIdentity? identity, CancellationToken ct)` -- domain op that combines strategy resolution with resilience execution
5. Override `GetDefaultStrategyId()` returning null

**DataManagementPluginBase** (check for `IDataManagementStrategy` or similar in SDK):

If no dedicated strategy interface exists, use `IStrategy` from PluginBase. Add before `#region Metadata` (after `#region AI Hooks`):
1. Typed registry or convenience wrappers
2. `ManageDataWithStrategyAsync(Dictionary<string, object> operation, string? strategyId, CommandIdentity? identity, CancellationToken ct)` -- domain op
3. Override `GetDefaultStrategyId()` returning `DataManagementDomain`

Add usings as needed: `using DataWarehouse.SDK.Contracts;`, `using DataWarehouse.SDK.Security;`

**FormatPluginBase** (uses `IDataFormatStrategy` from `DataWarehouse.SDK.Contracts.DataFormat`):

Add usings: `using DataWarehouse.SDK.Contracts.DataFormat;`, `using DataWarehouse.SDK.Contracts;`, `using DataWarehouse.SDK.Security;`, `using System;`, `using System.Threading;`, `using System.Threading.Tasks;`, `using System.IO;`

1. Typed `StrategyRegistry<IDataFormatStrategy>` with lazy init
2. `RegisterFormatStrategy(IDataFormatStrategy strategy)` method
3. `DispatchFormatStrategyAsync<TResult>(...)` method
4. `SerializeWithStrategyAsync(object data, string? strategyId, CommandIdentity? identity, CancellationToken ct)` -- domain op returning byte[]
5. `DeserializeWithStrategyAsync(byte[] data, string? strategyId, CommandIdentity? identity, CancellationToken ct)` -- domain op returning object
6. Override `GetDefaultStrategyId()` returning `FormatFamily`

CRITICAL: Do NOT change existing code. All additions go in new regions.
  </action>
  <verify>
Run: `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj --no-restore` -- 0 errors 0 warnings.
Grep all 3 files for `WithStrategyAsync` to confirm domain ops.
  </verify>
  <done>ResiliencePluginBase, DataManagementPluginBase, FormatPluginBase have strategy dispatch. SDK compiles clean.</done>
</task>

<task type="auto">
  <name>Task 2: Add strategy dispatch to InterfacePluginBase, OrchestrationPluginBase, and PlatformPluginBase</name>
  <files>
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/InterfacePluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/OrchestrationPluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/PlatformPluginBase.cs
  </files>
  <action>
**InterfacePluginBase** (uses `IInterfaceStrategy` from `DataWarehouse.SDK.Contracts.Interface`):

Add usings: `using DataWarehouse.SDK.Contracts.Interface;`, `using DataWarehouse.SDK.Contracts;`, `using DataWarehouse.SDK.Security;`, `using System;`

1. Typed `StrategyRegistry<IInterfaceStrategy>` with lazy init
2. `RegisterInterfaceStrategy(IInterfaceStrategy strategy)` method
3. `DispatchInterfaceStrategyAsync<TResult>(...)` method
4. `HandleRequestWithStrategyAsync(Dictionary<string, object> request, string? strategyId, CommandIdentity? identity, CancellationToken ct)` -- domain op
5. Override `GetDefaultStrategyId()` returning `Protocol`

**OrchestrationPluginBase** (check for `IEdgeComputingStrategy` or similar):

If no dedicated orchestration strategy interface exists, use `IStrategy`. Add:
1. Convenience dispatch methods using PluginBase.ExecuteWithStrategyAsync
2. `OrchestrateWithStrategyAsync(Dictionary<string, object> workflow, string? strategyId, CommandIdentity? identity, CancellationToken ct)` -- domain op
3. Override `GetDefaultStrategyId()` returning `OrchestrationMode`

Add usings: `using DataWarehouse.SDK.Contracts;`, `using DataWarehouse.SDK.Security;`, `using System;`, `using System.Threading;`, `using System.Threading.Tasks;`

**PlatformPluginBase** (check for platform strategy interface):

Same pattern. Add:
1. Convenience dispatch or typed registry (if interface exists)
2. `ExecutePlatformOpWithStrategyAsync(Dictionary<string, object> operation, string? strategyId, CommandIdentity? identity, CancellationToken ct)` -- domain op
3. Override `GetDefaultStrategyId()` returning `PlatformDomain`

Add usings as needed.

CRITICAL: Do NOT change existing code. All additions go in new regions.
  </action>
  <verify>
Run: `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj --no-restore` -- 0 errors 0 warnings.
Grep all 3 files for `WithStrategyAsync` to confirm domain ops.
  </verify>
  <done>InterfacePluginBase, OrchestrationPluginBase, PlatformPluginBase have strategy dispatch. SDK compiles clean.</done>
</task>

</tasks>

<verification>
- `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj --no-restore` passes with 0 errors 0 warnings
- All 6 Feature branch bases (batch 2) have strategy dispatch
- Combined with Plan 03, ALL 11 Feature bases now have dispatch
</verification>

<success_criteria>
All remaining Feature branch bases have strategy dispatch. Combined with Plan 02 (DataPipeline) and Plan 03 (Feature batch 1), ALL ~15 plugin bases now have typed strategy registries and domain operations.
</success_criteria>

<output>
After completion, create `.planning/phases/65.4-comprehensive-strategy-dispatch-migration/65.4-04-SUMMARY.md`
</output>
