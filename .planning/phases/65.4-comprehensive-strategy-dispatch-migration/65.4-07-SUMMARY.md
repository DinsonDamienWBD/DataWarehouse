---
phase: 65.4-comprehensive-strategy-dispatch-migration
plan: "07"
subsystem: plugin-strategy-dispatch
tags:
  - strategy-migration
  - dispatch
  - obsolete
  - wave-3
  - sdkports
  - iot
  - dataprotection
  - databaseprotocol
dependency_graph:
  requires:
    - 65.4-01 (registry audit)
    - 65.4-03 (SecurityPluginBase, StreamingPluginBase dispatch)
    - 65.4-04 (PlatformPluginBase dispatch)
  provides:
    - UltimateSDKPorts custom registry marked [Obsolete]
    - UltimateIoTIntegration custom registry marked [Obsolete] + dual-registration
    - UltimateDataProtection custom registry marked [Obsolete] + dual-registration
    - UltimateDatabaseProtocol inline registry marked [Obsolete] + DiscoverStrategiesFromAssembly
  affects:
    - All downstream code referencing SDKPortStrategyRegistry, IoTStrategyRegistry,
      DataProtectionStrategyRegistry (deprecation warnings surfaced)
tech_stack:
  added: []
  patterns:
    - "[Obsolete] annotation on standalone/inline custom registry classes"
    - "Pragma suppress CS0618 on internal plugin usages of retained registries"
    - "Dual-registration pattern: domain registry + PluginBase.RegisterStrategy()"
    - "DiscoverStrategiesFromAssembly() used alongside domain registry.DiscoverStrategies()"
key_files:
  created: []
  modified:
    - Plugins/DataWarehouse.Plugins.UltimateSDKPorts/SDKPortStrategyRegistry.cs
    - Plugins/DataWarehouse.Plugins.UltimateSDKPorts/UltimateSDKPortsPlugin.cs
    - Plugins/DataWarehouse.Plugins.UltimateIoTIntegration/IoTStrategyRegistry.cs
    - Plugins/DataWarehouse.Plugins.UltimateIoTIntegration/UltimateIoTIntegrationPlugin.cs
    - Plugins/DataWarehouse.Plugins.UltimateDataProtection/DataProtectionStrategyRegistry.cs
    - Plugins/DataWarehouse.Plugins.UltimateDataProtection/UltimateDataProtectionPlugin.cs
    - Plugins/DataWarehouse.Plugins.UltimateDataProtection/Subsystems/BackupSubsystem.cs
    - Plugins/DataWarehouse.Plugins.UltimateDataProtection/Subsystems/IntelligenceSubsystem.cs
    - Plugins/DataWarehouse.Plugins.UltimateDataProtection/Subsystems/RestoreSubsystem.cs
    - Plugins/DataWarehouse.Plugins.UltimateDataProtection/Retention/RetentionPolicyEngine.cs
    - Plugins/DataWarehouse.Plugins.UltimateDataProtection/Validation/BackupValidator.cs
    - Plugins/DataWarehouse.Plugins.UltimateDatabaseProtocol/DatabaseProtocolStrategyBase.cs
    - Plugins/DataWarehouse.Plugins.UltimateDatabaseProtocol/UltimateDatabaseProtocolPlugin.cs
decisions:
  - "SDKPortStrategyBase does not implement IStrategy -- PlatformPluginBase.RegisterPlatformStrategy() cannot be used; registry marked [Obsolete] as documentation only"
  - "IoTStrategyBase extends StrategyBase (IStrategy) -- dual-registration used: _registry for typed dispatch + RegisterStrategy() for lifecycle"
  - "DataProtectionStrategyBase extends StrategyBase (IStrategy) -- dual-registration used; subsystem files need pragma suppress since they accept registry by constructor injection"
  - "DatabaseProtocolStrategyBase extends StrategyBase (IStrategy) -- DiscoverStrategiesFromAssembly() added alongside domain registry.DiscoverStrategies() in OnStartCoreAsync"
  - "UltimateDataProtection and UltimateDatabaseProtocol were already migrated by Plan 06 SUMMARY commit (28bc6fe5) -- Plan 07 Task 2 changes were pre-applied, confirming idempotency"
metrics:
  duration: "7m"
  completed_date: "2026-02-21"
  tasks_completed: 2
  tasks_total: 2
  files_created: 0
  files_modified: 13
---

# Phase 65.4 Plan 07: Wave 3 Standalone Registry Migration (SDKPorts, IoT, DataProtection, DatabaseProtocol) Summary

## One-liner

Migrated 4 plugins from standalone/inline custom strategy registries to base-class dispatch using dual-registration pattern and [Obsolete] annotations; SDKPortStrategyBase discovered to lack IStrategy inheritance, documented as architecture constraint.

## Objective

Migrate UltimateSDKPorts, UltimateIoTIntegration, UltimateDataProtection, and UltimateDatabaseProtocol from custom registries to inherited base class dispatch, completing the Pattern A standalone registry migrations.

## Context

Wave 3 completes the custom registry migration started in Waves 1-2. Each plugin's strategy base class relationship determined the migration approach:

- `SDKPortStrategyBase` → plain abstract class (no `IStrategy` ancestry)
- `IoTStrategyBase` → `StrategyBase` → `IStrategy`
- `DataProtectionStrategyBase` → `StrategyBase` → `IStrategy`
- `DatabaseProtocolStrategyBase` → `StrategyBase` → `IStrategy`

## Tasks Executed

### Task 1: Migrate UltimateSDKPorts and UltimateIoTIntegration

**Commit:** `e64954e7`
**Files modified:** 4

**UltimateSDKPorts:**
- `SDKPortStrategyRegistry.cs` marked `[Obsolete]` with explanation that `SDKPortStrategyBase` does not implement `IStrategy`, so base-class `RegisterPlatformStrategy()` cannot accept these strategies directly. Registry retained as typed lookup thin wrapper.
- `UltimateSDKPortsPlugin.cs`: `_registry` field and `Registry` property marked with pragma suppress + `[Obsolete]` forwarding.

**UltimateIoTIntegration:**
- `IoTStrategyRegistry.cs` marked `[Obsolete]` with documentation that base-class `RegisterStrategy()` is now used for lifecycle while the registry handles domain-typed dispatch.
- `UltimateIoTIntegrationPlugin.cs`: `DiscoverAndRegisterStrategies()` updated to dual-register: `_registry.Register(strategy)` for typed domain dispatch AND `RegisterStrategy(baseStrategy)` for PluginBase lifecycle when strategy implements `IStrategy`.

**Verification:** Both plugins built with 0 errors, 0 warnings.

### Task 2: Migrate UltimateDataProtection and UltimateDatabaseProtocol

**Commit:** `28bc6fe5` (pre-applied by Plan 06 SUMMARY commit)
**Files modified:** 9

**UltimateDataProtection:**
- `DataProtectionStrategyRegistry.cs` marked `[Obsolete]` with full migration guidance.
- `UltimateDataProtectionPlugin.cs`: `DiscoverAndRegisterStrategies()` dual-registers via both domain registry and `RegisterStrategy()`.
- Subsystem files (`BackupSubsystem`, `IntelligenceSubsystem`, `RestoreSubsystem`, `RetentionPolicyEngine`, `BackupValidator`) all received `#pragma warning disable CS0618` since they accept the registry via constructor injection and cannot trivially migrate.

**UltimateDatabaseProtocol:**
- `DatabaseProtocolStrategyBase.cs`: Inline `DatabaseProtocolStrategyRegistry` class marked `[Obsolete]`.
- `UltimateDatabaseProtocolPlugin.cs`: `OnStartCoreAsync()` now calls `DiscoverStrategiesFromAssembly(Assembly.GetExecutingAssembly())` in addition to `_registry.DiscoverStrategies()` for base-class lifecycle registration.

**Verification:** Both plugins built with 0 errors, 0 warnings.

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug/Discovery] SDKPortStrategyBase does not implement IStrategy**
- **Found during:** Task 1, inspecting `SDKPortStrategyBase`
- **Issue:** The plan suggested `Register()` → `RegisterStrategy()` mapping for UltimateSDKPorts. `SDKPortStrategyBase` is a standalone abstract class with no `IStrategy` ancestry, making direct `RegisterStrategy()` use impossible.
- **Fix:** Marked `SDKPortStrategyRegistry` `[Obsolete]` with documentation of the constraint. Used `#pragma warning disable CS0618` on internal usages. Registry retained as-is for typed dispatch.
- **Files modified:** `SDKPortStrategyRegistry.cs`, `UltimateSDKPortsPlugin.cs`
- **Commit:** `e64954e7`

**2. [Rule 2 - Discovery] Task 2 changes pre-applied by Plan 06**
- **Found during:** Task 2 git commit attempt
- **Issue:** `UltimateDataProtection` and `UltimateDatabaseProtocol` migrations were already committed in the Plan 06 SUMMARY commit (`28bc6fe5`), making Plan 07 Task 2 idempotent (same changes, no diff).
- **Outcome:** Confirmed changes match Plan 07 requirements exactly. No re-work needed. Task 2 counted as complete via prior commit.

**3. [Rule 2 - Missing] DataProtection subsystem files needed pragma suppressions**
- **Found during:** Task 2 build verification
- **Issue:** `BackupSubsystem`, `IntelligenceSubsystem`, `RestoreSubsystem`, `RetentionPolicyEngine`, `BackupValidator` all reference `DataProtectionStrategyRegistry` by type (constructor injection). Marking the registry `[Obsolete]` caused build errors in these files.
- **Fix:** Added `#pragma warning disable CS0618` at file level in each affected file.
- **Files modified:** 5 subsystem/validation files
- **Commit:** `28bc6fe5`

## Overall Verification

All 4 plugins verified:
```
UltimateSDKPorts:          Build succeeded. 0 Warning(s)  0 Error(s)
UltimateIoTIntegration:    Build succeeded. 0 Warning(s)  0 Error(s)
UltimateDataProtection:    Build succeeded. 0 Warning(s)  0 Error(s)
UltimateDatabaseProtocol:  Build succeeded. 0 Warning(s)  0 Error(s)
```

## Self-Check: PASSED

- `SDKPortStrategyRegistry.cs` -- FOUND (marked [Obsolete])
- `IoTStrategyRegistry.cs` -- FOUND (marked [Obsolete])
- `DataProtectionStrategyRegistry.cs` -- FOUND (marked [Obsolete])
- `DatabaseProtocolStrategyBase.cs` DatabaseProtocolStrategyRegistry -- FOUND (marked [Obsolete])
- Commit `e64954e7` -- FOUND
- Commit `28bc6fe5` -- FOUND (pre-applied, covers Task 2)
- All 4 plugins build: 0 errors, 0 warnings -- VERIFIED
