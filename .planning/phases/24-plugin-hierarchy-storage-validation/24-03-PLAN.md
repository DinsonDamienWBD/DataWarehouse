---
phase: 24-plugin-hierarchy-storage-validation
plan: 03
type: execute
wave: 3
depends_on: ["24-02"]
files_modified:
  - DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/DataTransformationPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/EncryptionPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/CompressionPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/StoragePluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/ReplicationPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/DataTransitPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/IntegrityPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/SecurityPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/InterfacePluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/DataManagementPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/ComputePluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/ObservabilityPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/StreamingPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/MediaPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/FormatPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/InfrastructurePluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/OrchestrationPluginBase.cs
  - DataWarehouse.SDK/Contracts/Hierarchy/Feature/PlatformPluginBase.cs
autonomous: true

must_haves:
  truths:
    - "7 domain bases exist under DataPipelinePluginBase"
    - "11 domain bases exist under FeaturePluginBase"
    - "Each domain base provides domain-specific abstract/virtual methods and metadata"
    - "Existing IntelligenceAware* specialized bases marked [Obsolete] pointing to new domain bases"
    - "SDK compiles with zero new errors"
  artifacts:
    - path: "DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/StoragePluginBase.cs"
      provides: "Storage domain base under DataPipeline branch"
      contains: "class StoragePluginBase : DataPipelinePluginBase"
    - path: "DataWarehouse.SDK/Contracts/Hierarchy/Feature/SecurityPluginBase.cs"
      provides: "Security domain base under Feature branch"
      contains: "class SecurityPluginBase : FeaturePluginBase"
  key_links:
    - from: "Domain bases"
      to: "DataPipelinePluginBase or FeaturePluginBase"
      via: "inheritance"
      pattern: "class \\w+PluginBase : (DataPipelinePluginBase|FeaturePluginBase)"
---

<objective>
Create all ~18 domain-specific plugin base classes under the correct branch per AD-01 target hierarchy (HIER-06, HIER-08). DataPipeline branch gets 7 bases for data-flow plugins. Feature branch gets 11 bases for service plugins. Mark existing IntelligenceAware* specialized bases as [Obsolete].

Purpose: Domain bases provide common functionality for each plugin category (HIER-08), reducing code duplication across Ultimate plugins. This completes the AD-01 hierarchy in the SDK.
Output: 18 new domain base class files in DataWarehouse.SDK/Contracts/Hierarchy/.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/ARCHITECTURE_DECISIONS.md
@.planning/phases/24-plugin-hierarchy-storage-validation/24-RESEARCH.md
@.planning/phases/24-plugin-hierarchy-storage-validation/24-02-SUMMARY.md
@DataWarehouse.SDK/Contracts/Hierarchy/DataPipelinePluginBase.cs
@DataWarehouse.SDK/Contracts/Hierarchy/NewFeaturePluginBase.cs
@DataWarehouse.SDK/Contracts/IntelligenceAware/SpecializedIntelligenceAwareBases.cs
@DataWarehouse.SDK/Contracts/PluginBase.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create DataPipeline branch domain bases (7 classes)</name>
  <files>
    DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/DataTransformationPluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/EncryptionPluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/CompressionPluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/StoragePluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/ReplicationPluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/DataTransitPluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/IntegrityPluginBase.cs
  </files>
  <action>
Create directory `DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/` and the following 7 files. All classes are in namespace `DataWarehouse.SDK.Contracts.Hierarchy`.

**CRITICAL RULE:** Each domain base must incorporate the AI integration hooks from its corresponding IntelligenceAware* base class (if one exists). Read `SpecializedIntelligenceAwareBases.cs` to understand what domain-specific AI methods each IntelligenceAware* base provides. Those methods must be available in the new domain base (either copied or delegated). DO NOT lose any functionality (AD-08).

**1. DataTransformationPluginBase.cs** -- Mutates data (encryption, compression). Inherits DataPipelinePluginBase.
- `MutatesData => true` override
- `abstract string SubCategory { get; }` -- e.g., "Encryption", "Compression"
- `virtual int QualityLevel => 50` -- for sorting/selection
- `abstract Task<Stream> OnWriteAsync(Stream input, IKernelContext context, Dictionary<string, object> args)` -- transform on write
- `abstract Task<Stream> OnReadAsync(Stream stored, IKernelContext context, Dictionary<string, object> args)` -- transform on read
- `virtual Stream OnWrite(...)` / `virtual Stream OnRead(...)` sync wrappers that call async (for backward compat with existing pipeline)
- `Category => PluginCategory.DataTransformationProvider`
- Reference: existing `DataTransformationPluginBase` in PluginBase.cs lines ~1040-1120 -- copy its full logic

**2. EncryptionPluginBase.cs** -- Inherits new DataTransformationPluginBase.
- `SubCategory => "Encryption"`
- `abstract int KeySizeBytes { get; }`, `abstract int IvSizeBytes { get; }`, `abstract int TagSizeBytes { get; }`, `abstract string AlgorithmId { get; }`
- Key management infrastructure: `DefaultKeyStore`, `DefaultKeyManagementMode`, `DefaultEnvelopeKeyStore`, `DefaultKekKeyId`, `ConfigProvider`, `KeyStoreRegistry`
- Statistics: `EncryptionCount`, `DecryptionCount`, `TotalBytesEncrypted`, `TotalBytesDecrypted`, `KeyAccessLog`
- `ResolveKeyStoreAsync`, `ResolveKeyManagementModeAsync` helper methods
- AI hooks from IntelligenceAwareEncryptionPluginBase: `SelectOptimalAlgorithmAsync`, `EvaluateKeyStrengthAsync`, `DetectEncryptionAnomalyAsync`
- Reference: existing `EncryptionPluginBase` in PluginBase.cs lines ~2782-3200+ AND `IntelligenceAwareEncryptionPluginBase` in SpecializedIntelligenceAwareBases.cs

**3. CompressionPluginBase.cs** -- Inherits new DataTransformationPluginBase.
- `SubCategory => "Compression"`
- `abstract string CompressionAlgorithm { get; }`, `virtual int CompressionLevel => 6`
- Statistics: compression ratio, bytes processed
- AI hooks from IntelligenceAwareCompressionPluginBase: `SelectOptimalAlgorithmAsync`, `PredictCompressionRatioAsync`
- Reference: `IntelligenceAwareCompressionPluginBase` in SpecializedIntelligenceAwareBases.cs

**4. StoragePluginBase.cs** -- Data persistence endpoint. Inherits DataPipelinePluginBase.
- `MutatesData => false` (persists, doesn't mutate)
- Object/key-based core model per AD-04: `abstract Task<StorageObjectMetadata> StoreAsync(string key, Stream data, ...)`, `abstract Task<Stream> RetrieveAsync(string key, ...)`, `abstract Task DeleteAsync(string key, ...)`, `abstract Task<bool> ExistsAsync(string key, ...)`
- `abstract IAsyncEnumerable<StorageObjectMetadata> ListAsync(string? prefix, CancellationToken ct)`
- `abstract Task<StorageObjectMetadata> GetMetadataAsync(string key, CancellationToken ct)`
- `abstract Task<StorageHealthInfo> GetHealthAsync(CancellationToken ct)`
- `Category => PluginCategory.StorageProvider`
- AI hooks from IntelligenceAwareStoragePluginBase: `OptimizeStoragePlacementAsync`, `PredictAccessPatternAsync`
- Reference: IStorageStrategy interface in StorageStrategy.cs (this IS the target model per AD-04)

**5. ReplicationPluginBase.cs** -- Distributes data. Inherits DataPipelinePluginBase.
- `MutatesData => false`
- `abstract Task<ReplicationResult> ReplicateAsync(string key, string[] targetNodes, CancellationToken ct)`
- `abstract Task<SyncStatus> GetSyncStatusAsync(string key, CancellationToken ct)`
- `virtual ReplicationMode DefaultMode => ReplicationMode.Async`
- `Category => PluginCategory.StorageProvider` (sub-type replication)
- Reference: existing `ReplicationPluginBase` in PluginBase.cs line ~2204 and IReplicationService interface

**6. DataTransitPluginBase.cs** -- Moves data between nodes. Inherits DataPipelinePluginBase.
- `MutatesData => false`
- `abstract Task<TransferResult> TransferAsync(string key, TransferTarget target, CancellationToken ct)`
- `abstract Task<TransferStatus> GetTransferStatusAsync(string transferId, CancellationToken ct)`
- Transport-level metadata: `virtual string TransportProtocol => "tcp"`
- Reference: DataTransitTypes in Contracts/Transit/

**7. IntegrityPluginBase.cs** -- Verifies data at boundaries. Inherits DataPipelinePluginBase.
- `MutatesData => false`
- `abstract Task<IntegrityResult> VerifyAsync(string key, CancellationToken ct)`
- `abstract Task<byte[]> ComputeHashAsync(Stream data, CancellationToken ct)`
- Tamper-proof chain support: `virtual Task<bool> ValidateChainAsync(string startKey, string endKey, CancellationToken ct)`
- Reference: TamperProof contracts in Contracts/TamperProof/

**For ALL classes:**
- Use `namespace DataWarehouse.SDK.Contracts.Hierarchy;` (file-scoped)
- Add full XML documentation
- Include `using` statements as needed
- Override `GetMetadata()` to include domain-specific metadata
- Methods that reference types not yet in the SDK should use generic `Dictionary<string, object>` or `Task<bool>` temporarily -- do NOT create new type definitions in this plan
- ALL abstract methods must have `CancellationToken ct = default` parameter

Build the SDK after creating all files.
  </action>
  <verify>
Run `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` -- must compile with zero new errors.
Verify all 7 files exist in `DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/`.
Grep for `class.*PluginBase.*:.*DataPipelinePluginBase` to confirm correct inheritance.
  </verify>
  <done>7 DataPipeline domain bases created (DataTransformation, Encryption, Compression, Storage, Replication, DataTransit, Integrity), all inheriting from DataPipelinePluginBase, all with domain-specific methods and AI hooks. SDK compiles.</done>
</task>

<task type="auto">
  <name>Task 2: Create Feature branch domain bases (11 classes) and mark old bases [Obsolete]</name>
  <files>
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/SecurityPluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/InterfacePluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/DataManagementPluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/ComputePluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/ObservabilityPluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/StreamingPluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/MediaPluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/FormatPluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/InfrastructurePluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/OrchestrationPluginBase.cs
    DataWarehouse.SDK/Contracts/Hierarchy/Feature/PlatformPluginBase.cs
    DataWarehouse.SDK/Contracts/IntelligenceAware/SpecializedIntelligenceAwareBases.cs
  </files>
  <action>
Create directory `DataWarehouse.SDK/Contracts/Hierarchy/Feature/` and the following 11 files. All classes in namespace `DataWarehouse.SDK.Contracts.Hierarchy`.

**Use `FeaturePluginBase` from `DataWarehouse.SDK.Contracts.Hierarchy` as the parent** (the new one from 24-02).

**1. SecurityPluginBase.cs** -- Security services (access control, key mgmt, compliance, threat detection)
- `FeatureCategory => "Security"`
- `abstract Task<AuthorizationResult> AuthorizeAsync(AuthorizationRequest request, CancellationToken ct)`
- AI hooks from IntelligenceAwareAccessControlPluginBase: `EvaluateAccessWithIntelligenceAsync`, `DetectAnomalousAccessAsync`
- Sub-domain constants: `AccessControl`, `KeyManagement`, `Compliance`, `ThreatDetection`
- Reference: IntelligenceAwareAccessControlPluginBase, IntelligenceAwareKeyManagementPluginBase, IntelligenceAwareCompliancePluginBase

**2. InterfacePluginBase.cs** -- External interfaces (REST, gRPC, SQL, WebSocket)
- `FeatureCategory => "Interface"`
- `abstract string Protocol { get; }`, `virtual int? Port => null`, `virtual string? BasePath => null`
- AI hooks from IntelligenceAwareInterfacePluginBase: `OptimizeResponseAsync`, `ParseNaturalLanguageQueryAsync`
- Reference: existing InterfacePluginBase in PluginBase.cs line ~1410, IntelligenceAwareInterfacePluginBase

**3. DataManagementPluginBase.cs** -- Data governance, catalog, quality, lineage, lake, mesh, privacy, integration, fabric
- `FeatureCategory => "DataManagement"`
- `abstract string DataManagementDomain { get; }` -- e.g., "Governance", "Catalog", "Quality"
- AI hooks from IntelligenceAwareDataManagementPluginBase: `ClassifyDataAsync`, `SuggestGovernancePolicyAsync`
- Reference: IntelligenceAwareDataManagementPluginBase

**4. ComputePluginBase.cs** -- Compute runtimes (WASM, container, sandbox, GPU)
- `FeatureCategory => "Compute"`
- `abstract string RuntimeType { get; }`
- `abstract Task<ComputeResult> ExecuteWorkloadAsync(ComputeWorkload workload, CancellationToken ct)`
- Reference: IComputeRuntimeStrategy in Contracts/Compute/

**5. ObservabilityPluginBase.cs** -- Metrics, tracing, logging, health
- `FeatureCategory => "Observability"`
- `abstract string ObservabilityDomain { get; }` -- "Metrics", "Tracing", "Logging"
- Reference: IObservabilityStrategy in Contracts/Observability/

**6. StreamingPluginBase.cs** -- Real-time data streaming
- `FeatureCategory => "Streaming"`
- `abstract Task PublishAsync(string topic, Stream data, CancellationToken ct)`
- `abstract IAsyncEnumerable<StreamMessage> SubscribeAsync(string topic, CancellationToken ct)`
- Reference: StreamingStrategy contracts

**7. MediaPluginBase.cs** -- Media processing (transcoding, image processing)
- `FeatureCategory => "Media"`
- `abstract string MediaType { get; }` -- "Video", "Image", "Audio"
- Reference: IMediaStrategy, MediaTranscodingPluginBase

**8. FormatPluginBase.cs** -- Data format handling (columnar, graph, scientific, lakehouse)
- `FeatureCategory => "Format"`
- `abstract string FormatFamily { get; }` -- "Columnar", "Graph", "Scientific"
- Reference: DataFormatStrategy

**9. InfrastructurePluginBase.cs** -- Infrastructure services (deployment, resilience, sustainability, multi-cloud)
- `FeatureCategory => "Infrastructure"`
- `abstract string InfrastructureDomain { get; }` -- "Deployment", "Resilience"

**10. OrchestrationPluginBase.cs** -- Workflow and edge computing orchestration
- `FeatureCategory => "Orchestration"`
- `abstract string OrchestrationMode { get; }`
- Reference: existing OrchestrationProviderPluginBase in PluginBase.cs

**11. PlatformPluginBase.cs** -- Platform services (SDK ports, microservices, IoT, app platform, marketplace)
- `FeatureCategory => "Platform"`
- `abstract string PlatformDomain { get; }` -- "SDKPorts", "Microservices", "IoT"

**For ALL classes:**
- Use `namespace DataWarehouse.SDK.Contracts.Hierarchy;` (file-scoped)
- Add full XML documentation
- Override `GetMetadata()` with domain-specific metadata
- Use placeholder types (Dictionary<string, object>, Task<bool>) when referencing types that don't yet exist
- CancellationToken on all async methods

**Then: Mark existing IntelligenceAware* specialized bases as [Obsolete]**

In `DataWarehouse.SDK/Contracts/IntelligenceAware/SpecializedIntelligenceAwareBases.cs`, add `[Obsolete("Use <NewBase> from DataWarehouse.SDK.Contracts.Hierarchy namespace. This class will be removed in Phase 28.")]` to each:
- `IntelligenceAwareConnectorPluginBase` -> "Use InterfacePluginBase"
- `IntelligenceAwareInterfacePluginBase` -> "Use InterfacePluginBase"
- `IntelligenceAwareEncryptionPluginBase` -> "Use EncryptionPluginBase"
- `IntelligenceAwareCompressionPluginBase` -> "Use CompressionPluginBase"
- `IntelligenceAwareStoragePluginBase` -> "Use StoragePluginBase"
- `IntelligenceAwareAccessControlPluginBase` -> "Use SecurityPluginBase"
- `IntelligenceAwareCompliancePluginBase` -> "Use SecurityPluginBase"
- `IntelligenceAwareDataManagementPluginBase` -> "Use DataManagementPluginBase"
- `IntelligenceAwareKeyManagementPluginBase` -> "Use SecurityPluginBase"
- `IntelligenceAwareDatabasePluginBase` -> "Use StoragePluginBase"

Do NOT delete any of these classes. Do NOT modify their functionality. Only add the [Obsolete] attribute.

Build the SDK after all changes.
  </action>
  <verify>
Run `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` -- must compile (Obsolete warnings are OK, they are not errors).
Verify all 11 files exist in `DataWarehouse.SDK/Contracts/Hierarchy/Feature/`.
Grep for `\[Obsolete` in SpecializedIntelligenceAwareBases.cs to confirm all are marked.
  </verify>
  <done>11 Feature domain bases created (Security, Interface, DataManagement, Compute, Observability, Streaming, Media, Format, Infrastructure, Orchestration, Platform). 10 IntelligenceAware* bases marked [Obsolete]. SDK compiles.</done>
</task>

</tasks>

<verification>
1. `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` -- compiles (Obsolete warnings allowed)
2. 18 total domain base files exist in Hierarchy/ directory
3. DataPipeline branch: 7 bases (DataTransformation, Encryption, Compression, Storage, Replication, DataTransit, Integrity)
4. Feature branch: 11 bases (Security, Interface, DataManagement, Compute, Observability, Streaming, Media, Format, Infrastructure, Orchestration, Platform)
5. All IntelligenceAware* specialized bases marked [Obsolete] but fully functional
6. No existing code removed or broken (AD-08)
</verification>

<success_criteria>
- HIER-06: All feature-specific plugin base classes exist under the two branches
- HIER-08: Each domain base implements common domain functionality (methods, metadata, AI hooks)
- AD-01: Target hierarchy fully materialized in SDK
- AD-08: Zero regression -- all existing bases preserved with [Obsolete] markers
</success_criteria>

<output>
After completion, create `.planning/phases/24-plugin-hierarchy-storage-validation/24-03-SUMMARY.md`
</output>
