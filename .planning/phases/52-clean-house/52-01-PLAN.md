---
phase: 52-clean-house
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - DataWarehouse.CLI/Commands/BackupCommands.cs
  - DataWarehouse.CLI/Commands/DeveloperCommands.cs
  - DataWarehouse.CLI/Commands/HealthCommands.cs
  - DataWarehouse.CLI/Commands/PluginCommands.cs
  - DataWarehouse.CLI/Commands/RaidCommands.cs
autonomous: true

must_haves:
  truths:
    - "Zero TODO comments remain in any CLI command file"
    - "CLI commands query the kernel/message bus for real data instead of returning hardcoded samples"
    - "Build compiles with 0 errors, 0 warnings"
  artifacts:
    - path: "DataWarehouse.CLI/Commands/BackupCommands.cs"
      provides: "Real backup list via message bus query"
      contains: "MessageBus"
    - path: "DataWarehouse.CLI/Commands/DeveloperCommands.cs"
      provides: "Real API endpoint, schema, collection, and query data via message bus"
      contains: "MessageBus"
    - path: "DataWarehouse.CLI/Commands/HealthCommands.cs"
      provides: "Real alert data via message bus"
      contains: "MessageBus"
    - path: "DataWarehouse.CLI/Commands/PluginCommands.cs"
      provides: "Real plugin list via message bus"
      contains: "MessageBus"
    - path: "DataWarehouse.CLI/Commands/RaidCommands.cs"
      provides: "Real RAID configuration via message bus"
      contains: "MessageBus"
  key_links:
    - from: "DataWarehouse.CLI/Commands/*.cs"
      to: "DataWarehouse.SDK/Contracts/IMessageBus.cs"
      via: "message bus publish/subscribe"
      pattern: "PublishAsync|SubscribeAsync|RequestAsync"
---

<objective>
Replace all 11 CLI TODO comments with real message bus queries.

Purpose: CLI commands currently have TODO comments marking places where they return hardcoded sample data instead of querying the kernel/message bus for real information. Each TODO must be replaced with actual message bus integration.

Output: 5 CLI command files with zero TODOs, all querying real data via message bus.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/PLUGIN-CATALOG.md
@DataWarehouse.SDK/Contracts/IMessageBus.cs
@DataWarehouse.CLI/Commands/BackupCommands.cs
@DataWarehouse.CLI/Commands/DeveloperCommands.cs
@DataWarehouse.CLI/Commands/HealthCommands.cs
@DataWarehouse.CLI/Commands/PluginCommands.cs
@DataWarehouse.CLI/Commands/RaidCommands.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Wire CLI backup and plugin commands to message bus</name>
  <files>
    DataWarehouse.CLI/Commands/BackupCommands.cs
    DataWarehouse.CLI/Commands/PluginCommands.cs
  </files>
  <action>
    In BackupCommands.cs (line 85): Replace the TODO comment and hardcoded backup list with a real message bus request. Use the existing IMessageBus reference (available via the CLI's kernel context). Publish a request to topic "dataprotection.backup.list" and await the response. Parse the response payload into the backup display format. If the message bus is not available or the plugin is not loaded, fall back to displaying "No backup data available - DataProtection plugin not loaded" instead of fake data.

    In PluginCommands.cs (line 130): Replace the TODO comment and hardcoded plugin list. Use the kernel context to enumerate loaded plugins via the message bus topic "kernel.plugin.list". The kernel already tracks loaded plugins. Parse the response and display real plugin IDs, names, versions, and status. Fall back to "Plugin information unavailable" if kernel context is not accessible.

    IMPORTANT: Do NOT add any new project references to the CLI project. The CLI already has access to IMessageBus through the kernel context. Do NOT use placeholder/mock data as fallback - use descriptive "not available" messages.
  </action>
  <verify>
    grep -rn "// TODO" DataWarehouse.CLI/Commands/BackupCommands.cs DataWarehouse.CLI/Commands/PluginCommands.cs
    # Should return zero results
    dotnet build DataWarehouse.CLI/DataWarehouse.CLI.csproj --no-restore 2>&1 | tail -3
  </verify>
  <done>Zero TODO comments in BackupCommands.cs and PluginCommands.cs. Both query message bus for real data. Build succeeds with 0 errors, 0 warnings.</done>
</task>

<task type="auto">
  <name>Task 2: Wire CLI developer, health, and RAID commands to message bus</name>
  <files>
    DataWarehouse.CLI/Commands/DeveloperCommands.cs
    DataWarehouse.CLI/Commands/HealthCommands.cs
    DataWarehouse.CLI/Commands/RaidCommands.cs
  </files>
  <action>
    In DeveloperCommands.cs (7 TODOs at lines 561, 600, 608, 633, 641, 649, 657):
    - Line 561 "Query kernel/message bus for actual API endpoints": Publish to "interface.api.list" and display real endpoint data. Fallback: "No API endpoint data available".
    - Line 600 "Query kernel/message bus for actual schemas": Publish to "dataformat.schema.list" to get registered schemas. Fallback: "No schema data available".
    - Line 608 "Query kernel/message bus for actual schema": Same topic, filter by specific schema name.
    - Line 633 "Query kernel/message bus for actual collections": Publish to "storage.collection.list". Fallback: "No collection data available".
    - Line 641 "Query kernel/message bus for actual fields": Publish to "storage.collection.fields" with collection name. Fallback: "No field data available".
    - Line 649 "Query kernel/message bus for actual query results": Publish to "storage.query.execute" with query. Fallback: "Query execution unavailable".
    - Line 657 "Query kernel/message bus for actual query templates": Publish to "storage.query.templates". Fallback: "No query templates available".

    In HealthCommands.cs (line 190): Replace "Query kernel/message bus for actual alerts" with a real request to "observability.alert.list". Display real alert data. Fallback: "No alert data available".

    In RaidCommands.cs (line 177): Replace "Query kernel/message bus for actual RAID configurations" with a real request to "raid.configuration.list". Display real RAID config. Fallback: "No RAID configuration data available".

    Pattern for all: Use the RequestAsync pattern on the message bus (publish and await response). Check if the response payload contains data. If timeout or no response, display the fallback message. Remove all TODO comments.

    IMPORTANT: Do NOT add any new project references. Do NOT create placeholder/mock responses. Use descriptive "not available" messages as fallback.
  </action>
  <verify>
    grep -rn "// TODO" DataWarehouse.CLI/Commands/DeveloperCommands.cs DataWarehouse.CLI/Commands/HealthCommands.cs DataWarehouse.CLI/Commands/RaidCommands.cs
    # Should return zero results
    dotnet build DataWarehouse.CLI/DataWarehouse.CLI.csproj --no-restore 2>&1 | tail -3
  </verify>
  <done>Zero TODO comments in DeveloperCommands.cs, HealthCommands.cs, and RaidCommands.cs. All query message bus for real data. Build succeeds with 0 errors, 0 warnings.</done>
</task>

</tasks>

<verification>
grep -rn "// TODO\|// FIXME\|// HACK\|// STUB\|// PLACEHOLDER" DataWarehouse.CLI/ --include="*.cs"
# Must return zero results
dotnet build DataWarehouse.slnx 2>&1 | tail -3
# Must show 0 errors, 0 warnings
</verification>

<success_criteria>
- Zero TODO/FIXME/HACK/STUB/PLACEHOLDER comments in any CLI command file
- All CLI commands query the message bus for real data
- Graceful fallback messages when data is unavailable (no fake/hardcoded data)
- Build: 0 errors, 0 warnings
</success_criteria>

<output>
After completion, create `.planning/phases/52-clean-house/52-01-SUMMARY.md`
</output>
