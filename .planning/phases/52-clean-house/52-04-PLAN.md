---
phase: 52-clean-house
plan: 04
type: execute
wave: 2
depends_on: ["52-01", "52-02", "52-03"]
files_modified:
  - DataWarehouse.Tests/DataWarehouse.Tests.csproj
  - DataWarehouse.Tests/Dashboard/DashboardServiceTests.cs
  - DataWarehouse.Tests/Infrastructure/DynamicEndpointGeneratorTests.cs
  - DataWarehouse.Tests/Infrastructure/EnvelopeEncryptionBenchmarks.cs
  - DataWarehouse.Tests/Infrastructure/TcpP2PNetworkTests.cs
  - DataWarehouse.Tests/Plugins/AdaptiveTransportTests.cs
  - DataWarehouse.Tests/Plugins/AedsCoreTests.cs
  - DataWarehouse.Tests/Plugins/AirGapBridgeTests.cs
  - DataWarehouse.Tests/Plugins/AppPlatformTests.cs
  - DataWarehouse.Tests/Plugins/ComputeWasmTests.cs
  - DataWarehouse.Tests/Plugins/DataMarketplaceTests.cs
  - DataWarehouse.Tests/Plugins/FuseDriverTests.cs
  - DataWarehouse.Tests/Plugins/KubernetesCsiTests.cs
  - DataWarehouse.Tests/Plugins/PluginMarketplaceTests.cs
  - DataWarehouse.Tests/Plugins/SelfEmulatingObjectsTests.cs
  - DataWarehouse.Tests/Plugins/UltimateBlockchainTests.cs
  - DataWarehouse.Tests/Plugins/UltimateComputeTests.cs
  - DataWarehouse.Tests/Plugins/UltimateConnectorTests.cs
autonomous: true

must_haves:
  truths:
    - "Zero Assert.True(true) placeholders in any of the 17 test files"
    - "Each test file has at least 3 meaningful behavior tests"
    - "All tests pass"
    - "Build compiles with 0 errors, 0 warnings"
  artifacts:
    - path: "DataWarehouse.Tests/DataWarehouse.Tests.csproj"
      provides: "ProjectReferences for all plugins being tested"
    - path: "DataWarehouse.Tests/Plugins/UltimateConnectorTests.cs"
      provides: "Real behavior tests for UltimateConnector plugin"
    - path: "DataWarehouse.Tests/Plugins/SelfEmulatingObjectsTests.cs"
      provides: "Real behavior tests for SelfEmulatingObjects plugin"
  key_links:
    - from: "DataWarehouse.Tests/*.cs"
      to: "Plugin assemblies"
      via: "ProjectReference in csproj"
      pattern: "ProjectReference"
---

<objective>
Replace placeholder tests batch 1: Infrastructure, Connectors, and Compute plugins (17 test files).

Purpose: 17 test files contain only `Assert.True(true)` placeholder assertions. Each must be replaced with real behavior tests that instantiate plugin classes and verify their actual behavior.

Output: 17 test files with real tests, all passing, all plugins referenced in csproj.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/PLUGIN-CATALOG.md
@DataWarehouse.Tests/DataWarehouse.Tests.csproj
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add missing ProjectReferences and replace infrastructure + connector test placeholders</name>
  <files>
    DataWarehouse.Tests/DataWarehouse.Tests.csproj
    DataWarehouse.Tests/Dashboard/DashboardServiceTests.cs
    DataWarehouse.Tests/Infrastructure/DynamicEndpointGeneratorTests.cs
    DataWarehouse.Tests/Infrastructure/EnvelopeEncryptionBenchmarks.cs
    DataWarehouse.Tests/Infrastructure/TcpP2PNetworkTests.cs
    DataWarehouse.Tests/Plugins/AdaptiveTransportTests.cs
    DataWarehouse.Tests/Plugins/AedsCoreTests.cs
    DataWarehouse.Tests/Plugins/AirGapBridgeTests.cs
    DataWarehouse.Tests/Plugins/UltimateConnectorTests.cs
    DataWarehouse.Tests/Plugins/UltimateBlockchainTests.cs
  </files>
  <action>
    STEP 1: Add missing ProjectReferences to DataWarehouse.Tests.csproj for all plugins being tested. Check which are already referenced (UltimateStorage, UltimateEncryption, etc are already there). Add references for: AdaptiveTransport, AedsCore, AirGapBridge, AppPlatform, Compute.Wasm, DataMarketplace, FuseDriver, KubernetesCsi, PluginMarketplace, SelfEmulatingObjects, UltimateBlockchain, UltimateConsensus (if not already there), UltimateConnector (if not already there).

    STEP 2: For each test file, read the corresponding plugin source to understand what public types and behaviors are available, then write 3-5 real tests per file.

    Test patterns to use (since these plugins use message bus and kernel context):
    - **Instantiation test**: Verify the plugin can be constructed and has correct Id, Name, Version properties.
    - **Capability test**: Verify the plugin reports correct capabilities/metadata via GetMetadata().
    - **Strategy test**: If the plugin has strategies, instantiate a strategy and verify StrategyId, Name, and capabilities are correct.
    - **Configuration test**: If the plugin has configuration, verify it accepts and validates configuration values.
    - **Edge case test**: Test null/empty inputs are handled gracefully (no unhandled exceptions).

    DO NOT mock the message bus or kernel context for these tests. Use the pattern from existing real tests (check DataWarehouse.Tests/Plugins/ for non-placeholder examples). If the plugin requires kernel context for instantiation, test only the parts that don't require it, or create a minimal test context.

    Keep [Trait("Category", "Unit")] on all tests. Add [Trait("Plugin", "PluginName")] where appropriate.

    For DashboardServiceTests.cs: Test the DashboardStrategyBase-derived classes in UniversalDashboards.
    For DynamicEndpointGeneratorTests.cs: Test endpoint generation logic from the Kernel.
    For EnvelopeEncryptionBenchmarks.cs: Convert to real encryption round-trip tests.
    For TcpP2PNetworkTests.cs: Test P2P network connection/disconnection logic.
  </action>
  <verify>
    grep -rn "Assert.True(true)" DataWarehouse.Tests/Dashboard/DashboardServiceTests.cs DataWarehouse.Tests/Infrastructure/DynamicEndpointGeneratorTests.cs DataWarehouse.Tests/Infrastructure/EnvelopeEncryptionBenchmarks.cs DataWarehouse.Tests/Infrastructure/TcpP2PNetworkTests.cs DataWarehouse.Tests/Plugins/AdaptiveTransportTests.cs DataWarehouse.Tests/Plugins/AedsCoreTests.cs DataWarehouse.Tests/Plugins/AirGapBridgeTests.cs DataWarehouse.Tests/Plugins/UltimateConnectorTests.cs DataWarehouse.Tests/Plugins/UltimateBlockchainTests.cs
    # Should return zero results
    dotnet test DataWarehouse.Tests/ --filter "Category=Unit" --no-restore 2>&1 | tail -5
  </verify>
  <done>Zero Assert.True(true) in these 9 test files. Each has 3+ real behavior tests. All tests pass.</done>
</task>

<task type="auto">
  <name>Task 2: Replace compute and marketplace plugin test placeholders</name>
  <files>
    DataWarehouse.Tests/Plugins/AppPlatformTests.cs
    DataWarehouse.Tests/Plugins/ComputeWasmTests.cs
    DataWarehouse.Tests/Plugins/DataMarketplaceTests.cs
    DataWarehouse.Tests/Plugins/FuseDriverTests.cs
    DataWarehouse.Tests/Plugins/KubernetesCsiTests.cs
    DataWarehouse.Tests/Plugins/PluginMarketplaceTests.cs
    DataWarehouse.Tests/Plugins/SelfEmulatingObjectsTests.cs
    DataWarehouse.Tests/Plugins/UltimateComputeTests.cs
  </files>
  <action>
    For each of the 8 remaining test files in this batch, read the corresponding plugin source and write 3-5 real tests.

    For SelfEmulatingObjectsTests.cs: Test the ViewerBundler (bundle/unbundle round-trip), format detection (detect PNG/JPEG/PDF by magic bytes), and viewer library (all formats have viewers). This plugin was updated in Plan 03 with snapshot/rollback/replay.

    For ComputeWasmTests.cs: The Compute.Wasm plugin has a WasmInterpreter. Test basic WASM execution, memory operations, and error handling.

    For AppPlatformTests.cs: Test app registration, capability reporting.
    For DataMarketplaceTests.cs: Test marketplace listing, metadata.
    For FuseDriverTests.cs: Test file operation request creation, attribute handling.
    For KubernetesCsiTests.cs: Test CSI driver volume lifecycle types.
    For PluginMarketplaceTests.cs: Test marketplace discovery, versioning.
    For UltimateComputeTests.cs: Test compute strategy instantiation, workload types.

    Same patterns as Task 1. Keep [Trait("Category", "Unit")]. No mocks for message bus - test what's testable without it.
  </action>
  <verify>
    grep -rn "Assert.True(true)" DataWarehouse.Tests/Plugins/AppPlatformTests.cs DataWarehouse.Tests/Plugins/ComputeWasmTests.cs DataWarehouse.Tests/Plugins/DataMarketplaceTests.cs DataWarehouse.Tests/Plugins/FuseDriverTests.cs DataWarehouse.Tests/Plugins/KubernetesCsiTests.cs DataWarehouse.Tests/Plugins/PluginMarketplaceTests.cs DataWarehouse.Tests/Plugins/SelfEmulatingObjectsTests.cs DataWarehouse.Tests/Plugins/UltimateComputeTests.cs
    # Should return zero results
    dotnet test DataWarehouse.Tests/ --filter "Category=Unit" --no-restore 2>&1 | tail -5
  </verify>
  <done>Zero Assert.True(true) in these 8 test files. Each has 3+ real behavior tests. All tests pass.</done>
</task>

</tasks>

<verification>
grep -rn "Assert.True(true)" DataWarehouse.Tests/Dashboard/ DataWarehouse.Tests/Infrastructure/ DataWarehouse.Tests/Plugins/AdaptiveTransportTests.cs DataWarehouse.Tests/Plugins/AedsCoreTests.cs DataWarehouse.Tests/Plugins/AirGapBridgeTests.cs DataWarehouse.Tests/Plugins/AppPlatformTests.cs DataWarehouse.Tests/Plugins/ComputeWasmTests.cs DataWarehouse.Tests/Plugins/DataMarketplaceTests.cs DataWarehouse.Tests/Plugins/FuseDriverTests.cs DataWarehouse.Tests/Plugins/KubernetesCsiTests.cs DataWarehouse.Tests/Plugins/PluginMarketplaceTests.cs DataWarehouse.Tests/Plugins/SelfEmulatingObjectsTests.cs DataWarehouse.Tests/Plugins/UltimateBlockchainTests.cs DataWarehouse.Tests/Plugins/UltimateComputeTests.cs DataWarehouse.Tests/Plugins/UltimateConnectorTests.cs
# Must return zero results
dotnet test DataWarehouse.Tests/ --filter "Category=Unit" --no-restore 2>&1 | tail -5
# All tests must pass
</verification>

<success_criteria>
- Zero Assert.True(true) placeholders in all 17 test files
- Each test file has at least 3 real behavior tests
- All necessary ProjectReferences added to DataWarehouse.Tests.csproj
- All tests pass
- Build: 0 errors, 0 warnings
</success_criteria>

<output>
After completion, create `.planning/phases/52-clean-house/52-04-SUMMARY.md`
</output>
