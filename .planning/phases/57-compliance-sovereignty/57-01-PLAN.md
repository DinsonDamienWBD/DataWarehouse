---
phase: 57-compliance-sovereignty
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - DataWarehouse.SDK/Compliance/CompliancePassport.cs
  - DataWarehouse.SDK/Compliance/ISovereigntyMesh.cs
  - DataWarehouse.SDK/Compliance/PassportEnums.cs
autonomous: true
must_haves:
  truths:
    - "SDK defines CompliancePassport as a portable per-object certification record"
    - "SDK defines ISovereigntyMesh interface for declarative zone enforcement"
    - "Passport carries regulations, status, audit timestamps, evidence chain, expiration"
    - "All downstream plans can reference SDK types without circular dependencies"
  artifacts:
    - path: "DataWarehouse.SDK/Compliance/CompliancePassport.cs"
      provides: "CompliancePassport record, PassportEntry, EvidenceLink, PassportVerificationResult types"
      min_lines: 150
    - path: "DataWarehouse.SDK/Compliance/ISovereigntyMesh.cs"
      provides: "ISovereigntyMesh, ISovereigntyZone, IZoneEnforcer, ICrossBorderProtocol interfaces"
      min_lines: 120
    - path: "DataWarehouse.SDK/Compliance/PassportEnums.cs"
      provides: "PassportStatus, PassportScope, EvidenceType, ZoneAction, TransferDecision enums"
      min_lines: 80
  key_links:
    - from: "DataWarehouse.SDK/Compliance/CompliancePassport.cs"
      to: "DataWarehouse.SDK/Compliance/PassportEnums.cs"
      via: "enum references"
      pattern: "PassportStatus|PassportScope|EvidenceType"
    - from: "DataWarehouse.SDK/Compliance/ISovereigntyMesh.cs"
      to: "DataWarehouse.SDK/Compliance/CompliancePassport.cs"
      via: "passport parameter in zone check methods"
      pattern: "CompliancePassport"
---

<objective>
Define all SDK types and interfaces for Compliance Passports and Sovereignty Mesh.

Purpose: Establish the foundational type contracts that all 8 subsequent plans build on. Passports are per-object compliance certifications; sovereignty mesh is the declarative zone enforcement layer. Both must live in the SDK so plugins can reference them without circular dependencies.

Output: Three new SDK files defining the complete type surface for Phase 57.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/PLUGIN-CATALOG.md
@DataWarehouse.SDK/Compliance/IComplianceAutomation.cs
@DataWarehouse.SDK/Contracts/Compliance/ComplianceStrategy.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Define CompliancePassport types and PassportEnums</name>
  <files>
    DataWarehouse.SDK/Compliance/PassportEnums.cs
    DataWarehouse.SDK/Compliance/CompliancePassport.cs
  </files>
  <action>
Create `PassportEnums.cs` in namespace `DataWarehouse.SDK.Compliance` with:
- `PassportStatus` enum: Active, Expired, Revoked, Suspended, PendingReview, Provisional
- `PassportScope` enum: Object, Collection, Tenant, System, CrossBorder
- `EvidenceType` enum: AutomatedCheck, ManualAudit, CertificateChain, ZeroKnowledgeProof, AttestationReport, ThirdPartyVerification, ContinuousMonitoring
- `ZoneAction` enum: Allow, Deny, RequireApproval, RequireEncryption, RequireAnonymization, Quarantine
- `TransferDecision` enum: Approved, Denied, ConditionalApproval, PendingAgreement, EscalationRequired
- `PassportRevocationReason` enum: Expired, PolicyChange, SecurityBreach, RegulatoryUpdate, ManualRevocation, ComplianceFailure

Create `CompliancePassport.cs` in namespace `DataWarehouse.SDK.Compliance` with:
- `CompliancePassport` sealed record:
  - `string PassportId` (required, unique UUID-based)
  - `string ObjectId` (required, the data object this passport certifies)
  - `PassportStatus Status` (required)
  - `PassportScope Scope` (required)
  - `IReadOnlyList<PassportEntry> Entries` (required, one per regulation)
  - `IReadOnlyList<EvidenceLink> EvidenceChain` (required)
  - `DateTimeOffset IssuedAt` (required)
  - `DateTimeOffset ExpiresAt` (required)
  - `DateTimeOffset? LastVerifiedAt`
  - `string IssuerId` (required, who/what issued the passport)
  - `string? TenantId`
  - `IReadOnlyDictionary<string, object>? Metadata`
  - `byte[]? DigitalSignature` (cryptographic signature of passport contents)
  - Helper method `bool IsValid()` that checks Status == Active && ExpiresAt > DateTimeOffset.UtcNow
  - Helper method `bool CoversRegulation(string regulationId)` that checks Entries

- `PassportEntry` sealed record:
  - `string RegulationId` (required, e.g. "GDPR", "HIPAA")
  - `string ControlId` (required, specific control within regulation)
  - `PassportStatus Status` (required)
  - `DateTimeOffset AssessedAt` (required)
  - `DateTimeOffset? NextAssessmentDue`
  - `double ComplianceScore` (0.0-1.0)
  - `IReadOnlyList<string>? Conditions` (conditions for compliance)
  - `IReadOnlyDictionary<string, object>? Evidence`

- `EvidenceLink` sealed record:
  - `string EvidenceId` (required)
  - `EvidenceType Type` (required)
  - `string Description` (required)
  - `DateTimeOffset CollectedAt` (required)
  - `string? ArtifactReference` (URI to evidence artifact)
  - `byte[]? ContentHash` (SHA-256 of evidence content)
  - `string? VerifierId` (who verified this evidence)

- `PassportVerificationResult` sealed record:
  - `bool IsValid` (required)
  - `CompliancePassport Passport` (required)
  - `IReadOnlyList<string> FailureReasons`
  - `DateTimeOffset VerifiedAt`
  - `bool SignatureValid`
  - `bool AllEntriesCurrent`

All records use `required` for mandatory fields. All use `init` setters. Use XML doc comments on every type and property. Namespace: `DataWarehouse.SDK.Compliance`.
  </action>
  <verify>Build the SDK project: `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj --no-restore 2>&1 | tail -5` should show 0 errors.</verify>
  <done>PassportEnums.cs has 6 enums. CompliancePassport.cs has CompliancePassport, PassportEntry, EvidenceLink, PassportVerificationResult records with full XML docs.</done>
</task>

<task type="auto">
  <name>Task 2: Define ISovereigntyMesh interfaces</name>
  <files>DataWarehouse.SDK/Compliance/ISovereigntyMesh.cs</files>
  <action>
Create `ISovereigntyMesh.cs` in namespace `DataWarehouse.SDK.Compliance` with:

- `ISovereigntyZone` interface:
  - `string ZoneId { get; }` (unique zone identifier, e.g. "eu-gdpr-zone")
  - `string Name { get; }` (human-readable)
  - `IReadOnlyList<string> Jurisdictions { get; }` (country codes in this zone)
  - `IReadOnlyList<string> RequiredRegulations { get; }` (regulations enforced)
  - `IReadOnlyDictionary<string, ZoneAction> ActionRules { get; }` (tag-based rules: key=tag pattern, value=action)
  - `bool IsActive { get; }`
  - `Task<ZoneAction> EvaluateAsync(string objectId, CompliancePassport? passport, IReadOnlyDictionary<string, object> context, CancellationToken ct)`

- `IZoneEnforcer` interface:
  - `Task<ZoneEnforcementResult> EnforceAsync(string objectId, string sourceZoneId, string destinationZoneId, CompliancePassport? passport, CancellationToken ct)`
  - `Task<IReadOnlyList<ISovereigntyZone>> GetZonesForJurisdictionAsync(string jurisdictionCode, CancellationToken ct)`
  - `Task<ISovereigntyZone?> GetZoneAsync(string zoneId, CancellationToken ct)`
  - `Task RegisterZoneAsync(ISovereigntyZone zone, CancellationToken ct)`
  - `Task DeactivateZoneAsync(string zoneId, CancellationToken ct)`

- `ZoneEnforcementResult` sealed record:
  - `bool Allowed` (required)
  - `ZoneAction Action` (required)
  - `string? DenialReason`
  - `IReadOnlyList<string>? RequiredActions` (what must happen before transfer)
  - `string SourceZoneId` (required)
  - `string DestinationZoneId` (required)
  - `DateTimeOffset EvaluatedAt`

- `ICrossBorderProtocol` interface:
  - `Task<TransferAgreementRecord> NegotiateTransferAsync(string sourceJurisdiction, string destJurisdiction, CompliancePassport passport, CancellationToken ct)`
  - `Task<TransferDecision> EvaluateTransferAsync(string transferId, CancellationToken ct)`
  - `Task LogTransferAsync(CrossBorderTransferLog log, CancellationToken ct)`
  - `Task<IReadOnlyList<CrossBorderTransferLog>> GetTransferHistoryAsync(string objectId, int limit, CancellationToken ct)`

- `TransferAgreementRecord` sealed record:
  - `string AgreementId` (required)
  - `string SourceJurisdiction` (required)
  - `string DestinationJurisdiction` (required)
  - `TransferDecision Decision` (required)
  - `IReadOnlyList<string>? Conditions`
  - `DateTimeOffset NegotiatedAt`
  - `DateTimeOffset? ExpiresAt`
  - `string? LegalBasis` (SCC, BCR, AdequacyDecision, etc.)

- `CrossBorderTransferLog` sealed record:
  - `string TransferId` (required)
  - `string ObjectId` (required)
  - `string SourceJurisdiction` (required)
  - `string DestinationJurisdiction` (required)
  - `string PassportId` (required)
  - `TransferDecision Decision` (required)
  - `string? AgreementId`
  - `DateTimeOffset Timestamp`
  - `IReadOnlyDictionary<string, object>? Metadata`

- `ISovereigntyMesh` interface (the top-level orchestrator):
  - `IZoneEnforcer ZoneEnforcer { get; }`
  - `ICrossBorderProtocol CrossBorderProtocol { get; }`
  - `Task<CompliancePassport> IssuePassportAsync(string objectId, IReadOnlyList<string> regulations, CancellationToken ct)`
  - `Task<PassportVerificationResult> VerifyPassportAsync(string passportId, CancellationToken ct)`
  - `Task<ZoneEnforcementResult> CheckSovereigntyAsync(string objectId, string sourceLocation, string destLocation, CancellationToken ct)`

All interfaces and records use XML doc comments. Use `required` for mandatory record properties.
  </action>
  <verify>Build the SDK project: `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj --no-restore 2>&1 | tail -5` should show 0 errors.</verify>
  <done>ISovereigntyMesh.cs defines ISovereigntyZone, IZoneEnforcer, ICrossBorderProtocol, ISovereigntyMesh interfaces plus ZoneEnforcementResult, TransferAgreementRecord, CrossBorderTransferLog records. SDK builds clean.</done>
</task>

</tasks>

<verification>
- `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` passes with 0 errors
- All 3 new files exist under DataWarehouse.SDK/Compliance/
- No circular dependencies introduced
- All types use `DataWarehouse.SDK.Compliance` namespace
</verification>

<success_criteria>
- SDK builds with 0 errors
- CompliancePassport record has ObjectId, Status, Entries, EvidenceChain, DigitalSignature, ExpiresAt
- ISovereigntyMesh interface exposes IssuePassportAsync, VerifyPassportAsync, CheckSovereigntyAsync
- ISovereigntyZone supports tag-based ActionRules
- ICrossBorderProtocol supports NegotiateTransferAsync with legal basis
</success_criteria>

<output>
After completion, create `.planning/phases/57-compliance-sovereignty/57-01-SUMMARY.md`
</output>
