---
phase: 65-infrastructure
plan: 09
type: execute
wave: 1
depends_on: []
files_modified:
  - DataWarehouse.SDK/Security/Siem/SiemTransportBridge.cs
  - DataWarehouse.SDK/Security/Siem/ISiemTransport.cs
  - DataWarehouse.SDK/Security/IncidentResponse/IncidentResponseEngine.cs
  - DataWarehouse.SDK/Security/IncidentResponse/ContainmentActions.cs
autonomous: true

must_haves:
  truths:
    - "Security events flow to external SIEM (Splunk, Sentinel, QRadar) via transport bridge"
    - "Incident response engine can execute containment actions (isolate node, revoke credentials, block IP)"
    - "All containment actions are logged to audit trail before and after execution"
  artifacts:
    - path: "DataWarehouse.SDK/Security/Siem/ISiemTransport.cs"
      provides: "SIEM transport interface"
      exports: ["ISiemTransport", "SiemEvent"]
    - path: "DataWarehouse.SDK/Security/Siem/SiemTransportBridge.cs"
      provides: "Bridges DW security events to external SIEM systems"
      min_lines: 150
    - path: "DataWarehouse.SDK/Security/IncidentResponse/IncidentResponseEngine.cs"
      provides: "Automated incident response with containment actions"
      min_lines: 200
    - path: "DataWarehouse.SDK/Security/IncidentResponse/ContainmentActions.cs"
      provides: "IsolateNode, RevokeCredentials, BlockIp, QuarantineData actions"
      min_lines: 100
  key_links:
    - from: "SiemTransportBridge"
      to: "IMessageBus"
      via: "security event subscription"
      pattern: "security\\.event|security\\.alert"
    - from: "IncidentResponseEngine"
      to: "ContainmentActions"
      via: "action execution"
      pattern: "IContainmentAction.*Execute"
---

<objective>
Wire SIEM transport for external security event delivery and build incident response containment actions.

Purpose: Security score is 91/100 after Phase 53. Missing items include SIEM integration (security events stay internal) and incident response automation (manual containment only). These are needed for Tier 5-7 (regulated/military) compliance.

Output: ISiemTransport + SiemTransportBridge + IncidentResponseEngine + ContainmentActions in SDK/Security/.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/PLUGIN-CATALOG.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: SIEM transport bridge</name>
  <files>
    DataWarehouse.SDK/Security/Siem/ISiemTransport.cs
    DataWarehouse.SDK/Security/Siem/SiemTransportBridge.cs
  </files>
  <action>
Create DataWarehouse.SDK/Security/Siem/ folder.

Create ISiemTransport.cs:
- ISiemTransport interface: SendEventAsync(SiemEvent evt, CancellationToken ct), SendBatchAsync(IReadOnlyList<SiemEvent> events, CancellationToken ct), TestConnectionAsync(CancellationToken ct) -> bool
- SiemEvent record: Timestamp (DateTimeOffset), Severity (SiemSeverity enum: Info, Low, Medium, High, Critical), Source (string), EventType (string), Description (string), Metadata (Dictionary<string, string>), RawData (string?)
- SiemSeverity maps to common syslog severity levels
- SiemTransportOptions: Endpoint (Uri), AuthToken (string?), BatchSize (int, default 100), FlushIntervalMs (int, default 5000), MaxRetries (int, default 3)

Create SiemTransportBridge.cs:
- Subscribes to MessageBus topics: "security.event.*", "security.alert.*", "access.denied", "auth.failed"
- Converts DW security events to SiemEvent format (CEF - Common Event Format)
- Batches events (configurable batch size) and flushes periodically or when batch full
- Supports multiple SIEM transports simultaneously (fan-out)
- Built-in transports (implement as ISiemTransport):
  - SyslogSiemTransport: sends via UDP/TCP syslog (RFC 5424 format)
  - HttpSiemTransport: sends via HTTPS POST (for Splunk HEC, Azure Sentinel, generic webhook)
  - FileSiemTransport: writes to local file (for air-gapped environments)
- Retry with exponential backoff on transport failure (1s, 2s, 4s base)
- Circuit breaker: if transport fails 5 consecutive times, open circuit for 60s
- Buffer overflow: bounded queue (10000 events), oldest dropped when full with warning log
- Thread-safe: uses Channel<SiemEvent> for producer-consumer pattern

Register bridge in plugin initialization via bus subscription.
  </action>
  <verify>dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj — zero errors</verify>
  <done>SIEM transport bridge subscribes to security events and delivers to external systems via syslog, HTTPS, or file; supports batching, retry, circuit breaker</done>
</task>

<task type="auto">
  <name>Task 2: Incident response engine with containment actions</name>
  <files>
    DataWarehouse.SDK/Security/IncidentResponse/IncidentResponseEngine.cs
    DataWarehouse.SDK/Security/IncidentResponse/ContainmentActions.cs
  </files>
  <action>
Create DataWarehouse.SDK/Security/IncidentResponse/ folder.

Create ContainmentActions.cs:
- IContainmentAction interface: string ActionId, string Description, Task<ContainmentResult> ExecuteAsync(ContainmentContext ctx, CancellationToken ct), Task<ContainmentResult> RollbackAsync(ContainmentContext ctx, CancellationToken ct)
- ContainmentContext record: IncidentId (string), Severity, TargetNodeId (string?), TargetUserId (string?), TargetIpAddress (string?), TargetDataKey (string?), Metadata
- ContainmentResult record: Success (bool), ActionId, ExecutedAt (DateTimeOffset), Details (string), RollbackAvailable (bool)

Built-in actions (all publish to message bus for actual enforcement):
- IsolateNodeAction: publishes "cluster.node.isolate" — removes node from SWIM membership, blocks incoming connections
- RevokeCredentialsAction: publishes "auth.credentials.revoke" — invalidates all sessions for target user, rotates affected API keys
- BlockIpAction: publishes "network.ip.block" — adds IP to deny list, terminates active connections from that IP
- QuarantineDataAction: publishes "storage.data.quarantine" — moves data to quarantine storage, removes from active indexes
- ReadOnlyModeAction: publishes "system.mode.readonly" — puts system in read-only mode (no writes), allows reads
- AuditSnapshotAction: publishes "audit.snapshot.create" — captures current state for forensic analysis

Create IncidentResponseEngine.cs:
- RegisterAction(IContainmentAction action)
- CreateIncident(IncidentSeverity severity, string description, Dictionary<string, string>? metadata = null) -> Incident
- ExecutePlaybook(Incident incident, IReadOnlyList<string> actionIds, CancellationToken ct) -> PlaybookResult
- Incident record: Id (Guid), CreatedAt, Severity, Description, Status (Open/Contained/Resolved), Actions (list of ContainmentResult)
- PlaybookResult: Incident, AllSucceeded (bool), Results (list of ContainmentResult)
- Auto-response rules: register rules that auto-trigger playbooks based on event patterns
  - Example: 5 failed auth from same IP in 60s -> auto-execute BlockIpAction
  - AutoResponseRule record: Name, EventPattern (regex on bus topic), Threshold (int), WindowSeconds (int), PlaybookActionIds
- All actions logged to audit trail BEFORE execution (intent) and AFTER execution (result)
- MessageBus subscription: listen for "security.alert.critical" to auto-trigger incident creation
  </action>
  <verify>dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj — zero errors</verify>
  <done>IncidentResponseEngine with 6 containment actions, auto-response rules, and audit logging exists; all actions communicate via message bus</done>
</task>

</tasks>

<verification>
- Build passes with zero errors
- ISiemTransport has 3 implementations (syslog, HTTP, file)
- 6 containment actions registered in engine
- Auto-response rules can be configured
</verification>

<success_criteria>
SIEM transport wiring and incident response containment actions exist in SDK/Security/. Security events flow externally, incidents can be auto-detected and contained.
</success_criteria>

<output>
After completion, create `.planning/phases/65-infrastructure/65-09-SUMMARY.md`
</output>
