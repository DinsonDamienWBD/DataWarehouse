---
phase: 05-tamperproof-pipeline
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "All T4.16-T4.20 sub-tasks (24 items) are verified as production-ready with real cryptographic implementations"
    - "HashProviderFactory covers all algorithm families: SHA-3, Keccak, HMAC, Salted, Salted-HMAC"
    - "SHA-3 providers use BouncyCastle Sha3Digest (not hand-rolled)"
    - "Keccak providers use BouncyCastle KeccakDigest (not hand-rolled)"
    - "HMAC providers use System.Security.Cryptography.HMAC* for standard variants"
    - "Salted variants wrap inner IHashProvider with per-object random salt"
    - "All T4.16-T4.20 items in TODO.md are marked [x]"
    - "T4.21-T4.23 (compression) are marked [x] with note referencing T92 UltimateCompression"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.TamperProof/Hashing/HashProviders.cs"
      provides: "All hash provider implementations and HashProviderFactory"
  key_links:
    - from: "HashProviderFactory"
      to: "Individual hash providers"
      via: "factory Create/CreateHmac/CreateSalted methods"
      pattern: "HashProviderFactory\\.Create"
    - from: "SHA-3/Keccak providers"
      to: "BouncyCastle"
      via: "Sha3Digest and KeccakDigest"
      pattern: "Sha3Digest|KeccakDigest"
---

<objective>
Verify all hashing algorithm implementations (T4.16-T4.20, 24 sub-tasks) are production-ready with real cryptographic libraries, and resolve the compression scope issue (T4.21-T4.23) by marking them as handled by T92 UltimateCompression.

Purpose: Hashing is foundational to integrity verification. All hash providers must use audited cryptographic libraries (BouncyCastle for SHA-3/Keccak, System.Security.Cryptography for HMAC). The compression tasks (T4.21-T4.23) are architecturally out of scope for TamperProof and belong to T92.

Output: 24 hashing sub-tasks + 10 compression sub-tasks marked [x] in TODO.md. Verification confirming cryptographic correctness.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/05-tamperproof-pipeline/05-RESEARCH.md

@Plugins/DataWarehouse.Plugins.TamperProof/Hashing/HashProviders.cs
@DataWarehouse.SDK/Contracts/TamperProof/TamperProofEnums.cs
@Metadata/TODO.md (T4.16-T4.23 section, lines 2148-2211)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify T4.16-T4.20 Hashing Implementations</name>
  <files>
    Plugins/DataWarehouse.Plugins.TamperProof/Hashing/HashProviders.cs
    DataWarehouse.SDK/Contracts/TamperProof/TamperProofEnums.cs
  </files>
  <action>
    Read HashProviders.cs (~978 lines) and verify each sub-task:

    **T4.16 - SHA-3 family (BouncyCastle Sha3Digest):**
    - T4.16.1: Sha3_256Provider using `new Sha3Digest(256)`
    - T4.16.2: Sha3_384Provider using `new Sha3Digest(384)`
    - T4.16.3: Sha3_512Provider using `new Sha3Digest(512)`
    Confirm: Real BouncyCastle Sha3Digest, not hand-rolled Keccak

    **T4.17 - Keccak family (BouncyCastle KeccakDigest):**
    - T4.17.1: Keccak256Provider using `new KeccakDigest(256)`
    - T4.17.2: Keccak384Provider using `new KeccakDigest(384)`
    - T4.17.3: Keccak512Provider using `new KeccakDigest(512)`
    Confirm: Uses KeccakDigest (pre-NIST), NOT Sha3Digest

    **T4.18 - HMAC variants (keyed hashes):**
    - T4.18.1: HmacSha256Provider using `System.Security.Cryptography.HMACSHA256`
    - T4.18.2: HmacSha384Provider using `System.Security.Cryptography.HMACSHA384`
    - T4.18.3: HmacSha512Provider using `System.Security.Cryptography.HMACSHA512`
    - T4.18.4: HmacSha3_256Provider (manual HMAC construction with SHA-3)
    - T4.18.5: Verify if HmacSha3_384 exists (research says HMAC-SHA3-256 only -- may need T4.18.5-6 noted as N/A if only 256 variant implemented, or confirm all 3 exist)
    - T4.18.6: Same as above
    Confirm: System.Security.Cryptography for standard HMAC, BouncyCastle for SHA-3 HMAC variants

    **T4.19 - Salted hash variants:**
    - T4.19.1-T4.19.5: SaltedHashProvider wrapping inner IHashProvider with SaltedStream
    Confirm: Per-object random salt, salt stored alongside hash for verification

    **T4.20 - Salted HMAC variants:**
    - T4.20.1-T4.20.4: Salted HMAC combining key + per-object salt
    Confirm: Combines HMAC key with per-object salt

    **HashProviderFactory verification:**
    - `Create(HashAlgorithm)` returns correct provider for all enum values
    - `CreateHmac(HashAlgorithm, byte[] key)` returns HMAC variant
    - `CreateSalted(HashAlgorithm)` returns salted variant
    - `IsSupported(HashAlgorithm)` returns true for all implemented algorithms

    Scan for forbidden patterns in Hashing/ directory.

    **IMPORTANT:** If HMAC-SHA3-384 and HMAC-SHA3-512 (T4.18.5-T4.18.6) do not exist as separate providers, check if the SaltedHashProvider can wrap them generically. If truly missing, they should be added following the HmacSha3_256Provider pattern but with Sha3Digest(384) and Sha3Digest(512). Use BouncyCastle's HMac class with Sha3Digest for these.
  </action>
  <verify>
    Run: `dotnet build Plugins/DataWarehouse.Plugins.TamperProof/DataWarehouse.Plugins.TamperProof.csproj --no-restore 2>&1 | tail -5`
    Expect: Build succeeded.

    Verify provider classes exist:
    - `grep -c "class.*Provider" Plugins/DataWarehouse.Plugins.TamperProof/Hashing/HashProviders.cs`
    Expect: At least 10 provider classes.

    Verify BouncyCastle usage:
    - `grep "Sha3Digest\|KeccakDigest" Plugins/DataWarehouse.Plugins.TamperProof/Hashing/HashProviders.cs`

    Verify factory coverage:
    - `grep "HashProviderFactory" Plugins/DataWarehouse.Plugins.TamperProof/Hashing/HashProviders.cs`
  </verify>
  <done>All T4.16-T4.20 hash providers verified as using real cryptographic libraries. Factory covers all algorithm variants. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Mark T4.16-T4.23 Complete in TODO.md</name>
  <files>Metadata/TODO.md</files>
  <action>
    In Metadata/TODO.md, mark hashing and compression tasks complete:

    **Hashing (T4.16-T4.20) -- mark all `[ ]` to `[x]` on lines 2151-2176:**
    - Lines 2151-2154: T4.16, T4.16.1-T4.16.3 (SHA-3)
    - Lines 2155-2158: T4.17, T4.17.1-T4.17.3 (Keccak)
    - Lines 2159-2165: T4.18, T4.18.1-T4.18.6 (HMAC)
    - Lines 2166-2171: T4.19, T4.19.1-T4.19.5 (Salted)
    - Lines 2172-2176: T4.20, T4.20.1-T4.20.4 (Salted-HMAC)

    **Compression (T4.21-T4.23) -- mark all `[ ]` to `[x]` on lines 2181-2193:**
    - Lines 2181-2184: T4.21, T4.21.1-T4.21.3 (Classic: RLE, Huffman, LZW)
    - Lines 2185-2189: T4.22, T4.22.1-T4.22.4 (Dictionary: BZip2, LZMA, LZMA2, Snappy)
    - Lines 2190-2193: T4.23, T4.23.1-T4.23.3 (Statistical: PPM, NNCP, Schumacher)

    For compression tasks T4.21-T4.23, update the status column to `[x]` AND append a note to the Description column:
    - Change description for T4.21 to: `Implement classic/simple compression algorithms (→ T92 UltimateCompression)`
    - Change description for T4.22 to: `Implement dictionary-based compression (→ T92 UltimateCompression)`
    - Change description for T4.23 to: `Implement statistical/context compression (→ T92 UltimateCompression)`

    Also update the Compression Algorithm Reference table (lines ~2203-2211): change `[ ] Pending` to `[x] T92` for all pending algorithms.

    Note: Line numbers are approximate. Search for exact patterns.
  </action>
  <verify>
    Run: `grep -E "T4\.(1[6-9]|20)\b" Metadata/TODO.md | grep "\[ \]"` -- should return zero.
    Run: `grep -E "T4\.2[1-3]" Metadata/TODO.md | grep "\[ \]"` -- should return zero.
    Run: `grep "T92 UltimateCompression" Metadata/TODO.md | head -3` -- should show the scope notes.
  </verify>
  <done>24 hashing sub-tasks marked [x]. 10 compression sub-tasks marked [x] with T92 scope notes. Compression reference table updated.</done>
</task>

</tasks>

<verification>
1. `dotnet build Plugins/DataWarehouse.Plugins.TamperProof/DataWarehouse.Plugins.TamperProof.csproj` passes
2. All hash providers use real crypto libraries (BouncyCastle SHA-3/Keccak, System.Security HMAC)
3. HashProviderFactory Create/CreateHmac/CreateSalted cover all algorithm variants
4. Zero T4.16-T4.23 sub-tasks remain marked `[ ]` in TODO.md
5. T4.21-T4.23 have clear scope notes pointing to T92
</verification>

<success_criteria>
- All 24 hashing sub-tasks verified production-ready
- All 34 sub-tasks (24 hashing + 10 compression) marked [x] in TODO.md
- Compression scope resolution documented with T92 reference
- Build passes without errors
</success_criteria>

<output>
After completion, create `.planning/phases/05-tamperproof-pipeline/05-03-SUMMARY.md`
</output>
