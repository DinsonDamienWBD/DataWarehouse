---
phase: 60-semantic-sync
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - DataWarehouse.SDK/Contracts/SemanticSync/ISemanticClassifier.cs
  - DataWarehouse.SDK/Contracts/SemanticSync/ISyncFidelityController.cs
  - DataWarehouse.SDK/Contracts/SemanticSync/ISummaryRouter.cs
  - DataWarehouse.SDK/Contracts/SemanticSync/ISemanticConflictResolver.cs
  - DataWarehouse.SDK/Contracts/SemanticSync/SemanticSyncModels.cs
  - DataWarehouse.SDK/Contracts/SemanticSync/SemanticSyncStrategyBase.cs
autonomous: true

must_haves:
  truths:
    - "All semantic sync components have SDK contracts they can implement"
    - "Strategy base class follows AD-05 flat hierarchy (no intelligence in strategies)"
    - "Models cover semantic importance, fidelity levels, sync decisions, and conflict types"
    - "Contracts are plugin-agnostic — any plugin can implement semantic sync strategies"
  artifacts:
    - path: "DataWarehouse.SDK/Contracts/SemanticSync/ISemanticClassifier.cs"
      provides: "Interface for AI-driven data importance classification"
      exports: ["ISemanticClassifier"]
    - path: "DataWarehouse.SDK/Contracts/SemanticSync/ISyncFidelityController.cs"
      provides: "Interface for bandwidth-aware fidelity adjustment"
      exports: ["ISyncFidelityController"]
    - path: "DataWarehouse.SDK/Contracts/SemanticSync/ISummaryRouter.cs"
      provides: "Interface for summary-vs-raw routing decisions"
      exports: ["ISummaryRouter"]
    - path: "DataWarehouse.SDK/Contracts/SemanticSync/ISemanticConflictResolver.cs"
      provides: "Interface for meaning-based conflict resolution"
      exports: ["ISemanticConflictResolver"]
    - path: "DataWarehouse.SDK/Contracts/SemanticSync/SemanticSyncModels.cs"
      provides: "All shared model types for semantic sync"
      contains: "SemanticImportance"
    - path: "DataWarehouse.SDK/Contracts/SemanticSync/SemanticSyncStrategyBase.cs"
      provides: "Base class for semantic sync strategies"
      contains: "class SemanticSyncStrategyBase : StrategyBase"
  key_links:
    - from: "SemanticSyncStrategyBase"
      to: "DataWarehouse.SDK.Contracts.StrategyBase"
      via: "inheritance"
      pattern: "class SemanticSyncStrategyBase : StrategyBase"
---

<objective>
Define all SDK contracts, interfaces, models, and the strategy base class for the Semantic Sync Protocol.

Purpose: Every subsequent plan in Phase 60 depends on these contracts. They define the vocabulary — semantic importance levels, fidelity tiers, sync decisions, conflict types — and the interfaces that strategies implement. Following AD-05, the strategy base is flat (inherits StrategyBase directly, no intelligence layer).

Output: 6 files in DataWarehouse.SDK/Contracts/SemanticSync/
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/PLUGIN-CATALOG.md
@DataWarehouse.SDK/Contracts/StrategyBase.cs
@DataWarehouse.SDK/Contracts/Replication/ReplicationStrategy.cs
@DataWarehouse.SDK/AI/IAIProvider.cs
@Plugins/DataWarehouse.Plugins.AdaptiveTransport/BandwidthMonitor/BandwidthModels.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Semantic Sync Models and Enums</name>
  <files>DataWarehouse.SDK/Contracts/SemanticSync/SemanticSyncModels.cs</files>
  <action>
Create SemanticSyncModels.cs in namespace DataWarehouse.SDK.Contracts.SemanticSync containing all shared types:

**Enums:**
- `SemanticImportance` — Critical, High, Normal, Low, Negligible (5 levels for AI classification output)
- `SyncFidelity` — Full, Detailed, Standard, Summarized, Metadata (5 fidelity levels from raw to metadata-only)
- `SyncDecisionReason` — BandwidthConstrained, HighImportance, LowImportance, PolicyOverride, UserExplicit, EdgeInferenceResult, ConflictResolution
- `ConflictType` — SemanticEquivalent, SemanticDivergent, SchemaEvolution, PartialOverlap, Irreconcilable
- `ConflictResolution` — MergeSemanticFields, PreferHigherFidelity, PreferNewerMeaning, PreferEdge, PreferCloud, DeferToUser, AutoResolve

**Records:**
- `SemanticClassification(string DataId, SemanticImportance Importance, double Confidence, string[] SemanticTags, string DomainHint, DateTimeOffset ClassifiedAt)` — result of AI classification
- `SyncDecision(string DataId, SyncFidelity Fidelity, SyncDecisionReason Reason, bool RequiresSummary, long EstimatedSizeBytes, TimeSpan? DeferUntil)` — what fidelity to sync at and when
- `DataSummary(string DataId, string SummaryText, byte[] SummaryEmbedding, SyncFidelity SourceFidelity, double CompressionRatio, DateTimeOffset GeneratedAt)` — AI-generated summary representation
- `SemanticConflict(string DataId, ConflictType Type, ReadOnlyMemory<byte> LocalData, ReadOnlyMemory<byte> RemoteData, SemanticClassification LocalClassification, SemanticClassification RemoteClassification)` — conflict with semantic context
- `ConflictResolutionResult(string DataId, ConflictResolution Strategy, ReadOnlyMemory<byte> ResolvedData, double SemanticSimilarity, string Explanation)` — resolution output
- `FidelityBudget(long AvailableBandwidthBps, int PendingSyncCount, double BudgetUtilizationPercent, Dictionary<SyncFidelity, int> FidelityDistribution)` — bandwidth budget state
- `EdgeInferenceResult(string ModelId, SemanticClassification Classification, SyncDecision Decision, double InferenceLatencyMs, bool UsedLocalModel)` — edge inference output

Follow existing record patterns from BandwidthModels.cs (sealed record, XML doc comments on each param). Use DateTimeOffset for timestamps. Use ReadOnlyMemory for data payloads.
  </action>
  <verify>dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj --no-restore 2>&1 | tail -5</verify>
  <done>All enums and records compile with zero errors, all types in namespace DataWarehouse.SDK.Contracts.SemanticSync</done>
</task>

<task type="auto">
  <name>Task 2: Interfaces and Strategy Base Class</name>
  <files>
    DataWarehouse.SDK/Contracts/SemanticSync/ISemanticClassifier.cs
    DataWarehouse.SDK/Contracts/SemanticSync/ISyncFidelityController.cs
    DataWarehouse.SDK/Contracts/SemanticSync/ISummaryRouter.cs
    DataWarehouse.SDK/Contracts/SemanticSync/ISemanticConflictResolver.cs
    DataWarehouse.SDK/Contracts/SemanticSync/SemanticSyncStrategyBase.cs
  </files>
  <action>
Create 5 files:

**ISemanticClassifier.cs** — Interface for AI-driven data importance classification:
- `Task<SemanticClassification> ClassifyAsync(ReadOnlyMemory<byte> data, IDictionary<string, string>? metadata = null, CancellationToken ct = default)` — classify a single item
- `IAsyncEnumerable<SemanticClassification> ClassifyBatchAsync(IAsyncEnumerable<(string DataId, ReadOnlyMemory<byte> Data)> items, CancellationToken ct = default)` — batch classification
- `Task<double> ComputeSemanticSimilarityAsync(ReadOnlyMemory<byte> data1, ReadOnlyMemory<byte> data2, CancellationToken ct = default)` — similarity score 0.0-1.0
- `SemanticClassifierCapabilities Capabilities { get; }` — record with bool flags: SupportsEmbeddings, SupportsLocalInference, SupportsDomainHints, MaxBatchSize (int)

**ISyncFidelityController.cs** — Interface for bandwidth-aware fidelity:
- `Task<SyncDecision> DecideFidelityAsync(SemanticClassification classification, FidelityBudget budget, CancellationToken ct = default)` — decide what fidelity for given classification and budget
- `Task<FidelityBudget> GetCurrentBudgetAsync(CancellationToken ct = default)` — get current budget state
- `Task UpdateBandwidthAsync(long currentBandwidthBps, CancellationToken ct = default)` — feed bandwidth measurement
- `Task SetPolicyAsync(FidelityPolicy policy, CancellationToken ct = default)` — configure policy
- Include `FidelityPolicy` record: MinFidelityForCritical (SyncFidelity), DefaultFidelity (SyncFidelity), BandwidthThresholds (Dictionary<long, SyncFidelity>), MaxDeferDuration (TimeSpan)

**ISummaryRouter.cs** — Interface for summary-vs-raw routing:
- `Task<SyncDecision> RouteAsync(string dataId, SemanticClassification classification, FidelityBudget budget, CancellationToken ct = default)` — decide summary vs raw
- `Task<DataSummary> GenerateSummaryAsync(string dataId, ReadOnlyMemory<byte> rawData, SyncFidelity targetFidelity, CancellationToken ct = default)` — create summary
- `Task<ReadOnlyMemory<byte>> ReconstructFromSummaryAsync(DataSummary summary, CancellationToken ct = default)` — best-effort reconstruct
- `SummaryRouterCapabilities Capabilities { get; }` — record: SupportedFidelities (SyncFidelity[]), MaxSummarySizeBytes (long), SupportsReconstruction (bool)

**ISemanticConflictResolver.cs** — Interface for meaning-based conflict resolution:
- `Task<SemanticConflict?> DetectConflictAsync(string dataId, ReadOnlyMemory<byte> localData, ReadOnlyMemory<byte> remoteData, CancellationToken ct = default)` — detect with semantic analysis
- `Task<ConflictResolutionResult> ResolveAsync(SemanticConflict conflict, CancellationToken ct = default)` — resolve using meaning
- `Task<ConflictType> ClassifyConflictAsync(SemanticConflict conflict, CancellationToken ct = default)` — classify what kind of conflict
- `ConflictResolverCapabilities Capabilities { get; }` — record: SupportsAutoMerge (bool), SupportedTypes (ConflictType[]), RequiresAI (bool)

**SemanticSyncStrategyBase.cs** — Abstract base class:
- Inherit from `StrategyBase` (DataWarehouse.SDK.Contracts) per AD-05 (flat hierarchy, no intelligence in strategies)
- Add virtual property `SemanticDomain` (string, e.g., "text", "binary", "structured", "media") indicating what kind of data this strategy handles
- Add virtual property `SupportsLocalInference` (bool, default false)
- Add protected helper `ValidateClassification(SemanticClassification classification)` that throws ArgumentException if Confidence < 0 or > 1
- Add protected helper `ComputeCosineSimilarity(float[] a, float[] b)` returning double (actual dot-product / magnitude implementation, NOT a stub)
- XML doc comments on every public member following existing SDK patterns

All interfaces in namespace DataWarehouse.SDK.Contracts.SemanticSync. Follow the existing pattern from IEdgeComputingStrategy.cs and IReplicationStrategy.
  </action>
  <verify>dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj --no-restore 2>&1 | tail -5</verify>
  <done>All 5 files compile, SemanticSyncStrategyBase extends StrategyBase, all interfaces define async methods with CancellationToken</done>
</task>

</tasks>

<verification>
- `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` compiles with zero errors
- All 6 files exist in DataWarehouse.SDK/Contracts/SemanticSync/
- SemanticSyncStrategyBase inherits from StrategyBase (grep confirms)
- No references to IMessageBus or intelligence layer in strategy base (AD-05 compliance)
- All public types have XML doc comments
</verification>

<success_criteria>
- 6 new files in SDK defining the complete contract surface for semantic sync
- All downstream plans (02-07) can reference these types without circular dependencies
- Zero build errors in SDK project
</success_criteria>

<output>
After completion, create `.planning/phases/60-semantic-sync/60-01-SUMMARY.md`
</output>
