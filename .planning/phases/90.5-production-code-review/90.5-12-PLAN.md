---
phase: 90.5-production-code-review
plan: 12
type: manual
wave: 3
depends_on: ["90.5-04"]
files_modified: [Plugins/DataWarehouse.Plugins.UltimateEncryption/]
autonomous: false

must_haves:
  truths:
    - "All ~24 throws are replaced with real encryption implementations or documented as capability guards"
    - "Every encryption strategy uses real cryptographic operations (no placeholders)"
    - "Wiring document explains cipher selection, key derivation, and encryption pipeline"
  artifacts:
    - path: ".planning/phases/90.5-production-code-review/wiring/12-encryption-wiring.md"
      provides: "Complete wiring documentation for UltimateEncryption"
  key_links:
    - from: "Plugins/DataWarehouse.Plugins.UltimateEncryption/"
      to: "DataWarehouse.SDK/VirtualDiskEngine/Encryption/"
      via: "VDE encryption hooks"
    - from: "Plugins/DataWarehouse.Plugins.UltimateEncryption/"
      to: "Plugins/DataWarehouse.Plugins.UltimateKeyManagement/"
      via: "Key retrieval for encryption operations"
---

<objective>
Production Code Review and Gap Closure for UltimateEncryption plugin.

Purpose: Encryption is security-critical. ~24 throws mean some cipher operations fail at runtime. Each must be implemented with real cryptographic operations.

Output: Zero-gap UltimateEncryption with comprehensive wiring documentation.
</objective>

<context>
@.planning/PROJECT.md
@.planning/PLUGIN-CATALOG.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Systematic Scan of UltimateEncryption</name>
  <files>Plugins/DataWarehouse.Plugins.UltimateEncryption/</files>
  <action>

    **MANDATORY PER-FILE REPORTING RULE:**
    Every single .cs file in the project directory MUST be individually listed in the findings report. No exceptions, no summarization across files. For each file report:
    - Full file path and total line count
    - Every finding (stub, no-op, gap, fake payload, TODO) with exact line number(s) and code snippet
    - If the file has zero issues, explicitly list it as: "filename.cs (N lines) â€” CLEAN, no issues"
    
    Do NOT skip any file. Do NOT group files together. Do NOT say "similar pattern in X files".
    Go through every line of code in every file. We are closing all gaps once and for all.
    Perform exhaustive scan for:
    1. All ~24 throws (locate each, identify which cipher/operation)
    2. Task.CompletedTask no-ops
    3. Placeholder key handling (hardcoded keys, dummy IVs)
    4. Encryption strategies that don't actually encrypt
    5. TODO/FIXME comments

    For each throw, classify:
    - IMPLEMENT: Standard cipher available in .NET or via NuGet
    - GUARD: Exotic/future cipher not implementable now (must justify)

    Present findings to user.
  </action>
  <verify>User reviews findings and approves</verify>
  <done>Complete inventory presented to user</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Implement Encryption Fixes</name>
  <files>Plugins/DataWarehouse.Plugins.UltimateEncryption/</files>
  <action>
    Implement all fixes:
    1. Use System.Security.Cryptography for standard algorithms (AES, RSA, etc.)
    2. Use BouncyCastle or equivalent for exotic algorithms
    3. Every cipher must: encrypt correctly, decrypt correctly, handle key/IV properly
    4. No hardcoded keys or IVs in any code path
    5. Document approved guards with XML comments

    Rescan and build: `dotnet build Plugins/DataWarehouse.Plugins.UltimateEncryption/`
  </action>
  <verify>Rescan clean, build succeeds, user confirms</verify>
  <done>All gaps closed, plugin builds clean</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Write Wiring Document</name>
  <files>.planning/phases/90.5-production-code-review/wiring/12-encryption-wiring.md</files>
  <action>
    Document: All supported ciphers, key derivation functions, cipher selection logic, VDE encryption hook flow, key management integration, IV/nonce generation, authenticated encryption modes.
  </action>
  <verify>User reviews wiring document</verify>
  <done>Wiring document complete, approved by user</done>
</task>

</tasks>

<verification>
- Zero unexplained throws remaining
- No hardcoded keys or IVs
- Plugin builds clean
- Wiring document complete
</verification>

<success_criteria>
UltimateEncryption is 100% production-ready. All ciphers use real cryptographic operations. Wiring document complete.
</success_criteria>

<output>
After completion, create `.planning/phases/90.5-production-code-review/90.5-12-SUMMARY.md`
</output>
