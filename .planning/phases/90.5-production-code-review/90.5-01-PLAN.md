---
phase: 90.5-production-code-review
plan: 01
type: manual
wave: 1
depends_on: []
files_modified: [DataWarehouse.SDK/Contracts/]
autonomous: false

must_haves:
  truths:
    - "Every method in SDK Contracts has a real implementation or is a deliberate capability guard with documentation"
    - "SqlAst INSERT/UPDATE/DELETE operations produce valid AST nodes, not stubs"
    - "IPolicyEngine PERF-07 DryRun has a real implementation"
    - "All NotSupportedException throws are justified capability guards, not lazy stubs"
    - "Wiring document explains how each contract family connects to its consumers"
  artifacts:
    - path: ".planning/phases/90.5-production-code-review/wiring/01-sdk-contracts-wiring.md"
      provides: "Complete wiring documentation for SDK Contracts"
  key_links:
    - from: "DataWarehouse.SDK/Contracts/"
      to: "Plugins/*"
      via: "Interface implementations"
      pattern: "All contract interfaces consumed by plugins"
---

<objective>
Production Code Review and Gap Closure for SDK Contracts (DataWarehouse.SDK/Contracts/).

Purpose: Eliminate every stub, no-op, fake payload, Task.CompletedTask, and incomplete implementation in SDK Contracts. This is the foundation layer — every gap here propagates to all 50+ plugins.

Output: Zero-gap SDK Contracts with comprehensive wiring documentation.
</objective>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/PLUGIN-CATALOG.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Systematic Scan of SDK Contracts</name>
  <files>DataWarehouse.SDK/Contracts/</files>
  <action>

    **MANDATORY PER-FILE REPORTING RULE:**
    Every single .cs file in the project directory MUST be individually listed in the findings report. No exceptions, no summarization across files. For each file report:
    - Full file path and total line count
    - Every finding (stub, no-op, gap, fake payload, TODO) with exact line number(s) and code snippet
    - If the file has zero issues, explicitly list it as: "filename.cs (N lines) — CLEAN, no issues"
    
    Do NOT skip any file. Do NOT group files together. Do NOT say "similar pattern in X files".
    Go through every line of code in every file. We are closing all gaps once and for all.
    Perform exhaustive scan of ALL files under DataWarehouse.SDK/Contracts/ for:

    1. **Stub methods**: `throw new NotImplementedException()`, `throw new NotSupportedException()` (distinguish capability guards from lazy stubs)
    2. **Task.CompletedTask / Task.FromResult no-ops**: Methods returning completed tasks without doing work
    3. **Fake payloads**: Hardcoded byte arrays, dummy data, placeholder strings
    4. **Incomplete implementations**: TODO comments, partial logic, commented-out code
    5. **Known issues**:
       - SqlAst: INSERT/UPDATE/DELETE visitor methods are stubs
       - KernelInfrastructure: version check is a no-op
       - IPolicyEngine: PERF-07 DryRun is a placeholder
       - 28 NotSupportedException throws (audit each one)

    For each finding, classify as:
    - **STUB**: Must be implemented (production code path)
    - **GUARD**: Legitimate capability boundary (document why)
    - **NO-OP**: Must be implemented or removed
    - **PARTIAL**: Must be completed

    Present findings as a structured table to the user with:
    | File | Line | Type | Current Code | Suggested Fix |
  </action>
  <verify>User reviews findings table and approves fix plan</verify>
  <done>Complete inventory of all gaps in SDK Contracts presented to user</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Implement Fixes for SDK Contracts</name>
  <files>DataWarehouse.SDK/Contracts/</files>
  <action>
    After user approval of the scan findings, implement all agreed fixes:

    1. **SqlAst stubs**: Implement INSERT/UPDATE/DELETE AST node generation following the same patterns as SELECT (which works). Each must produce valid SqlAstNode trees.
    2. **IPolicyEngine DryRun**: Implement real dry-run evaluation that simulates policy execution without side effects, returning predicted outcomes.
    3. **KernelInfrastructure version check**: Implement semantic version comparison logic.
    4. **NotSupportedException audit**: For each of the 28 throws:
       - If capability guard: Add XML doc comment explaining WHY it's unsupported
       - If lazy stub: Implement the method
    5. **Task.CompletedTask no-ops**: Implement real async logic or convert to sync if no async work needed.

    After implementing, rescan the entire Contracts directory to confirm zero remaining gaps.
    Build the solution to confirm no compilation errors: `dotnet build DataWarehouse.SDK/`
  </action>
  <verify>
    Rescan shows zero stubs/no-ops remaining.
    `dotnet build DataWarehouse.SDK/` succeeds with no errors.
    User confirms fixes are correct.
  </verify>
  <done>All SDK Contract gaps are closed, solution builds clean</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Write SDK Contracts Wiring Document</name>
  <files>.planning/phases/90.5-production-code-review/wiring/01-sdk-contracts-wiring.md</files>
  <action>
    Create comprehensive wiring document covering:

    1. **Contract Family Map**: Group all interfaces by domain (Storage, Compute, Encryption, etc.)
    2. **Consumer Map**: For each contract interface, list which plugins implement it
    3. **Dependency Flow**: Show how contracts chain (e.g., IStorageEngine -> IBlockDevice -> IEncryptionProvider)
    4. **Message Bus Contracts**: Which contracts define message types and who subscribes
    5. **Strategy Contracts**: Which contracts define strategy bases and their registration points
    6. **Cross-Cutting Contracts**: Contracts used by 5+ plugins (highlight as critical paths)
    7. **Version/Compatibility**: Any versioning contracts and how they're enforced

    Format as Markdown with diagrams (ASCII art flow diagrams where helpful).
  </action>
  <verify>User reviews wiring document for completeness and accuracy</verify>
  <done>Wiring document explains all SDK Contract connections, approved by user</done>
</task>

</tasks>

<verification>
- Zero NotImplementedException throws remaining (except documented capability guards)
- Zero Task.CompletedTask no-ops remaining
- Zero TODO/FIXME/HACK comments remaining
- Solution builds clean
- Wiring document covers all contract families
</verification>

<success_criteria>
SDK Contracts directory is 100% production-ready with zero stubs, all capability guards documented, and a complete wiring document explaining how everything connects.
</success_criteria>

<output>
After completion, create `.planning/phases/90.5-production-code-review/90.5-01-SUMMARY.md`
</output>
