---
phase: 90.5-production-code-review
plan: 11
type: manual
wave: 3
depends_on: ["90.5-04"]
files_modified: [Plugins/DataWarehouse.Plugins.UltimateDataProtection/]
autonomous: false

must_haves:
  truths:
    - "All 5 fake byte[1MB] payloads are replaced with real protection logic"
    - "All 219 Task.CompletedTask no-ops are replaced with real operations"
    - "Data protection strategies actually protect data (encrypt, mask, tokenize)"
    - "Wiring document explains protection pipeline, key management integration, and policy enforcement"
  artifacts:
    - path: ".planning/phases/90.5-production-code-review/wiring/11-data-protection-wiring.md"
      provides: "Complete wiring documentation for UltimateDataProtection"
  key_links:
    - from: "Plugins/DataWarehouse.Plugins.UltimateDataProtection/"
      to: "Plugins/DataWarehouse.Plugins.UltimateEncryption/"
      via: "Encryption operations for data protection"
    - from: "Plugins/DataWarehouse.Plugins.UltimateDataProtection/"
      to: "Plugins/DataWarehouse.Plugins.UltimateAccessControl/"
      via: "Access control for protection policies"
---

<objective>
Production Code Review and Gap Closure for UltimateDataProtection plugin.

Purpose: Data protection is security-critical. 5 fake byte[1MB] payloads mean data appears protected but isn't. 219 Task.CompletedTask means most protection operations silently skip. This is a HIGH priority remediation.

Output: Zero-gap UltimateDataProtection with comprehensive wiring documentation.
</objective>

<context>
@.planning/PROJECT.md
@.planning/PLUGIN-CATALOG.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Systematic Scan of UltimateDataProtection</name>
  <files>Plugins/DataWarehouse.Plugins.UltimateDataProtection/</files>
  <action>

    **MANDATORY PER-FILE REPORTING RULE:**
    Every single .cs file in the project directory MUST be individually listed in the findings report. No exceptions, no summarization across files. For each file report:
    - Full file path and total line count
    - Every finding (stub, no-op, gap, fake payload, TODO) with exact line number(s) and code snippet
    - If the file has zero issues, explicitly list it as: "filename.cs (N lines) â€” CLEAN, no issues"
    
    Do NOT skip any file. Do NOT group files together. Do NOT say "similar pattern in X files".
    Go through every line of code in every file. We are closing all gaps once and for all.
    Perform exhaustive scan for:
    1. **CRITICAL**: The 5 fake byte[1MB] payloads (methods returning `new byte[1048576]` or similar instead of real protected data)
    2. All 219 Task.CompletedTask no-ops
    3. NotImplementedException / NotSupportedException throws
    4. Strategies that pass data through without actually protecting it
    5. TODO/FIXME comments

    Classify by protection type:
    - Encryption-based protection
    - Masking/tokenization
    - Access-controlled protection
    - Backup/recovery protection

    Present findings with CRITICAL severity for fake payloads (these are security holes).
  </action>
  <verify>User reviews findings and approves fix plan</verify>
  <done>Complete inventory with severity ratings presented to user</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Implement Data Protection Fixes</name>
  <files>Plugins/DataWarehouse.Plugins.UltimateDataProtection/</files>
  <action>
    Implement all fixes, CRITICAL items first:

    1. **Fake payloads (CRITICAL)**: Replace all 5 fake byte arrays with real protection:
       - Encryption: Use real cipher operations via UltimateEncryption integration
       - Masking: Implement real data masking (format-preserving where needed)
       - Tokenization: Generate real tokens with secure vault storage
    2. **Task.CompletedTask no-ops (219)**: Each must perform its stated operation
    3. Every protection strategy must actually transform data
    4. Recovery operations must be able to reverse the protection

    Rescan and build: `dotnet build Plugins/DataWarehouse.Plugins.UltimateDataProtection/`
  </action>
  <verify>Rescan shows zero fake payloads and zero no-ops, build succeeds</verify>
  <done>All 224 gaps closed (5 fake + 219 no-op), plugin builds clean</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Write Wiring Document</name>
  <files>.planning/phases/90.5-production-code-review/wiring/11-data-protection-wiring.md</files>
  <action>
    Document: Protection strategy types, encryption integration flow, masking pipeline, tokenization vault, key management integration, access control integration, protection policy evaluation, recovery procedures.
  </action>
  <verify>User reviews wiring document</verify>
  <done>Wiring document complete, approved by user</done>
</task>

</tasks>

<verification>
- Zero fake payloads remaining
- Zero Task.CompletedTask no-ops remaining
- All protection strategies produce real protected output
- Plugin builds clean
- Wiring document complete
</verification>

<success_criteria>
UltimateDataProtection is 100% production-ready. All fake payloads eliminated, all no-ops replaced with real logic. Wiring document complete.
</success_criteria>

<output>
After completion, create `.planning/phases/90.5-production-code-review/90.5-11-SUMMARY.md`
</output>
