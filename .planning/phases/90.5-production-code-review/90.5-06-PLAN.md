---
phase: 90.5-production-code-review
plan: 06
type: manual
wave: 3
depends_on: ["90.5-04"]
files_modified: [Plugins/DataWarehouse.Plugins.UltimateCompression/]
autonomous: false

must_haves:
  truths:
    - "All ~58 real compression gaps are implemented (not the 228 correct Stream guards)"
    - "Each compression strategy produces valid compressed output that decompresses correctly"
    - "No stub or no-op code paths remain"
    - "Wiring document explains compression strategy selection, pipeline integration, and stream handling"
  artifacts:
    - path: ".planning/phases/90.5-production-code-review/wiring/06-compression-wiring.md"
      provides: "Complete wiring documentation for UltimateCompression"
  key_links:
    - from: "Plugins/DataWarehouse.Plugins.UltimateCompression/"
      to: "DataWarehouse.SDK/Contracts/Compression/"
      via: "Compression strategy implementations"
---

<objective>
Production Code Review and Gap Closure for UltimateCompression plugin.

Purpose: Compression is used throughout the storage pipeline. ~58 real gaps exist (distinct from the 228 correct Stream guards for non-streamable algorithms). Each gap must be closed.

Output: Zero-gap UltimateCompression with comprehensive wiring documentation.
</objective>

<context>
@.planning/PROJECT.md
@.planning/PLUGIN-CATALOG.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Systematic Scan of UltimateCompression</name>
  <files>Plugins/DataWarehouse.Plugins.UltimateCompression/</files>
  <action>

    **MANDATORY PER-FILE REPORTING RULE:**
    Every single .cs file in the project directory MUST be individually listed in the findings report. No exceptions, no summarization across files. For each file report:
    - Full file path and total line count
    - Every finding (stub, no-op, gap, fake payload, TODO) with exact line number(s) and code snippet
    - If the file has zero issues, explicitly list it as: "filename.cs (N lines) â€” CLEAN, no issues"
    
    Do NOT skip any file. Do NOT group files together. Do NOT say "similar pattern in X files".
    Go through every line of code in every file. We are closing all gaps once and for all.
    Perform exhaustive scan distinguishing:

    1. **Real gaps (~58 known)**: Methods that should work but throw or no-op
    2. **Correct guards (~228 known)**: Stream-based methods for non-streamable algorithms (these are CORRECT - NotSupportedException is the right behavior)
    3. **Task.CompletedTask no-ops**: Methods returning without doing compression work
    4. **Fake payloads**: Methods returning input unchanged or returning dummy bytes
    5. **TODO/FIXME comments**

    CRITICAL: Distinguish real gaps from correct capability guards. A compression algorithm that doesn't support streaming CORRECTLY throws NotSupportedException on CreateCompressionStream/CreateDecompressionStream.

    Present findings with clear classification: REAL GAP vs CORRECT GUARD.
  </action>
  <verify>User reviews findings, confirms guard classification</verify>
  <done>Complete inventory with clear gap vs guard classification presented to user</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Implement Compression Fixes</name>
  <files>Plugins/DataWarehouse.Plugins.UltimateCompression/</files>
  <action>
    Implement all real gaps (not guards):

    1. For each compression strategy with real gaps: implement using the algorithm's standard approach
    2. Algorithms requiring NuGet packages: use the correct package (document which)
    3. Every CompressAsync/DecompressAsync must produce valid output
    4. Ensure round-trip correctness: Decompress(Compress(data)) == data
    5. Add XML doc comments on all correct guards explaining WHY streaming is unsupported

    Rescan after fixes. Build: `dotnet build Plugins/DataWarehouse.Plugins.UltimateCompression/`
  </action>
  <verify>Rescan shows only correct guards remaining, build succeeds</verify>
  <done>All real gaps closed, guards documented, plugin builds clean</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Write Wiring Document</name>
  <files>.planning/phases/90.5-production-code-review/wiring/06-compression-wiring.md</files>
  <action>
    Document: All compression algorithms supported, which are streamable vs block-only, strategy selection logic, integration with VDE write path, compression pipeline order, performance characteristics per algorithm.
  </action>
  <verify>User reviews wiring document</verify>
  <done>Wiring document complete, approved by user</done>
</task>

</tasks>

<verification>
- Only documented capability guards remain as NotSupportedException
- All ~58 real gaps closed
- Plugin builds clean
- Wiring document complete
</verification>

<success_criteria>
UltimateCompression is 100% production-ready. All real compression algorithms work, guards are documented, wiring document complete.
</success_criteria>

<output>
After completion, create `.planning/phases/90.5-production-code-review/90.5-06-SUMMARY.md`
</output>
