---
phase: 90.5-production-code-review
plan: 09
type: manual
wave: 3
depends_on: ["90.5-04"]
files_modified: [Plugins/DataWarehouse.Plugins.UltimateDataFormat/]
autonomous: false

must_haves:
  truths:
    - "All 13 stubbed strategies have real implementations (using appropriate NuGet packages)"
    - "All 3 partial strategies are completed"
    - "Every data format strategy can serialize and deserialize its format correctly"
    - "Wiring document explains format detection, conversion pipeline, and strategy selection"
  artifacts:
    - path: ".planning/phases/90.5-production-code-review/wiring/09-data-format-wiring.md"
      provides: "Complete wiring documentation for UltimateDataFormat"
  key_links:
    - from: "Plugins/DataWarehouse.Plugins.UltimateDataFormat/"
      to: "DataWarehouse.SDK/Contracts/DataFormat/"
      via: "Format strategy implementations"
---

<objective>
Production Code Review and Gap Closure for UltimateDataFormat plugin.

Purpose: Data format handling is fundamental to data ingestion and export. 13 strategies are stubbed (need NuGet packages), 3 are partial. Each must be completed.

Output: Zero-gap UltimateDataFormat with comprehensive wiring documentation.
</objective>

<context>
@.planning/PROJECT.md
@.planning/PLUGIN-CATALOG.md
</context>

<tasks>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 1: Systematic Scan of UltimateDataFormat</name>
  <files>Plugins/DataWarehouse.Plugins.UltimateDataFormat/</files>
  <action>

    **MANDATORY PER-FILE REPORTING RULE:**
    Every single .cs file in the project directory MUST be individually listed in the findings report. No exceptions, no summarization across files. For each file report:
    - Full file path and total line count
    - Every finding (stub, no-op, gap, fake payload, TODO) with exact line number(s) and code snippet
    - If the file has zero issues, explicitly list it as: "filename.cs (N lines) â€” CLEAN, no issues"
    
    Do NOT skip any file. Do NOT group files together. Do NOT say "similar pattern in X files".
    Go through every line of code in every file. We are closing all gaps once and for all.
    Perform exhaustive scan for:
    1. The 13 known stubbed strategies (identify each, note which NuGet package needed)
    2. The 3 known partial strategies (identify what's missing in each)
    3. Additional stubs, Task.CompletedTask no-ops, TODO comments
    4. Format strategies that return dummy data instead of actual parsing

    For each stubbed strategy, identify the correct NuGet package:
    - e.g., Apache Parquet -> Parquet.Net or Apache.Arrow
    - e.g., Apache Avro -> Apache.Avro
    - e.g., MessagePack -> MessagePack-CSharp
    - etc.

    Present findings with NuGet package recommendations.
  </action>
  <verify>User reviews findings, approves NuGet package choices</verify>
  <done>Complete inventory with NuGet recommendations presented to user</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 2: Implement Format Fixes</name>
  <files>Plugins/DataWarehouse.Plugins.UltimateDataFormat/</files>
  <action>
    Implement all fixes:
    1. Add approved NuGet packages to the project
    2. Implement each of the 13 stubbed strategies using the real library
    3. Complete the 3 partial strategies
    4. Every strategy must support: Serialize(object -> bytes) and Deserialize(bytes -> object)
    5. Verify round-trip correctness for each format

    Rescan and build: `dotnet build Plugins/DataWarehouse.Plugins.UltimateDataFormat/`
  </action>
  <verify>Rescan clean, build succeeds, user confirms</verify>
  <done>All format strategies implemented, plugin builds clean</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <name>Task 3: Write Wiring Document</name>
  <files>.planning/phases/90.5-production-code-review/wiring/09-data-format-wiring.md</files>
  <action>
    Document: All supported formats, auto-detection logic, format conversion pipeline, NuGet dependencies, strategy registration, integration with data ingestion and export paths.
  </action>
  <verify>User reviews wiring document</verify>
  <done>Wiring document complete, approved by user</done>
</task>

</tasks>

<verification>
- Zero stubbed strategies remaining
- All 3 partial strategies completed
- Plugin builds clean with NuGet packages
- Wiring document complete
</verification>

<success_criteria>
UltimateDataFormat is 100% production-ready. All formats serialize/deserialize correctly. Wiring document complete.
</success_criteria>

<output>
After completion, create `.planning/phases/90.5-production-code-review/90.5-09-SUMMARY.md`
</output>
