---
phase: 56-data-consciousness
plan: 05
type: execute
wave: 3
depends_on: ["56-02", "56-03"]
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateDataGovernance/Strategies/IntelligentGovernance/AutoArchiveStrategies.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataGovernance/Strategies/IntelligentGovernance/AutoPurgeStrategies.cs
autonomous: true

must_haves:
  truths:
    - "Auto-archive rules trigger when consciousness score falls below configurable threshold"
    - "Auto-purge recommendations flag high-liability + low-value objects with approval workflow"
    - "Both systems consume message bus events from the ingest pipeline scorer"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateDataGovernance/Strategies/IntelligentGovernance/AutoArchiveStrategies.cs"
      provides: "ThresholdAutoArchiveStrategy, AgeBasedAutoArchiveStrategy, TieredAutoArchiveStrategy, AutoArchiveOrchestrator"
      min_lines: 200
    - path: "Plugins/DataWarehouse.Plugins.UltimateDataGovernance/Strategies/IntelligentGovernance/AutoPurgeStrategies.cs"
      provides: "ToxicDataPurgeStrategy, RetentionExpiredPurgeStrategy, PurgeApprovalWorkflowStrategy, AutoPurgeOrchestrator"
      min_lines: 200
  key_links:
    - from: "AutoArchiveOrchestrator"
      to: "consciousness.archive.recommended"
      via: "subscribes to message bus topic"
      pattern: "consciousness\\.archive\\.recommended"
    - from: "AutoPurgeOrchestrator"
      to: "consciousness.purge.recommended"
      via: "subscribes to message bus topic"
      pattern: "consciousness\\.purge\\.recommended"
---

<objective>
Implement auto-archive rules and auto-purge recommendation strategies that act on consciousness scores to automatically manage data lifecycle.

Purpose: Scoring alone is informational. Auto-archive moves low-value data to cold/archive tiers, saving storage costs. Auto-purge flags toxic data (high liability + low value) for secure deletion with an approval workflow. Together they transform consciousness scores into actionable lifecycle management.

Output: Two strategy files — auto-archive strategies and auto-purge strategies, each with multiple strategies plus an orchestrator.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/PLUGIN-CATALOG.md
@.planning/phases/56-data-consciousness/56-01-SUMMARY.md
@DataWarehouse.SDK/Contracts/Consciousness/ConsciousnessScore.cs
@Plugins/DataWarehouse.Plugins.UltimateDataGovernance/Strategies/RetentionManagement/RetentionManagementStrategies.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Auto-archive strategies</name>
  <files>Plugins/DataWarehouse.Plugins.UltimateDataGovernance/Strategies/IntelligentGovernance/AutoArchiveStrategies.cs</files>
  <action>
Create `AutoArchiveStrategies.cs` in namespace `DataWarehouse.Plugins.UltimateDataGovernance.Strategies.IntelligentGovernance`.

**Supporting types:**

`ArchiveDecision` record: string ObjectId, bool ShouldArchive, string TargetTier ("cold"/"archive"/"glacier"/"deep_archive"), string Reason, ConsciousnessScore Score, DateTime DecidedAt.

`ArchivePolicy` record: double ScoreThreshold (default 30), int MinAgeDays (default 90, don't archive recently created data), int GracePeriodDays (default 7, wait before executing), bool RequireApproval (default false for archive), string[] ExemptClassifications (default ["restricted", "top_secret"]).

**Strategy 1: ThresholdAutoArchiveStrategy**
- StrategyId: "auto-archive-threshold"
- Category: ConsciousnessCategory.AutoArchive
- Given a ConsciousnessScore, decides archive if: CompositeScore < policy.ScoreThreshold AND age > MinAgeDays AND classification NOT in ExemptClassifications AND no legal hold
- Target tier selection: score 20-30 = "cold", score 10-20 = "archive", score < 10 = "deep_archive"

**Strategy 2: AgeBasedAutoArchiveStrategy**
- StrategyId: "auto-archive-age"
- Category: ConsciousnessCategory.AutoArchive
- Time-decaying consciousness: re-evaluates score considering that idle data loses value over time
- If no access in 30 days, reduce effective value by 10%. 60 days = 20%. 90 days = 30%. 180 days = 50%.
- Apply decay to value portion only (liability doesn't decay), recompute composite, then check threshold

**Strategy 3: TieredAutoArchiveStrategy**
- StrategyId: "auto-archive-tiered"
- Category: ConsciousnessCategory.AutoArchive
- Implements progressive archival: data moves through tiers over time
- Tier rules: hot -> warm (score < 60, age > 30d), warm -> cold (score < 40, age > 90d), cold -> archive (score < 25, age > 180d), archive -> deep_archive (score < 15, age > 365d)
- Each tier transition is logged with timestamp and reason

**Strategy 4: AutoArchiveOrchestrator**
- StrategyId: "auto-archive-orchestrator"
- Category: ConsciousnessCategory.AutoArchive
- Capabilities: all true
- Subscribes to "consciousness.archive.recommended" message bus topic
- On event: loads ConsciousnessScore, evaluates all archive strategies (threshold, age, tiered), takes the most aggressive action that all agree on (consensus — if any strategy says "don't archive", it doesn't)
- Publishes "consciousness.archive.executed" with objectId, fromTier, toTier, reason
- Publishes "consciousness.archive.deferred" if grace period not yet elapsed
- Maintains ConcurrentDictionary<string, ArchiveDecision> for tracking
- Method: `Task<ArchiveDecision> EvaluateAsync(ConsciousnessScore score, Dictionary<string, object> metadata, CancellationToken ct)`
- Method: `Task<IReadOnlyList<ArchiveDecision>> EvaluateBatchAsync(IReadOnlyList<ConsciousnessScore> scores, CancellationToken ct)`
  </action>
  <verify>Build the governance plugin: `dotnet build Plugins/DataWarehouse.Plugins.UltimateDataGovernance/DataWarehouse.Plugins.UltimateDataGovernance.csproj --no-restore`. Zero errors.</verify>
  <done>4 auto-archive strategies compile, orchestrator subscribes to message bus events, consensus-based archive decisions, tiered storage support.</done>
</task>

<task type="auto">
  <name>Task 2: Auto-purge strategies</name>
  <files>Plugins/DataWarehouse.Plugins.UltimateDataGovernance/Strategies/IntelligentGovernance/AutoPurgeStrategies.cs</files>
  <action>
Create `AutoPurgeStrategies.cs` in namespace `DataWarehouse.Plugins.UltimateDataGovernance.Strategies.IntelligentGovernance`.

**Supporting types:**

`PurgeDecision` record: string ObjectId, bool ShouldPurge, PurgeReason Reason, PurgeUrgency Urgency, bool RequiresApproval, string ApprovalStatus ("pending"/"approved"/"rejected"/"auto_approved"), ConsciousnessScore Score, DateTime DecidedAt, DateTime? PurgeScheduledAt.

`PurgeReason` enum: ToxicData (low value + high liability), RetentionExpired, RegulatoryRequirement, UserRequested, StorageReclamation.

`PurgeUrgency` enum: Immediate (regulatory/breach), High (within 24h), Medium (within 7 days), Low (next maintenance window), Scheduled (specific date).

**Strategy 1: ToxicDataPurgeStrategy**
- StrategyId: "auto-purge-toxic"
- Category: ConsciousnessCategory.AutoPurge
- Toxic data = value score < 30 AND liability score > 70
- Urgency: liability > 90 = Immediate, liability > 80 = High, else Medium
- Always requires approval (purge is destructive)
- Generates purge justification string explaining why data is toxic

**Strategy 2: RetentionExpiredPurgeStrategy**
- StrategyId: "auto-purge-retention-expired"
- Category: ConsciousnessCategory.AutoPurge
- Reads metadata: "retention_end_date" (DateTime), "legal_hold" (bool)
- If retention expired AND no legal hold AND no active litigation flag: recommend purge
- Urgency: overdue by >90 days = High, overdue by >30 days = Medium, else Low
- Auto-approve if policy allows (configurable: autoApproveRetentionPurge bool)

**Strategy 3: PurgeApprovalWorkflowStrategy**
- StrategyId: "auto-purge-approval"
- Category: ConsciousnessCategory.AutoPurge
- Manages approval state machine: pending -> approved/rejected
- Approval rules: if purge affects > 1000 objects, require senior approval. If any object has liability > 80, require compliance officer approval. If regulatory requirement, auto-approve after 48h hold.
- Tracks approvals in ConcurrentDictionary<string, PurgeApproval>
- PurgeApproval record: string ObjectId, string RequestedBy, DateTime RequestedAt, string? ApprovedBy, DateTime? ApprovedAt, string? RejectedReason

**Strategy 4: AutoPurgeOrchestrator**
- StrategyId: "auto-purge-orchestrator"
- Category: ConsciousnessCategory.AutoPurge
- Subscribes to "consciousness.purge.recommended" message bus topic
- On event: evaluates toxic and retention-expired strategies, routes through approval workflow
- Publishes "consciousness.purge.approved" when approved
- Publishes "consciousness.purge.executed" when purge completes
- Publishes "consciousness.purge.rejected" when rejected
- Never executes purge without approval (safety critical — purge is irreversible)
- Method: `Task<PurgeDecision> EvaluateAsync(ConsciousnessScore score, Dictionary<string, object> metadata, CancellationToken ct)`
  </action>
  <verify>Build the governance plugin: `dotnet build Plugins/DataWarehouse.Plugins.UltimateDataGovernance/DataWarehouse.Plugins.UltimateDataGovernance.csproj --no-restore`. Zero errors.</verify>
  <done>4 auto-purge strategies compile, approval workflow prevents accidental deletion, toxic data detection works, orchestrator subscribes to message bus events.</done>
</task>

</tasks>

<verification>
- Governance plugin builds with zero errors
- Auto-archive orchestrator evaluates scores and produces ArchiveDecision with target tier
- Auto-purge orchestrator never purges without approval
- ToxicDataPurgeStrategy correctly identifies low-value + high-liability objects
- Message bus topics follow "consciousness.*" namespace
</verification>

<success_criteria>
Auto-archive automatically moves low-consciousness data to cheaper storage tiers. Auto-purge flags toxic data (high liability + low value) with mandatory approval workflows. Both systems consume consciousness scores from the ingest pipeline and publish their own events for audit trails.
</success_criteria>

<output>
After completion, create `.planning/phases/56-data-consciousness/56-05-SUMMARY.md`
</output>
