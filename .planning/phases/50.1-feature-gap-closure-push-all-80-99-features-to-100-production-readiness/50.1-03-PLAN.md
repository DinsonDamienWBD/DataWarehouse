---
phase: 50.1-feature-gap-closure
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/BwtStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/MtfStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Archive/TarStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Archive/ZipStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateStreamingData/Strategies/StreamProcessing/XzStreamingStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateStreamingData/Strategies/StreamProcessing/SevenZipStreamingStrategy.cs
autonomous: true
must_haves:
  truths:
    - "BWT and MTF transform strategies have production infrastructure"
    - "Tar and Zip archive strategies have production infrastructure"
    - "Xz and 7-Zip streaming strategies have production infrastructure"
    - "All 6 strategies have config validation, health checks, shutdown, counters, edge case guards"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/BwtStrategy.cs"
      provides: "BWT with production infrastructure"
      contains: "InitializeAsyncCore"
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Archive/TarStrategy.cs"
      provides: "Tar with production infrastructure"
      contains: "InitializeAsyncCore"
  key_links:
    - from: "Transform/Archive strategies"
      to: "StrategyBase"
      via: "IncrementCounter, GetCachedHealthAsync, InitializeAsyncCore"
      pattern: "IncrementCounter|GetCachedHealthAsync"
---

<objective>
Add production readiness infrastructure to remaining compression domain strategies: BWT, MTF (transform), Tar, Zip (archive), and Xz, 7-Zip (streaming data).

Purpose: Complete Domain 01 (Compression) gap closure. These 6 strategies complete the 17 features at 90% for Domain 01.

Output: 6 strategy files updated. Domain 01 fully at 100%.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/50.1-feature-gap-closure-push-all-80-99-features-to-100-production-readiness/50.1-RESEARCH.md

NOTE: The Xz and 7-Zip features are listed under "UltimateStreamingData" plugin in the feature list. Check the actual file locations — they may be in StreamProcessing subfolder or a different path. If the file names differ from what's listed, locate them with `find Plugins/DataWarehouse.Plugins.UltimateStreamingData -name "*Xz*" -o -name "*SevenZip*" -o -name "*7z*"` and update accordingly.

Same StrategyBase patterns as Plans 01-02.
</context>

<tasks>

<task type="auto">
  <name>Task 1: Production-harden BWT, MTF, Tar, Zip strategies</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/BwtStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/MtfStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Archive/TarStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Archive/ZipStrategy.cs
  </files>
  <action>
For each strategy, add production infrastructure preserving all existing algorithm code:

1. **InitializeAsyncCore override**: For BWT: validate block size (256-10MB). For MTF: validate alphabet size (2-65536). For Tar: validate max file name length, max archive size. For Zip: validate compression method, max entry count, max uncompressed size. Throw ArgumentException for invalid values.

2. **Health check**: `CheckHealthAsync` using `GetCachedHealthAsync()`. Round-trip test. 60-second cache.

3. **ShutdownAsyncCore/DisposeAsyncCore**: Dispose resources, call base.

4. **Strategy-specific counters**: `IncrementCounter("bwt.transform")`, `IncrementCounter("tar.compress")`, etc.

5. **Edge case guards**: Max input size (100MB for compression, configurable for archives), empty input handling, corrupted header detection for decompression.

DO NOT modify any algorithm logic.
  </action>
  <verify>
`dotnet build DataWarehouse.slnx --no-restore 2>&1 | tail -5` — 0 errors 0 warnings.
Grep each file for "InitializeAsyncCore", "GetCachedHealthAsync", "IncrementCounter".
  </verify>
  <done>BWT, MTF, Tar, Zip strategies have full production infrastructure. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Production-harden Xz and 7-Zip streaming strategies</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateStreamingData/Strategies/
  </files>
  <action>
FIRST: Locate the actual Xz and 7-Zip strategy files in UltimateStreamingData plugin:
```bash
find Plugins/DataWarehouse.Plugins.UltimateStreamingData -name "*.cs" | grep -i -E "xz|seven|7z|7zip"
```
If they are in UltimateCompression Archive folder instead (Archive/XzStrategy.cs, Archive/SevenZipStrategy.cs), work with those files.

For each strategy found, add production infrastructure:

1. **InitializeAsyncCore override**: For Xz: validate dictionary size (4KB-1.5GB), integrity check type (CRC32/CRC64/SHA-256). For 7-Zip: validate method set, solid block size, header encryption option. Throw ArgumentException for invalid values.

2. **Health check**: `CheckHealthAsync` using `GetCachedHealthAsync()`. Round-trip test. 60-second cache.

3. **ShutdownAsyncCore/DisposeAsyncCore**: Dispose resources, call base.

4. **Strategy-specific counters**: `IncrementCounter("xz.compress")`, `IncrementCounter("7zip.compress")`, etc.

5. **Edge case guards**: Max input size, corrupted header detection, empty archive handling.

DO NOT modify any algorithm logic.
  </action>
  <verify>
`dotnet build DataWarehouse.slnx --no-restore 2>&1 | tail -5` — 0 errors 0 warnings.
  </verify>
  <done>Xz and 7-Zip strategies have full production infrastructure. Build passes. Domain 01 complete.</done>
</task>

</tasks>

<verification>
1. `dotnet build DataWarehouse.slnx --no-restore` passes with 0 errors, 0 warnings
2. All 6 remaining Domain 01 strategies have production infrastructure
3. Domain 01 (all 17 compression features) fully at 100%
</verification>

<success_criteria>
All 17 Domain 01 compression features pushed to 100%. Zero build errors.
</success_criteria>

<output>
After completion, create `.planning/phases/50.1-feature-gap-closure-push-all-80-99-features-to-100-production-readiness/50.1-03-SUMMARY.md`
</output>
