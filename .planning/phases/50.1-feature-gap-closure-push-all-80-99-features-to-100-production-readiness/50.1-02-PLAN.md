---
phase: 50.1-feature-gap-closure
plan: 02
type: execute
wave: 1  # Waves are execution scheduling groups (max 2-3 concurrent), not dependency markers
depends_on: []
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/EntropyCoding/HuffmanStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/EntropyCoding/RleStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/EntropyCoding/ArithmeticStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/EntropyCoding/AnsStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/EntropyCoding/RansStrategy.cs
autonomous: true
must_haves:
  truths:
    - "All 5 entropy coding strategies have InitializeAsyncCore with configuration validation"
    - "All 5 entropy coding strategies have health checks with 60-second caching"
    - "All 5 entropy coding strategies have ShutdownAsyncCore for resource cleanup"
    - "All 5 entropy coding strategies have strategy-specific IncrementCounter calls"
    - "All 5 entropy coding strategies have edge case guards"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/EntropyCoding/HuffmanStrategy.cs"
      provides: "Huffman compression with production infrastructure"
      contains: "InitializeAsyncCore"
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/EntropyCoding/AnsStrategy.cs"
      provides: "ANS compression with production infrastructure"
      contains: "InitializeAsyncCore"
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/EntropyCoding/RansStrategy.cs"
      provides: "rANS compression with production infrastructure"
      contains: "InitializeAsyncCore"
  key_links:
    - from: "EntropyCoding strategies"
      to: "StrategyBase"
      via: "InitializeAsyncCore, ShutdownAsyncCore, IncrementCounter, GetCachedHealthAsync"
      pattern: "IncrementCounter|GetCachedHealthAsync"
---

<objective>
Add production readiness infrastructure to 5 entropy coding compression strategies (Huffman, Rle, Arithmetic, Ans, Rans) in UltimateCompression plugin.

Purpose: These strategies have real entropy coding algorithms but lack production infrastructure. Push from 90% to 100%.

Output: 5 strategy files updated with full production infrastructure.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/50.1-feature-gap-closure-push-all-80-99-features-to-100-production-readiness/50.1-RESEARCH.md

Key patterns (same as Plan 01):
- `IncrementCounter(string name)` from StrategyBase for per-strategy metrics
- `GetCachedHealthAsync(...)` from StrategyBase for cached health checks
- `InitializeAsyncCore(CancellationToken)` for config validation
- `ShutdownAsyncCore(CancellationToken)` for cleanup
- CompressionStrategyBase ALREADY wraps Compress/Decompress with timing, stats, error wrapping
</context>

<tasks>

<task type="auto">
  <name>Task 1: Production-harden entropy coding strategies (Huffman, Rle, Arithmetic)</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/EntropyCoding/HuffmanStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/EntropyCoding/RleStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/EntropyCoding/ArithmeticStrategy.cs
  </files>
  <action>
For each strategy, add production infrastructure while preserving ALL existing algorithm code:

1. **InitializeAsyncCore override**: For Huffman: validate max tree depth (8-32), max symbol count (2-65536). For RLE: validate min run length (1-255), max run length (1-65535). For Arithmetic: validate precision bits (16-64), model update frequency (1-10000). Throw ArgumentException for invalid values.

2. **Health check**: Add `CheckHealthAsync` method using `GetCachedHealthAsync()`. Round-trip test with known test data. 60-second cache.

3. **ShutdownAsyncCore override**: Dispose any resources. Call base.

4. **DisposeAsyncCore override**: Disposal pattern, call base.

5. **Strategy-specific counters**: `IncrementCounter("huffman.compress")`, `IncrementCounter("rle.compress")`, `IncrementCounter("arithmetic.compress")` etc. in CompressCore/DecompressCore.

6. **Edge case guards**: Max 100MB input, minimum input size for algorithm to be useful (e.g., RLE needs >= 1 byte, Huffman needs >= 2 distinct bytes to build tree or handle gracefully).

DO NOT modify any algorithm logic.
  </action>
  <verify>
`dotnet build DataWarehouse.slnx --no-restore 2>&1 | tail -5` — 0 errors 0 warnings.
Grep files for "InitializeAsyncCore", "GetCachedHealthAsync", "ShutdownAsyncCore", "IncrementCounter".
  </verify>
  <done>HuffmanStrategy, RleStrategy, ArithmeticStrategy have full production infrastructure. Build passes.</done>
</task>

<task type="auto">
  <name>Task 2: Production-harden entropy coding strategies (Ans, Rans)</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/EntropyCoding/AnsStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/EntropyCoding/RansStrategy.cs
  </files>
  <action>
For each strategy, add production infrastructure:

1. **InitializeAsyncCore override**: For ANS: validate table log size (8-16), precision (10-16). For rANS: validate number of interleaved streams (1-64), precision bits (8-32). Throw ArgumentException for invalid values.

2. **Health check**: `CheckHealthAsync` using `GetCachedHealthAsync()`. Round-trip test. 60-second cache.

3. **ShutdownAsyncCore override**: Dispose resources. Call base.

4. **DisposeAsyncCore override**: Disposal pattern, call base.

5. **Strategy-specific counters**: `IncrementCounter("ans.compress")`, `IncrementCounter("rans.compress")` etc.

6. **Edge case guards**: Max 100MB input, validate internal state consistency during decompression.

DO NOT modify any algorithm logic.
  </action>
  <verify>
`dotnet build DataWarehouse.slnx --no-restore 2>&1 | tail -5` — 0 errors 0 warnings.
Grep files for "InitializeAsyncCore", "GetCachedHealthAsync", "ShutdownAsyncCore", "IncrementCounter".
  </verify>
  <done>AnsStrategy, RansStrategy have full production infrastructure. Build passes.</done>
</task>

</tasks>

<verification>
1. `dotnet build DataWarehouse.slnx --no-restore` passes with 0 errors, 0 warnings
2. All 5 entropy coding files contain all 4 production infrastructure patterns
3. No algorithm logic was modified
</verification>

<success_criteria>
All 5 entropy coding strategies (Huffman, Rle, Arithmetic, Ans, Rans) upgraded from 90% to 100%. Zero build errors.
</success_criteria>

<output>
After completion, create `.planning/phases/50.1-feature-gap-closure-push-all-80-99-features-to-100-production-readiness/50.1-02-SUMMARY.md`
</output>
