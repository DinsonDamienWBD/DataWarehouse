---
phase: 49
plan: 49-05
title: "Fix P1 Findings: Domain-Specific"
depends_on: [49-01, 49-02, 49-03, 49-04]
---

# Plan 49-05: Fix P1 Findings — Domain-Specific

## Role
You are a **Domain Integration Engineer**. P1 domain findings are issues specific to DataWarehouse architecture: strategy registration, bus wiring, configuration problems.

## Goal
Fix ALL P1 domain-specific findings identified in Phases 43-48:
- Strategy registration gaps (strategies exist but aren't discoverable)
- Message bus wiring issues (topics not wired correctly)
- Configuration validation problems
- Plugin lifecycle issues (Initialize/Execute/Shutdown)
- Knowledge registration gaps
- Inter-plugin dependency issues

## Inputs
Read findings from:
- `.planning/phases/44-hostile-domain-audit/DOMAIN-AUDIT-*.md` (P1 domain findings)
- `.planning/phases/45-hostile-tier-audit/TIER-AUDIT-*.md` (P1 domain findings)
- `.planning/phases/46-hostile-plugin-audit/PLUGIN-AUDIT-*.md` (P1 domain findings)
- `.planning/phases/47-hostile-flow-audit/FLOW-AUDIT-*.md` (P1 domain findings)
- `.planning/PLUGIN-CATALOG.md` — authoritative reference for expected behavior

## Approach

### 1. Inventory P1 Domain Findings
Use `Grep` to extract all P1 domain findings:
```bash
grep -r "P1.*domain\|P1.*strategy\|P1.*bus\|P1.*config\|P1.*lifecycle\|P1.*knowledge\|P1.*dependency" .planning/phases/44-*/*.md .planning/phases/45-*/*.md .planning/phases/46-*/*.md .planning/phases/47-*/*.md
```

Create consolidated list in `49-05-P1-DOMAIN-INVENTORY.md`:
- Finding ID
- Description
- Location (file:line)
- Domain/Plugin affected
- Fix approach

### 2. Fix Categories

#### Category A: Strategy Registration Gaps
Search for:
- Strategy classes in `Strategies/` folders not registered in Initialize()
- Strategies registered with wrong names/aliases
- Strategy factories that fail to discover strategies
- Strategies not exposed via SDK interfaces

Fix approach:
- Review PLUGIN-CATALOG.md for expected strategies per plugin
- Add missing strategy registrations in Initialize()
- Verify strategy names match documentation
- Ensure strategies inherit from correct base classes
- Add unit tests for strategy discovery

#### Category B: Message Bus Wiring Issues
Search for:
- Topics published but never subscribed
- Topics subscribed but never published
- Message handlers with incorrect type filters
- Message routing to wrong handlers
- Missing correlation IDs

Fix approach:
- Review PLUGIN-CATALOG.md for expected bus topics per plugin
- Add missing Subscribe() calls in Initialize()
- Verify topic names are exact matches (case-sensitive)
- Ensure message types match handlers
- Add correlation ID propagation
- Add unit tests to verify message routing

#### Category C: Configuration Validation Problems
Search for:
- Configuration loaded but not validated
- Missing required configuration keys
- Invalid configuration values accepted
- Configuration defaults that violate constraints

Fix approach:
- Add configuration validation in Initialize()
- Validate required keys are present
- Validate value ranges/formats
- Fail fast on invalid configuration with clear error messages
- Document configuration schema
- Add unit tests for config validation

#### Category D: Plugin Lifecycle Issues
Search for:
- Initialize() methods that partially succeed
- Execute() methods that don't check initialization state
- Shutdown() methods that don't clean up resources
- Plugins that fail to respond to lifecycle events

Fix approach:
- Add initialization state tracking
- Check initialized state in Execute()
- Ensure Shutdown() releases all resources
- Add error handling for lifecycle transitions
- Add unit tests for lifecycle scenarios (init, execute, shutdown)

#### Category E: Knowledge Registration Gaps
Search for:
- Plugins with capabilities not registered in knowledge base
- Requirements not declared
- Dependencies not documented
- Metadata missing or incorrect

Fix approach:
- Review PLUGIN-CATALOG.md for expected capabilities per plugin
- Add missing knowledge registration in Initialize()
- Declare all requirements (hardware, software, configuration)
- Document dependencies on other plugins
- Add unit tests to verify knowledge is registered

#### Category F: Inter-Plugin Dependency Issues
Search for:
- Circular dependencies between plugins
- Missing dependency declarations
- Hard-coded plugin dependencies (should use SDK interfaces)
- Dependency resolution failures

Fix approach:
- Identify circular dependencies and break them (use events/bus)
- Declare all dependencies explicitly
- Use SDK interfaces instead of direct plugin references
- Add dependency injection where appropriate
- Add unit tests for dependency resolution

### 3. Fix Execution
For EACH finding:
1. Read the affected file(s)
2. Consult PLUGIN-CATALOG.md for expected behavior
3. Locate the exact issue
4. Implement the fix
5. Add unit test to prevent regression
6. Verify build passes
7. Document the fix in `49-05-FIXES.md`

### 4. Verification
After all fixes:
1. `dotnet build DataWarehouse.slnx --configuration Release` — must pass
2. `dotnet test` — must pass
3. Manual verification:
   - All strategies are discoverable via SDK
   - All bus topics are correctly wired
   - All configurations validate correctly
   - All plugins initialize/execute/shutdown cleanly
   - All knowledge is registered
   - All dependencies resolve correctly
4. Compare finding count: MUST be zero P1 domain findings

## Output
Create `49-05-P1-DOMAIN-INVENTORY.md` — List of all P1 domain findings
Create `49-05-FIXES.md` — Detailed log of every fix applied:
```markdown
# P1 Domain Fixes

## Summary
- Total P1 findings: N
- Fixed: N
- Remaining: 0

## Fixes Applied

### [Finding ID]: [Brief Description]
**Location**: `path/to/file.cs:line`
**Category**: Strategy Registration / Bus Wiring / Config Validation / Lifecycle / Knowledge / Dependency
**Domain/Plugin**: [Affected domain or plugin]
**Original Code**:
\`\`\`csharp
// original code
\`\`\`
**Fixed Code**:
\`\`\`csharp
// corrected code
\`\`\`
**PLUGIN-CATALOG Reference**: Section X.Y specifies that...
**Test Added**: `path/to/test.cs` — test description
**Verification**: Build passes, test passes, domain behavior correct

---
(repeat for EVERY finding)
```

## Success Criteria
- All P1 domain findings identified and fixed
- Zero remaining P1 domain findings
- All fixes have accompanying unit tests
- Build passes: 0 errors, 0 warnings
- All tests pass
- All strategies discoverable
- All bus topics correctly wired
- All configurations validate
- All plugins lifecycle correct
- All knowledge registered
- All dependencies resolve
- All fixes consistent with PLUGIN-CATALOG.md
- `49-05-FIXES.md` documents every fix with evidence

## Failure Modes
- P1 finding not fixed → Document reason if deferring
- Fix violates PLUGIN-CATALOG.md specification → Roll back and rework
- Fix introduces new dependency issues → Roll back and rework
- Build breaks → Fix immediately
- Tests fail → Fix immediately

## Constraints
- ALL strategy registrations must match PLUGIN-CATALOG.md
- ALL bus wiring must match PLUGIN-CATALOG.md
- ALL plugin behavior must match PLUGIN-CATALOG.md
- NO circular plugin dependencies (use message bus instead)
- NO direct plugin-to-plugin references (use SDK interfaces)
- ALL configuration must be validated on load
