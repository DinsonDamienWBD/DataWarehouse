---
phase: 84-deployment-topology-cli-modes
plan: 03
type: execute
wave: 2
depends_on: ["84-01"]
files_modified:
  - DataWarehouse.GUI/Components/Pages/ModeSelection.razor
  - DataWarehouse.GUI/Components/Pages/VdeComposer.razor
  - DataWarehouse.GUI/Components/Shared/TopologyPreview.razor
autonomous: true
must_haves:
  truths:
    - "GUI shows a mode-selection page at startup with three options: Connect, Live, Install"
    - "Install mode presents topology selection (DW-only, VDE-only, DW+VDE)"
    - "VDE Composer wizard allows selecting modules from a checklist"
    - "Topology preview visualizes which components run where"
  artifacts:
    - path: "DataWarehouse.GUI/Components/Pages/ModeSelection.razor"
      provides: "Startup mode selection page"
      contains: "ModeSelection"
    - path: "DataWarehouse.GUI/Components/Pages/VdeComposer.razor"
      provides: "VDE module selection wizard"
      contains: "ModuleId"
    - path: "DataWarehouse.GUI/Components/Shared/TopologyPreview.razor"
      provides: "Visual topology diagram component"
      contains: "DeploymentTopology"
  key_links:
    - from: "DataWarehouse.GUI/Components/Pages/ModeSelection.razor"
      to: "DataWarehouse.GUI/Components/Pages/VdeComposer.razor"
      via: "Navigation from Install mode to VDE Composer"
      pattern: "NavigationManager"
    - from: "DataWarehouse.GUI/Components/Pages/VdeComposer.razor"
      to: "DataWarehouse.SDK/VirtualDiskEngine/Format/ModuleDefinitions.cs"
      via: "Uses ModuleId enum for module checklist"
      pattern: "ModuleId"
---

<objective>
Build GUI mode-selection startup page and VDE Composer wizard for module selection and topology preview.

Purpose: DPLY-06 requires a GUI VDE Composer wizard; DPLY-13 requires a mode-selection startup page.
Output: Three Blazor Razor components for mode selection, VDE composition, and topology preview.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@DataWarehouse.GUI/Components/Pages/Index.razor
@DataWarehouse.SDK/Hosting/DeploymentTopology.cs
@DataWarehouse.SDK/VirtualDiskEngine/Format/ModuleDefinitions.cs
@DataWarehouse.SDK/VirtualDiskEngine/Format/VdeCreationProfile.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Mode-selection startup page</name>
  <files>DataWarehouse.GUI/Components/Pages/ModeSelection.razor</files>
  <action>
Create `ModeSelection.razor` at route `/mode-selection`:

```razor
@page "/mode-selection"
@using DataWarehouse.SDK.Hosting
@inject NavigationManager Navigation
```

Implement a startup wizard with three card-style options:

1. **Connect (Mode A)**: "Connect to an existing DataWarehouse instance" -- navigates to `/connections`
2. **Live (Mode B)**: "Start a temporary in-memory instance" -- navigates to `/` with live mode flag
3. **Install (Mode C)**: "Install and configure a new DataWarehouse" -- shows topology sub-selection

When Install is selected, show a secondary panel with three topology cards:
- **DW+VDE** (default): "Full installation with local VDE storage"
- **DW-Only**: "DataWarehouse kernel connecting to remote VDE"
- **VDE-Only**: "VDE engine accepting remote DataWarehouse connections"

Each card shows an icon (use Unicode), title, 1-line description.

Include a `TopologyPreview` component (from Task 2 area) below the selection.

After topology selection, show a "Continue" button that navigates to:
- DW+VDE or DW-Only: standard install config page
- Any topology: `/vde-composer` if user wants to create a VDE during install

State management: use `[CascadingParameter]` or a simple `ModeSelectionState` service injected via DI to carry the selected mode and topology to subsequent pages.

Style with Tailwind/Bootstrap classes consistent with existing GUI pages (check Index.razor for conventions).
  </action>
  <verify>Build `DataWarehouse.GUI` with `dotnet build DataWarehouse.GUI/DataWarehouse.GUI.csproj` -- zero errors.</verify>
  <done>ModeSelection.razor renders three mode cards; Install mode shows topology sub-selection; navigation works to downstream pages.</done>
</task>

<task type="auto">
  <name>Task 2: VDE Composer wizard and topology preview</name>
  <files>DataWarehouse.GUI/Components/Pages/VdeComposer.razor, DataWarehouse.GUI/Components/Shared/TopologyPreview.razor</files>
  <action>
**VdeComposer.razor** at route `/vde-composer`:

Multi-step wizard:
1. **Module Selection**: Checklist of all 19 `ModuleId` values with name, description, and dependency hints. Group by category (Security: Security/Compliance/Privacy; Storage: RAID/Compression/Snapshot/Streaming; Intelligence: Intelligence/Tags/Query/Compute; Infrastructure: Replication/Consensus/Fabric/Integrity/Observability/AuditLog; Other: Sustainability/Transit). Use checkboxes.

2. **Configuration**: For each selected module, show a config level slider (0-15) with preset descriptions. Block size selector (512, 1024, 2048, 4096, 8192, 16384, 32768, 65536). Total size input with unit selector (MB/GB/TB).

3. **Preview**: Show computed `ModuleManifestField` value (hex), estimated metadata overhead, inode size, and a `TopologyPreview` component.

4. **Create**: Output path input + Create button. On click, call the VDE creation service (or show the CLI equivalent command for copy-paste).

**TopologyPreview.razor** (shared component):

Parameters: `[Parameter] public DeploymentTopology Topology { get; set; }` and `[Parameter] public IReadOnlyList<ModuleId>? ActiveModules { get; set; }`

Renders a simple ASCII/Unicode box diagram showing:
- For DW+VDE: `[DW Kernel] <-> [VDE Engine]` on same box
- For DW-Only: `[DW Kernel] --network--> [Remote VDE]`
- For VDE-Only: `[Remote DW] --network--> [VDE Engine]`

Below the diagram, list active modules as pills/badges.

Use `@using DataWarehouse.SDK.VirtualDiskEngine.Format` for ModuleId. Use `@using DataWarehouse.SDK.Hosting` for DeploymentTopology.
  </action>
  <verify>Build `DataWarehouse.GUI` with `dotnet build DataWarehouse.GUI/DataWarehouse.GUI.csproj` -- zero errors.</verify>
  <done>VdeComposer wizard renders 4-step flow; TopologyPreview shows correct diagram per topology; module checklist includes all 19 modules grouped by category; GUI builds cleanly.</done>
</task>

</tasks>

<verification>
- `dotnet build DataWarehouse.sln` compiles with zero errors
- ModeSelection page exists at `/mode-selection`
- VdeComposer page exists at `/vde-composer`
- TopologyPreview component renders for all 3 topologies
</verification>

<success_criteria>
- GUI mode-selection page presents Connect/Live/Install options
- Install mode shows DW-only/VDE-only/DW+VDE topology cards
- VDE Composer wizard has module checklist, config sliders, preview, and create steps
- TopologyPreview shows correct network diagram for each topology
- GUI project builds with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/84-deployment-topology-cli-modes/84-03-SUMMARY.md`
</output>
