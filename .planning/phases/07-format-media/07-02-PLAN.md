---
phase: 07-format-media
plan: 02
type: execute
wave: 1
depends_on: [07-01]
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Columnar/ParquetStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Columnar/OrcStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Columnar/ArrowStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Scientific/Hdf5Strategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Scientific/NetCdfStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Scientific/FitsStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Geo/GeoJsonStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Geo/ShapefileStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Geo/GeoTiffStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Geo/KmlStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/DataWarehouse.Plugins.UltimateDataFormat.csproj
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "Columnar format strategies (Parquet, ORC, Arrow) support column-based data access"
    - "Scientific format strategies (HDF5, NetCDF, FITS) handle hierarchical scientific data"
    - "Geospatial format strategies (GeoJSON, Shapefile, GeoTIFF, KML) process geo data"
    - "All strategies support schema extraction where applicable"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Columnar/ParquetStrategy.cs"
      provides: "Parquet columnar format with RandomAccess capability"
      exports: ["ParquetStrategy"]
    - path: "Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Scientific/Hdf5Strategy.cs"
      provides: "HDF5 hierarchical data format"
      exports: ["Hdf5Strategy"]
    - path: "Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Geo/GeoJsonStrategy.cs"
      provides: "GeoJSON format extending JsonStrategy"
      exports: ["GeoJsonStrategy"]
  key_links:
    - from: "ParquetStrategy"
      to: "DataFormatStrategyBase"
      via: "inheritance with RandomAccess=true"
      pattern: "RandomAccess = true"
    - from: "Hdf5Strategy"
      to: "DataFormatStrategyBase"
      via: "inheritance with SchemaAware=true, SupportsHierarchicalData=true"
      pattern: "SchemaAware = true.*SupportsHierarchicalData = true"
---

<objective>
Implement columnar, scientific, and geospatial data format strategies for UltimateDataFormat plugin.

Purpose: Add 10 strategies across 3 specialized domains (T110.B5-B7): columnar formats for analytics workloads, scientific formats for research data, and geospatial formats for location-based data.

Output: 10 production-ready format strategies with domain-specific capabilities.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-format-media/07-RESEARCH.md
@DataWarehouse.SDK/Contracts/DataFormat/DataFormatStrategy.cs
@.planning/phases/07-format-media/07-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement 3 columnar format strategies</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Columnar/ParquetStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Columnar/OrcStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Columnar/ArrowStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/DataWarehouse.Plugins.UltimateDataFormat.csproj
  </files>
  <action>
**Create Strategies/Columnar/ directory if needed:**
```bash
mkdir -p Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Columnar
```

**1. ParquetStrategy** (strategyId: "parquet")
- Extensions: .parquet
- MIME: application/parquet
- DomainFamily: Analytics
- Capabilities: Bidirectional, Streaming, SchemaAware, CompressionAware, RandomAccess, SelfDescribing, SupportsBinaryData
- DetectFormatCoreAsync: Check for PAR1 magic bytes at end of file
- ParseAsync: Stub - requires Apache.Parquet.Net library
- SerializeAsync: Stub - requires Apache.Parquet.Net library
- ExtractSchemaCoreAsync: Return Parquet schema from file metadata
- ValidateCoreAsync: Check PAR1 footer exists and is readable
- **Research note:** Parquet is column-oriented with embedded schema and compression

**2. OrcStrategy** (strategyId: "orc")
- Extensions: .orc
- MIME: application/orc
- DomainFamily: Analytics
- Capabilities: Bidirectional, Streaming, SchemaAware, CompressionAware, RandomAccess, SupportsBinaryData
- DetectFormatCoreAsync: Check for ORC magic bytes (0x4F, 0x52, 0x43)
- ParseAsync: Stub - requires ORC library
- SerializeAsync: Stub - requires ORC library
- ExtractSchemaCoreAsync: Return ORC schema from file footer
- ValidateCoreAsync: Check ORC footer structure
- **Research note:** ORC (Optimized Row Columnar) similar to Parquet but different compression

**3. ArrowStrategy** (strategyId: "arrow")
- Extensions: .arrow, .feather
- MIME: application/vnd.apache.arrow
- DomainFamily: Analytics
- Capabilities: Bidirectional, Streaming, SchemaAware, RandomAccess, SupportsBinaryData, SelfDescribing
- DetectFormatCoreAsync: Check for Arrow IPC magic bytes (0xFF, 0xFF, 0xFF, 0xFF)
- ParseAsync: Stub - requires Apache.Arrow library
- SerializeAsync: Stub - requires Apache.Arrow library
- ExtractSchemaCoreAsync: Return Arrow schema from IPC header
- ValidateCoreAsync: Check IPC format structure

**Add NuGet packages to .csproj (commented out until libraries added):**
```xml
<!-- <PackageReference Include="Apache.Parquet.Net" Version="..." /> -->
<!-- <PackageReference Include="Apache.Arrow" Version="..." /> -->
```

**Why stubs:** Research (pitfall 4) warns against loading entire files into memory. Columnar formats require specialized libraries for efficient processing. Stubs demonstrate pattern; full implementations require library integration in later plan.
  </action>
  <verify>
```bash
cd Plugins/DataWarehouse.Plugins.UltimateDataFormat && dotnet build
# Expect: Build succeeded

grep -l "class.*Strategy.*:.*DataFormatStrategyBase" Strategies/Columnar/*.cs | wc -l
# Expect: 3
```
  </verify>
  <done>
- [ ] 3 columnar strategy files created
- [ ] All extend DataFormatStrategyBase
- [ ] RandomAccess=true for all columnar strategies
- [ ] DetectFormatCoreAsync checks for format-specific magic bytes
- [ ] ExtractSchemaCoreAsync implemented (stub OK)
- [ ] Builds without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement 3 scientific + 4 geospatial format strategies</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Scientific/Hdf5Strategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Scientific/NetCdfStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Scientific/FitsStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Geo/GeoJsonStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Geo/ShapefileStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Geo/GeoTiffStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Geo/KmlStrategy.cs
    Metadata/TODO.md
  </files>
  <action>
**Scientific Strategies (3):**

**1. Hdf5Strategy** (strategyId: "hdf5")
- Extensions: .h5, .hdf5, .he5
- MIME: application/x-hdf
- DomainFamily: Scientific
- Capabilities: Bidirectional, SchemaAware, RandomAccess, SupportsHierarchicalData, CompressionAware, SupportsBinaryData, SelfDescribing
- DetectFormatCoreAsync: Check for HDF5 signature (0x89, 0x48, 0x44, 0x46, 0x0D, 0x0A, 0x1A, 0x0A)
- ParseAsync: Stub - requires HDF.PInvoke or HDF5-CSharp library
- ExtractSchemaCoreAsync: Return HDF5 group/dataset hierarchy
- **Research note:** HDF5 is hierarchical with groups, datasets, attributes

**2. NetCdfStrategy** (strategyId: "netcdf")
- Extensions: .nc, .nc4
- MIME: application/netcdf
- DomainFamily: Scientific (Climate)
- Capabilities: Bidirectional, SchemaAware, RandomAccess, SupportsHierarchicalData, SelfDescribing, SupportsBinaryData
- DetectFormatCoreAsync: Check for NetCDF signature (CDF\x01 or \x89HDF)
- ParseAsync: Stub - requires NetCDF library
- ExtractSchemaCoreAsync: Return NetCDF dimensions, variables, attributes
- **Research note:** NetCDF v4 uses HDF5 underneath

**3. FitsStrategy** (strategyId: "fits")
- Extensions: .fits, .fit, .fts
- MIME: application/fits
- DomainFamily: Astronomy
- Capabilities: Bidirectional, SchemaAware, SupportsBinaryData, SelfDescribing
- DetectFormatCoreAsync: Check for FITS signature (SIMPLE or XTENSION at start)
- ParseAsync: Stub - requires FITS library
- ExtractSchemaCoreAsync: Return FITS header keywords
- **Research note:** FITS (Flexible Image Transport System) for astronomy data

**Geospatial Strategies (4):**

**4. GeoJsonStrategy** (strategyId: "geojson")
- Extensions: .geojson, .json
- MIME: application/geo+json
- DomainFamily: Geospatial
- Capabilities: Bidirectional, Streaming, SupportsHierarchicalData, SelfDescribing (extends JSON capabilities)
- DetectFormatCoreAsync: Parse as JSON, check for "type": "FeatureCollection" or "Feature"
- ParseAsync: Use System.Text.Json, validate GeoJSON structure (type, geometry, coordinates)
- SerializeAsync: Serialize with GeoJSON structure validation
- ValidateCoreAsync: Check GeoJSON spec compliance (valid geometry types: Point, LineString, Polygon, etc.)
- **Research note:** GeoJSON is JSON with specific structure for geographic features

**5. ShapefileStrategy** (strategyId: "shapefile")
- Extensions: .shp (requires .shx, .dbf companions)
- MIME: application/x-shapefile
- DomainFamily: Geospatial
- Capabilities: Bidirectional, SchemaAware, RandomAccess, SupportsBinaryData
- DetectFormatCoreAsync: Check for shapefile magic number (9994)
- ParseAsync: Stub - requires shapefile library (e.g., NetTopologySuite)
- **Research note:** Shapefile is ESRI format with multiple companion files

**6. GeoTiffStrategy** (strategyId: "geotiff")
- Extensions: .tif, .tiff, .geotiff
- MIME: image/tiff
- DomainFamily: Geospatial
- Capabilities: Bidirectional, SchemaAware, SupportsBinaryData
- DetectFormatCoreAsync: Check for TIFF signature + GeoTIFF tags
- ParseAsync: Stub - requires TIFF + GeoTIFF library
- ExtractSchemaCoreAsync: Return GeoTIFF geospatial metadata (CRS, bounds)

**7. KmlStrategy** (strategyId: "kml")
- Extensions: .kml, .kmz
- MIME: application/vnd.google-earth.kml+xml
- DomainFamily: Geospatial
- Capabilities: Bidirectional, SupportsHierarchicalData, SelfDescribing
- DetectFormatCoreAsync: Check for XML with <kml> root element
- ParseAsync: Use XDocument, parse KML structure (Placemark, Polygon, LineString)
- SerializeAsync: Generate valid KML XML
- ValidateCoreAsync: Check against KML 2.2 schema

**Mark complete in TODO.md:** T110.B5 (columnar formats), T110.B6 (scientific formats), T110.B7 (geospatial formats).

**Why this scope:** 7 strategies demonstrate domain-specific patterns. GeoJSON and KML have full implementations (JSON/XML based). Binary formats (HDF5, NetCDF, FITS, Shapefile, GeoTIFF) use stubs until libraries added.
  </action>
  <verify>
```bash
cd Plugins/DataWarehouse.Plugins.UltimateDataFormat && dotnet build
# Expect: Build succeeded

# Count strategies:
find Strategies/Scientific -name "*.cs" | wc -l  # Expect: 3
find Strategies/Geo -name "*.cs" | wc -l         # Expect: 4
```
  </verify>
  <done>
- [ ] 7 strategy files created (3 scientific, 4 geospatial)
- [ ] All extend DataFormatStrategyBase
- [ ] DomainFamily set correctly (Scientific, Astronomy, Geospatial)
- [ ] GeoJSON and KML have full parse/serialize implementations
- [ ] Binary formats have stub implementations
- [ ] TODO.md updated for T110.B5-B7
- [ ] Builds without errors
  </done>
</task>

</tasks>

<verification>
1. Build verification: `cd Plugins/DataWarehouse.Plugins.UltimateDataFormat && dotnet build`
2. Strategy count: 10 new strategies (3 columnar + 3 scientific + 4 geospatial)
3. Capability flags: RandomAccess for columnar, SupportsHierarchicalData for scientific/geo
4. Format detection: DetectFormatCoreAsync checks magic bytes or structure markers
5. Schema extraction: ExtractSchemaCoreAsync implemented for schema-aware formats
</verification>

<success_criteria>
- [ ] 10 format strategies implemented across 3 domains
- [ ] Columnar strategies have RandomAccess=true
- [ ] Scientific strategies have SupportsHierarchicalData=true
- [ ] Geospatial strategies set DomainFamily correctly
- [ ] GeoJSON and KML have production-ready implementations
- [ ] Binary formats have stub implementations with correct capabilities
- [ ] All strategies auto-discovered by orchestrator
- [ ] Build passes with zero errors
</success_criteria>

<output>
After completion, create `.planning/phases/07-format-media/07-02-SUMMARY.md`
</output>
