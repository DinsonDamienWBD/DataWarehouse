---
phase: 07-format-media
plan: 07
type: execute
wave: 3
depends_on: []
files_modified:
  - Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Streaming/HlsStreamingStrategy.cs
  - Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Streaming/DashStreamingStrategy.cs
  - Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Streaming/CmafStreamingStrategy.cs
  - Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Video/H264CodecStrategy.cs
  - Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Video/H265CodecStrategy.cs
  - Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Video/Vp9CodecStrategy.cs
  - Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Video/Av1CodecStrategy.cs
  - Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Video/VvcCodecStrategy.cs
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "Streaming delivery strategies (HLS, DASH, CMAF) generate adaptive bitrate manifests"
    - "Video codec strategies (H.264, H.265, VP9, AV1, VVC) transcode video streams"
    - "All strategies extend MediaStrategyBase from SDK"
    - "FFmpeg integration for transcoding operations"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Streaming/HlsStreamingStrategy.cs"
      provides: "HLS manifest generation with m3u8 playlists"
      exports: ["HlsStreamingStrategy"]
    - path: "Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Video/H264CodecStrategy.cs"
      provides: "H.264/AVC video encoding via FFmpeg"
      exports: ["H264CodecStrategy"]
  key_links:
    - from: "H264CodecStrategy"
      to: "SDK.Contracts.Media.MediaStrategyBase"
      via: "inheritance with TranscodeAsyncCore implementation"
      pattern: "TranscodeAsyncCore"
    - from: "HlsStreamingStrategy"
      to: "MediaStrategyBase"
      via: "inheritance with SupportsAdaptiveBitrate=true"
      pattern: "SupportsAdaptiveBitrate = true"
---

<objective>
Verify and complete Transcoding.Media streaming delivery and video codec strategies (T118.B2-B3).

Purpose: Research shows Transcoding.Media plugin exists with only orchestrator file. Add streaming protocols (HLS, DASH, CMAF) and video codecs (H.264, H.265, VP9, AV1, VVC).

Output: 8 production-ready media strategies for streaming and transcoding.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-format-media/07-RESEARCH.md
@DataWarehouse.SDK/Contracts/Media/IMediaStrategy.cs
@DataWarehouse.SDK/Contracts/Media/MediaStrategyBase.cs
@Plugins/DataWarehouse.Plugins.Transcoding.Media/MediaTranscodingPlugin.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement streaming delivery strategies</name>
  <files>
    Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Streaming/HlsStreamingStrategy.cs
    Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Streaming/DashStreamingStrategy.cs
    Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Streaming/CmafStreamingStrategy.cs
  </files>
  <action>
**HlsStreamingStrategy** (strategyId: "hls")
- Protocol: HTTP Live Streaming (Apple)
- MediaCapabilities: SupportsStreaming=true, SupportsAdaptiveBitrate=true, SupportedOutputFormats=[HLS]
- TranscodeAsyncCore: Generate m3u8 master playlist + variant playlists + TS segments
- Segment duration: 6 seconds default
- Variants: 360p, 480p, 720p, 1080p with different bitrates
- **Research note:** Use FFMpegCore with HLS output format

**DashStreamingStrategy** (strategyId: "dash")
- Protocol: Dynamic Adaptive Streaming over HTTP (MPEG)
- MediaCapabilities: SupportsStreaming=true, SupportsAdaptiveBitrate=true, SupportedOutputFormats=[DASH]
- TranscodeAsyncCore: Generate MPD manifest + adaptation sets + segment files
- Segment template with SegmentTimeline
- Supports multiple audio tracks and subtitle streams

**CmafStreamingStrategy** (strategyId: "cmaf")
- Protocol: Common Media Application Format
- MediaCapabilities: SupportsStreaming=true, SupportsAdaptiveBitrate=true, SupportedOutputFormats=[CMAF]
- TranscodeAsyncCore: Generate fragmented MP4 with both HLS and DASH compatible manifest
- Unified packaging for multi-platform delivery

All strategies extend MediaStrategyBase with MediaCapabilities.SupportsStreaming=true.
  </action>
  <verify>
```bash
cd Plugins/DataWarehouse.Plugins.Transcoding.Media && dotnet build
ls Strategies/Streaming/*.cs | wc -l  # Expect: 3
```
  </verify>
  <done>
- [ ] 3 streaming delivery strategies implemented
- [ ] All extend MediaStrategyBase
- [ ] SupportsAdaptiveBitrate=true for all
- [ ] Manifest generation logic implemented
- [ ] Builds without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement video codec strategies</name>
  <files>
    Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Video/H264CodecStrategy.cs
    Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Video/H265CodecStrategy.cs
    Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Video/Vp9CodecStrategy.cs
    Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Video/Av1CodecStrategy.cs
    Plugins/DataWarehouse.Plugins.Transcoding.Media/Strategies/Video/VvcCodecStrategy.cs
    Metadata/TODO.md
  </files>
  <action>
**H264CodecStrategy** (strategyId: "h264")
- Codec: H.264/AVC (libx264)
- SupportedCodecs: ["h264", "avc", "libx264"]
- TranscodeAsyncCore: FFmpeg transcode with H.264 encoder
- Presets: ultrafast, fast, medium, slow, veryslow
- Profile: baseline, main, high
- Hardware acceleration: NVIDIA NVENC (h264_nvenc), Intel QSV (h264_qsv)

**H265CodecStrategy** (strategyId: "h265")
- Codec: H.265/HEVC (libx265)
- SupportedCodecs: ["h265", "hevc", "libx265"]
- TranscodeAsyncCore: FFmpeg with H.265 encoder (50% better compression than H.264)
- Hardware acceleration: NVIDIA NVENC (hevc_nvenc), Intel QSV (hevc_qsv)

**Vp9CodecStrategy** (strategyId: "vp9")
- Codec: VP9 (Google, open-source)
- SupportedCodecs: ["vp9", "libvpx-vp9"]
- TranscodeAsyncCore: FFmpeg with libvpx-vp9
- Two-pass encoding for quality optimization
- WebM container output

**Av1CodecStrategy** (strategyId: "av1")
- Codec: AV1 (libaom, SVT-AV1)
- SupportedCodecs: ["av1", "libaom-av1", "libsvtav1"]
- TranscodeAsyncCore: FFmpeg with AV1 encoder (30% better than H.265)
- Slower encode, better compression
- Patent-free

**VvcCodecStrategy** (strategyId: "vvc")
- Codec: VVC/H.266 (next-gen)
- SupportedCodecs: ["vvc", "h266", "libvvenc"]
- TranscodeAsyncCore: Stub - VVC support limited (experimental)
- 50% better compression than H.265 (when mature)

**FFmpeg integration pattern:**
```csharp
protected override async Task<Stream> TranscodeAsyncCore(
    Stream inputStream, TranscodeOptions options, CancellationToken ct)
{
    // Use FFMpegCore library (research don't-hand-roll section)
    var outputStream = new MemoryStream();
    await FFMpegArguments
        .FromPipeInput(new StreamPipeSource(inputStream))
        .OutputToPipe(new StreamPipeSink(outputStream), options => options
            .WithVideoCodec("libx264")
            .WithConstantRateFactor(23)
            .WithFastStart())
        .ProcessAsynchronously();
    outputStream.Position = 0;
    return outputStream;
}
```

Mark complete in TODO.md: T118.B2 (streaming delivery), T118.B3 (video codecs).

**Research note:** Research warns against hand-rolling FFmpeg process management (Pitfall 3). Use FFMpegCore library for lifecycle, progress, error handling.
  </action>
  <verify>
```bash
cd Plugins/DataWarehouse.Plugins.Transcoding.Media && dotnet build
ls Strategies/Video/*.cs | wc -l  # Expect: 5

# Verify FFMpegCore usage:
grep -r "FFMpegCore\|FFMpegArguments" Strategies/Video/
# Expect: FFmpeg library integration, not raw Process.Start
```
  </verify>
  <done>
- [ ] 5 video codec strategies implemented
- [ ] All extend MediaStrategyBase
- [ ] SupportedCodecs defined for each
- [ ] FFMpegCore library used (not raw Process)
- [ ] Hardware acceleration support documented
- [ ] TODO.md updated for T118.B2-B3
- [ ] Builds without errors
  </done>
</task>

</tasks>

<verification>
1. Build: `cd Plugins/DataWarehouse.Plugins.Transcoding.Media && dotnet build`
2. Strategy count: 8 (3 streaming + 5 video codecs)
3. MediaCapabilities: SupportsStreaming, SupportsAdaptiveBitrate, SupportedCodecs
4. FFmpeg integration: FFMpegCore library usage, not raw CLI
</verification>

<success_criteria>
- [ ] 8 media strategies implemented (3 streaming + 5 codecs)
- [ ] Streaming strategies generate HLS/DASH/CMAF manifests
- [ ] Video codec strategies use FFMpegCore library
- [ ] Hardware acceleration documented per codec
- [ ] All extend MediaStrategyBase from SDK
- [ ] Build passes with zero errors
- [ ] TODO.md updated for T118.B2-B3
</success_criteria>

<output>
After completion, create `.planning/phases/07-format-media/07-07-SUMMARY.md`
</output>
