---
phase: 07-format-media
plan: 03
type: execute
wave: 1
depends_on: [07-01]
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Graph/RdfStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Graph/GraphMlStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Lakehouse/DeltaLakeStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Lakehouse/IcebergStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/AI/OnnxStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/AI/SafeTensorsStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/ML/PmmlStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Simulation/VtkStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Simulation/CgnsStrategy.cs
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "Graph format strategies (RDF, GraphML) parse graph structures"
    - "Lakehouse format strategies (Delta Lake, Iceberg) handle table metadata"
    - "AI/ML format strategies (ONNX, SafeTensors, PMML) process model files"
    - "Simulation format strategies (VTK, CGNS) parse CFD data"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Graph/RdfStrategy.cs"
      provides: "RDF triple format parsing"
      exports: ["RdfStrategy"]
    - path: "Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/AI/OnnxStrategy.cs"
      provides: "ONNX model format with schema extraction"
      exports: ["OnnxStrategy"]
    - path: "Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Lakehouse/DeltaLakeStrategy.cs"
      provides: "Delta Lake table format"
      exports: ["DeltaLakeStrategy"]
  key_links:
    - from: "RdfStrategy"
      to: "DataFormatStrategyBase"
      via: "inheritance with SupportsHierarchicalData=true"
      pattern: "SupportsHierarchicalData = true"
    - from: "OnnxStrategy"
      to: "DataFormatStrategyBase"
      via: "inheritance with DomainFamily.MachineLearning"
      pattern: "DomainFamily = DomainFamily\\.MachineLearning"
---

<objective>
Implement graph, lakehouse, AI, ML, and simulation format strategies completing T110.B8-B12.

Purpose: Add 9 strategies covering advanced data domains: graph databases, modern lakehouse formats, AI/ML model formats, and scientific simulation data.

Output: 9 format strategies demonstrating pattern coverage across specialized domains.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-format-media/07-RESEARCH.md
@DataWarehouse.SDK/Contracts/DataFormat/DataFormatStrategy.cs
@.planning/phases/07-format-media/07-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement graph and lakehouse format strategies</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Graph/RdfStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Graph/GraphMlStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Lakehouse/DeltaLakeStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Lakehouse/IcebergStrategy.cs
  </files>
  <action>
**Graph Strategies (2):**

**1. RdfStrategy** (strategyId: "rdf")
- Extensions: .rdf, .ttl, .nt, .n3
- MIME: application/rdf+xml, text/turtle
- DomainFamily: General
- Capabilities: Bidirectional, SchemaAware, SupportsHierarchicalData, SelfDescribing
- DetectFormatCoreAsync: Check for RDF XML root element or Turtle syntax (@prefix)
- ParseAsync: Parse RDF triples (subject, predicate, object) - basic RDF/XML or Turtle
- SerializeAsync: Serialize triples to RDF/XML or Turtle
- ExtractSchemaCoreAsync: Extract RDF Schema (RDFS) or OWL ontology
- ValidateCoreAsync: Check triple structure validity
- **Research note:** RDF is for semantic web, graph data model

**2. GraphMlStrategy** (strategyId: "graphml")
- Extensions: .graphml
- MIME: application/graphml+xml
- DomainFamily: General
- Capabilities: Bidirectional, SchemaAware, SupportsHierarchicalData, SelfDescribing
- DetectFormatCoreAsync: Check for <graphml> root element
- ParseAsync: Parse GraphML XML (nodes, edges, data attributes)
- SerializeAsync: Generate GraphML XML
- ExtractSchemaCoreAsync: Extract node/edge attribute schema
- ValidateCoreAsync: Check against GraphML spec
- **Research note:** GraphML is XML-based graph serialization format

**Lakehouse Strategies (2):**

**3. DeltaLakeStrategy** (strategyId: "deltalake")
- Extensions: .delta (directory-based format)
- MIME: application/delta-lake
- DomainFamily: Analytics
- Capabilities: SchemaAware, RandomAccess, SelfDescribing, SupportsHierarchicalData (via Parquet)
- DetectFormatCoreAsync: Check for _delta_log directory with JSON transaction log
- ParseAsync: Stub - requires Delta Lake library (reads Parquet + transaction log)
- ExtractSchemaCoreAsync: Read schema from transaction log JSON
- ValidateCoreAsync: Validate transaction log consistency
- **Research note:** Delta Lake = Parquet + ACID transaction log

**4. IcebergStrategy** (strategyId: "iceberg")
- Extensions: .iceberg (directory-based format)
- MIME: application/iceberg
- DomainFamily: Analytics
- Capabilities: SchemaAware, RandomAccess, SelfDescribing, SupportsHierarchicalData
- DetectFormatCoreAsync: Check for metadata/ directory with Iceberg metadata JSON
- ParseAsync: Stub - requires Iceberg library
- ExtractSchemaCoreAsync: Read schema from Iceberg metadata JSON
- ValidateCoreAsync: Validate metadata structure
- **Research note:** Apache Iceberg table format for data lakes

**Why directory-based formats:** Delta Lake and Iceberg are multi-file formats. DetectFormatCoreAsync checks for metadata directories. ParseAsync requires understanding of their transaction log structures.
  </action>
  <verify>
```bash
cd Plugins/DataWarehouse.Plugins.UltimateDataFormat && dotnet build
# Expect: Build succeeded

ls Strategies/Graph/*.cs | wc -l      # Expect: 2
ls Strategies/Lakehouse/*.cs | wc -l  # Expect: 2
```
  </verify>
  <done>
- [ ] 4 strategy files created (2 graph, 2 lakehouse)
- [ ] RDF and GraphML have full parse/serialize implementations
- [ ] Delta Lake and Iceberg have schema extraction from metadata
- [ ] All extend DataFormatStrategyBase with correct DomainFamily
- [ ] Builds without errors
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement AI, ML, and simulation format strategies</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/AI/OnnxStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/AI/SafeTensorsStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/ML/PmmlStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Simulation/VtkStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateDataFormat/Strategies/Simulation/CgnsStrategy.cs
    Metadata/TODO.md
  </files>
  <action>
**AI Strategies (2):**

**1. OnnxStrategy** (strategyId: "onnx")
- Extensions: .onnx
- MIME: application/onnx
- DomainFamily: MachineLearning
- Capabilities: Bidirectional, SchemaAware, SupportsBinaryData, SelfDescribing
- DetectFormatCoreAsync: Check for ONNX magic bytes (protobuf with "onnx" string)
- ParseAsync: Stub - requires Microsoft.ML.OnnxRuntime library
- ExtractSchemaCoreAsync: Extract model graph (inputs, outputs, operators)
- ValidateCoreAsync: Check ONNX model structure
- **Research note:** ONNX is neural network interchange format using protobuf

**2. SafeTensorsStrategy** (strategyId: "safetensors")
- Extensions: .safetensors
- MIME: application/safetensors
- DomainFamily: MachineLearning
- Capabilities: Bidirectional, SchemaAware, SupportsBinaryData, RandomAccess
- DetectFormatCoreAsync: Check for SafeTensors header (JSON metadata + tensor data)
- ParseAsync: Parse header JSON, read tensor binary data
- ExtractSchemaCoreAsync: Extract tensor names, shapes, dtypes from header
- ValidateCoreAsync: Check header JSON validity and tensor data integrity
- **Research note:** SafeTensors is Hugging Face format for safe tensor serialization

**ML Strategy (1):**

**3. PmmlStrategy** (strategyId: "pmml")
- Extensions: .pmml
- MIME: application/pmml+xml
- DomainFamily: MachineLearning
- Capabilities: Bidirectional, SchemaAware, SupportsHierarchicalData, SelfDescribing
- DetectFormatCoreAsync: Check for <PMML> root element with version attribute
- ParseAsync: Parse PMML XML (data dictionary, model elements)
- SerializeAsync: Generate PMML XML
- ExtractSchemaCoreAsync: Extract model schema (inputs, outputs, model type)
- ValidateCoreAsync: Check against PMML spec
- **Research note:** PMML is XML-based predictive model markup language

**Simulation Strategies (2):**

**4. VtkStrategy** (strategyId: "vtk")
- Extensions: .vtk, .vtu, .vtp
- MIME: application/vtk
- DomainFamily: Simulation
- Capabilities: Bidirectional, SchemaAware, SupportsBinaryData, SupportsHierarchicalData
- DetectFormatCoreAsync: Check for "# vtk DataFile" header
- ParseAsync: Stub - requires VTK library or manual parsing
- ExtractSchemaCoreAsync: Extract dataset type (structured/unstructured grid)
- ValidateCoreAsync: Check VTK file format structure
- **Research note:** VTK is Visualization Toolkit format for 3D scientific data

**5. CgnsStrategy** (strategyId: "cgns")
- Extensions: .cgns
- MIME: application/cgns
- DomainFamily: Simulation
- Capabilities: Bidirectional, SchemaAware, SupportsBinaryData, SupportsHierarchicalData, RandomAccess
- DetectFormatCoreAsync: Check for CGNS HDF5 signature (CGNS uses HDF5)
- ParseAsync: Stub - requires CGNS library (reads HDF5 with CGNS conventions)
- ExtractSchemaCoreAsync: Extract zone structure, boundary conditions
- ValidateCoreAsync: Check CGNS/SIDS compliance
- **Research note:** CGNS (CFD General Notation System) for computational fluid dynamics

**Mark complete in TODO.md:** T110.B8 (graph formats), T110.B9 (lakehouse formats), T110.B10 (AI formats), T110.B11 (ML formats), T110.B12 (simulation formats).

**Why this scope:** 5 strategies complete T110.B8-B12. AI/ML formats critical for model serving. Simulation formats demonstrate specialized scientific domains. Stubs for complex binary formats (ONNX, VTK, CGNS) are acceptable - full implementations require specialized libraries.
  </action>
  <verify>
```bash
cd Plugins/DataWarehouse.Plugins.UltimateDataFormat && dotnet build
# Expect: Build succeeded

ls Strategies/AI/*.cs | wc -l         # Expect: 2
ls Strategies/ML/*.cs | wc -l         # Expect: 1
ls Strategies/Simulation/*.cs | wc -l # Expect: 2

# Verify all strategies discovered:
grep -r "class.*Strategy.*:.*DataFormatStrategyBase" Strategies/ | wc -l
# Expect: 29 (10 from 07-01 + 10 from 07-02 + 9 from 07-03)
```
  </verify>
  <done>
- [ ] 5 strategy files created (2 AI, 1 ML, 2 simulation)
- [ ] DomainFamily.MachineLearning for AI/ML strategies
- [ ] DomainFamily.Simulation for VTK/CGNS
- [ ] SafeTensors and PMML have full implementations
- [ ] ONNX, VTK, CGNS have stub implementations
- [ ] TODO.md updated for T110.B8-B12
- [ ] Builds without errors
  </done>
</task>

</tasks>

<verification>
1. Build verification: `cd Plugins/DataWarehouse.Plugins.UltimateDataFormat && dotnet build`
2. Strategy count: 29 total (10+10+9)
3. Domain families: Graph, Analytics (lakehouse), MachineLearning, Simulation
4. Schema extraction: ExtractSchemaCoreAsync for all schema-aware formats
5. Format detection: DetectFormatCoreAsync checks for format-specific markers
</verification>

<success_criteria>
- [ ] 9 format strategies implemented (2 graph, 2 lakehouse, 2 AI, 1 ML, 2 simulation)
- [ ] Graph strategies parse triples and nodes/edges
- [ ] Lakehouse strategies extract schema from metadata
- [ ] AI/ML strategies set DomainFamily.MachineLearning
- [ ] Simulation strategies set DomainFamily.Simulation
- [ ] SafeTensors and PMML have production-ready implementations
- [ ] Build passes with zero errors
- [ ] TODO.md updated for T110.B8-B12
</success_criteria>

<output>
After completion, create `.planning/phases/07-format-media/07-03-SUMMARY.md`
</output>
