---
phase: 03-security-infrastructure
plan: 05
type: execute
wave: 2
depends_on: ["03-03"]
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ThreatDetection/*.cs
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "All 6 Zero Trust strategies enforce continuous verification"
    - "All 6 policy engine strategies integrate with external policy engines"
    - "All 9 threat detection strategies detect and respond to security threats"
    - "T95 B5, B6, B7 items in TODO.md are marked [x]"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/"
      provides: "6 Zero Trust strategy implementations"
    - path: "Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/"
      provides: "6 policy engine integrations"
    - path: "Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ThreatDetection/"
      provides: "9 threat detection strategies"
  key_links:
    - from: "ZeroTrust strategies"
      to: "UltimateAccessControlPlugin orchestrator"
      via: "IAccessControlStrategy auto-discovery"
      pattern: "IAccessControlStrategy"
    - from: "ThreatDetection strategies"
      to: "Intelligence plugin (T90)"
      via: "Message bus for ML delegation"
      pattern: "intelligence\\."
---

<objective>
Implement Zero Trust strategies (T95.B5), policy engine integrations (T95.B6), and threat detection strategies (T95.B7) for UltimateAccessControl.

Purpose: These three groups represent the security posture layer -- continuous verification, policy enforcement, and threat detection. B7 strategies delegate ML workloads to Intelligence plugin (T90) via message bus with rule-based fallbacks.
Output: 21 strategy implementations covering Zero Trust, policy engines, and threat detection.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-security-infrastructure/03-RESEARCH.md
@Metadata/CLAUDE.md
@.planning/phases/03-security-infrastructure/03-03-SUMMARY.md
@Plugins/DataWarehouse.Plugins.UltimateAccessControl/IAccessControlStrategy.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement Zero Trust and policy engine strategies (T95.B5, B6)</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/ZeroTrustCoreStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/SpiffeSpireStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/MtlsStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/ServiceMeshStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/MicroSegmentationStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/ContinuousVerificationStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/OpaStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/CasbinStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/CedarStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/ZanzibarStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/PermifyStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/CerbosStrategy.cs
  </files>
  <action>
CRITICAL WORKFLOW RULES:
- Rule 13: No simulations, mocks, stubs, placeholders
- Verify before implementing: ZeroTrustStrategy.cs already exists in Core/ -- check if it covers B5.1
- Plugin isolation: SDK-only references
- Base classes mandatory

1. Check existing: ZeroTrustStrategy.cs is in Strategies/Core/. Read it. If it covers B5.1, don't duplicate.

2. Create Strategies/ZeroTrust/ and Strategies/PolicyEngine/ directories.

3. Implement B5 Zero Trust strategies:

   **B5.1 ZeroTrustStrategy** - Core framework (may already exist):
   - Never trust, always verify
   - Per-request authentication + authorization
   - Least privilege access
   - Device posture assessment

   **B5.2 SpiffeSpireStrategy** - SPIFFE/SPIRE workload identity:
   - SPIFFE ID validation (spiffe://trust-domain/path)
   - X.509 SVID verification
   - JWT SVID validation
   - Workload registration API

   **B5.3 MtlsStrategy** - Mutual TLS:
   - Client certificate validation
   - Certificate pinning
   - OCSP/CRL checking
   - Certificate rotation handling

   **B5.4 ServiceMeshStrategy** - Service mesh (Istio/Linkerd):
   - Sidecar proxy integration
   - Service-to-service authorization policies
   - Traffic policy enforcement

   **B5.5 MicroSegmentationStrategy** - Network micro-segmentation:
   - Zone-based network policies
   - Application-layer segmentation
   - Dynamic policy updates based on threat level

   **B5.6 ContinuousVerificationStrategy** - Continuous auth:
   - Session re-evaluation on risk change
   - Behavioral anomaly triggers re-auth
   - Step-up authentication on sensitive operations

4. Implement B6 Policy Engine strategies:

   **B6.1 OpaStrategy** - Open Policy Agent:
   - Rego policy evaluation via REST API
   - Policy bundle management
   - Decision logging

   **B6.2 CasbinStrategy** - Casbin:
   - Model/policy file management
   - RBAC/ABAC/PBAC model support
   - Adapter pattern for policy storage

   **B6.3 CedarStrategy** - AWS Cedar:
   - Cedar policy language parsing
   - Entity/action/resource evaluation
   - Policy set management

   **B6.4 ZanzibarStrategy** - Google Zanzibar-style:
   - Relationship tuple management (user:relation:object)
   - Transitive relationship resolution
   - Check/Expand/Read APIs

   **B6.5 PermifyStrategy** - Permify:
   - Schema-based authorization
   - Permission checking via Permify API
   - Data filtering

   **B6.6 CerbosStrategy** - Cerbos:
   - Policy definition (resource policies, derived roles)
   - gRPC/REST policy evaluation
   - Audit trail

5. Build project.
  </action>
  <verify>
`dotnet build` succeeds. 12 strategy files exist in ZeroTrust/ and PolicyEngine/ directories.
  </verify>
  <done>
6 Zero Trust + 6 policy engine strategies implemented and compiling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement threat detection strategies (T95.B7) and sync TODO.md</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ThreatDetection/ThreatDetectionStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ThreatDetection/SiemIntegrationStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ThreatDetection/SoarStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ThreatDetection/UebaStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ThreatDetection/NdRStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ThreatDetection/EdRStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ThreatDetection/XdRStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ThreatDetection/HoneypotStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ThreatDetection/ThreatIntelStrategy.cs
    Metadata/TODO.md
  </files>
  <action>
CRITICAL: B7 strategies that delegate to AI (B7.4 UEBA, B7.9 ThreatIntel) MUST use message bus to communicate with Intelligence plugin (T90) and have rule-based fallbacks when T90 is unavailable.

1. Check existing: Strategies/Honeypot/ already has CanaryStrategy.cs and DeceptionNetworkStrategy.cs. These may overlap with B7.8. Read and decide whether to reuse or create separate.

2. Create Strategies/ThreatDetection/ directory.

3. Implement B7 strategies:

   **B7.1 ThreatDetectionStrategy** - Generic threat detection engine:
   - Anomaly scoring based on configurable rules
   - Threat level escalation (Low, Medium, High, Critical)
   - Alert generation and routing

   **B7.2 SiemIntegrationStrategy** - SIEM integration:
   - Syslog (CEF, LEEF) event forwarding
   - REST API integration for Splunk/Sentinel
   - Structured log formatting

   **B7.3 SoarStrategy** - Security orchestration & response:
   - Playbook-based incident response
   - Automated containment actions
   - Integration with ticketing systems

   **B7.4 UebaStrategy** - User/Entity Behavior Analytics:
   - **Message bus**: Request ML analysis from Intelligence plugin (T90)
   - **Fallback**: Rule-based anomaly detection (login time, location, frequency)
   - Baseline behavior profiling
   - Deviation scoring

   **B7.5 NdRStrategy** - Network Detection & Response:
   - Network traffic pattern analysis
   - Protocol anomaly detection
   - Lateral movement detection

   **B7.6 EdRStrategy** - Endpoint Detection & Response:
   - Process monitoring patterns
   - File integrity monitoring
   - Registry/config change detection

   **B7.7 XdRStrategy** - Extended Detection & Response:
   - Cross-domain correlation (network + endpoint + identity)
   - Unified threat timeline
   - Automated investigation workflows

   **B7.8 HoneypotStrategy** - Deception technology:
   - Check existing Honeypot/CanaryStrategy.cs -- may already cover this
   - If not: decoy resource deployment, access monitoring, attacker profiling

   **B7.9 ThreatIntelStrategy** - Threat intelligence feeds:
   - **Message bus**: Request AI enrichment from Intelligence plugin (T90)
   - **Fallback**: STIX/TAXII feed consumption, IoC matching
   - Threat feed management and correlation

4. Build project.

5. Update Metadata/TODO.md:
   - Mark T95.B5.1 through B5.6 as [x] (lines ~8118-8123)
   - Mark T95.B6.1 through B6.6 as [x] (lines ~8125-8130)
   - Mark T95.B7.1 through B7.9 as [x] (lines ~8132-8140)
  </action>
  <verify>
`dotnet build` succeeds. 9 threat detection strategy files exist.
TODO.md T95.B5, B6, B7 items all marked [x].
  </verify>
  <done>
9 threat detection strategies implemented with AI fallback patterns.
T95 B5 (6), B6 (6), B7 (9) = 21 items marked [x] in TODO.md.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build` succeeds for UltimateAccessControl project
2. 6 Zero Trust strategy files in Strategies/ZeroTrust/
3. 6 policy engine strategy files in Strategies/PolicyEngine/
4. 9 threat detection strategy files in Strategies/ThreatDetection/
5. AI-dependent strategies have message bus + fallback pattern
6. TODO.md B5+B6+B7 items all [x]
</verification>

<success_criteria>
- All 21 strategies implemented and building
- AI-dependent strategies use message bus with graceful degradation
- Plugin builds cleanly
- TODO.md T95 B5+B6+B7 fully synced
</success_criteria>

<output>
After completion, create `.planning/phases/03-security-infrastructure/03-05-SUMMARY.md`
</output>
