---
phase: 03-security-infrastructure
plan: 10
type: execute
wave: 4
depends_on: ["03-08", "03-09"]
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Duress/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Clearance/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/Features/*.cs
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "All B15 duress/anti-forensics strategies handle physical/digital coercion scenarios"
    - "All B16 clearance strategies enforce government/military clearance levels"
    - "MlAnomalyDetection sends message bus request to 'intelligence.analyze' topic and falls back to Z-score statistical anomaly detection"
    - "AiSecurityIntegration sends message bus request to 'intelligence.decide' topic and falls back to rule-based security decisions"
    - "All C advanced features (ML anomaly, threat intel, DLP, PAM, MFA orch, posture, incident, AI-security, SIEM) are implemented"
    - "D migration items complete: grep confirms zero references to old AccessControl plugin names"
    - "UltimateAccessControl plugin builds clean with ALL strategies (100+ count verified)"
    - "T95 B15, B16, C, D items in TODO.md are marked [x]"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Duress/"
      provides: "10 duress/anti-forensics strategies"
    - path: "Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Clearance/"
      provides: "10 clearance strategies"
    - path: "Plugins/DataWarehouse.Plugins.UltimateAccessControl/Features/"
      provides: "Advanced feature implementations"
  key_links:
    - from: "All strategies"
      to: "UltimateAccessControlPlugin"
      via: "Auto-discovery registration"
      pattern: "IAccessControlStrategy"
    - from: "MlAnomalyDetection"
      to: "Intelligence plugin (T90)"
      via: "Message bus request to 'intelligence.analyze' topic"
      pattern: "_messageBus\\.RequestAsync.*intelligence\\.analyze"
    - from: "MlAnomalyDetection"
      to: "Rule-based fallback"
      via: "Z-score statistical anomaly detection when AI unavailable"
      pattern: "if.*!.*Success|catch.*TimeoutException"
    - from: "AiSecurityIntegration"
      to: "Intelligence plugin (T90)"
      via: "Message bus request to 'intelligence.decide' topic"
      pattern: "_messageBus\\.RequestAsync.*intelligence\\.decide"
    - from: "AiSecurityIntegration"
      to: "Rule-based fallback"
      via: "Rule-based security decisions when AI unavailable"
      pattern: "if.*!.*Success|catch.*TimeoutException"
---

<objective>
Complete UltimateAccessControl plugin: implement duress/anti-forensics (T95.B15), clearance strategies (T95.B16), advanced features (T95.C), and migration (T95.D). Final build verification.

Purpose: This is the final plan for T95, completing the remaining strategy groups and ensuring the entire UltimateAccessControl plugin builds cleanly with 100+ strategies registered. C1 (MlAnomalyDetection) and C9 (AiSecurityIntegration) delegate ML to T90 via message bus with rule-based fallbacks.
Output: Complete T95 with all strategies, features, and migration items done.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-security-infrastructure/03-RESEARCH.md
@Metadata/CLAUDE.md
@.planning/phases/03-security-infrastructure/03-03-SUMMARY.md
@Plugins/DataWarehouse.Plugins.UltimateAccessControl/UltimateAccessControlPlugin.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement duress/anti-forensics and clearance strategies (T95.B15, B16)</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Duress/DuressNetworkAlertStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Duress/DuressPhysicalAlertStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Duress/DuressDeadDropStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Duress/DuressMultiChannelStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Duress/DuressKeyDestructionStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Duress/PlausibleDeniabilityStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Duress/AntiForensicsStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Duress/ColdBootProtectionStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Duress/EvilMaidProtectionStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Duress/SideChannelMitigationStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Clearance/UsGovClearanceStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Clearance/NatoClearanceStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Clearance/FiveEyesClearanceStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Clearance/CustomClearanceFrameworkStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Clearance/CompartmentalizationStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Clearance/ClearanceValidationStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Clearance/ClearanceExpirationStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Clearance/ClearanceBadgingStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Clearance/EscortRequirementStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Clearance/CrossDomainTransferStrategy.cs
  </files>
  <action>
CRITICAL WORKFLOW RULES:
- Rule 13: No simulations -- these are real security mechanisms
- For hardware-dependent features (TPM sealing, GPIO): use IsAvailableAsync pattern
- Message bus for inter-plugin communication

1. Create Strategies/Duress/ and Strategies/Clearance/ directories.

2. Implement B15 Duress/Anti-Forensics strategies:

   **B15.1 DuressNetworkAlertStrategy** - Multi-channel network alerts (MQTT, HTTP POST, SMTP, SNMP trap)
   **B15.2 DuressPhysicalAlertStrategy** - Physical alerts (GPIO, Modbus, OPC-UA) with IsAvailableAsync
   **B15.3 DuressDeadDropStrategy** - Steganographic evidence exfiltration to pre-configured dead drops
   **B15.4 DuressMultiChannelStrategy** - Parallel multi-channel alert orchestration
   **B15.5 DuressKeyDestructionStrategy** - Cryptographic key destruction on duress signal (message bus to T94)
   **B15.6 PlausibleDeniabilityStrategy** - Hidden volumes, decoy data, deniable encryption layers
   **B15.7 AntiForensicsStrategy** - Secure memory wiping (CryptProtectMemory), trace elimination
   **B15.8 ColdBootProtectionStrategy** - Memory encryption against cold boot attacks
   **B15.9 EvilMaidProtectionStrategy** - Boot integrity verification, TPM sealing
   **B15.10 SideChannelMitigationStrategy** - Constant-time operations, power analysis countermeasures

3. Implement B16 Clearance strategies:

   **B16.1 UsGovClearanceStrategy** - U.S. Government levels (Unclassified/Confidential/Secret/TopSecret/TS-SCI)
   **B16.2 NatoClearanceStrategy** - NATO levels (NATO Unclassified through Cosmic Top Secret)
   **B16.3 FiveEyesClearanceStrategy** - Five Eyes intelligence sharing levels
   **B16.4 CustomClearanceFrameworkStrategy** - User-defined hierarchical clearance levels
   **B16.5 CompartmentalizationStrategy** - Need-to-know compartments (SCI, SAP, codeword)
   **B16.6 ClearanceValidationStrategy** - Clearance verification against authoritative sources
   **B16.7 ClearanceExpirationStrategy** - Time-limited access with auto-revocation
   **B16.8 ClearanceBadgingStrategy** - Physical badge/RFID verification
   **B16.9 EscortRequirementStrategy** - Escort-based access for uncleared personnel
   **B16.10 CrossDomainTransferStrategy** - Secure data transfer between classification levels

4. Build project.
  </action>
  <verify>
`dotnet build` succeeds. 20 strategy files in Duress/ and Clearance/.
No forbidden patterns.
  </verify>
  <done>
10 duress + 10 clearance strategies implemented and compiling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement advanced features with AI wiring, migration, and final sync (T95.C, D)</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Features/MlAnomalyDetection.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Features/ThreatIntelligenceEngine.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Features/BehavioralAnalysis.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Features/DlpEngine.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Features/PrivilegedAccessManager.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Features/MfaOrchestrator.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Features/SecurityPostureAssessment.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Features/AutomatedIncidentResponse.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Features/AiSecurityIntegration.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Features/SiemConnector.cs
    Metadata/TODO.md
  </files>
  <action>
1. Create Features/ directory if not exists.

2. Implement T95.C Advanced Features -- standard features (no AI dependency):

   **C2 ThreatIntelligenceEngine** - Real-time threat feed aggregation and correlation
   **C3 BehavioralAnalysis** - User profiling with baseline comparison, deviation scoring
   **C4 DlpEngine** - Content inspection, regex patterns, keyword matching, data classification
   **C5 PrivilegedAccessManager** - PAM: session recording, JIT access, privilege escalation controls
   **C6 MfaOrchestrator** - Orchestrates MFA strategies: adaptive MFA based on risk score
   **C7 SecurityPostureAssessment** - Continuous security posture scoring, gap identification
   **C8 AutomatedIncidentResponse** - Playbook-based auto-response, containment, notification
   **C10 SiemConnector** - SIEM event forwarding (Splunk, Sentinel, ELK) via Syslog/REST

3. Implement AI-DEPENDENT C features WITH EXPLICIT WIRING:

   **C1 MlAnomalyDetection** - ML-based anomaly detection:
   MUST implement the following message bus wiring pattern:
   ```
   var aiResponse = await _messageBus.RequestAsync<AnomalyResult>(
       topic: "intelligence.analyze",
       request: new AnalysisRequest
       {
           DataType = "access-pattern",
           Payload = accessData,
           AnalysisType = "anomaly-detection"
       },
       timeout: TimeSpan.FromSeconds(10),
       ct: cancellationToken
   );

   if (!aiResponse.Success)
   {
       _logger.LogWarning("Intelligence plugin unavailable for ML anomaly detection, using rule-based fallback");
       return await StatisticalAnomalyDetectionAsync(accessData, ct);
   }
   ```
   - Rule-based fallback: Z-score statistical anomaly detection on access patterns

   **C9 AiSecurityIntegration** - AI-powered security decisions:
   MUST implement the following message bus wiring pattern:
   ```
   var aiResponse = await _messageBus.RequestAsync<SecurityDecision>(
       topic: "intelligence.decide",
       request: new DecisionRequest
       {
           DataType = "security-context",
           Context = securityContext,
           DecisionType = "access-risk"
       },
       timeout: TimeSpan.FromSeconds(10),
       ct: cancellationToken
   );

   if (!aiResponse.Success)
   {
       _logger.LogWarning("Intelligence plugin unavailable for AI security decision, using rule-based fallback");
       return await RuleBasedSecurityDecisionAsync(securityContext, ct);
   }
   ```
   - Rule-based fallback: configurable rule engine for security decisions

4. Implement T95.D Migration (D1-D5):

   **D1** - Scan for old AccessControl/IAM/Security plugin references using concrete grep commands:
   Run: `grep -r "DataWarehouse.Plugins.AccessControl[^U]" --include="*.cs" --include="*.csproj" Plugins/ SDK/`
   Run: `grep -r "DataWarehouse.Plugins.IAM[^.]" --include="*.cs" --include="*.csproj" Plugins/ SDK/`
   Run: `grep -r "DataWarehouse.Plugins.Security[^P]" --include="*.cs" --include="*.csproj" Plugins/ SDK/`
   For each match found: update the reference to use UltimateAccessControl or remove if obsolete.

   **D2** - Create migration guide as XML doc comments in UltimateAccessControlPlugin.cs (not standalone doc)
   **D3** - Add [Obsolete("Use UltimateAccessControl. See migration guide.")] attributes to any deprecated security plugins found by D1 grep
   **D4** - Mark for removal (defer actual deletion to Phase 18 per ROADMAP convention)
   **D5** - Update documentation via XML doc comments

5. Final build and full strategy count:
   - `dotnet build` the entire project
   - Count total IAccessControlStrategy implementations: `grep -r "IAccessControlStrategy" --include="*.cs" Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ | wc -l`
   - Verify auto-discovery registers all strategies

6. Update Metadata/TODO.md:
   - Mark T95.B15.1-B15.10 as [x]
   - Mark T95.B16.1-B16.10 as [x]
   - Mark T95.C1-C10 as [x]
   - Mark T95.D1-D5 as [x]
   - Update the Task 95 summary to show all phases complete

7. Verify T95 section has ZERO remaining [ ] items.
  </action>
  <verify>
`dotnet build` succeeds for full project.
Total strategy count exceeds 100.
Grep for "intelligence.analyze" in MlAnomalyDetection.cs -- MUST find a match.
Grep for "intelligence.decide" in AiSecurityIntegration.cs -- MUST find a match.
Grep for old AccessControl plugin references (D1 patterns) returns zero results (all migrated).
TODO.md T95 section has zero remaining [ ] items.
  </verify>
  <done>
T95 is fully complete: 100+ strategies, 10 advanced features with AI wiring, migration done.
All T95 items marked [x] in TODO.md. Phase 3 is complete.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build` succeeds for UltimateAccessControl project (with ALL strategies)
2. 20 strategy files in Duress/ + Clearance/
3. 10 feature files in Features/
4. AI-dependent features (C1, C9) have message bus calls with rule-based fallbacks
5. D1-D5 migration tasks completed (grep confirms zero old plugin references)
6. Total strategy count > 100
7. TODO.md T95 section: ZERO [ ] items remaining
8. Full solution `dotnet build` succeeds
</verification>

<success_criteria>
- All T95 sub-tasks complete (B1-B16, C1-C10, D1-D5)
- UltimateAccessControl plugin builds with 100+ strategies auto-discovered
- AI-dependent features use message bus with graceful degradation
- Migration verified via grep (zero old plugin references)
- TODO.md T95 fully synced to [x]
- Phase 3 security infrastructure is complete
</success_criteria>

<output>
After completion, create `.planning/phases/03-security-infrastructure/03-10-SUMMARY.md`
</output>
