---
phase: 03-security-infrastructure
plan: 06
type: execute
wave: 2
depends_on: ["03-03"]
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/*.cs
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "All 6 Zero Trust strategies enforce continuous verification with per-request auth"
    - "All 6 policy engine strategies integrate with external policy engines via configurable endpoints"
    - "All 12 strategy classes compile with zero forbidden patterns"
    - "T95 B5 and B6 items in TODO.md are marked [x]"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/"
      provides: "6 Zero Trust strategy implementations"
    - path: "Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/"
      provides: "6 policy engine integrations"
  key_links:
    - from: "ZeroTrust strategies"
      to: "UltimateAccessControlPlugin orchestrator"
      via: "IAccessControlStrategy auto-discovery"
      pattern: "IAccessControlStrategy"
    - from: "PolicyEngine strategies"
      to: "External policy engines (OPA, Casbin, Cedar, Zanzibar, Permify, Cerbos)"
      via: "HTTP/gRPC client calls to configured endpoints"
      pattern: "HttpClient|_policyEndpoint"
---

<objective>
Implement Zero Trust strategies (T95.B5) and policy engine integrations (T95.B6) for UltimateAccessControl.

Purpose: Zero Trust provides continuous verification (never trust, always verify). Policy engines integrate with external authorization frameworks (OPA, Casbin, Cedar, Zanzibar, Permify, Cerbos).
Output: 12 strategy implementations covering Zero Trust and policy engines.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-security-infrastructure/03-RESEARCH.md
@Metadata/CLAUDE.md
@.planning/phases/03-security-infrastructure/03-03-SUMMARY.md
@Plugins/DataWarehouse.Plugins.UltimateAccessControl/IAccessControlStrategy.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement 6 Zero Trust strategies (T95.B5)</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/ZeroTrustCoreStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/SpiffeSpireStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/MtlsStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/ServiceMeshStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/MicroSegmentationStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/ZeroTrust/ContinuousVerificationStrategy.cs
  </files>
  <action>
CRITICAL WORKFLOW RULES:
- Rule 13: No simulations, mocks, stubs, placeholders
- Verify before implementing: ZeroTrustStrategy.cs already exists in Core/ -- check if it covers B5.1
- Plugin isolation: SDK-only references
- Base classes mandatory

1. Check existing: ZeroTrustStrategy.cs is in Strategies/Core/. Read it. If it covers B5.1, don't duplicate -- reference it in the summary as covering B5.1.

2. Create Strategies/ZeroTrust/ directory.

3. Implement B5 Zero Trust strategies:

   **B5.1 ZeroTrustCoreStrategy** - Core framework (may already exist as ZeroTrustStrategy.cs):
   - Never trust, always verify
   - Per-request authentication + authorization
   - Least privilege access
   - Device posture assessment

   **B5.2 SpiffeSpireStrategy** - SPIFFE/SPIRE workload identity:
   - SPIFFE ID validation (spiffe://trust-domain/path)
   - X.509 SVID verification
   - JWT SVID validation
   - Workload registration API

   **B5.3 MtlsStrategy** - Mutual TLS:
   - Client certificate validation
   - Certificate pinning
   - OCSP/CRL checking
   - Certificate rotation handling

   **B5.4 ServiceMeshStrategy** - Service mesh (Istio/Linkerd):
   - Sidecar proxy integration
   - Service-to-service authorization policies
   - Traffic policy enforcement

   **B5.5 MicroSegmentationStrategy** - Network micro-segmentation:
   - Zone-based network policies
   - Application-layer segmentation
   - Dynamic policy updates based on threat level

   **B5.6 ContinuousVerificationStrategy** - Continuous auth:
   - Session re-evaluation on risk change
   - Behavioral anomaly triggers re-auth
   - Step-up authentication on sensitive operations

4. Build project.
  </action>
  <verify>
`dotnet build` succeeds. 6 Zero Trust strategy files exist.
No forbidden patterns.
  </verify>
  <done>
6 Zero Trust strategies implemented and compiling.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement 6 policy engine strategies (T95.B6) and sync TODO.md</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/OpaStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/CasbinStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/CedarStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/ZanzibarStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/PermifyStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/PolicyEngine/CerbosStrategy.cs
    Metadata/TODO.md
  </files>
  <action>
1. Create Strategies/PolicyEngine/ directory.

2. Implement B6 Policy Engine strategies:

   **B6.1 OpaStrategy** - Open Policy Agent:
   - Rego policy evaluation via REST API (POST to /v1/data/{path})
   - Policy bundle management
   - Decision logging

   **B6.2 CasbinStrategy** - Casbin:
   - Model/policy file management
   - RBAC/ABAC/PBAC model support
   - Adapter pattern for policy storage

   **B6.3 CedarStrategy** - AWS Cedar:
   - Cedar policy language parsing
   - Entity/action/resource evaluation
   - Policy set management

   **B6.4 ZanzibarStrategy** - Google Zanzibar-style:
   - Relationship tuple management (user:relation:object)
   - Transitive relationship resolution
   - Check/Expand/Read APIs

   **B6.5 PermifyStrategy** - Permify:
   - Schema-based authorization
   - Permission checking via Permify API
   - Data filtering

   **B6.6 CerbosStrategy** - Cerbos:
   - Policy definition (resource policies, derived roles)
   - gRPC/REST policy evaluation
   - Audit trail

3. Build project.

4. Update Metadata/TODO.md:
   - Mark T95.B5.1 through B5.6 as [x]
   - Mark T95.B6.1 through B6.6 as [x]
  </action>
  <verify>
`dotnet build` succeeds. 6 policy engine strategy files exist in PolicyEngine/.
TODO.md T95.B5, B6 items all marked [x].
  </verify>
  <done>
6 policy engine strategies implemented. T95 B5 (6) + B6 (6) = 12 items marked [x] in TODO.md.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build` succeeds for UltimateAccessControl project
2. 6 Zero Trust strategy files in Strategies/ZeroTrust/
3. 6 policy engine strategy files in Strategies/PolicyEngine/
4. No forbidden patterns in any file
5. TODO.md B5+B6 items all [x]
</verification>

<success_criteria>
- All 12 strategies implemented and building
- Plugin builds cleanly
- TODO.md T95 B5+B6 fully synced
</success_criteria>

<output>
After completion, create `.planning/phases/03-security-infrastructure/03-06-SUMMARY.md`
</output>
