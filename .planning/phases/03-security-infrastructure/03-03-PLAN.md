---
phase: 03-security-infrastructure
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/UltimateAccessControlPlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/IAccessControlStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Core/*.cs
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "UltimateAccessControlPlugin orchestrator discovers and registers all access control strategies"
    - "Unified security policy engine evaluates access decisions using combined strategies"
    - "All 9 access control strategies (RBAC, ABAC, MAC, DAC, PBAC, ReBac, HrBAC, ACL, Capability) are implemented"
    - "T95 B1 and B2 items in TODO.md are marked [x]"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateAccessControl/UltimateAccessControlPlugin.cs"
      provides: "Access control orchestrator with auto-discovery"
      contains: "DiscoverAndRegisterStrategiesAsync"
    - path: "Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Core/"
      provides: "All 9 access control model strategies"
  key_links:
    - from: "UltimateAccessControlPlugin.cs"
      to: "IAccessControlStrategy implementations"
      via: "Reflection-based strategy auto-discovery"
      pattern: "typeof\\(IAccessControlStrategy\\)"
    - from: "UltimateAccessControlPlugin.cs"
      to: "IMessageBus"
      via: "Message bus for inter-plugin communication"
      pattern: "_messageBus"
---

<objective>
Verify and complete UltimateAccessControl plugin orchestrator (T95.B1) and all 9 access control model strategies (T95.B2).

Purpose: T95 is the largest workload in Phase 3. The plugin project exists with 24 strategy files, but TODO.md shows B1-B2 as incomplete. This plan verifies existing orchestrator/strategies and implements any missing access control models (MAC, DAC, ReBac, HrBAC, ACL, Capability).
Output: Working orchestrator with all 9 core access control strategies.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/03-security-infrastructure/03-RESEARCH.md
@Metadata/CLAUDE.md
@Plugins/DataWarehouse.Plugins.UltimateAccessControl/UltimateAccessControlPlugin.cs
@Plugins/DataWarehouse.Plugins.UltimateAccessControl/IAccessControlStrategy.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify and complete orchestrator and security policy engine (T95.B1)</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/UltimateAccessControlPlugin.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/IAccessControlStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/DataWarehouse.Plugins.UltimateAccessControl.csproj
  </files>
  <action>
CRITICAL WORKFLOW RULES:
- Rule 13: No simulations, mocks, stubs, placeholders -- everything production-ready
- Plugin isolation: plugins reference ONLY SDK via ProjectReference
- All communication via message bus (no direct plugin references)
- Base classes mandatory: never implement interfaces directly, always use *StrategyBase
- Verify before implementing: check what exists first

1. Read UltimateAccessControlPlugin.cs -- check if orchestrator already exists with:
   - Strategy auto-discovery (reflection scanning for IAccessControlStrategy)
   - Strategy registration in a dictionary/registry
   - Message bus integration for receiving access check requests
   - StartAsync/StopAsync lifecycle

2. Read IAccessControlStrategy.cs -- verify the interface includes:
   - StrategyId property
   - EvaluateAccessAsync method
   - Capabilities/metadata

3. If orchestrator exists but is incomplete: enhance it to match the pattern from UltimateEncryption/UltimateKeyManagement (auto-discovery, FIPS checking, hardware detection where applicable).

4. If orchestrator is missing or minimal: Implement it following the exact pattern from UltimateEncryptionPlugin.cs:
   - Extend SecurityProviderPluginBase (or appropriate base from SDK)
   - Auto-discover IAccessControlStrategy implementations
   - Register on message bus topics: "accesscontrol.evaluate", "accesscontrol.list-strategies"
   - Implement unified security policy engine that can combine multiple strategy decisions (AND/OR/FIRST-MATCH logic)

5. Implement unified security policy engine (T95.B1.3):
   - PolicyEvaluationMode enum: AllMustAllow, AnyMustAllow, FirstMatch, Weighted
   - EvaluateAsync that runs applicable strategies based on security context
   - Audit logging for all access decisions

6. Verify .csproj only references SDK. Fix if needed.

7. Build: `dotnet build` on the project.
  </action>
  <verify>
Run: `dotnet build Plugins/DataWarehouse.Plugins.UltimateAccessControl/DataWarehouse.Plugins.UltimateAccessControl.csproj`
Build succeeds. Orchestrator has auto-discovery. Policy engine exists with evaluation modes.
  </verify>
  <done>
T95.B1.1 (project), B1.2 (orchestrator), B1.3 (policy engine) all verified/implemented and building.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify and complete all 9 access control strategies (T95.B2)</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Core/RbacStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Core/AbacStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Core/MacStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Core/DacStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Core/PbacStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Core/ReBacStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Core/HrBacStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Core/AclStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Core/CapabilityStrategy.cs
    Metadata/TODO.md
  </files>
  <action>
CRITICAL: Verify before implementing. Existing files in Strategies/Core/ include: RbacStrategy.cs, AbacStrategy.cs, PolicyBasedAccessControlStrategy.cs, ZeroTrustStrategy.cs, plus others. Some B2 strategies may already exist under different names.

1. Check existing Strategies/Core/ files. Map each file to a T95.B2 task:
   - RbacStrategy.cs -> B2.1 (likely exists)
   - AbacStrategy.cs -> B2.2 (likely exists)
   - PolicyBasedAccessControlStrategy.cs -> B2.5 PbacStrategy (may be this)
   - ZeroTrustStrategy.cs -> actually B5.1, not B2

2. For each EXISTING strategy, verify it is production-ready:
   - Implements IAccessControlStrategy (or appropriate base)
   - Has full EvaluateAccessAsync implementation (not stub)
   - Has proper error handling, XML documentation, no forbidden patterns
   - Uses appropriate access control model logic (not just returning true/false)

3. For each MISSING strategy from B2 list, implement it:

   **B2.3 MacStrategy (Mandatory Access Control):**
   - Bell-LaPadula model: "no read up, no write down"
   - Security clearance levels: Unclassified, Confidential, Secret, TopSecret
   - Subject clearance vs object classification comparison

   **B2.4 DacStrategy (Discretionary Access Control):**
   - Owner-based permissions (owner grants access to others)
   - Permission matrix: Read, Write, Execute, Delete per user/group
   - Ownership transfer capability

   **B2.6 ReBacStrategy (Relationship-Based Access Control):**
   - Graph-based relationship evaluation (user -> relation -> object)
   - Support for: owner, editor, viewer, member, parent relationships
   - Transitive relationship resolution

   **B2.7 HrBacStrategy (Hierarchical RBAC):**
   - Role inheritance (child roles inherit parent permissions)
   - Role hierarchy traversal
   - Separation of duties (SoD) constraints

   **B2.8 AclStrategy (Access Control Lists):**
   - Per-resource ACL entries (allow/deny per principal)
   - ACL inheritance from parent resources
   - Deny-takes-precedence evaluation

   **B2.9 CapabilityStrategy (Capability-Based Security):**
   - Token-based capabilities (unforgeable tokens grant access)
   - Capability creation, delegation, revocation
   - Fine-grained object capabilities

4. Build and verify all compile.

5. Update Metadata/TODO.md: mark T95.B1.1, B1.2, B1.3, B2.1-B2.9 as [x].
  </action>
  <verify>
Run: `dotnet build` on UltimateAccessControl project -- succeeds.
All 9 access control strategies exist in Strategies/Core/ with production-ready implementations.
TODO.md T95 B1 and B2 items all marked [x].
  </verify>
  <done>
All 9 access control model strategies implemented and verified. Orchestrator with policy engine working.
T95 B1 (3 items) and B2 (9 items) = 12 items marked [x] in TODO.md.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build` succeeds for UltimateAccessControl project
2. Orchestrator auto-discovers all strategies
3. Policy engine supports multiple evaluation modes
4. All 9 access control strategies have real implementations (no stubs)
5. TODO.md B1+B2 items all [x]
</verification>

<success_criteria>
- UltimateAccessControl plugin builds cleanly with orchestrator + policy engine
- 9 access control strategies (RBAC, ABAC, MAC, DAC, PBAC, ReBac, HrBAC, ACL, Capability) all production-ready
- TODO.md T95 B1+B2 fully synced
</success_criteria>

<output>
After completion, create `.planning/phases/03-security-infrastructure/03-03-SUMMARY.md`
</output>
