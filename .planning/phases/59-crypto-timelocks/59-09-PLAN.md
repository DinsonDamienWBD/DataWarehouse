---
phase: 59-crypto-timelocks
plan: 09
type: execute
wave: 4
depends_on: ["59-02", "59-04", "59-05", "59-06", "59-07", "59-08"]
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateEncryption/UltimateEncryptionPlugin.cs
  - Plugins/DataWarehouse.Plugins.TamperProof/TamperProofPlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateEncryption/Registration/PqcStrategyRegistration.cs
  - Plugins/DataWarehouse.Plugins.TamperProof/Registration/TimeLockRegistration.cs
autonomous: true

must_haves:
  truths:
    - "All new PQC strategies are registered in UltimateEncryption plugin initialization"
    - "All time-lock providers are registered in TamperProof plugin initialization"
    - "Crypto-agility engine is registered and starts background migration monitoring"
    - "Strategy discovery via message bus returns PQC algorithms when queried"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateEncryption/Registration/PqcStrategyRegistration.cs"
      provides: "Registers all CRYSTALS-Kyber, Dilithium, SPHINCS+, and hybrid strategies"
      min_lines: 80
    - path: "Plugins/DataWarehouse.Plugins.TamperProof/Registration/TimeLockRegistration.cs"
      provides: "Registers all time-lock providers and vaccination service"
      min_lines: 60
  key_links:
    - from: "PqcStrategyRegistration"
      to: "UltimateEncryptionPlugin"
      via: "called during plugin initialization"
      pattern: "PqcStrategyRegistration"
    - from: "TimeLockRegistration"
      to: "TamperProofPlugin"
      via: "called during plugin initialization"
      pattern: "TimeLockRegistration"
    - from: "PqcStrategyRegistration"
      to: "encryption.strategy.register"
      via: "publishes strategy availability to bus"
      pattern: "encryption\\.strategy\\.register"
---

<objective>
Wire all new PQC strategies and time-lock providers into their host plugins.

Purpose: Connect the new strategies and providers to the plugin lifecycle so they are discoverable, registered, and available at runtime. Without this wiring step, the implementations from Plans 02-08 exist as code but are not accessible through the plugin system. This plan ensures all new capabilities appear in capability registries, knowledge banks, and message bus discovery.

Output: Registration classes and updated plugin files that initialize all Phase 59 components.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/PLUGIN-CATALOG.md
@.planning/phases/59-crypto-timelocks/59-02-SUMMARY.md
@.planning/phases/59-crypto-timelocks/59-04-SUMMARY.md
@.planning/phases/59-crypto-timelocks/59-05-SUMMARY.md
@.planning/phases/59-crypto-timelocks/59-06-SUMMARY.md
@.planning/phases/59-crypto-timelocks/59-07-SUMMARY.md
@.planning/phases/59-crypto-timelocks/59-08-SUMMARY.md
@Plugins/DataWarehouse.Plugins.UltimateEncryption/UltimateEncryptionPlugin.cs
@Plugins/DataWarehouse.Plugins.TamperProof/TamperProofPlugin.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create PQC strategy registration and update UltimateEncryption plugin</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateEncryption/Registration/PqcStrategyRegistration.cs
    Plugins/DataWarehouse.Plugins.UltimateEncryption/UltimateEncryptionPlugin.cs
  </files>
  <action>
PqcStrategyRegistration.cs in namespace DataWarehouse.Plugins.UltimateEncryption.Registration:

Static class `PqcStrategyRegistration`:

- `RegisterAllPqcStrategies(IStrategyRegistry registry)` method that registers:
  - KyberKem512Strategy, KyberKem768Strategy, KyberKem1024Strategy (CRYSTALS-Kyber KEM)
  - DilithiumSignature44Strategy, DilithiumSignature65Strategy, DilithiumSignature87Strategy (CRYSTALS-Dilithium)
  - SphincsPlus128fStrategy, SphincsPlus192fStrategy, SphincsPlus256fStrategy (SPHINCS+)
  - X25519Kyber768Strategy (Hybrid)
  Total: 10 new strategies

- `PublishPqcCapabilities(IMessageBus bus)` method that publishes each strategy to bus topic "encryption.strategy.register" with payload containing StrategyId, AlgorithmName, SecurityLevel, FipsReference, NistLevel

- `GetPqcStrategies()` returns IReadOnlyList of all PQC strategy instances for bulk registration

Update UltimateEncryptionPlugin.cs:
- In the existing initialization method (InitializeAsync or similar), add a call to `PqcStrategyRegistration.RegisterAllPqcStrategies(registry)` AFTER existing strategy registration
- Add call to `PqcStrategyRegistration.PublishPqcCapabilities(MessageBus)` during bus setup
- Register CryptoAgilityEngine as a feature component: `new CryptoAgilityEngine()` instantiated and registered

Read UltimateEncryptionPlugin.cs first to understand the existing registration pattern. Follow it exactly. Do NOT restructure existing code -- only ADD registration calls.
  </action>
  <verify>`dotnet build Plugins/DataWarehouse.Plugins.UltimateEncryption/DataWarehouse.Plugins.UltimateEncryption.csproj --no-restore` -- 0 errors</verify>
  <done>10 PQC strategies registered in UltimateEncryption plugin. CryptoAgilityEngine registered as feature component. Bus publishes strategy capabilities.</done>
</task>

<task type="auto">
  <name>Task 2: Create TimeLock registration and update TamperProof plugin</name>
  <files>
    Plugins/DataWarehouse.Plugins.TamperProof/Registration/TimeLockRegistration.cs
    Plugins/DataWarehouse.Plugins.TamperProof/TamperProofPlugin.cs
  </files>
  <action>
TimeLockRegistration.cs in namespace DataWarehouse.Plugins.TamperProof.Registration:

Static class `TimeLockRegistration`:

- `RegisterTimeLockProviders(IMessageBus bus)` method that:
  1. Instantiates SoftwareTimeLockProvider, HsmTimeLockProvider, CloudTimeLockProvider
  2. Publishes each to bus topic "timelock.provider.register" with Id, Name, TimeLockMode, capabilities
  3. Returns list of providers

- `RegisterVaccinationService(IMessageBus bus)` method that:
  1. Instantiates RansomwareVaccinationService
  2. Publishes to bus topic "timelock.vaccination.available"
  3. Returns service instance

- `RegisterPolicyEngine()` method that:
  1. Instantiates TimeLockPolicyEngine with default rules
  2. Returns engine instance

- `PublishTimeLockCapabilities(IMessageBus bus)` method that publishes capability registration for time-lock subsystem

Update TamperProofPlugin.cs:
- Read TamperProofPlugin.cs first to understand existing initialization pattern
- In initialization, add calls to TimeLockRegistration methods AFTER existing WORM/integrity registration
- Register time-lock providers, vaccination service, and policy engine
- Add time-lock bus topic subscriptions if the plugin subscribes to topics

Follow existing patterns exactly. Only ADD, do not restructure.
  </action>
  <verify>`dotnet build Plugins/DataWarehouse.Plugins.TamperProof/DataWarehouse.Plugins.TamperProof.csproj --no-restore` -- 0 errors</verify>
  <done>3 time-lock providers and vaccination service registered in TamperProof plugin. Policy engine initialized with default compliance rules. Bus topics published.</done>
</task>

</tasks>

<verification>
- `dotnet build DataWarehouse.slnx` -- 0 errors across entire solution
- UltimateEncryptionPlugin registers 10 new PQC strategies + CryptoAgilityEngine
- TamperProofPlugin registers 3 time-lock providers + vaccination service + policy engine
- Bus topics: encryption.strategy.register, timelock.provider.register, timelock.vaccination.available
</verification>

<success_criteria>
Full solution builds. All Phase 59 components wired into plugin lifecycle. Strategy discovery returns PQC algorithms. Time-lock providers discoverable via bus.
</success_criteria>

<output>
After completion, create `.planning/phases/59-crypto-timelocks/59-09-SUMMARY.md`
</output>
