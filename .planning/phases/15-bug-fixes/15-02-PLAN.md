---
phase: 15-bug-fixes
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - DataWarehouse.SDK/Contracts/ITamperProofProvider.cs
  - Plugins/DataWarehouse.Plugins.UltimateFilesystem/**/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateEncryption/**/*.cs
  - Plugins/DataWarehouse.Plugins.AedsCore/**/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateResourceManager/**/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataLineage/**/*.cs
  - Plugins/DataWarehouse.Plugins.SigNoz/**/*.cs
  - DataWarehouse.GUI/**/*.cs
  - DataWarehouse.SDK/**/*.cs
autonomous: true

must_haves:
  truths:
    - "CA2021 invalid cast bug in ITamperProofProvider.cs is fixed (no runtime InvalidCastException)"
    - "CA2022 inexact Stream.Read warnings are eliminated using ReadExactly/ReadExactlyAsync"
    - "CS0420 volatile field reference warnings are resolved"
    - "CS8425 missing EnumeratorCancellation warnings are resolved"
    - "SYSLIB0060 Rfc2898DeriveBytes constructor calls replaced with static Pbkdf2 method"
    - "SYSLIB0057 X509Certificate2 constructor calls replaced with X509CertificateLoader"
    - "SYSLIB0058 obsolete SslStream property accesses replaced with NegotiatedCipherSuite"
    - "CS0114/CS0108 member hiding warnings resolved with override or new keyword"
    - "Unused code warnings (CS0649, CS0219, CS0414, CS0169, CS0162, CS0067, CS0168) are resolved"
    - "CS1591 missing XML doc warnings are suppressed per-project for projects with 100+ instances"
    - "Build warning count reduced from 1,154 to under 50"
  artifacts:
    - path: "DataWarehouse.SDK/Contracts/ITamperProofProvider.cs"
      provides: "Fixed CA2021 invalid cast"
    - path: "Plugins/DataWarehouse.Plugins.UltimateEncryption/"
      provides: "Migrated SYSLIB0060/0057/0058 obsolete APIs"
  key_links:
    - from: "ITamperProofProvider.cs"
      to: "AccessLogEntry type"
      via: "Correct cast or type usage"
      pattern: "AccessLogEntry|AccessLog"
    - from: "Stream.Read callers"
      to: "ReadExactly"
      via: "Migration to exact read API"
      pattern: "ReadExactly"
---

<objective>
Fix all build warnings across the solution -- from runtime bugs to obsolete APIs to dead code to missing XML docs.

Purpose: The solution has 1,154 build warnings across 18 categories. This includes 2 real runtime bugs (CA2021 invalid cast), 96 data corruption risks (CA2022 inexact reads), 200+ obsolete API calls that will break in future .NET versions, and hundreds of dead code/missing doc warnings. Fixing these ensures build health and prevents runtime failures.

Output: Solution build with dramatically reduced warnings (target: under 50 remaining, mostly CA1416 platform-specific which are intentional).
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/15-bug-fixes/15-RESEARCH.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Fix Tier 1 real bugs and Tier 2 obsolete API migrations</name>
  <files>
    DataWarehouse.SDK/Contracts/ITamperProofProvider.cs
    Plugins/DataWarehouse.Plugins.AedsCore/Extensions/DeltaSyncPlugin.cs
    Plugins/DataWarehouse.Plugins.UltimateEncryption/**/*.cs
    Plugins/DataWarehouse.Plugins.AedsCore/Extensions/CodeSigningPlugin.cs
    Plugins/DataWarehouse.Plugins.UltimateFilesystem/**/*.cs
    DataWarehouse.GUI/**/*.cs
  </files>
  <action>
    Fix warnings in priority order. Build after each tier to confirm fixes work.

    **Tier 1: Real Bugs (fix first, ~104 warnings)**

    1. **CA2021 (2 instances) -- Invalid cast, HIGHEST PRIORITY:**
       - File: `DataWarehouse.SDK/Contracts/ITamperProofProvider.cs` around line 574
       - Fix: Find the cast from `AccessLogEntry` to `AccessLog` (or similar) that will throw InvalidCastException at runtime
       - Replace with proper type conversion, pattern matching (`if (entry is AccessLog log)`), or fix the type hierarchy

    2. **CA2022 (96 instances) -- Inexact Stream.Read:**
       - Replace all `stream.Read(buffer, 0, buffer.Length)` with `stream.ReadExactly(buffer, 0, buffer.Length)`
       - Replace all `await stream.ReadAsync(buffer, 0, buffer.Length, ct)` with `await stream.ReadExactlyAsync(buffer, 0, buffer.Length, ct)`
       - For cases where partial reads are intentional (e.g., reading until EOF), use a read loop with the return value checked
       - Primary affected projects: UltimateFilesystem, AedsCore, others

    3. **CS0420 (4 instances) -- Volatile field reference:**
       - Find volatile fields passed by reference (e.g., to `Interlocked.CompareExchange`)
       - Fix by: (a) removing `volatile` if Interlocked is used (they are mutually exclusive), or (b) using a local copy
       - Add `#pragma warning disable CS0420` with comment if Interlocked+volatile is intentional

    4. **CS8425 (2 instances) -- Missing EnumeratorCancellation:**
       - Find async iterator methods (returning `IAsyncEnumerable<T>`) missing `[EnumeratorCancellation]` attribute
       - Add `[System.Runtime.CompilerServices.EnumeratorCancellation]` to the `CancellationToken` parameter

    **Tier 2: Obsolete API Migrations (~200 warnings)**

    5. **SYSLIB0060 (48 instances) -- Rfc2898DeriveBytes constructor:**
       - Replace `new Rfc2898DeriveBytes(password, salt, iterations, hashAlg)` + `.GetBytes(n)`
       - With: `Rfc2898DeriveBytes.Pbkdf2(password, salt, iterations, hashAlg, n)`
       - Primary project: UltimateEncryption

    6. **SYSLIB0057 (26 instances) -- X509Certificate2 constructor:**
       - Replace `new X509Certificate2(certBytes)` with `X509CertificateLoader.LoadCertificate(certBytes)`
       - Replace `new X509Certificate2(certBytes, password)` with `X509CertificateLoader.LoadPkcs12(certBytes, password)`
       - Primary projects: AedsCore, UltimateEncryption

    7. **SYSLIB0058 (26 instances) -- Obsolete SslStream properties:**
       - Replace `sslStream.CipherAlgorithm`, `.CipherStrength`, `.HashAlgorithm`, `.KeyExchangeAlgorithm`
       - With: `sslStream.NegotiatedCipherSuite` (returns TlsCipherSuite enum)
       - Extract individual details from the cipher suite name if needed

    8. **CS0618 (178 instances) -- General obsolete API usage:**
       - MAUI GUI: Replace `Application.MainPage = ...` with `Application.Current?.Windows.FirstOrDefault()?.Page = ...` or equivalent MAUI 9+ pattern
       - Other CS0618: Check each obsolete usage and apply the recommended replacement from the warning message
       - For SYSLIB0039 (TLS 1.0/1.1 in tests, 4 instances): Add `#pragma warning disable SYSLIB0039` with comment "Intentional: testing legacy TLS version handling"
       - For SYSLIB0027 (PublicKey.Key, 2 instances): Replace with `GetRSAPublicKey()` or equivalent
       - For CS0672 (obsolete override, 2 instances): Add `[Obsolete]` attribute to the overriding member

    Build and verify after completing Tier 1 and Tier 2.
  </action>
  <verify>
    Run `dotnet build DataWarehouse.slnx 2>&1 | grep -c "warning CA2021"` -- should be 0.
    Run `dotnet build DataWarehouse.slnx 2>&1 | grep -c "warning CA2022"` -- should be 0.
    Run `dotnet build DataWarehouse.slnx 2>&1 | grep -c "warning SYSLIB"` -- should be 4 or less (only SYSLIB0039 in tests if suppressed).
    Run `dotnet build DataWarehouse.slnx` -- zero errors.
  </verify>
  <done>
    CA2021 runtime bug fixed. CA2022 inexact reads fixed. CS0420/CS8425 resolved. All SYSLIB obsolete APIs migrated. CS0618 obsolete usages resolved. Build passes with zero errors and Tier 1+2 warning count reduced to near zero.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix Tier 3 code quality warnings and Tier 4 XML documentation</name>
  <files>
    DataWarehouse.SDK/**/*.cs
    Plugins/**/*.cs
    Plugins/DataWarehouse.Plugins.UltimateFilesystem/DataWarehouse.Plugins.UltimateFilesystem.csproj
    Plugins/DataWarehouse.Plugins.UltimateResourceManager/DataWarehouse.Plugins.UltimateResourceManager.csproj
    Plugins/DataWarehouse.Plugins.UltimateDataLineage/DataWarehouse.Plugins.UltimateDataLineage.csproj
    Plugins/DataWarehouse.Plugins.SigNoz/DataWarehouse.Plugins.SigNoz.csproj
    DataWarehouse.GUI/DataWarehouse.GUI.csproj
  </files>
  <action>
    **Tier 3: Code Quality (~376 warnings)**

    1. **CS0114 (80) + CS0108 (12) -- Member hiding:**
       - For each warning, check if the base member is `virtual` -- if yes, add `override` keyword
       - If the base member is NOT virtual and hiding is intentional, add `new` keyword
       - The research notes most CS0114 are about `GetStaticKnowledge()` in plugin base classes -- these should use `override`
       - Do NOT use `new` blindly -- check whether polymorphism is expected

    2. **CS0649 (74) -- Field never assigned:**
       - For fields with a type that has a default (int, bool, etc.): add explicit `= default;` if the default is intentional
       - For reference-type fields never assigned: determine if the field is dead code (remove it) or should be initialized
       - For fields that are serialization targets (JSON/XML deserialization): they may be set by the serializer -- suppress with `#pragma warning disable CS0649` and add comment

    3. **CS0219 (64) -- Unused variable assigned:**
       - Remove unused local variables, or prefix with `_` discard if the assignment has a side effect
       - If the variable holds a return value that should be checked, add appropriate usage

    4. **CS0414 (44) -- Field assigned but value never read:**
       - If field is truly unused: remove the field and its assignment
       - If field is for future use or serialization: suppress with pragma and comment

    5. **CS0169 (44) -- Field never used:**
       - Remove unused fields entirely
       - If the field is meant for memory layout/padding, suppress with pragma and comment

    6. **CS0162 (42) -- Unreachable code:**
       - Remove code after `return`, `throw`, `break`, `continue` statements
       - If the unreachable code is intentional (e.g., switch default after exhaustive cases), suppress with pragma

    7. **CS0067 (10) -- Unused events:**
       - If event is required by interface: keep but suppress with pragma and comment "Required by interface"
       - If event is dead code: remove

    8. **CS0168 (6) -- Unused catch variable:**
       - Replace `catch (Exception ex)` with `catch (Exception)` or `catch` if the exception variable is not used

    **Tier 4: XML Documentation (1,118 warnings)**

    CS1591 is concentrated in 6 projects with 100+ instances each. Adding individual XML docs to 1,118 public members is not feasible in one plan. Instead:

    9. **CS1591 -- Per-project suppression for high-count projects:**
       - Add `<NoWarn>$(NoWarn);CS1591</NoWarn>` to the `<PropertyGroup>` in these .csproj files ONLY:
         - `Plugins/DataWarehouse.Plugins.UltimateFilesystem/DataWarehouse.Plugins.UltimateFilesystem.csproj` (360 warnings)
         - `Plugins/DataWarehouse.Plugins.UltimateResourceManager/DataWarehouse.Plugins.UltimateResourceManager.csproj` (348 warnings)
         - `Plugins/DataWarehouse.Plugins.UltimateDataLineage/DataWarehouse.Plugins.UltimateDataLineage.csproj` (244 warnings)
         - `Plugins/DataWarehouse.Plugins.SigNoz/DataWarehouse.Plugins.SigNoz.csproj` (128 warnings)
         - Any other project with 20+ CS1591 warnings
       - Add a comment in each .csproj: `<!-- CS1591: XML doc warnings suppressed - internal plugin strategies have self-documenting names -->`
       - Do NOT add NoWarn to Directory.Build.props (keep it enforced globally so new public APIs get docs)

    10. **CS1573 (8) + CS1572 (2) -- XML param tag mismatches:**
        - Fix mismatched `<param>` tags in XML comments (wrong name, extra tag, missing tag)

    **CA1416 (110) + CA1418 (24) -- Platform compatibility:**
    - These are intentional for QUIC (platform-specific by design) and niche OS support
    - Add `#pragma warning disable CA1416` at the top of QuicDataPlanePlugin.cs with comment: "QUIC APIs are intentionally platform-specific; runtime checks exist at plugin level"
    - Add `#pragma warning disable CA1418` at the top of files using niche platform names with comment: "Intentional: supporting niche platform identifiers"

    Build after all fixes and count remaining warnings.
  </action>
  <verify>
    Run `dotnet build DataWarehouse.slnx 2>&1 | grep -c "Warning(s)"` -- total warning count should be under 50.
    Run `dotnet build DataWarehouse.slnx` -- zero errors.
    Verify no CS0114, CS0108, CS0649, CS0219, CS0162 warnings remain (or only justified suppressions).
  </verify>
  <done>
    All Tier 3 code quality warnings resolved (member hiding, unused code, unreachable code). CS1591 XML doc warnings suppressed per-project for high-volume plugin projects. CA1416/CA1418 platform warnings suppressed with comments in platform-specific code. Total warning count reduced from 1,154 to under 50. Build passes with zero errors.
  </done>
</task>

</tasks>

<verification>
- `dotnet build DataWarehouse.slnx` produces 0 errors
- Warning count reduced from 1,154 to under 50
- CA2021 runtime bug eliminated
- CA2022 data corruption risk eliminated
- All SYSLIB obsolete APIs migrated to current .NET 10 patterns
- No regressions in existing functionality
</verification>

<success_criteria>
- Zero build errors
- Build warnings reduced from 1,154 to under 50
- All Tier 1 (real bugs) and Tier 2 (obsolete APIs) warnings fully resolved
- Tier 3 (code quality) warnings resolved via proper fixes
- Tier 4 (XML docs) warnings managed via per-project suppression for bulk cases
- CA1416/CA1418 platform warnings suppressed with justification comments
</success_criteria>

<output>
After completion, create `.planning/phases/15-bug-fixes/15-02-SUMMARY.md`
</output>
