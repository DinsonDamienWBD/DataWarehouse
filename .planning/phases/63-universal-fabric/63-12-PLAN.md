---
phase: 63-universal-fabric
plan: 12
type: execute
wave: 4
depends_on: ["63-06", "63-07"]
files_modified:
  - Clients/go/dwclient/client.go
  - Clients/go/dwclient/s3compat.go
  - Clients/go/go.mod
  - Clients/go/go.sum
autonomous: true

must_haves:
  truths:
    - "Go client connects to DataWarehouse S3-compatible endpoint using aws-sdk-go-v2"
    - "Go client supports get, put, delete, list operations"
    - "Go module importable as github.com/datawarehouse/dw-client-go"
  artifacts:
    - path: "Clients/go/dwclient/client.go"
      provides: "Main DataWarehouse Go client"
      contains: "type Client struct"
    - path: "Clients/go/dwclient/s3compat.go"
      provides: "S3-compatible operations"
      contains: "type S3Client struct"
    - path: "Clients/go/go.mod"
      provides: "Go module definition"
      contains: "module"
  key_links:
    - from: "Clients/go/dwclient/s3compat.go"
      to: "Plugins/DataWarehouse.Plugins.UniversalFabric/S3Server/S3HttpServer.cs"
      via: "S3 HTTP protocol"
      pattern: "s3.Client"
---

<objective>
Create the Go cross-language client SDK for DataWarehouse.

Purpose: Go is widely used in infrastructure and cloud-native tooling. This client SDK allows Go applications to interact with DataWarehouse via the S3-compatible API.

Output: Go module with S3-compatible and native dw:// clients.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/phases/63-universal-fabric/63-06-SUMMARY.md
@DataWarehouse.SDK/Storage/Fabric/S3Types.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create Go module and S3-compatible client</name>
  <files>Clients/go/go.mod, Clients/go/dwclient/s3compat.go</files>
  <action>
1. Create Clients/go/ directory structure.

2. go.mod:
```
module github.com/datawarehouse/dw-client-go
go 1.21
require (
    github.com/aws/aws-sdk-go-v2 v1.24.0
    github.com/aws/aws-sdk-go-v2/config v1.26.0
    github.com/aws/aws-sdk-go-v2/credentials v1.16.0
    github.com/aws/aws-sdk-go-v2/service/s3 v1.47.0
)
```

Run `go mod tidy` to resolve exact versions and generate go.sum.

3. s3compat.go -- S3-compatible client:

```go
package dwclient

import (
    "context"
    "io"
    "github.com/aws/aws-sdk-go-v2/aws"
    "github.com/aws/aws-sdk-go-v2/credentials"
    "github.com/aws/aws-sdk-go-v2/service/s3"
    "github.com/aws/aws-sdk-go-v2/service/s3/types"
)

type S3Client struct {
    client *s3.Client
    region string
}

type S3Config struct {
    Endpoint  string
    AccessKey string
    SecretKey string
    Region    string
    UseSSL    bool
}

func NewS3Client(cfg S3Config) (*S3Client, error) {
    // Create S3 client with custom endpoint resolver for DataWarehouse
    // Use static credentials provider
    // Set path-style addressing (ForcePathStyle)
}

// Bucket operations
func (c *S3Client) ListBuckets(ctx context.Context) ([]types.Bucket, error)
func (c *S3Client) CreateBucket(ctx context.Context, name string) error
func (c *S3Client) DeleteBucket(ctx context.Context, name string) error
func (c *S3Client) BucketExists(ctx context.Context, name string) (bool, error)

// Object operations
func (c *S3Client) PutObject(ctx context.Context, bucket, key string, body io.Reader, opts ...PutOption) (*PutObjectOutput, error)
func (c *S3Client) GetObject(ctx context.Context, bucket, key string) (io.ReadCloser, *ObjectInfo, error)
func (c *S3Client) DeleteObject(ctx context.Context, bucket, key string) error
func (c *S3Client) HeadObject(ctx context.Context, bucket, key string) (*ObjectInfo, error)
func (c *S3Client) ListObjects(ctx context.Context, bucket string, opts ...ListOption) ([]ObjectInfo, error)
func (c *S3Client) ObjectExists(ctx context.Context, bucket, key string) (bool, error)

// Copy
func (c *S3Client) CopyObject(ctx context.Context, srcBucket, srcKey, dstBucket, dstKey string) error

// Presigned URLs
func (c *S3Client) PresignGetObject(ctx context.Context, bucket, key string, expiry time.Duration) (string, error)
func (c *S3Client) PresignPutObject(ctx context.Context, bucket, key string, expiry time.Duration) (string, error)

// Types
type ObjectInfo struct {
    Key          string
    Size         int64
    LastModified time.Time
    ETag         string
    ContentType  string
    Metadata     map[string]string
}

type PutOption func(*s3.PutObjectInput)
type ListOption func(*s3.ListObjectsV2Input)
```

All methods must be fully implemented using aws-sdk-go-v2 S3 client (not stubs). Include context.Context in all methods.
  </action>
  <verify>cd Clients/go && go build ./dwclient/ 2>&1 | tail -5</verify>
  <done>Go S3-compatible client compiles and wraps all S3 operations via aws-sdk-go-v2</done>
</task>

<task type="auto">
  <name>Task 2: Create native Go DataWarehouse client with dw:// addressing</name>
  <files>Clients/go/dwclient/client.go</files>
  <action>
```go
package dwclient

import (
    "context"
    "fmt"
    "io"
    "strings"
)

// Client is the high-level DataWarehouse client with dw:// addressing.
type Client struct {
    s3     *S3Client
    config ClientConfig
}

type ClientConfig struct {
    Endpoint  string
    AccessKey string
    SecretKey string
    Region    string
}

// New creates a new DataWarehouse client.
func New(cfg ClientConfig) (*Client, error) {
    s3Client, err := NewS3Client(S3Config{
        Endpoint:  cfg.Endpoint,
        AccessKey: cfg.AccessKey,
        SecretKey: cfg.SecretKey,
        Region:    cfg.Region,
    })
    if err != nil {
        return nil, fmt.Errorf("creating S3 client: %w", err)
    }
    return &Client{s3: s3Client, config: cfg}, nil
}

// Store writes data to a dw:// address.
func (c *Client) Store(ctx context.Context, dwURI string, body io.Reader, opts ...PutOption) error

// Retrieve reads data from a dw:// address.
func (c *Client) Retrieve(ctx context.Context, dwURI string) (io.ReadCloser, error)

// Delete removes an object at a dw:// address.
func (c *Client) Delete(ctx context.Context, dwURI string) error

// Exists checks if an object exists at a dw:// address.
func (c *Client) Exists(ctx context.Context, dwURI string) (bool, error)

// List lists objects under a dw:// prefix.
func (c *Client) List(ctx context.Context, dwURI string) ([]ObjectInfo, error)

// Copy copies an object between dw:// addresses.
func (c *Client) Copy(ctx context.Context, srcURI, dstURI string) error

// PresignGet generates a presigned GET URL for a dw:// address.
func (c *Client) PresignGet(ctx context.Context, dwURI string, expiry time.Duration) (string, error)

// Bucket management
func (c *Client) CreateBucket(ctx context.Context, name string) error
func (c *Client) DeleteBucket(ctx context.Context, name string) error
func (c *Client) ListBuckets(ctx context.Context) ([]types.Bucket, error)

// S3 returns the underlying S3 client for advanced operations.
func (c *Client) S3() *S3Client { return c.s3 }

// parseDwURI splits a dw:// URI into bucket and key.
func parseDwURI(uri string) (bucket, key string, err error) {
    uri = strings.TrimPrefix(uri, "dw://")
    uri = strings.TrimPrefix(uri, "s3://")
    parts := strings.SplitN(uri, "/", 2)
    if len(parts) == 0 || parts[0] == "" {
        return "", "", fmt.Errorf("invalid dw:// URI: missing bucket: %s", uri)
    }
    bucket = parts[0]
    if len(parts) > 1 {
        key = parts[1]
    }
    return bucket, key, nil
}
```

All methods must be fully implemented (delegating to s3 client after parsing dw:// URIs). Include godoc comments on all exported types and methods.
  </action>
  <verify>cd Clients/go && go build ./dwclient/ 2>&1 | tail -5</verify>
  <done>Go DataWarehouse client compiles with dw:// addressing and all methods implemented</done>
</task>

</tasks>

<verification>
- `go build ./dwclient/` compiles successfully
- All exported methods have godoc comments
- dw:// URI parsing handles edge cases
</verification>

<success_criteria>
- Go client connects to DataWarehouse S3 endpoint via aws-sdk-go-v2
- dw:// URIs parsed correctly
- Module importable as standard Go package
</success_criteria>

<output>
After completion, create `.planning/phases/63-universal-fabric/63-12-SUMMARY.md`
</output>
