---
phase: 04-compliance-storage-replication
plan: 02
type: execute
wave: 2
depends_on: ["04-01"]
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateCompliance/Services/ComplianceReportService.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompliance/Services/ChainOfCustodyExporter.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompliance/Services/ComplianceDashboardProvider.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompliance/Services/ComplianceAlertService.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompliance/Services/TamperIncidentWorkflowService.cs
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "Compliance report generator produces SOC2, HIPAA, FedRAMP, GDPR reports with evidence collection"
    - "Chain-of-custody export generates PDF/JSON output for legal discovery"
    - "Dashboard integration provides real-time compliance status data via message bus"
    - "Alert integrations notify via message bus topics for email, Slack, PagerDuty, OpsGenie"
    - "Tamper incident workflow creates incident tickets automatically on compliance violations"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompliance/Services/ComplianceReportService.cs"
      provides: "Multi-framework compliance report generation with evidence collection"
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompliance/Services/ChainOfCustodyExporter.cs"
      provides: "PDF/JSON chain-of-custody export for legal discovery"
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompliance/Services/ComplianceAlertService.cs"
      provides: "Alert routing to multiple notification channels via message bus"
  key_links:
    - from: "ComplianceReportService"
      to: "IComplianceStrategy implementations"
      via: "strategy iteration for evidence collection"
      pattern: "CollectEvidenceAsync|AssessAsync"
    - from: "ComplianceAlertService"
      to: "UniversalObservability"
      via: "message bus"
      pattern: "compliance\\.alert|compliance\\.report\\.publish"
---

<objective>
Implement compliance reporting features (T5.12-T5.16) as services within the UltimateCompliance plugin.

Purpose: Compliance reporting is essential for audit readiness. Organizations need automated report generation, chain-of-custody documentation, real-time dashboards, alert integrations, and automated incident workflows to maintain continuous compliance.

Output: Five compliance reporting services integrated into UltimateCompliance plugin. TODO.md T5.12-T5.16 synced.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-compliance-storage-replication/04-RESEARCH.md
@.planning/phases/04-compliance-storage-replication/04-01-SUMMARY.md
@Plugins/DataWarehouse.Plugins.UltimateCompliance/UltimateCompliancePlugin.cs
@Metadata/TODO.md (T5.12-T5.16, lines ~3560-3568)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement ComplianceReportService and ChainOfCustodyExporter (T5.12, T5.13)</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateCompliance/Services/ComplianceReportService.cs
    Plugins/DataWarehouse.Plugins.UltimateCompliance/Services/ChainOfCustodyExporter.cs
    Plugins/DataWarehouse.Plugins.UltimateCompliance/UltimateCompliancePlugin.cs
  </files>
  <action>
    Create a Services/ subfolder in UltimateCompliance plugin. Implement:

    1. **ComplianceReportService** (T5.12):
       - GenerateReportAsync(string framework, DateRange period) returning ComplianceReport
       - CollectEvidenceAsync(string framework, DateRange period) — iterates registered IComplianceStrategy instances, calls CollectEvidenceAsync on each
       - AnalyzeGapsAsync(evidence, framework) — identifies missing controls
       - MapControlsAsync(framework) — maps controls to evidence items
       - Supports SOC2, HIPAA, FedRAMP, GDPR frameworks
       - Cross-framework evidence reuse (one evidence item maps to multiple controls across frameworks)
       - Report output as structured ComplianceReport record with Framework, Period, Evidence, Gaps, Controls, OverallStatus
       - Publish reports via message bus topic "compliance.report.publish"

    2. **ChainOfCustodyExporter** (T5.13):
       - ExportAsync(ChainOfCustodyRequest request) returning ChainOfCustodyDocument
       - PDF export using structured document model (header, chain entries, signatures, timestamps)
       - JSON export with full custody chain serialization
       - Each entry: timestamp, actor, action, hash, previous hash (blockchain-style chain)
       - Supports legal discovery format requirements
       - Sign document with HMAC-SHA256 integrity seal

    Wire both services into UltimateCompliancePlugin orchestrator — register message bus handlers for "compliance.report.generate" and "compliance.custody.export" topics.
  </action>
  <verify>
    dotnet build Plugins/DataWarehouse.Plugins.UltimateCompliance/ --no-restore 2>&1 | Select-String -Pattern "error" | Select-Object -First 20
    Verify files exist: ls Plugins/DataWarehouse.Plugins.UltimateCompliance/Services/
  </verify>
  <done>
    ComplianceReportService generates multi-framework reports with evidence collection. ChainOfCustodyExporter produces PDF/JSON chain-of-custody documents with blockchain-style integrity chain. Both wired into plugin orchestrator via message bus. T5.12 and T5.13 marked [x] in TODO.md.
  </done>
</task>

<task type="auto">
  <name>Task 2: Implement dashboard, alerts, and incident workflow services (T5.14, T5.15, T5.16)</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateCompliance/Services/ComplianceDashboardProvider.cs
    Plugins/DataWarehouse.Plugins.UltimateCompliance/Services/ComplianceAlertService.cs
    Plugins/DataWarehouse.Plugins.UltimateCompliance/Services/TamperIncidentWorkflowService.cs
    Plugins/DataWarehouse.Plugins.UltimateCompliance/UltimateCompliancePlugin.cs
    Metadata/TODO.md
  </files>
  <action>
    Implement three more services:

    1. **ComplianceDashboardProvider** (T5.14):
       - GetDashboardDataAsync() returning ComplianceDashboardData
       - Aggregates: compliance score per framework, active violations count, evidence collection status, trending compliance metrics
       - Publishes status updates via message bus topic "compliance.dashboard.update"
       - Subscribe to "compliance.status.request" for on-demand queries
       - Real-time integrity status: overall health, per-framework status, last check timestamp

    2. **ComplianceAlertService** (T5.15):
       - SendAlertAsync(ComplianceAlert alert) — routes to configured channels
       - Supports: Email (via message bus "notification.email.send"), Slack ("notification.slack.send"), PagerDuty ("notification.pagerduty.send"), OpsGenie ("notification.opsgenie.send")
       - Alert severity levels: Info, Warning, Critical, Emergency
       - Deduplication: suppress duplicate alerts within configurable window
       - Alert escalation: auto-escalate if not acknowledged within timeout

    3. **TamperIncidentWorkflowService** (T5.16):
       - CreateIncidentAsync(TamperEvent tamperEvent) returning IncidentTicket
       - Automated incident creation on compliance violations detected
       - Incident lifecycle: Open -> Investigating -> Remediated -> Closed
       - Evidence attachment: links relevant compliance evidence to incident
       - Notification chain: alert responsible parties via ComplianceAlertService
       - Publish to "compliance.incident.created" topic

    Wire all three services into UltimateCompliancePlugin orchestrator. Subscribe to compliance-related message bus events.

    Update TODO.md: Mark T5.14, T5.15, T5.16 as [x].
  </action>
  <verify>
    dotnet build Plugins/DataWarehouse.Plugins.UltimateCompliance/ --no-restore 2>&1 | Select-String -Pattern "error" | Select-Object -First 20
    Verify all 5 services exist in Services/
    Grep for message bus topic strings in UltimateCompliancePlugin.cs
  </verify>
  <done>
    ComplianceDashboardProvider supplies real-time compliance status data. ComplianceAlertService routes alerts to Email/Slack/PagerDuty/OpsGenie via message bus. TamperIncidentWorkflowService automates incident creation with lifecycle management. All services wired into orchestrator. T5.14, T5.15, T5.16 marked [x] in TODO.md.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build Plugins/DataWarehouse.Plugins.UltimateCompliance/` passes with zero errors
2. All 5 services exist in Services/ subfolder
3. ComplianceReportService supports SOC2, HIPAA, FedRAMP, GDPR report generation
4. ChainOfCustodyExporter produces PDF/JSON with blockchain-style integrity chain
5. Alert routing covers Email, Slack, PagerDuty, OpsGenie channels
6. TODO.md T5.12-T5.16 all marked [x]
</verification>

<success_criteria>
Compliance reporting is fully functional with report generation, chain-of-custody export, dashboard data provision, alert integrations, and automated incident workflows — all communicating via message bus, no direct plugin references.
</success_criteria>

<output>
After completion, create `.planning/phases/04-compliance-storage-replication/04-02-SUMMARY.md`
</output>
