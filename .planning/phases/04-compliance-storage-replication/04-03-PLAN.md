---
phase: 04-compliance-storage-replication
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateStorage/UltimateStoragePlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateStorage/StorageStrategyBase.cs
  - Plugins/DataWarehouse.Plugins.UltimateStorage/StorageStrategyRegistry.cs
  - Plugins/DataWarehouse.Plugins.UltimateStorage/Strategies/**/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateStorage/Features/*.cs
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "UltimateStorage plugin orchestrator discovers and registers all 90+ storage strategy implementations"
    - "All storage backends (local, network, cloud, S3-compatible, enterprise, software-defined, OpenStack, decentralized, archive, specialized, future hardware, innovation) are verified production-ready"
    - "Seamless provider switching works via strategy registry — runtime selection of any backend"
    - "Advanced features (multi-backend fan-out, auto-tiering, cross-backend migration, lifecycle management, cost/latency selection, pool aggregation, quota management, RAID/replication integration) are functional"
    - "AI-dependent strategies (AiTieredStorage, ContentAwareStorage, PredictiveCompression) use message bus with rule-based fallbacks"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateStorage/UltimateStoragePlugin.cs"
      provides: "Storage plugin orchestrator with auto-discovery and unified path routing"
    - path: "Plugins/DataWarehouse.Plugins.UltimateStorage/StorageStrategyRegistry.cs"
      provides: "Strategy registry enabling runtime provider switching"
    - path: "Plugins/DataWarehouse.Plugins.UltimateStorage/Features/"
      provides: "Advanced storage features (fan-out, tiering, migration, lifecycle, quota, RAID/replication integration)"
  key_links:
    - from: "UltimateStoragePlugin.cs"
      to: "StorageStrategyRegistry"
      via: "auto-discovery"
      pattern: "DiscoverStrategies.*Assembly.GetExecutingAssembly"
    - from: "Features/ReplicationIntegrationFeature.cs"
      to: "UltimateReplication"
      via: "message bus"
      pattern: "replication\\."
---

<objective>
Verify the UltimateStorage plugin (T97) — all storage strategies, advanced features, and migration are complete.

Purpose: UltimateStorage is the central storage abstraction enabling all other plugins to read/write data. It must support seamless provider switching across 90+ backends with production-ready implementations.

Output: Verified UltimateStorage plugin with all Phases A-F confirmed complete. TODO.md T97 synced.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/04-compliance-storage-replication/04-RESEARCH.md
@Plugins/DataWarehouse.Plugins.UltimateStorage/UltimateStoragePlugin.cs
@Plugins/DataWarehouse.Plugins.UltimateStorage/StorageStrategyBase.cs
@Metadata/TODO.md (T97 section, lines ~8513-8767)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify UltimateStorage strategies and orchestrator are production-ready</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateStorage/UltimateStoragePlugin.cs
    Plugins/DataWarehouse.Plugins.UltimateStorage/StorageStrategyBase.cs
    Plugins/DataWarehouse.Plugins.UltimateStorage/StorageStrategyRegistry.cs
    Plugins/DataWarehouse.Plugins.UltimateStorage/Strategies/**/*.cs
  </files>
  <action>
    T97 is marked as "[x] Complete (132 strategies)" in TODO.md. Verify this claim:

    1. Count all strategy .cs files under Strategies/ (excluding obj/ files). Confirm count approaches 132.
    2. Verify UltimateStoragePlugin orchestrator:
       - Uses auto-discovery via StorageStrategyRegistry.DiscoverStrategies(Assembly.GetExecutingAssembly())
       - Inherits IntelligenceAwarePluginBase or equivalent
       - Has message bus subscriptions for storage.read, storage.write, storage.delete topics
       - Has OnStartWithIntelligenceAsync/OnStartWithoutIntelligenceAsync
    3. Spot-check 10 strategies across different categories (one from each: Local, Network, Cloud, S3Compatible, Enterprise, SoftwareDefined, OpenStack, Decentralized, Archive, Innovation):
       - Verify extends StorageStrategyBase
       - Verify has real implementation (no NotImplementedException, no stubs)
       - Verify XML docs on public members
    4. Verify all Phase A-F sub-tasks are genuinely marked [x] in TODO.md
    5. Fix any gaps found. If strategies are truly complete, confirm and move on.

    This is a VERIFICATION task — if everything checks out, the main work is confirming status and fixing any issues found. Do not re-implement things that already work.
  </action>
  <verify>
    dotnet build Plugins/DataWarehouse.Plugins.UltimateStorage/ --no-restore 2>&1 | Select-String -Pattern "error" | Select-Object -First 20
    Count: Get-ChildItem -Recurse -Filter "*Strategy.cs" Plugins/DataWarehouse.Plugins.UltimateStorage/Strategies/ | Where-Object { $_.FullName -notlike "*\obj\*" } | Measure-Object
    Grep for forbidden patterns in strategy files
  </verify>
  <done>
    UltimateStorage plugin verified with 90+ storage strategies across all categories. Orchestrator confirmed with auto-discovery, Intelligence-aware hooks, and message bus integration. Build passes. All T97 sub-tasks confirmed [x] in TODO.md.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify UltimateStorage advanced features and fix any gaps</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateStorage/Features/*.cs
    Plugins/DataWarehouse.Plugins.UltimateStorage/UltimateStoragePlugin.cs
    Metadata/TODO.md
  </files>
  <action>
    Verify all Phase C advanced features (C1-C10) are implemented:

    1. **MultiBackendFanOutFeature.cs** (C1) — writes to multiple backends simultaneously
    2. **AutoTieringFeature.cs** (C2) — automatic tiering between backends based on access patterns
    3. **CrossBackendMigrationFeature.cs** (C3) — migrate data between backends without downtime
    4. **LifecycleManagementFeature.cs** (C4) — unified lifecycle rules across all backends
    5. **CostBasedSelectionFeature.cs** (C5) — select cheapest backend meeting requirements
    6. **LatencyBasedSelectionFeature.cs** (C6) — select lowest-latency backend
    7. **StoragePoolAggregationFeature.cs** (C7) — aggregate multiple backends into virtual pool
    8. **CrossBackendQuotaFeature.cs** (C8) — enforce quotas across all backends
    9. **RaidIntegrationFeature.cs** (C9) — integrate with UltimateRAID for local redundancy
    10. **ReplicationIntegrationFeature.cs** (C10) — integrate with UltimateReplication for geo-distribution

    For each feature:
    - Verify file exists and has real implementation
    - Verify uses message bus for cross-plugin integration (RAID, Replication) — no direct plugin references
    - Verify AI-dependent features have IsIntelligenceAvailable fallbacks
    - Fix any issues found

    Verify Phase D migration (D1-D5) and Phase E (E1-E3 ExabyteScale) are complete.

    Confirm TODO.md T97 Phases C-F all marked [x]. Fix any discrepancies.
  </action>
  <verify>
    dotnet build Plugins/DataWarehouse.Plugins.UltimateStorage/ --no-restore 2>&1 | Select-String -Pattern "error" | Select-Object -First 20
    ls Plugins/DataWarehouse.Plugins.UltimateStorage/Features/
    Grep for "MessageBus" in Features/ files to confirm message bus usage
  </verify>
  <done>
    All 10 advanced features verified with real implementations. RAID and Replication integration uses message bus (no direct references). Migration and ExabyteScale confirmed complete. All TODO.md T97 Phases C-F confirmed [x]. Build passes.
  </done>
</task>

</tasks>

<verification>
1. `dotnet build Plugins/DataWarehouse.Plugins.UltimateStorage/` passes with zero errors
2. Strategy file count confirmed (90+ .cs files, excluding obj/)
3. All 10 Features/*.cs files exist with real implementations
4. No forbidden patterns in any strategy or feature file
5. All TODO.md T97 Phases A-F confirmed [x]
6. Cross-plugin integrations (RAID, Replication) use message bus only
</verification>

<success_criteria>
UltimateStorage plugin is verified production-ready with 90+ storage backend strategies, 10 advanced features, and complete migration — matching the TODO.md claim of 132 strategies complete.
</success_criteria>

<output>
After completion, create `.planning/phases/04-compliance-storage-replication/04-03-SUMMARY.md`
</output>
