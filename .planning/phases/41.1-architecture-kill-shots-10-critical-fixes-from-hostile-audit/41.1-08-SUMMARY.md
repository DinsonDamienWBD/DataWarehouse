---
phase: 41.1-architecture-kill-shots
plan: 08
subsystem: launcher, sdk-hosting, service-management
tags: [profile-loading, service-binary, daemon, plugin-filtering, AEDS]
dependency-graph:
  requires: []
  provides: [service-profiles, plugin-profile-attribute, profile-loader, profile-service-registration]
  affects: [launcher, sdk-hosting, platform-service-manager, cli-service-commands, aeds-plugins]
tech-stack:
  added: []
  patterns: [profile-based-loading, attribute-driven-filtering, auto-detection, platform-service-naming]
key-files:
  created:
    - DataWarehouse.SDK/Hosting/ServiceProfileType.cs
    - DataWarehouse.SDK/Hosting/PluginProfileAttribute.cs
    - DataWarehouse.Launcher/PluginProfileLoader.cs
  modified:
    - DataWarehouse.Launcher/Program.cs
    - DataWarehouse.Launcher/Integration/ServiceHost.cs
    - DataWarehouse.Launcher/appsettings.json
    - DataWarehouse.Shared/Services/PlatformServiceManager.cs
    - DataWarehouse.Shared/Commands/ServiceManagementCommands.cs
    - DataWarehouse.CLI/Program.cs
    - Plugins/DataWarehouse.Plugins.AedsCore/ServerDispatcherPlugin.cs
    - Plugins/DataWarehouse.Plugins.AedsCore/ClientCourierPlugin.cs
    - Plugins/DataWarehouse.Plugins.AedsCore/ControlPlane/GrpcControlPlanePlugin.cs
    - Plugins/DataWarehouse.Plugins.AedsCore/ControlPlane/MqttControlPlanePlugin.cs
    - Plugins/DataWarehouse.Plugins.AedsCore/ControlPlane/WebSocketControlPlanePlugin.cs
    - Plugins/DataWarehouse.Plugins.UltimateStorage/UltimateStoragePlugin.cs
    - Plugins/DataWarehouse.Plugins.UltimateRAID/UltimateRaidPlugin.cs
    - Plugins/DataWarehouse.Plugins.UltimateDatabaseStorage/UltimateDatabaseStoragePlugin.cs
    - Plugins/DataWarehouse.Plugins.UltimateIntelligence/UltimateIntelligencePlugin.cs
    - Plugins/DataWarehouse.Plugins.UltimateDataLineage/LineageStrategyBase.cs
    - Plugins/DataWarehouse.Plugins.UltimateDataManagement/DataManagementStrategyBase.cs
    - Plugins/DataWarehouse.Plugins.UltimateStreamingData/UltimateStreamingDataPlugin.cs
    - .planning/PLUGIN-CATALOG.md
decisions:
  - "Auto is default profile -- detects from available plugin types at startup"
  - "9 plugins explicitly annotated (4 Server AEDS, 1 Client AEDS, 4 Server heavy), rest default to Both"
  - "BFS implementations for LineageStrategyBase abstract methods (pre-existing build break from concurrent plan)"
metrics:
  duration: 25min
  completed: 2026-02-17
---

# Phase 41.1 Plan 08: Unified Service Binary with Profile-Based Plugin Loading Summary

Single unified binary with profile-based plugin loading via ServiceProfileType enum, PluginProfileAttribute, and PluginProfileLoader -- same binary serves as server or client daemon.

## What Was Built

### SDK Profile Infrastructure
- **ServiceProfileType enum** (`DataWarehouse.SDK/Hosting/ServiceProfileType.cs`): Server, Client, Both, None, Auto values with full XML documentation
- **PluginProfileAttribute** (`DataWarehouse.SDK/Hosting/PluginProfileAttribute.cs`): `[AttributeUsage(Inherited=true)]`, `GetProfile(Type)` static helper returns Both when no attribute present

### Launcher Profile Loading
- **ServiceOptions**: Added `Profile` property (default: Auto), parsed from `--profile`, `appsettings.json`, and `DW_PROFILE` env var
- **PluginProfileLoader** (`DataWarehouse.Launcher/PluginProfileLoader.cs`): `FilterPluginsByProfile()` with auto-detection logic (has ServerDispatcher = Server, has ClientCourier = Client)
- **ServiceHost**: Profile logged and passed through AdapterOptions CustomConfig
- **Help text**: Updated with `--profile server|client|auto` documentation and examples
- **appsettings.json**: Profile=auto, PluginProfiles whitelist/blacklist sections

### Plugin Annotations (9 plugins)
| Plugin | Profile | Reason |
|--------|---------|--------|
| ServerDispatcherPlugin | Server | Server-side job dispatch |
| GrpcControlPlanePlugin | Server | gRPC listener |
| MqttControlPlanePlugin | Server | MQTT listener |
| WebSocketControlPlanePlugin | Server | WebSocket listener |
| ClientCourierPlugin | Client | Client sentinel/executor/watchdog |
| UltimateStoragePlugin | Server | Heavy storage backends |
| UltimateRaidPlugin | Server | RAID array management |
| UltimateDatabaseStoragePlugin | Server | Database storage backends |
| UltimateIntelligencePlugin | Server | AI/ML providers |

### Service Management Integration
- **PlatformServiceManager**: `GetProfileServiceName()`, `GetProfileDisplayName()`, `GetProfileDescription()`, `CreateProfileRegistration()` -- platform-specific naming (Windows: DataWarehouse-Server, Linux: datawarehouse-server, macOS: com.datawarehouse.server)
- **ServiceInstallCommand** (new): `service.install` with `--profile` and `--path` flags
- **All service commands**: Updated to accept `--profile` (status, start, stop, restart, uninstall)
- **CLI Program.cs**: Service command group updated with --profile on all subcommands

### Documentation
- PLUGIN-CATALOG.md: Profile-Based Plugin Loading section with enum docs, attribute usage, annotated plugins table, service naming, CLI commands, and configuration examples

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] LineageStrategyBase abstract methods missing implementations**
- **Found during:** Task 5.2 (build verification)
- **Issue:** Concurrent plan made GetUpstreamAsync/GetDownstreamAsync/AnalyzeImpactAsync abstract on LineageStrategyBase, but 8 concrete strategies (SqlTransformation, EtlPipeline, ApiConsumption, ReportConsumption, AuditTrail, GdprLineage, MlPipelineLineage, SchemaEvolution, ExternalSource) had no implementations, causing 42 CS0534 errors
- **Fix:** Changed from abstract to virtual with BFS implementations (upstream=traverse edges backward, downstream=forward, impact=BFS with scoring)
- **Files modified:** `Plugins/DataWarehouse.Plugins.UltimateDataLineage/LineageStrategyBase.cs`
- **Commit:** 8343e47

**2. [Rule 1 - Bug] ThrowIfNotInitialized member hiding warnings treated as errors**
- **Found during:** Task 5.2 (build verification)
- **Issue:** DataManagementStrategyBase and StreamingDataStrategyBase defined ThrowIfNotInitialized() hiding StrategyBase.ThrowIfNotInitialized(), CS0108 errors with TreatWarningsAsErrors
- **Fix:** Added `new` keyword for legitimate member hiding
- **Files modified:** `DataManagementStrategyBase.cs`, `UltimateStreamingDataPlugin.cs`
- **Commit:** 8343e47

## Commits

| # | Hash | Message |
|---|------|---------|
| 1 | a0167e5 | feat(41.1-08): add ServiceProfileType enum and PluginProfileAttribute to SDK |
| 2 | 159b2e2 | feat(41.1-08): add PluginProfileLoader and --profile flag to Launcher |
| 3 | 9cf567a | feat(41.1-08): annotate AEDS and heavy plugins with PluginProfile attributes |
| 4 | 9c17b0f | feat(41.1-08): profile-aware PlatformServiceManager and CLI service commands |
| 5 | 8343e47 | fix(41.1-08): add profile config to appsettings.json and fix pre-existing build errors |
| 6 | 9438ebc | docs(41.1-08): document profile-based plugin loading in PLUGIN-CATALOG.md |

## Verification

- [x] Build: `dotnet build --configuration Release` -- 0 errors, 0 warnings
- [x] ServiceProfileType enum: Server, Client, Both, Auto, None values
- [x] PluginProfileAttribute: works with reflection via GetProfile(Type)
- [x] PluginProfileLoader: FilterPluginsByProfile with auto-detect
- [x] AEDS plugins: ServerDispatcher=Server, ClientCourier=Client, ControlPlane=Server
- [x] Service registration: Profile name in service name (Windows/Linux/macOS)
- [x] CLI: `dw service install --profile server|client` command
- [x] PLUGIN-CATALOG.md: Updated with profile-based loading documentation

## Self-Check: PASSED

All 10 key files verified present. All 6 commits verified in git log.
