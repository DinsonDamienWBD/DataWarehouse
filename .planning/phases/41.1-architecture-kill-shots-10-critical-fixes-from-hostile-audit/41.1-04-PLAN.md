---
phase: 41.1
plan_number: 04
plan_name: "FIX-10/11/12/13: Migrate Common Impls, Port Legacy Key Mgmt & Storage Chain, Delete 14 Legacy Bases"
wave: 1
depends_on: []
autonomous: true
priority: critical
estimated_effort: 8-12 hours
---

# Plan 41.1-04: FIX-10/11/12/13 — Hierarchy Consolidation & Legacy Deletion

## Overview
This plan addresses four critical architecture fixes from the hostile audit:
- **FIX-10**: Migrate common implementations (SelectOptimalAlgorithmAsync) down to DataTransformationPluginBase
- **FIX-12**: Port old EncryptionPluginBase key management (envelope encryption, key stores, DEK generation) to new hierarchy
- **FIX-13**: Port legacy storage chain features (listing, caching, indexing) to new StoragePluginBase
- **FIX-11**: DELETE all 14 legacy base classes from PluginBase.cs after successful migration

Wave 1, no dependencies. This is a clean break — all useful code moves to v3.0 hierarchy, then legacy bases are DELETED (no [Obsolete], no backward compat).

## Must Haves

### Truths
1. **FIX-10**: SelectOptimalAlgorithmAsync is duplicated in CompressionPluginBase and EncryptionPluginBase (both in Hierarchy/DataPipeline/), must be promoted to DataTransformationPluginBase
2. **FIX-12**: Old EncryptionPluginBase (PluginBase.cs line ~2114) has envelope encryption, key store registry, DEK generation, encryption statistics, audit logging — ALL must be ported to new EncryptionPluginBase
3. **FIX-13**: Legacy storage chain classes (ListableStoragePluginBase line ~1435, CacheableStoragePluginBase line ~1487, IndexableStoragePluginBase line ~1722) have caching/indexing/listing features that should be ported to new StoragePluginBase as opt-in protected methods
4. **FIX-11**: After porting useful code, COMPLETELY DELETE all 14 legacy inner classes from PluginBase.cs (lines ~1162-3200+)
5. Before deletion, MUST grep entire solution for references to each legacy class and fix any plugins still using them
6. Rule 13: NO stubs/placeholders/simplifications — production-ready implementations only
7. All changes must preserve existing plugin functionality while enabling migration to v3.0 hierarchy

### Artifacts
- `DataWarehouse.SDK/Contracts/Hierarchy/DataPipelinePluginBase.cs` — DataTransformationPluginBase updated with SelectOptimalAlgorithmAsync
- `DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/EncryptionPluginBase.cs` — ported key management from legacy
- `DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/StoragePluginBase.cs` — ported caching/indexing from legacy
- `DataWarehouse.SDK/Contracts/PluginBase.cs` — 14 legacy classes DELETED, clean file
- All plugins using legacy bases — updated to use v3.0 hierarchy equivalents
- Build passes with zero errors
- LSP diagnostics clean across all modified files

### Key Links
- Source legacy bases: `DataWarehouse.SDK/Contracts/PluginBase.cs` (lines ~1162-3200)
- Target hierarchy bases:
  - `DataWarehouse.SDK/Contracts/Hierarchy/DataPipelinePluginBase.cs`
  - `DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/CompressionPluginBase.cs`
  - `DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/EncryptionPluginBase.cs`
  - `DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/StoragePluginBase.cs`
- PLUGIN-CATALOG: `.planning/PLUGIN-CATALOG.md` — encryption, compression, storage plugin inventory

## Tasks

<task id="1" type="auto">
<description>
FIX-10 Discovery: Read all v3.0 hierarchy base classes, identify common implementation patterns (SelectOptimalAlgorithmAsync + any others) that should be migrated to lower common ancestor
</description>
<details>
Read the following files to identify duplication and common patterns:
- DataWarehouse.SDK/Contracts/Hierarchy/DataPipelinePluginBase.cs (DataTransformationPluginBase, DataIntegrationPluginBase, etc.)
- DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/CompressionPluginBase.cs
- DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/EncryptionPluginBase.cs
- DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/StoragePluginBase.cs
- DataWarehouse.SDK/Contracts/Hierarchy/Feature/*.cs (all feature hierarchy files)
- DataWarehouse.SDK/Contracts/Hierarchy/NewFeaturePluginBase.cs

Focus on:
1. SelectOptimalAlgorithmAsync in CompressionPluginBase and EncryptionPluginBase (known duplication)
2. Any other common helper methods, utilities, or patterns repeated across multiple leaf bases
3. Identify the lowest common ancestor for each duplicated pattern

Create analysis document at `.planning/phases/41.1-architecture-kill-shots-10-critical-fixes-from-hostile-audit/fix-10-duplication-analysis.md` with:
- List of duplicated methods/patterns
- Current locations (file + line range)
- Proposed target location (lowest common ancestor)
- Migration strategy for each item
</details>
<verify>
- Analysis document exists at `.planning/phases/41.1-architecture-kill-shots-10-critical-fixes-from-hostile-audit/fix-10-duplication-analysis.md`
- Document identifies SelectOptimalAlgorithmAsync in both CompressionPluginBase and EncryptionPluginBase
- Document proposes DataTransformationPluginBase as target for SelectOptimalAlgorithmAsync
- Document lists any other discovered duplications with migration targets
- All file reads completed successfully
</verify>
<done>
Analysis complete, duplication patterns identified, migration targets documented
</done>
</task>

<task id="2" type="auto">
<description>
FIX-10 Execution: Migrate SelectOptimalAlgorithmAsync and any other identified common implementations to their target base classes (DataTransformationPluginBase or other lowest common ancestors)
</description>
<details>
Based on task 1 analysis:
1. Read DataWarehouse.SDK/Contracts/Hierarchy/DataPipelinePluginBase.cs to understand DataTransformationPluginBase structure
2. Read CompressionPluginBase.cs and EncryptionPluginBase.cs to extract SelectOptimalAlgorithmAsync implementations
3. Add SelectOptimalAlgorithmAsync to DataTransformationPluginBase:
   - Protected virtual method with generic algorithm selection logic
   - Support for performance hints, context-aware selection
   - Preserve all existing functionality from both implementations
4. Update CompressionPluginBase and EncryptionPluginBase to REMOVE their local implementations and CALL base.SelectOptimalAlgorithmAsync
5. Migrate any other identified common implementations to their target ancestors
6. Ensure all changes preserve Rule 13 (production-ready, no stubs)
7. Run LSP diagnostics on all modified files
</details>
<verify>
- DataTransformationPluginBase contains SelectOptimalAlgorithmAsync (protected virtual)
- CompressionPluginBase and EncryptionPluginBase no longer have local SelectOptimalAlgorithmAsync implementations
- Both leaf classes call base.SelectOptimalAlgorithmAsync or override it appropriately
- All other identified duplications migrated to target ancestors
- LSP diagnostics clean on DataPipelinePluginBase.cs, CompressionPluginBase.cs, EncryptionPluginBase.cs
- No build errors introduced
</verify>
<done>
FIX-10 complete: common implementations migrated to lowest common ancestors, duplication eliminated
</done>
</task>

<task id="3" type="auto">
<description>
FIX-12 Discovery: Read old EncryptionPluginBase (PluginBase.cs starting line ~2114), extract all key management, envelope encryption, DEK generation, encryption statistics, and audit logging implementations
</description>
<details>
Read DataWarehouse.SDK/Contracts/PluginBase.cs starting at line ~2114 (old EncryptionPluginBase inner class).

Extract and document:
1. **Envelope Encryption**: EncryptWithEnvelopeAsync, DecryptWithEnvelopeAsync methods
2. **Key Store Registry**: RegisterKeyStore, GetKeyStore, key store management
3. **DEK Generation**: GenerateDataEncryptionKeyAsync, key derivation logic
4. **Encryption Statistics**: GetEncryptionStatisticsAsync, metrics tracking
5. **Audit Logging**: Crypto operation logging, compliance hooks
6. Any other useful encryption-related utilities

Create extraction document at `.planning/phases/41.1-architecture-kill-shots-10-critical-fixes-from-hostile-audit/fix-12-encryption-key-mgmt-extraction.md` with:
- Full method signatures
- Implementation details (algorithm choices, error handling, async patterns)
- Dependencies (external libs, SDK interfaces)
- Integration points (message bus, audit log)
- Port strategy for each component
</details>
<verify>
- Extraction document exists at `.planning/phases/41.1-architecture-kill-shots-10-critical-fixes-from-hostile-audit/fix-12-encryption-key-mgmt-extraction.md`
- Document lists all envelope encryption methods (EncryptWithEnvelopeAsync, DecryptWithEnvelopeAsync)
- Document lists key store registry methods (RegisterKeyStore, GetKeyStore)
- Document lists DEK generation method (GenerateDataEncryptionKeyAsync)
- Document lists encryption statistics method (GetEncryptionStatisticsAsync)
- Document identifies audit logging hooks
- Port strategy defined for each component
</verify>
<done>
FIX-12 discovery complete: old EncryptionPluginBase key management features extracted and documented
</done>
</task>

<task id="4" type="auto">
<description>
FIX-12 Execution: Port all old EncryptionPluginBase key management features to new DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/EncryptionPluginBase.cs
</description>
<details>
Read current new EncryptionPluginBase (DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/EncryptionPluginBase.cs).

Port from old EncryptionPluginBase (using task 3 extraction document):
1. **Envelope Encryption**:
   - Add protected EncryptWithEnvelopeAsync(data, kek, metadata)
   - Add protected DecryptWithEnvelopeAsync(envelope, kek, metadata)
   - Full async/await, CancellationToken support
   - Error handling, validation
2. **Key Store Registry**:
   - Add protected Dictionary<string, IKeyStore> keyStores
   - Add protected RegisterKeyStore(name, store)
   - Add protected GetKeyStore(name)
   - Thread-safe access
3. **DEK Generation**:
   - Add protected GenerateDataEncryptionKeyAsync(algorithm, size, context)
   - Cryptographically secure random generation
   - Configurable algorithms (AES-256, ChaCha20, etc.)
4. **Encryption Statistics**:
   - Add protected GetEncryptionStatisticsAsync() → EncryptionStats
   - Track operations, bytes encrypted/decrypted, key rotations
5. **Audit Logging**:
   - Add protected LogCryptoOperationAsync(operation, algorithm, outcome, metadata)
   - Integration with SDK audit logging
6. Preserve ALL functionality from old implementation
7. Follow v3.0 hierarchy patterns (protected virtual methods, opt-in features)
8. Run LSP diagnostics on EncryptionPluginBase.cs
</details>
<verify>
- New EncryptionPluginBase contains EncryptWithEnvelopeAsync and DecryptWithEnvelopeAsync (protected, async)
- New EncryptionPluginBase contains RegisterKeyStore and GetKeyStore with thread-safe key store registry
- New EncryptionPluginBase contains GenerateDataEncryptionKeyAsync with crypto-secure key generation
- New EncryptionPluginBase contains GetEncryptionStatisticsAsync with operation tracking
- New EncryptionPluginBase contains LogCryptoOperationAsync with audit integration
- All ported code is production-ready (Rule 13: no stubs/placeholders)
- LSP diagnostics clean on EncryptionPluginBase.cs
- No build errors introduced
</verify>
<done>
FIX-12 complete: old EncryptionPluginBase key management features ported to new v3.0 hierarchy EncryptionPluginBase
</done>
</task>

<task id="5" type="auto">
<description>
FIX-13 Discovery: Read legacy storage chain classes (ListableStoragePluginBase, CacheableStoragePluginBase, IndexableStoragePluginBase from PluginBase.cs), extract caching, indexing, and listing features
</description>
<details>
Read DataWarehouse.SDK/Contracts/PluginBase.cs legacy storage classes:
1. **ListableStoragePluginBase** (line ~1435): enumeration, listing, filtering
2. **CacheableStoragePluginBase** (line ~1487): caching layer with TTL, invalidation, memory management
3. **IndexableStoragePluginBase** (line ~1722): B-tree indexing, query support, range scans

Extract and document:
- Listing/enumeration APIs (ListAsync, EnumerateAsync, filters)
- Caching implementation (cache layer, TTL, LRU eviction, invalidation strategies)
- Indexing implementation (B-tree structure, query execution, range queries)
- Integration points (message bus, metrics, audit)
- Dependencies (external libs, data structures)

Create extraction document at `.planning/phases/41.1-architecture-kill-shots-10-critical-fixes-from-hostile-audit/fix-13-storage-chain-extraction.md` with:
- Full feature breakdown for each legacy class
- Method signatures and implementations
- Port strategy: which features to port, how to make them opt-in in new StoragePluginBase
- Trade-offs (e.g., always-on vs opt-in caching)
</details>
<verify>
- Extraction document exists at `.planning/phases/41.1-architecture-kill-shots-10-critical-fixes-from-hostile-audit/fix-13-storage-chain-extraction.md`
- Document lists ListableStoragePluginBase features (ListAsync, EnumerateAsync, filters)
- Document lists CacheableStoragePluginBase features (caching, TTL, LRU, invalidation)
- Document lists IndexableStoragePluginBase features (B-tree indexing, query support, range scans)
- Document identifies integration points (message bus, metrics, audit)
- Port strategy defined: which features to port, how to make opt-in
</verify>
<done>
FIX-13 discovery complete: legacy storage chain features extracted and documented
</done>
</task>

<task id="6" type="auto">
<description>
FIX-13 Execution: Port useful caching and indexing features from legacy storage chain classes to new DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/StoragePluginBase.cs as opt-in protected methods
</description>
<details>
Read current new StoragePluginBase (DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/StoragePluginBase.cs).

Port from legacy storage classes (using task 5 extraction document):
1. **Listing/Enumeration** (from ListableStoragePluginBase):
   - Add protected ListAsync(filter, pagination, cancellationToken)
   - Add protected EnumerateAsync(filter, batchSize, cancellationToken) → IAsyncEnumerable
   - Filter support (prefix, pattern, metadata)
2. **Caching Layer** (from CacheableStoragePluginBase):
   - Add protected EnableCaching(config) — opt-in caching
   - Add protected InvalidateCacheAsync(key)
   - Add protected InvalidateCacheRangeAsync(prefix)
   - LRU eviction, configurable TTL
   - Memory limit enforcement
3. **Indexing** (from IndexableStoragePluginBase):
   - Add protected EnableIndexing(config) — opt-in indexing
   - Add protected QueryIndexAsync(query, cancellationToken) → results
   - B-tree indexing for range queries
   - Support for common query patterns (prefix, range, exact match)
4. Make all features OPT-IN via protected Enable* methods (plugins choose whether to activate)
5. Preserve all useful functionality, discard obsolete/unused code
6. Follow v3.0 hierarchy patterns (protected virtual, async/await)
7. Run LSP diagnostics on StoragePluginBase.cs
</details>
<verify>
- New StoragePluginBase contains ListAsync and EnumerateAsync with filter/pagination support
- New StoragePluginBase contains EnableCaching, InvalidateCacheAsync, InvalidateCacheRangeAsync (opt-in caching)
- New StoragePluginBase contains EnableIndexing, QueryIndexAsync (opt-in B-tree indexing)
- All features are opt-in (plugins must call Enable* to activate)
- All ported code is production-ready (Rule 13: no stubs/placeholders)
- LSP diagnostics clean on StoragePluginBase.cs
- No build errors introduced
</verify>
<done>
FIX-13 complete: legacy storage chain features ported to new v3.0 hierarchy StoragePluginBase as opt-in capabilities
</done>
</task>

<task id="7" type="auto">
<description>
FIX-11 Pre-Deletion: Grep entire solution for references to all 14 legacy base classes, identify plugins still using them, create migration checklist
</description>
<details>
The 14 legacy base classes in PluginBase.cs (lines ~1162-3200) are:
1. CompressionPluginBase (old)
2. EncryptionPluginBase (old)
3. DeduplicationPluginBase (old)
4. HashingPluginBase (old)
5. SerializationPluginBase (old)
6. ValidationPluginBase (old)
7. TransformationPluginBase (old)
8. StoragePluginBase (old)
9. ListableStoragePluginBase
10. CacheableStoragePluginBase
11. IndexableStoragePluginBase
12. MetadataPluginBase (old)
13. SearchPluginBase (old)
14. SchedulerPluginBase (old)

For each class:
1. Grep entire solution: `Grep(pattern="{ClassName}", output_mode="files_with_matches")`
2. Read each file that references the legacy class
3. Identify if it's a plugin using the legacy base OR just a reference (e.g., comment, using statement)
4. For plugins using legacy bases: identify the v3.0 hierarchy equivalent

Create migration checklist at `.planning/phases/41.1-architecture-kill-shots-10-critical-fixes-from-hostile-audit/fix-11-legacy-base-migration-checklist.md` with:
- List of all 14 legacy classes
- For each class: list of plugins/files referencing it
- For each plugin: target v3.0 base class to migrate to
- Migration steps for each plugin
</details>
<verify>
- Migration checklist exists at `.planning/phases/41.1-architecture-kill-shots-10-critical-fixes-from-hostile-audit/fix-11-legacy-base-migration-checklist.md`
- Checklist lists all 14 legacy base classes
- For each legacy class: checklist shows grep results (files referencing it)
- For each plugin using a legacy base: checklist identifies the v3.0 hierarchy equivalent
- Migration steps documented for each plugin
- No references missed (comprehensive grep coverage)
</verify>
<done>
FIX-11 pre-deletion complete: all references to 14 legacy base classes identified, migration checklist created
</done>
</task>

<task id="8" type="auto">
<description>
FIX-11 Migration: Migrate all plugins still using legacy base classes to their v3.0 hierarchy equivalents
</description>
<details>
Using the migration checklist from task 7:
1. For each plugin using a legacy base class:
   - Read the plugin file
   - Update base class from legacy (PluginBase.{LegacyClass}) to v3.0 hierarchy (SDK.Contracts.Hierarchy.{NewClass})
   - Update using statements if needed
   - Update method overrides to match v3.0 hierarchy signatures
   - Update any legacy API calls to use new v3.0 APIs (e.g., envelope encryption, caching opt-in)
   - Preserve all existing functionality
2. For each migrated plugin:
   - Run LSP diagnostics to ensure no errors
   - Verify build passes
3. Common migrations:
   - Old CompressionPluginBase → Hierarchy.DataPipeline.CompressionPluginBase
   - Old EncryptionPluginBase → Hierarchy.DataPipeline.EncryptionPluginBase
   - Old StoragePluginBase → Hierarchy.DataPipeline.StoragePluginBase
   - Old MetadataPluginBase → Hierarchy.Feature.MetadataPluginBase
   - Old SearchPluginBase → Hierarchy.Feature.SearchPluginBase
   - Old SchedulerPluginBase → Hierarchy.Feature.SchedulingPluginBase
   - ListableStoragePluginBase → Hierarchy.DataPipeline.StoragePluginBase (use ListAsync)
   - CacheableStoragePluginBase → Hierarchy.DataPipeline.StoragePluginBase (use EnableCaching)
   - IndexableStoragePluginBase → Hierarchy.DataPipeline.StoragePluginBase (use EnableIndexing)
4. Update migration checklist to mark each plugin as MIGRATED
</details>
<verify>
- All plugins identified in task 7 migration checklist have been migrated to v3.0 hierarchy bases
- No plugin files contain references to legacy base classes (PluginBase.{LegacyClass})
- All migrated plugins use v3.0 hierarchy base classes (SDK.Contracts.Hierarchy.*)
- LSP diagnostics clean on all migrated plugin files
- Build passes with zero errors
- Migration checklist marked COMPLETE for all plugins
</verify>
<done>
FIX-11 migration complete: all plugins migrated from legacy base classes to v3.0 hierarchy equivalents
</done>
</task>

<task id="9" type="auto">
<description>
FIX-11 Deletion: COMPLETELY DELETE all 14 legacy base classes from PluginBase.cs (lines ~1162-3200+), no [Obsolete], clean break
</description>
<details>
Read DataWarehouse.SDK/Contracts/PluginBase.cs.

Delete all 14 legacy inner classes (lines ~1162-3200):
1. CompressionPluginBase (old)
2. EncryptionPluginBase (old)
3. DeduplicationPluginBase (old)
4. HashingPluginBase (old)
5. SerializationPluginBase (old)
6. ValidationPluginBase (old)
7. TransformationPluginBase (old)
8. StoragePluginBase (old)
9. ListableStoragePluginBase
10. CacheableStoragePluginBase
11. IndexableStoragePluginBase
12. MetadataPluginBase (old)
13. SearchPluginBase (old)
14. SchedulerPluginBase (old)

Steps:
1. Identify exact line range for all 14 classes in PluginBase.cs
2. DELETE entire block (no [Obsolete] attributes, no comments, just DELETE)
3. Clean up any orphaned using statements or comments referencing deleted classes
4. Ensure PluginBase.cs still compiles (only the main PluginBase class remains)
5. Run LSP diagnostics on PluginBase.cs
6. Verify no broken references in solution (grep for each deleted class name)
</details>
<verify>
- All 14 legacy base classes DELETED from PluginBase.cs
- PluginBase.cs contains ONLY the main PluginBase class (no legacy inner classes)
- File size significantly reduced (should be ~1100 lines vs ~3200 lines)
- LSP diagnostics clean on PluginBase.cs
- Grep for each deleted class name returns ZERO results in plugin files (only v3.0 hierarchy references remain)
- Build passes with zero errors
- No [Obsolete] attributes, no backward compat shims — clean deletion
</verify>
<done>
FIX-11 deletion complete: all 14 legacy base classes DELETED from PluginBase.cs, clean break accomplished
</done>
</task>

<task id="10" type="auto">
<description>
Final Build & LSP Verification: Build entire solution, run LSP diagnostics on all modified files, verify zero errors
</description>
<details>
1. Build entire solution: `dotnet build DataWarehouse.sln`
2. Capture build output, check for errors
3. Run LSP diagnostics on all modified files:
   - DataWarehouse.SDK/Contracts/Hierarchy/DataPipelinePluginBase.cs
   - DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/CompressionPluginBase.cs
   - DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/EncryptionPluginBase.cs
   - DataWarehouse.SDK/Contracts/Hierarchy/DataPipeline/StoragePluginBase.cs
   - DataWarehouse.SDK/Contracts/PluginBase.cs
   - All migrated plugin files (from task 8)
4. Verify zero LSP errors, zero LSP warnings (or only pre-existing warnings)
5. If errors found: fix immediately, re-verify
6. Create verification report at `.planning/phases/41.1-architecture-kill-shots-10-critical-fixes-from-hostile-audit/fix-10-11-12-13-verification-report.md` with:
   - Build status (pass/fail, error count)
   - LSP diagnostics summary (per file)
   - List of all modified files
   - Confirmation that FIX-10, FIX-11, FIX-12, FIX-13 are complete
</details>
<verify>
- Build passes with zero errors: `dotnet build DataWarehouse.sln` → Success
- LSP diagnostics clean on all modified hierarchy base files (DataPipelinePluginBase.cs, CompressionPluginBase.cs, EncryptionPluginBase.cs, StoragePluginBase.cs, PluginBase.cs)
- LSP diagnostics clean on all migrated plugin files
- Verification report exists at `.planning/phases/41.1-architecture-kill-shots-10-critical-fixes-from-hostile-audit/fix-10-11-12-13-verification-report.md`
- Report confirms all 4 fixes (FIX-10, FIX-11, FIX-12, FIX-13) complete
- No regressions introduced
</verify>
<done>
Final verification complete: build passes, LSP clean, all 4 fixes (FIX-10/11/12/13) validated and confirmed complete
</done>
</task>

<task id="11" type="auto">
<description>
Update Living Documentation (DOC-21)
</description>
<details>
Update `.planning/PLUGIN-CATALOG.md` to reflect ALL changes made in this plan:

- **MAJOR UPDATE**: Remove all 14 legacy base class entries (CompressionPluginBase old, EncryptionPluginBase old, DeduplicationPluginBase old, HashingPluginBase old, SerializationPluginBase old, ValidationPluginBase old, TransformationPluginBase old, StoragePluginBase old, ListableStoragePluginBase, CacheableStoragePluginBase, IndexableStoragePluginBase, MetadataPluginBase old, SearchPluginBase old, SchedulerPluginBase old)
- Update DataTransformationPluginBase: document new SelectOptimalAlgorithmAsync method (migrated from CompressionPluginBase and EncryptionPluginBase)
- Update EncryptionPluginBase (new hierarchy): document ported key management features (EncryptWithEnvelopeAsync, DecryptWithEnvelopeAsync, RegisterKeyStore, GetKeyStore, GenerateDataEncryptionKeyAsync, GetEncryptionStatisticsAsync, LogCryptoOperationAsync)
- Update StoragePluginBase (new hierarchy): document ported opt-in features (ListAsync, EnumerateAsync, EnableCaching, InvalidateCacheAsync, InvalidateCacheRangeAsync, EnableIndexing, QueryIndexAsync)
- Update CompressionPluginBase (new hierarchy): note it now calls base.SelectOptimalAlgorithmAsync
- Update hierarchy diagram: remove 14 legacy bases, show clean v3.0 hierarchy only
- Update all plugin entries that were migrated from legacy bases to new hierarchy equivalents

Ensure the hierarchy diagrams, plugin entries, and architectural notes are accurate and current. The goal is that after this plan completes, the PLUGIN-CATALOG reflects ground truth — no codebase exploration needed.
</details>
<files>
- .planning/PLUGIN-CATALOG.md
</files>
<verify>
Read `.planning/PLUGIN-CATALOG.md` and verify:
- All 14 legacy base class entries removed
- New hierarchy bases (DataTransformationPluginBase, EncryptionPluginBase, StoragePluginBase) updated with ported features
- Hierarchy diagram shows only v3.0 hierarchy (no legacy bases)
- All migrated plugins reference new hierarchy bases
</verify>
<done>
PLUGIN-CATALOG.md updated: 14 legacy bases removed, v3.0 hierarchy documented with all ported features, hierarchy diagram cleaned
</done>
</task>

## Acceptance Criteria

### FIX-10: Common Implementations Migrated
- [ ] SelectOptimalAlgorithmAsync migrated from CompressionPluginBase and EncryptionPluginBase to DataTransformationPluginBase
- [ ] All other identified common implementations migrated to lowest common ancestors
- [ ] No duplication remains in leaf hierarchy classes

### FIX-12: Key Management Ported
- [ ] EncryptWithEnvelopeAsync and DecryptWithEnvelopeAsync ported to new EncryptionPluginBase
- [ ] Key store registry (RegisterKeyStore, GetKeyStore) ported
- [ ] DEK generation (GenerateDataEncryptionKeyAsync) ported
- [ ] Encryption statistics (GetEncryptionStatisticsAsync) ported
- [ ] Audit logging (LogCryptoOperationAsync) ported
- [ ] All features production-ready (Rule 13: no stubs)

### FIX-13: Storage Chain Features Ported
- [ ] Listing/enumeration (ListAsync, EnumerateAsync) ported to new StoragePluginBase
- [ ] Caching layer (EnableCaching, InvalidateCacheAsync) ported as opt-in
- [ ] Indexing (EnableIndexing, QueryIndexAsync) ported as opt-in
- [ ] All features production-ready (Rule 13: no stubs)

### FIX-11: Legacy Bases Deleted
- [ ] All 14 legacy base classes DELETED from PluginBase.cs
- [ ] PluginBase.cs file size reduced from ~3200 lines to ~1100 lines
- [ ] All plugins migrated to v3.0 hierarchy equivalents
- [ ] Zero references to legacy base classes in solution
- [ ] No [Obsolete] attributes, clean break

### Build & Quality
- [ ] Build passes: `dotnet build DataWarehouse.sln` → Success, 0 errors
- [ ] LSP diagnostics clean on all modified files
- [ ] No regressions introduced
- [ ] Verification report created confirming all 4 fixes complete

### Documentation
- [ ] DOC-21: PLUGIN-CATALOG.md updated to reflect all changes from this plan (14 legacy bases removed, v3.0 hierarchy documented with ported features)

## Risk Mitigation

1. **Plugin Compatibility**: Migration checklist ensures no plugin is broken during legacy base deletion
2. **Functionality Loss**: Extraction documents ensure all useful code is ported before deletion
3. **Build Errors**: Incremental LSP verification after each migration catches errors early
4. **Rule 13 Violations**: Extraction documents explicitly verify production-ready implementations (no stubs/placeholders)
5. **Incomplete Port**: Task dependencies ensure discovery → port → migration → deletion sequence is enforced

## Notes

- This is a CLEAN BREAK: no [Obsolete], no backward compat, DELETE the old code after porting
- FIX-10/12/13 must complete before FIX-11 deletion to prevent functionality loss
- All ported code must be production-ready (Rule 13) — no placeholders allowed
- Opt-in features (caching, indexing) give plugins fine-grained control over storage capabilities
- Wave 1, no dependencies on other Phase 41.1 plans
