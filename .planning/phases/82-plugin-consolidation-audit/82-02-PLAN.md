---
phase: 82-plugin-consolidation-audit
plan: 02
type: execute
wave: 2
depends_on: ["82-01"]
files_modified:
  - Plugins/**/*.cs
  - Plugins/**/*.csproj
  - DataWarehouse.slnx
autonomous: true

must_haves:
  truths:
    - "Every MergeCandidate plugin identified in AUDIT-REPORT.md has been merged into its target plugin"
    - "Strategies from merged plugins are discoverable by assembly scanning in the target plugin"
    - "Standalone plugin project directories for merged plugins are deleted"
    - "Solution file no longer references deleted projects"
    - "Solution builds with 0 errors and 0 warnings after all merges"
  artifacts:
    - path: "DataWarehouse.slnx"
      provides: "Updated solution file without merged plugin projects"
  key_links:
    - from: "Target plugin assemblies"
      to: "Migrated strategy classes"
      via: "Assembly scanning (DiscoverAndRegister)"
      pattern: "DiscoverAndRegister|RegisterStrategies"
---

<objective>
Execute all merges identified in the AUDIT-REPORT.md from Plan 82-01. For each MergeCandidate: move strategies to target plugin, update namespaces, remove standalone project, update solution file.

Purpose: Reduce codebase surface area by absorbing small/overlapping plugins into their natural home, following the same pattern used in Phase 65.5 consolidation.

Output: Leaner codebase with fewer projects, all strategies preserved in target plugins.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/82-plugin-consolidation-audit/82-01-SUMMARY.md
@.planning/phases/82-plugin-consolidation-audit/AUDIT-REPORT.md
@.planning/PLUGIN-CATALOG.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Execute merge migrations per AUDIT-REPORT.md</name>
  <files>Plugins/**/*.cs, Plugins/**/*.csproj, DataWarehouse.slnx</files>
  <action>
Read `.planning/phases/82-plugin-consolidation-audit/AUDIT-REPORT.md` to get the list of MergeCandidate plugins and their migration plans.

For EACH MergeCandidate, follow the Phase 65.5 consolidation pattern:

1. **Move strategy files** from source plugin to target plugin's `Strategies/` directory (or appropriate subdirectory). Preserve the directory structure from the source.

2. **Update namespaces** in all moved files:
   - Change `namespace DataWarehouse.Plugins.{SourcePlugin}...` to `namespace DataWarehouse.Plugins.{TargetPlugin}...`
   - Update any `using DataWarehouse.Plugins.{SourcePlugin}...` references across the entire solution

3. **Move non-strategy files** (orchestrators, helpers, models) to appropriate locations in the target plugin.

4. **Update the target plugin's registration** -- if the target uses assembly scanning (DiscoverAndRegister pattern), moved strategies will be auto-discovered. If manual registration, add entries.

5. **Update any message bus topic subscribers** that reference the old plugin namespace.

6. **Remove the source plugin project**:
   - Delete the entire `Plugins/DataWarehouse.Plugins.{SourcePlugin}/` directory
   - Remove the project reference from `DataWarehouse.slnx`
   - Remove any `<ProjectReference>` to the deleted project from other .csproj files

7. **Verify no dangling references** -- grep for the old plugin namespace across the solution.

IMPORTANT constraints:
- All strategies must be preserved -- no strategy deletion
- Assembly scanning (DiscoverAndRegister) is the dominant registration pattern (46/47 plugins use it)
- Plugins reference ONLY SDK via ProjectReference -- no direct plugin-to-plugin references
- All communication via message bus -- namespace changes do NOT affect message bus topics (topics are string-based)
- Build after EACH merge to catch issues early: `dotnet build DataWarehouse.slnx --no-restore`

If the audit found 0 merge candidates (all 8 are Standalone), document this finding and skip to verification.
  </action>
  <verify>
After all merges:
```bash
dotnet build DataWarehouse.slnx 2>&1 | tail -5
```
Must show "0 Error(s)" and "0 Warning(s)".

Also verify no dangling references:
```bash
grep -r "DataWarehouse.Plugins.{DeletedPlugin}" --include="*.cs" --include="*.csproj" Plugins/ DataWarehouse.SDK/ DataWarehouse.Shared/ DataWarehouse.Kernel/
```
Must return empty for each deleted plugin name.
  </verify>
  <done>All merge candidates absorbed into target plugins. Deleted projects removed from solution. Build passes with 0 errors, 0 warnings. No dangling references to deleted plugins. PLUG-04, PLUG-05 requirements addressed.</done>
</task>

<task type="auto">
  <name>Task 2: Update PLUGIN-CATALOG.md and plugin-to-base-mapping.md</name>
  <files>.planning/PLUGIN-CATALOG.md, memory/plugin-to-base-mapping.md</files>
  <action>
After all merges are complete:

1. **Update `.planning/PLUGIN-CATALOG.md`**:
   - Update the Master Summary table (total plugin count, strategy counts)
   - For each merged plugin, add a line in the "Phase 65.5 Plugin Consolidation" table (or create a new "Phase 82 Plugin Consolidation" table)
   - Update the target plugin entries to reflect absorbed strategies
   - Remove or mark as "MERGED" the standalone entries for deleted plugins

2. **Update `memory/plugin-to-base-mapping.md`**:
   - Remove entries for deleted plugins
   - Update target plugin entries if strategy counts changed

3. **Update the Phase 65.5/82 consolidation table format**:
```markdown
### Phase 82 Plugin Consolidation ({old_count} -> {new_count})

| Merged Plugin | Target Plugin | Strategies Migrated | Plan |
|---------------|---------------|---------------------|------|
| {source} | {target} | {description} | 82-02 |
```

If no merges were executed (all Standalone), update the catalog to document that all 8 non-Ultimate plugins have reviewed standalone justification.
  </action>
  <verify>
Read `.planning/PLUGIN-CATALOG.md` and verify:
- Plugin count in Master Summary matches actual directory count
- No references to deleted plugin names as active plugins
- Phase 82 consolidation table present (even if empty with "no merges needed" note)
  </verify>
  <done>PLUGIN-CATALOG.md and plugin-to-base-mapping.md reflect the post-merge state. Documentation is consistent with actual codebase.</done>
</task>

</tasks>

<verification>
- `dotnet build DataWarehouse.slnx` passes with 0 errors, 0 warnings
- No dangling references to any deleted plugin namespace
- PLUGIN-CATALOG.md plugin count matches actual `ls Plugins/` count
- All strategies from merged plugins are present in target plugins
</verification>

<success_criteria>
- All identified merges executed successfully
- Solution builds cleanly
- No orphaned references
- Documentation updated to reflect new plugin count
- PLUG-04 and PLUG-05 requirements satisfied
</success_criteria>

<output>
After completion, create `.planning/phases/82-plugin-consolidation-audit/82-02-SUMMARY.md`
</output>
