---
phase: 02-core-infrastructure
plan: 04
type: execute
wave: 2
depends_on: ["02-02"]
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateRAID/UltimateRaidPlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateRAID/Features/Monitoring.cs
  - Plugins/DataWarehouse.Plugins.UltimateRAID/Features/BadBlockRemapping.cs
  - Plugins/DataWarehouse.Plugins.UltimateRAID/Features/Snapshots.cs
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "UltimateRaidPlugin orchestrator manages strategy registry, configuration, message bus"
    - "Health monitoring collects real SMART data and calculates health scores"
    - "Self-healing detects degradation, manages hot spares, runs background rebuild"
    - "Scrubbing engine verifies data integrity in background"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateRAID/UltimateRaidPlugin.cs"
      provides: "Plugin orchestrator with array management and message bus"
    - path: "Plugins/DataWarehouse.Plugins.UltimateRAID/Features/Monitoring.cs"
      provides: "SMART integration and health monitoring"
    - path: "Plugins/DataWarehouse.Plugins.UltimateRAID/Features/BadBlockRemapping.cs"
      provides: "Self-healing and bad block management"
  key_links:
    - from: "UltimateRaidPlugin.cs"
      to: "MessageBus"
      via: "topic subscriptions for RAID operations"
      pattern: "MessageBus.*Subscribe|RaidTopics"
    - from: "Monitoring.cs"
      to: "SMART data"
      via: "health data collection"
      pattern: "SMART|SmartData|HealthScore"
---

<objective>
Verify and complete UltimateRAID plugin orchestration (T91.C) and health/self-healing features (T91.D).

Purpose: The orchestrator ties all RAID strategies together with configuration, message bus, and array management. Health monitoring and self-healing keep arrays operational.
Output: Verified plugin orchestrator, health monitoring, and self-healing. TODO.md updated for T91.C and T91.D.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-infrastructure/02-RESEARCH.md
@Metadata/Incomplete Tasks.txt
@Metadata/TODO.md
@.planning/phases/02-core-infrastructure/02-02-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify plugin orchestration (T91.C)</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateRAID/UltimateRaidPlugin.cs
    Plugins/DataWarehouse.Plugins.UltimateRAID/RaidStrategyRegistry.cs
    Plugins/DataWarehouse.Plugins.UltimateRAID/RaidTopics.cs
  </files>
  <action>
    Verify T91.C items from `Metadata/Incomplete Tasks.txt`:

    **91.C1 Plugin Core**:
    - 91.C1.1 UltimateRaidPlugin extends correct SDK base class
    - 91.C1.2 Configuration loading/saving with validation
    - 91.C1.3 Strategy registry with auto-discovery
    - 91.C1.4 Multi-instance support (multiple RAID profiles)
    - 91.C1.5 Message bus integration (RaidTopics subscriptions)
    - 91.C1.6 Knowledge registration with Intelligence plugin

    **91.C2 Array Operations**:
    - 91.C2.1 Array creation with validation
    - 91.C2.2 Array expansion (add drives)
    - 91.C2.3 Array shrinking (remove drives)
    - 91.C2.5 Drive replacement (hot-swap)

    **91.C3 I/O Engine**:
    - 91.C3.1 Stripe write engine with parity calculation
    - 91.C3.2 Stripe read engine with parity verification
    - 91.C3.3 Parity calculation (real GF(2^8) math)
    - 91.C3.4 Data reconstruction from degraded state
    - 91.C3.5 Write hole prevention

    For each: verify production-ready implementation. No NotImplementedException. Plugin must handle message bus payloads with proper validation (TryGetValue pattern from research).
  </action>
  <verify>
    Build: `dotnet build Plugins/DataWarehouse.Plugins.UltimateRAID/DataWarehouse.Plugins.UltimateRAID.csproj --no-restore`
    Grep for NotImplementedException in plugin core files
  </verify>
  <done>
    Plugin orchestrator, array operations, and I/O engine all verified production-ready with real implementations.
  </done>
</task>

<task type="auto">
  <name>Task 2: Verify health monitoring and self-healing (T91.D), update TODO.md</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateRAID/Features/Monitoring.cs
    Plugins/DataWarehouse.Plugins.UltimateRAID/Features/BadBlockRemapping.cs
    Plugins/DataWarehouse.Plugins.UltimateRAID/Features/Snapshots.cs
    Metadata/TODO.md
  </files>
  <action>
    Verify T91.D items:

    **91.D1 Health Monitoring**:
    - 91.D1.1 SMART integration (real data collection, conditional Windows/Linux)
    - 91.D1.2 Predictive failure (ML-based if Intelligence available, fallback to thresholds)
    - 91.D1.3 Health scoring (aggregate per drive/array)
    - 91.D1.4 Trend analysis (health trends over time)
    - 91.D1.5 Alert system (configurable alerts)

    **91.D2 Self-Healing**:
    - 91.D2.1 Auto-degradation detection
    - 91.D2.2 Hot spare management (auto-failover)
    - 91.D2.3 Background rebuild with I/O throttling
    - 91.D2.4 Scrubbing engine (background verification)
    - 91.D2.6 Bit-rot detection and correction

    **91.D3 Recovery**:
    - 91.D3.1 Rebuild orchestrator (multi-drive)
    - 91.D3.2 Resilver engine (ZFS-style)
    - 91.D3.3 Recovery priority (critical data first)
    - 91.D3.4 Partial array recovery

    Fix gaps. Update TODO.md for all T91.C and T91.D items.
    Build: `dotnet build DataWarehouse.slnx --no-restore`
  </action>
  <verify>
    Run: `dotnet build DataWarehouse.slnx --no-restore` -- must succeed
    T91.C and T91.D items updated in TODO.md
  </verify>
  <done>
    Health monitoring, self-healing, and recovery all verified production-ready. TODO.md updated for T91.C and T91.D.
  </done>
</task>

</tasks>

<verification>
- Plugin orchestrator handles all RAID operations via message bus
- Health monitoring collects SMART data (with platform-conditional code)
- Self-healing manages hot spares and background rebuild
- Solution builds cleanly
- TODO.md T91.C and T91.D items updated
</verification>

<success_criteria>
UltimateRAID plugin orchestration, health monitoring, and self-healing are production-ready. Array operations (create, expand, shrink, replace) work through message bus. T91.C and T91.D items reflect actual status in TODO.md.
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-infrastructure/02-04-SUMMARY.md`
</output>
