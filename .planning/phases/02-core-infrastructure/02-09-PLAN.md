---
phase: 02-core-infrastructure
plan: 09
type: execute
wave: 2
depends_on: ["02-08"]
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/BrotliStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/Bzip2Strategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/BwtStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/MtfStrategy.cs
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "Brotli strategy compresses and decompresses using .NET BrotliStream with configurable quality levels"
    - "Bzip2 strategy applies BWT + MTF + Huffman pipeline for real compression"
    - "BWT strategy performs a correct Burrows-Wheeler Transform (sort all rotations, extract last column) and its inverse"
    - "MTF strategy performs real Move-to-Front encoding that improves compressibility of BWT output"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/BrotliStrategy.cs"
      provides: "Brotli compression using System.IO.Compression.BrotliStream"
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/Bzip2Strategy.cs"
      provides: "Bzip2 compression using BWT + Huffman"
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/BwtStrategy.cs"
      provides: "Burrows-Wheeler Transform"
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/MtfStrategy.cs"
      provides: "Move-to-Front encoding"
  key_links:
    - from: "BrotliStrategy.cs"
      to: "System.IO.Compression"
      via: "BrotliStream"
      pattern: "BrotliStream|BrotliEncoder"
    - from: "All Transform strategies"
      to: "CompressionStrategyBase"
      via: "class inheritance"
      pattern: "CompressionStrategyBase"
---

<objective>
Verify and complete UltimateCompression BWT-based / transform strategies (T92.B3).

Purpose: BWT-based algorithms (Brotli, Bzip2) add high-ratio compression options. BWT and MTF are transform-only strategies used as pre-processing stages to improve compressibility.
Output: Verified 4 BWT/transform strategies. TODO.md updated for T92.B3.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-infrastructure/02-RESEARCH.md
@Metadata/Incomplete Tasks.txt
@Metadata/TODO.md
@.planning/phases/02-core-infrastructure/02-08-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify BWT-based strategies</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/BrotliStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/Bzip2Strategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/BwtStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/MtfStrategy.cs
  </files>
  <action>
    Verify T92.B3 (BWT-based):
    - B3.1 BrotliStrategy -- uses System.IO.Compression.BrotliStream
    - B3.2 Bzip2Strategy -- BWT + Huffman (SharpCompress or hand-written)
    - B3.3 BwtStrategy -- Burrows-Wheeler Transform only
    - B3.4 MtfStrategy -- Move-to-Front encoding

    For each: verify inherits CompressionStrategyBase, has real algorithm, no placeholder.

    Brotli should use the built-in .NET BrotliStream for production quality.
    BWT and MTF are transform-only strategies (typically used as pre-processing stages).
    Bzip2 should combine BWT + MTF + Huffman for real bzip2-equivalent compression.

    For EACH file: grep for NotImplementedException, "TODO:", "placeholder", "simulation", "mock", "stub". Any found = fix immediately.
  </action>
  <verify>
    Build: `dotnet build Plugins/DataWarehouse.Plugins.UltimateCompression/DataWarehouse.Plugins.UltimateCompression.csproj --no-restore`
    Grep for NotImplementedException in Transform strategy files
  </verify>
  <done>
    All 4 BWT/transform strategies verified with real algorithm implementations.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix gaps and update TODO.md for T92.B3</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/Transform/*.cs
    Metadata/TODO.md
  </files>
  <action>
    Based on Task 1 findings:

    1. **Fix any gaps found**: Implement missing or incomplete algorithms following patterns from 02-RESEARCH.md.

    2. **Verify AI fallback for compression selection**: If UltimateCompressionPlugin uses Intelligence for content-aware selection (T92.C7), verify it checks `IsIntelligenceAvailable` and falls back to entropy-based selection. Specifically:
       - Every method calling Intelligence has an `if (!IsIntelligenceAvailable)` guard
       - Fallback returns a valid algorithm selection (not null)
       - No exception thrown when Intelligence is unavailable

    3. **Update TODO.md**: Mark all verified T92.B3 items as `[x]`.

    4. **Build full solution**: `dotnet build DataWarehouse.slnx --no-restore`
  </action>
  <verify>
    Run: `dotnet build DataWarehouse.slnx --no-restore` -- must succeed
    T92.B3 items updated in TODO.md
    If Intelligence integration exists, grep for IsIntelligenceAvailable to confirm fallback guards
  </verify>
  <done>
    BWT/transform strategies verified complete. AI fallback for compression selection verified (if applicable). TODO.md updated for T92.B3.
  </done>
</task>

</tasks>

<verification>
- All 4 BWT/transform strategies inherit CompressionStrategyBase
- Brotli uses System.IO.Compression.BrotliStream
- BWT implements real rotation-sort algorithm
- MTF implements real move-to-front encoding
- If Intelligence integration exists, fallback guards verified
- Solution builds cleanly
</verification>

<success_criteria>
All 4 BWT/transform strategies are production-ready. Brotli uses .NET BrotliStream. BWT and MTF implement correct transform algorithms. AI-based compression selection (if present) degrades gracefully without Intelligence plugin.
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-infrastructure/02-09-SUMMARY.md`
</output>
