---
phase: 02-core-infrastructure
plan: 08
type: execute
wave: 1
depends_on: []
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateCompression/UltimateCompressionPlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/*.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompression/DataWarehouse.Plugins.UltimateCompression.csproj
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "UltimateCompression plugin discovers and registers all compression strategies at startup"
    - "Content-aware algorithm selection picks the best strategy based on data entropy and type"
    - "Each LZ-family strategy (Zstd, LZ4, GZip, Deflate, Snappy, LZO, LZ77, LZ78, LZMA, LZMA2, LZFSE, LZH, LZX) can compress and decompress a byte array round-trip without data loss"
    - "Strategies using NuGet libraries (Zstd, LZ4, Snappy) have those packages in .csproj"
    - "Hand-written algorithms (LZ77, LZ78, LZO, LZFSE, LZH, LZX) implement real sliding-window or dictionary-based compression"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompression/UltimateCompressionPlugin.cs"
      provides: "Plugin orchestrator with strategy registry"
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/ZstdStrategy.cs"
      provides: "Zstandard compression using ZstdSharp.Port"
    - path: "Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/Lz4Strategy.cs"
      provides: "LZ4 compression using K4os.Compression.LZ4"
  key_links:
    - from: "UltimateCompressionPlugin.cs"
      to: "CompressionStrategyBase strategies"
      via: "strategy auto-discovery"
      pattern: "DiscoverStrategies|Assembly.*GetTypes"
    - from: "ZstdStrategy.cs"
      to: "ZstdSharp"
      via: "NuGet package"
      pattern: "ZstdSharp|CompressionStream"
    - from: "Lz4Strategy.cs"
      to: "K4os.Compression.LZ4"
      via: "NuGet package"
      pattern: "LZ4Pickler|LZ4Level"
---

<objective>
Verify and complete UltimateCompression plugin orchestrator (T92.B1) and LZ-family strategies (T92.B2).

Purpose: The compression plugin is a fundamental data transformation. LZ-family algorithms (Zstd, LZ4, GZip, etc.) cover the most common compression needs and form the foundation for all other compression strategies.
Output: Verified plugin orchestrator with 13 LZ-family compression strategies. TODO.md updated for T92.B1-B2.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-infrastructure/02-RESEARCH.md
@Metadata/Incomplete Tasks.txt
@Metadata/TODO.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify plugin orchestrator and LZ-family strategies</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateCompression/UltimateCompressionPlugin.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/DataWarehouse.Plugins.UltimateCompression.csproj
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/ZstdStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/Lz4Strategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/GZipStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/DeflateStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/SnappyStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/LzoStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/Lz77Strategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/Lz78Strategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/LzmaStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/Lzma2Strategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/LzfseStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/LzhStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/LzxStrategy.cs
  </files>
  <action>
    Verify T92.B1 (Plugin) and T92.B2 (LZ-family):

    **B1 Plugin Orchestrator**:
    - B1.1 Project exists (confirmed)
    - B1.2 UltimateCompressionPlugin orchestrator -- verify extends correct base, has strategy registry
    - B1.3 Strategy auto-discovery and registration
    - B1.4 Content-aware algorithm selection (uses entropy/magic byte detection from base)
    - B1.5 Parallel multi-algorithm compression

    **B2 LZ-Family** (13 strategies):
    - B2.1 ZstdStrategy -- uses ZstdSharp.Port for real Zstandard compression
    - B2.2 Lz4Strategy -- uses K4os.Compression.LZ4 for real LZ4
    - B2.3 GZipStrategy -- uses System.IO.Compression.GZipStream
    - B2.4 DeflateStrategy -- uses System.IO.Compression.DeflateStream
    - B2.5 SnappyStrategy -- uses Snappier for real Snappy
    - B2.6 LzoStrategy -- LZO compression implementation
    - B2.7 Lz77Strategy -- sliding window implementation
    - B2.8 Lz78Strategy -- dictionary-based implementation
    - B2.9 LzmaStrategy -- uses SharpCompress or similar
    - B2.10 Lzma2Strategy -- multi-threaded LZMA2
    - B2.11 LzfseStrategy -- Apple LZFSE
    - B2.12 LzhStrategy -- LHarc/LZH
    - B2.13 LzxStrategy -- Microsoft LZX

    For each strategy verify:
    1. Inherits from CompressionStrategyBase
    2. Implements CompressCore/DecompressCore with real algorithms (library calls or hand-written)
    3. Has CompressionCharacteristics with accurate metadata
    4. No NotImplementedException or placeholder
    5. Thread-safe (uses base class locking)

    For strategies using external libraries (Zstd, LZ4, Snappy, LZMA), verify the NuGet packages are in .csproj.
    For strategies implementing algorithms directly (LZ77, LZ78, LZO, LZFSE, LZH, LZX), verify the algorithm is real and complete.
  </action>
  <verify>
    Build: `dotnet build Plugins/DataWarehouse.Plugins.UltimateCompression/DataWarehouse.Plugins.UltimateCompression.csproj --no-restore`
    Grep for NotImplementedException in all LzFamily strategies
  </verify>
  <done>
    Plugin orchestrator and all 13 LZ-family strategies verified production-ready with real compression implementations.
  </done>
</task>

<task type="auto">
  <name>Task 2: Fix gaps and update TODO.md for T92.B1 and T92.B2</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateCompression/UltimateCompressionPlugin.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/Strategies/LzFamily/*.cs
    Metadata/TODO.md
  </files>
  <action>
    Based on Task 1 findings:

    1. **Fix any gaps found**: Implement missing strategies or fix incomplete implementations. Follow patterns from 02-RESEARCH.md.

    2. **Verify plugin isolation**: .csproj must reference ONLY DataWarehouse.SDK. No other plugin references.

    3. **Update TODO.md**: Mark all verified T92.B1 and T92.B2 items as `[x]`. Leave B3 (BWT) items for plan 02-09.

    4. **Build full solution**: `dotnet build DataWarehouse.slnx --no-restore`
  </action>
  <verify>
    Run: `dotnet build DataWarehouse.slnx --no-restore` -- must succeed
    T92.B1 and B2 items updated in TODO.md
  </verify>
  <done>
    Plugin orchestrator and 13 LZ-family strategies verified complete. TODO.md updated for T92.B1-B2. Solution builds cleanly.
  </done>
</task>

</tasks>

<verification>
- All 13 LZ-family strategies inherit CompressionStrategyBase
- Zstd/LZ4/Snappy use NuGet packages (verified in .csproj)
- GZip/Deflate use System.IO.Compression
- Hand-written algorithms (LZ77, LZ78, LZO, LZFSE, LZH, LZX) are complete
- Plugin references only DataWarehouse.SDK
- Solution builds cleanly
</verification>

<success_criteria>
UltimateCompression plugin orchestrator and 13 LZ-family compression strategies are production-ready. Each strategy provides real compression/decompression. TODO.md reflects actual status for T92.B1-B2.
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-infrastructure/02-08-SUMMARY.md`
</output>
