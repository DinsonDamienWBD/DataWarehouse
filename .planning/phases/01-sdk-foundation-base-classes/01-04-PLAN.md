---
phase: 01-sdk-foundation-base-classes
plan: 04
type: tdd
wave: 2
depends_on: ["01-01", "01-02", "01-03"]
files_modified:
  - DataWarehouse.Tests/Infrastructure/SdkSecurityStrategyTests.cs
  - DataWarehouse.Tests/Infrastructure/SdkComplianceStrategyTests.cs
  - DataWarehouse.Tests/Infrastructure/SdkObservabilityStrategyTests.cs
  - DataWarehouse.Tests/Infrastructure/SdkInterfaceStrategyTests.cs
  - DataWarehouse.Tests/Infrastructure/SdkDataFormatStrategyTests.cs
  - DataWarehouse.Tests/Infrastructure/SdkStreamingStrategyTests.cs
  - DataWarehouse.Tests/Infrastructure/SdkMediaStrategyTests.cs
  - DataWarehouse.Tests/Infrastructure/SdkProcessingStrategyTests.cs
  - DataWarehouse.Tests/Infrastructure/SdkStorageStrategyTests.cs
  - Metadata/TODO.md
autonomous: true
must_haves:
  truths:
    - "Unit tests exist for SDK security infrastructure covering ISecurityStrategy, SecurityDomain, SecurityContext, SecurityDecision, ZeroTrust, threat detection, integrity verification"
    - "Unit tests exist for SDK compliance infrastructure covering IComplianceStrategy and supporting types"
    - "Unit tests exist for SDK observability, interface, format, streaming, media, and processing infrastructure"
    - "All unit tests pass when run via dotnet test"
    - "Tests verify type construction, required properties, serialization round-trip, and capabilities"
  artifacts:
    - path: "DataWarehouse.Tests/Infrastructure/SdkSecurityStrategyTests.cs"
      provides: "Unit tests for T95.A8 — SDK security infrastructure"
      contains: "SecurityStrategyTests"
    - path: "DataWarehouse.Tests/Infrastructure/SdkComplianceStrategyTests.cs"
      provides: "Unit tests for T96.A6 — SDK compliance infrastructure"
      contains: "ComplianceStrategyTests"
    - path: "DataWarehouse.Tests/Infrastructure/SdkObservabilityStrategyTests.cs"
      provides: "Unit tests for T100.A6 — SDK observability infrastructure"
      contains: "ObservabilityStrategyTests"
    - path: "DataWarehouse.Tests/Infrastructure/SdkInterfaceStrategyTests.cs"
      provides: "Unit tests for T109.A6 — SDK interface infrastructure"
      contains: "InterfaceStrategyTests"
    - path: "DataWarehouse.Tests/Infrastructure/SdkDataFormatStrategyTests.cs"
      provides: "Unit tests for T110.A7 — SDK format infrastructure"
      contains: "DataFormatStrategyTests"
    - path: "DataWarehouse.Tests/Infrastructure/SdkStreamingStrategyTests.cs"
      provides: "Unit tests for T113.A7 — SDK streaming infrastructure"
      contains: "StreamingStrategyTests"
    - path: "DataWarehouse.Tests/Infrastructure/SdkMediaStrategyTests.cs"
      provides: "Unit tests for T118.A7 — SDK media infrastructure"
      contains: "MediaStrategyTests"
    - path: "DataWarehouse.Tests/Infrastructure/SdkProcessingStrategyTests.cs"
      provides: "Unit tests for T112.A6 — SDK processing infrastructure"
      contains: "ProcessingStrategyTests"
    - path: "DataWarehouse.Tests/Infrastructure/SdkStorageStrategyTests.cs"
      provides: "Unit tests for T97.A6 — SDK storage infrastructure"
      contains: "StorageStrategyTests"
  key_links:
    - from: "DataWarehouse.Tests/Infrastructure/Sdk*Tests.cs"
      to: "DataWarehouse.SDK/Contracts/*/Strategy.cs"
      via: "Tests reference SDK types directly"
      pattern: "using DataWarehouse.SDK"
---

<objective>
Write missing unit tests for ALL SDK infrastructure domains: security (T95.A8), compliance (T96.A6), observability (T100.A6), interface (T109.A6), format (T110.A7), streaming (T113.A7), media (T118.A7), processing (T112.A6), and storage (T97.A6).

Purpose: Research confirmed these unit test files are missing. Without them, SDK refactoring is risky and the Phase A items cannot be marked complete. This plan creates comprehensive unit tests for all SDK strategy infrastructure types.

Output: 9 new test files covering all SDK domains, all tests passing.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/01-sdk-foundation-base-classes/01-RESEARCH.md
@.planning/phases/01-sdk-foundation-base-classes/01-01-SUMMARY.md
@.planning/phases/01-sdk-foundation-base-classes/01-02-SUMMARY.md
@.planning/phases/01-sdk-foundation-base-classes/01-03-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Write unit tests for security, compliance, and observability SDK infrastructure (T95.A8, T96.A6, T100.A6)</name>
  <files>
    DataWarehouse.Tests/Infrastructure/SdkSecurityStrategyTests.cs
    DataWarehouse.Tests/Infrastructure/SdkComplianceStrategyTests.cs
    DataWarehouse.Tests/Infrastructure/SdkObservabilityStrategyTests.cs
    Metadata/TODO.md
  </files>
  <action>
    First, read existing test patterns from `DataWarehouse.Tests/Infrastructure/SdkInfrastructureTests.cs` to follow conventions (imports, test class structure, naming conventions, test framework usage).

    Then read the SDK files from Plans 01-02, 01-03 (the actual source types) to understand what to test.

    **SdkSecurityStrategyTests.cs (T95.A8):**
    Create test class with tests covering:
    1. SecurityDomain enum — verify all expected values exist (AccessControl, DataProtection, Network, Identity, Compliance, ThreatDetection, IntegrityVerification, ZeroTrust)
    2. SecurityContext — verify construction with required fields (UserId, ResourceId, Action), verify optional fields work
    3. SecurityDecision — verify construction, verify Allowed/Domain/Reason/PolicyId properties, test JSON serialization round-trip
    4. ZeroTrust types — verify policy creation, evaluation result construction
    5. Threat detection types — verify ThreatIndicator construction, ThreatSeverity values
    6. Integrity verification types — verify IntegrityResult construction, violation tracking
    7. SecurityCapabilities — verify capability flags
    8. ISecurityStrategy interface — verify it defines EvaluateAsync method (reflection test)

    **SdkComplianceStrategyTests.cs (T96.A6):**
    Create test class with tests covering:
    1. IComplianceStrategy interface — verify method signatures via reflection
    2. ComplianceRequirements — verify construction and properties
    3. ComplianceReport — verify construction with Status, Findings, Score
    4. ComplianceViolation — verify Severity values, Description, Remediation
    5. ComplianceEvidence — verify Type, Source, Data
    6. ComplianceCapabilities — verify capability flags
    7. JSON serialization round-trip for key types

    **SdkObservabilityStrategyTests.cs (T100.A6):**
    Create test class with tests covering:
    1. IObservabilityStrategy interface — verify method signatures via reflection
    2. Metric types — verify counter, gauge, histogram types
    3. Trace types — verify TraceContext, SpanContext
    4. Alert types — verify AlertRule, AlertCondition
    5. ObservabilityCapabilities — verify flags (SupportsMetrics, SupportsTracing, SupportsAlerting)
    6. ObservabilityStrategyBase — verify it exists and provides base implementation
    7. JSON serialization round-trip for metric/trace types

    Use xUnit with [Fact] and [Theory] attributes. Use System.Text.Json for serialization tests.
    Mark T95.A8, T96.A6, T100.A6 as [x] in TODO.md after tests pass.
  </action>
  <verify>
    Run `dotnet test DataWarehouse.Tests/DataWarehouse.Tests.csproj --filter "FullyQualifiedName~SdkSecurity|FullyQualifiedName~SdkCompliance|FullyQualifiedName~SdkObservability"` — all tests pass.
    Verify each test file has at least 5 test methods.
  </verify>
  <done>
    Unit tests for security (T95.A8), compliance (T96.A6), and observability (T100.A6) SDK infrastructure are written and passing. Each test file covers type construction, required properties, serialization, and capabilities. TODO.md updated.
  </done>
</task>

<task type="auto">
  <name>Task 2: Write unit tests for interface, format, streaming, media, processing, storage SDK infrastructure (T109.A6, T110.A7, T113.A7, T118.A7, T112.A6, T97.A6)</name>
  <files>
    DataWarehouse.Tests/Infrastructure/SdkInterfaceStrategyTests.cs
    DataWarehouse.Tests/Infrastructure/SdkDataFormatStrategyTests.cs
    DataWarehouse.Tests/Infrastructure/SdkStreamingStrategyTests.cs
    DataWarehouse.Tests/Infrastructure/SdkMediaStrategyTests.cs
    DataWarehouse.Tests/Infrastructure/SdkProcessingStrategyTests.cs
    DataWarehouse.Tests/Infrastructure/SdkStorageStrategyTests.cs
    Metadata/TODO.md
  </files>
  <action>
    Continue using the same test patterns from Task 1.

    **SdkInterfaceStrategyTests.cs (T109.A6):**
    1. IInterfaceStrategy interface — verify method signatures via reflection
    2. InterfaceProtocol enum/types — verify expected protocol identifiers
    3. InterfaceRequest/InterfaceResponse — verify construction and properties
    4. InterfaceEndpoint — verify configuration type
    5. InterfaceCapabilities — verify SupportedProtocols, SupportsStreaming
    6. JSON serialization round-trip

    **SdkDataFormatStrategyTests.cs (T110.A7):**
    1. IDataFormatStrategy interface — verify method signatures
    2. DataFormat identifiers/enum — verify expected formats (JSON, CSV, Parquet, etc.)
    3. FormatMetadata — verify construction
    4. FormatDetectionResult — verify confidence scoring
    5. DataFormatCapabilities — verify SupportedFormats
    6. JSON serialization round-trip

    **SdkStreamingStrategyTests.cs (T113.A7):**
    1. IStreamingStrategy interface — verify method signatures
    2. StreamingProtocol types — verify Kafka, RabbitMQ, MQTT, etc.
    3. StreamMessage/StreamRecord — verify construction
    4. StreamingConfiguration — verify topic, partition, offset
    5. StreamingCapabilities — verify flags
    6. JSON serialization round-trip

    **SdkMediaStrategyTests.cs (T118.A7):**
    1. IMediaStrategy interface — verify method signatures
    2. MediaType enum — verify Video, Audio, Image, etc.
    3. MediaCodec — verify codec identifiers
    4. MediaProcessingResult — verify construction
    5. MediaCapabilities — verify SupportedCodecs, SupportsGPU
    6. JSON serialization round-trip

    **SdkProcessingStrategyTests.cs (T112.A6):**
    1. IStorageProcessingStrategy interface — verify method signatures
    2. ProcessingJob — verify construction and status tracking
    3. ProcessingResult — verify construction
    4. ProcessingCapabilities — verify SupportedOperations
    5. JSON serialization round-trip

    **SdkStorageStrategyTests.cs (T97.A6):**
    1. IStorageStrategy interface — verify method signatures
    2. StorageCapabilities — verify flags (SupportsVersioning, SupportsTiering, etc.)
    3. Storage configuration types — verify construction
    4. JSON serialization round-trip

    Each test file: at least 4 test methods using xUnit [Fact]/[Theory].
    Mark T109.A6, T110.A7, T113.A7, T118.A7, T112.A6, T97.A6 as [x] in TODO.md.
    Also mark T111.A7 (compute) if compute types are tested alongside.
  </action>
  <verify>
    Run `dotnet test DataWarehouse.Tests/DataWarehouse.Tests.csproj --filter "FullyQualifiedName~SdkInterface|FullyQualifiedName~SdkDataFormat|FullyQualifiedName~SdkStreaming|FullyQualifiedName~SdkMedia|FullyQualifiedName~SdkProcessing|FullyQualifiedName~SdkStorage"` — all tests pass.
    Verify each test file has at least 4 test methods.
  </verify>
  <done>
    Unit tests for interface (T109.A6), format (T110.A7), streaming (T113.A7), media (T118.A7), processing (T112.A6), and storage (T97.A6) are written and passing. Each test file covers type construction, required properties, serialization, and capabilities. TODO.md updated for all unit test sub-tasks.
  </done>
</task>

</tasks>

<verification>
1. `dotnet test DataWarehouse.Tests/DataWarehouse.Tests.csproj` — all tests pass (both new and existing)
2. 9 new test files exist in DataWarehouse.Tests/Infrastructure/
3. Each test file has 4+ test methods
4. Tests cover: type construction, required properties, JSON serialization round-trip, capability flags
5. No test uses mocks or stubs (tests verify SDK types directly)
6. TODO.md updated for all unit test sub-tasks: T95.A8, T96.A6, T97.A6, T100.A6, T109.A6, T110.A7, T112.A6, T113.A7, T118.A7
</verification>

<success_criteria>
- All 9 test files created and compiling
- All unit tests pass
- Coverage includes all SDK infrastructure domains
- TODO.md unit test sub-tasks marked [x]
- Existing tests still pass (no regressions)
</success_criteria>

<output>
After completion, create `.planning/phases/01-sdk-foundation-base-classes/01-04-SUMMARY.md`
</output>
