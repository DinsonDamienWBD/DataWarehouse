---
phase: 09-advanced-security
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - DataWarehouse.Tests/Security/SteganographyStrategyTests.cs
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Steganography/SteganographyStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Steganography/ShardDistributionStrategy.cs
autonomous: true

must_haves:
  truths:
    - "Data can be hidden in image carriers (PNG/BMP) using LSB embedding with encryption"
    - "Data can be hidden in text carriers using whitespace encoding"
    - "Hidden data can be extracted and decrypted from carriers"
    - "Capacity estimation prevents embedding more data than carrier can hold"
    - "Shard distribution embeds multiple shards across carriers with threshold recovery"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Steganography/SteganographyStrategy.cs"
      provides: "LSB image and text steganography implementation"
      min_lines: 400
    - path: "Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Steganography/ShardDistributionStrategy.cs"
      provides: "Shard distribution across multiple carriers"
      min_lines: 200
    - path: "DataWarehouse.Tests/Security/SteganographyStrategyTests.cs"
      provides: "Test suite covering embedding, extraction, capacity, sharding"
      min_lines: 300
  key_links:
    - from: "SteganographyStrategy.cs"
      to: "AccessControlStrategyBase"
      via: "inheritance"
      pattern: "class SteganographyStrategy : AccessControlStrategyBase"
    - from: "ShardDistributionStrategy.cs"
      to: "SteganographyStrategy"
      via: "uses for embedding"
      pattern: "HideInImage\\|HideInText"
---

<objective>
Verify and test the steganographic sharding implementation (T74). SteganographyStrategy.cs implements LSB image embedding and text whitespace encoding. ShardDistributionStrategy.cs handles multi-carrier shard distribution. Create comprehensive test suite validating all embedding/extraction modes.

Purpose: Confirm covert data hiding and shard distribution work for secure communication
Output: Complete test suite validating all T74 requirements
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/09-advanced-security/09-RESEARCH.md

# Existing implementations
@Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Steganography/SteganographyStrategy.cs
@Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Steganography/ShardDistributionStrategy.cs

# SDK contracts
@DataWarehouse.SDK/Security/AccessControlStrategyBase.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Verify steganography implementation completeness</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Steganography/SteganographyStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Steganography/ShardDistributionStrategy.cs
  </files>
  <action>
    Read both strategy files and verify T74 sub-tasks:

    **SteganographyStrategy.cs:**
    - T74.1: LSB embedding in images (HideInImage with PNG/BMP support)
    - T74.2: Text steganography (HideInText with whitespace encoding)
    - T74.5: Capacity estimation (EstimateCapacity method)
    - T74.6: Encryption support (PrepareDataForHiding with AES-GCM)
    - Header format: STEG magic + length + checksum
    - FindImageDataOffset to skip PNG/BMP headers
    - ExtractFromImage and ExtractFromText for recovery

    **ShardDistributionStrategy.cs:**
    - T74.7: Shard distribution across multiple carriers
    - Threshold sharing integration (uses Shamir or erasure coding)
    - Multi-carrier embedding coordination

    Research notes T74.3 (audio) and T74.4 (video) as "verify audio/video/DCT" items. Check if DCT frequency-domain embedding exists for JPEG. If not, document as gap for completion in Task 2.

    Verify build passes with zero errors.
  </action>
  <verify>
    Grep for "HideInImage", "HideInText", "ExtractFromImage", "ExtractFromText", "EstimateCapacity" confirms all methods exist. Grep for "NotImplementedException" returns zero in both files. Build passes with zero errors.
  </verify>
  <done>
    All T74 LSB and text steganography methods exist with real implementations. Shard distribution strategy confirmed. Audio/video/DCT status documented (if gaps exist, mark for Task 2 completion). Build passes.
  </done>
</task>

<task type="auto">
  <name>Task 2: Create steganography test suite and complete any gaps</name>
  <files>
    DataWarehouse.Tests/Security/SteganographyStrategyTests.cs
    Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Steganography/SteganographyStrategy.cs
  </files>
  <action>
    **Step 1: Complete any identified gaps** (if audio/video/DCT incomplete per Task 1 verification):

    If HideInAudio/ExtractFromAudio methods missing, add basic audio LSB embedding:
    - WAV format LSB embedding in audio samples
    - Skip WAV header, embed in PCM sample LSBs
    - Similar pattern to image embedding

    If HideInVideo/ExtractFromVideo methods missing, add basic video frame embedding:
    - Extract video frames, embed in keyframes using LSB
    - Basic H.264/MPEG frame extraction and LSB embedding

    If DCT frequency-domain embedding missing, add JPEG DCT embedding:
    - DCT coefficient modification for JPEG images
    - Frequency-domain steganography more robust than spatial LSB

    **Step 2: Create comprehensive test suite:**

    **T74.1 Image LSB tests:**
    - HideInImage embeds data in PNG carrier with encryption
    - ExtractFromImage recovers original data byte-for-byte
    - Header validation (STEG magic, length, checksum)
    - Carrier too small throws InvalidOperationException
    - Alpha channel skipped in RGBA images

    **T74.2 Text steganography tests:**
    - HideInText embeds data using whitespace encoding
    - ExtractFromText recovers original data
    - Text steganography preserves visible text

    **T74.3 Audio tests** (if implemented in Step 1):
    - HideInAudio embeds in WAV PCM samples
    - ExtractFromAudio recovers data

    **T74.4 Video tests** (if implemented in Step 1):
    - HideInVideo embeds in video keyframes
    - ExtractFromVideo recovers data

    **T74.5 Capacity tests:**
    - EstimateCapacity returns accurate capacity for carriers
    - Embedding respects capacity limits

    **T74.6 Encryption tests:**
    - Encryption enabled by default, data encrypted before embedding
    - Decryption during extraction recovers plaintext

    **T74.7 Shard distribution tests:**
    - ShardDistributionStrategy distributes shards across multiple carriers
    - Threshold recovery works with subset of carriers

    Use synthetic test images (create small PNG/BMP in memory), synthetic text, synthetic audio/video if needed. No external file dependencies.
  </action>
  <verify>
    `dotnet build Plugins/DataWarehouse.Plugins.UltimateAccessControl/DataWarehouse.Plugins.UltimateAccessControl.csproj --no-restore` passes with zero errors.

    `dotnet test DataWarehouse.Tests/DataWarehouse.Tests.csproj --filter FullyQualifiedName~SteganographyStrategyTests` passes with 100% success rate.

    Grep confirms audio/video methods exist (if gaps were filled) or test suite marks them as "not yet implemented" (if deferred).
  </verify>
  <done>
    SteganographyStrategyTests.cs exists with comprehensive tests for LSB image, text, audio (if implemented), video (if implemented), capacity, encryption, shard distribution. All tests pass. Build succeeds. Audio/video/DCT status clear (either implemented or documented as future work).
  </done>
</task>

</tasks>

<verification>
Build verification:
```bash
dotnet build Plugins/DataWarehouse.Plugins.UltimateAccessControl/DataWarehouse.Plugins.UltimateAccessControl.csproj --no-restore
```

Test execution:
```bash
dotnet test DataWarehouse.Tests/DataWarehouse.Tests.csproj --filter FullyQualifiedName~SteganographyStrategyTests --no-build
```

Implementation check:
```bash
grep -c "HideInImage\|HideInText\|ExtractFromImage\|ExtractFromText\|EstimateCapacity" Plugins/DataWarehouse.Plugins.UltimateAccessControl/Strategies/Steganography/SteganographyStrategy.cs
# Should return 5+ (one per method)
```
</verification>

<success_criteria>
1. SteganographyStrategy.cs and ShardDistributionStrategy.cs verified complete for LSB and text steganography
2. Audio/video/DCT gaps identified and either completed or documented
3. SteganographyStrategyTests.cs created with comprehensive test coverage
4. All tests pass with 100% success rate
5. Build succeeds with zero errors
6. Test coverage validates: image LSB, text whitespace, capacity estimation, encryption, shard distribution
</success_criteria>

<output>
After completion, create `.planning/phases/09-advanced-security/09-02-SUMMARY.md`
</output>
