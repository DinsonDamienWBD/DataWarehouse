---
phase: 65.5-production-readiness
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateDataTransit/UltimateDataTransitPlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateFilesystem/UltimateFilesystemPlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateReplication/UltimateReplicationPlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateDatabaseStorage/UltimateDatabaseStoragePlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataLake/UltimateDataLakePlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateStorageProcessing/UltimateStorageProcessingPlugin.cs
autonomous: true

must_haves:
  truths:
    - "All 6 plugins use OnStartCoreAsync/OnStopCoreAsync (not direct StartAsync/StopAsync overrides)"
    - "UltimateReplication persists node identity via SaveStateAsync"
    - "UltimateDatabaseStorage calls base.OnHandshakeAsync in OnHandshakeAsync"
    - "UltimateDataLake has SaveStateAsync/LoadStateAsync for catalog/lineage/policies"
    - "UltimateStorageProcessing does not double-count errors"
    - "All 6 plugins compile with zero errors"
---

<objective>
Fix lifecycle bypasses in 6 DataPipeline-branch plugins. Each plugin must use the proper SDK lifecycle hooks (OnStartCoreAsync/OnStopCoreAsync) instead of directly overriding StartAsync/StopAsync.

1. **UltimateDataTransit**: Replace direct StartAsync/StopAsync overrides with OnStartCoreAsync/OnStopCoreAsync, call base methods
2. **UltimateFilesystem**: Same fix — replace no-op StartAsync/StopAsync
3. **UltimateReplication**: Fix _nodeId regeneration — persist node identity via SaveStateAsync
4. **UltimateDatabaseStorage**: Fix OnHandshakeAsync to call base.OnHandshakeAsync(request)
5. **UltimateDataLake**: Add SaveStateAsync/LoadStateAsync for catalog, lineage, policies
6. **UltimateStorageProcessing**: Fix error-path double-counting in ProcessAsync stats
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/phases/65.5-production-readiness-plan.md
@.planning/PLUGIN-CATALOG.md
</context>

<tasks>
<task type="auto">
  <name>Task 1: Fix lifecycle bypasses in 6 DataPipeline plugins</name>
  <action>
    For each of the 6 plugins listed:
    1. Read the current plugin main file
    2. Identify lifecycle bypass patterns (direct StartAsync/StopAsync overrides, missing base calls)
    3. Replace with proper OnStartCoreAsync/OnStopCoreAsync pattern
    4. For UltimateReplication: persist _nodeId via SaveStateAsync/LoadStateAsync
    5. For UltimateDatabaseStorage: ensure OnHandshakeAsync calls base
    6. For UltimateDataLake: add state persistence
    7. For UltimateStorageProcessing: fix error double-counting

    Build verify after all changes: `dotnet build` affected projects.
  </action>
  <verify>All 6 plugins compile cleanly with proper lifecycle hooks.</verify>
  <done>All 6 DataPipeline-branch plugins use correct lifecycle pattern.</done>
</task>
</tasks>

<verification>
- All 6 plugins compile with zero errors
- No direct StartAsync/StopAsync overrides remain
- Base lifecycle methods called appropriately
</verification>

<success_criteria>
All 6 plugins properly participate in the SDK lifecycle without bypasses.
</success_criteria>

<output>
After completion, create `.planning/phases/65.5-production-readiness/65.5-02-SUMMARY.md`
</output>
