---
phase: 65.5-production-readiness
plan: 03
subsystem: Plugin Lifecycle
tags: [lifecycle, feature-plugins, OnStartCoreAsync, OnStopCoreAsync]
dependency-graph:
  requires: []
  provides: [proper-lifecycle-participation]
  affects: [UltimateDataLineage, UltimateResourceManager, UltimateEdgeComputing, UltimateDataFabric, UltimateCompliance, Compute.Wasm]
tech-stack:
  added: []
  patterns: [OnStartCoreAsync/OnStopCoreAsync lifecycle hooks]
key-files:
  modified:
    - Plugins/DataWarehouse.Plugins.UltimateDataLineage/UltimateDataLineagePlugin.cs
    - Plugins/DataWarehouse.Plugins.UltimateResourceManager/UltimateResourceManagerPlugin.cs
    - Plugins/DataWarehouse.Plugins.UltimateEdgeComputing/UltimateEdgeComputingPlugin.cs
    - Plugins/DataWarehouse.Plugins.UltimateDataFabric/UltimateDataFabricPlugin.cs
    - Plugins/DataWarehouse.Plugins.UltimateCompliance/UltimateCompliancePlugin.cs
    - Plugins/DataWarehouse.Plugins.Compute.Wasm/WasmComputePlugin.cs
decisions:
  - "UltimateDataLineage and UltimateResourceManager no-op overrides simply removed (base defaults suffice)"
  - "UltimateEdgeComputing gets OnStartCoreAsync that auto-calls InitializeAsync with default config"
  - "UltimateCompliance merged two OnStartCoreAsync methods into one (strategy discovery + KS3 handler)"
  - "UltimateDataFabric OnHandshakeAsync now delegates to base before adding custom metadata"
metrics:
  duration: 4min
  completed: 2026-02-23T07:57:34Z
---

# Phase 65.5 Plan 03: Fix Lifecycle Bypasses in Feature-Branch Plugins Summary

Fix lifecycle bypasses in 6 Feature-branch plugins by replacing direct StartAsync/StopAsync overrides with proper OnStartCoreAsync/OnStopCoreAsync hooks from IntelligenceAwarePluginBase.

## Changes Made

### Task 1: Fix lifecycle bypasses in 6 Feature-branch plugins

| Plugin | Issue | Fix |
|--------|-------|-----|
| UltimateDataLineage | No-op `StartAsync`/`StopAsync` overrides blocked base lifecycle | Removed overrides; base `IntelligenceAwarePluginBase` handles lifecycle correctly |
| UltimateResourceManager | Same no-op pattern | Removed overrides; base handles lifecycle correctly |
| UltimateEdgeComputing | Hidden `InitializeAsync(config)` not called during SDK lifecycle | Added `OnStartCoreAsync` that auto-initializes with default config; added `OnStopCoreAsync` for cleanup |
| UltimateDataFabric | `OnHandshakeAsync` built response from scratch, skipping base handshake | Changed to call `base.OnHandshakeAsync(request)` and augment the returned response |
| UltimateCompliance | `StartAsync` directly overridden; `StopAsync` returned `Task.CompletedTask` without calling base | Moved init to `OnStartCoreAsync` (merged with existing KS3 handler registration); `StopAsync` changed to `OnStopCoreAsync` |
| Compute.Wasm | `StartAsync`/`StopAsync` directly overridden with real logic | Renamed to `OnStartCoreAsync`/`OnStopCoreAsync` preserving all scheduler/shutdown logic |

### SDK Lifecycle Pattern Reference

`IntelligenceAwarePluginBase.StartAsync(ct)` calls:
1. `SubscribeToIntelligenceTopics()`
2. `DiscoverIntelligenceAsync(ct)`
3. `OnStartWithIntelligenceAsync(ct)` or `OnStartWithoutIntelligenceAsync(ct)`
4. `OnStartCoreAsync(ct)`

`IntelligenceAwarePluginBase.StopAsync()` calls:
1. Intelligence subscription cleanup
2. Pending request cleanup
3. `OnStopCoreAsync()`

Plugins that override `StartAsync`/`StopAsync` directly bypass steps 1-3.

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 1 - Bug] Duplicate OnStartCoreAsync in UltimateCompliance**
- **Found during:** Task 1 (UltimateCompliance fix)
- **Issue:** Plugin already had an `OnStartCoreAsync` for KS3 handler registration; moving `StartAsync` logic to `OnStartCoreAsync` created a duplicate
- **Fix:** Merged both into a single `OnStartCoreAsync` that does strategy discovery, service init, bus handlers, AND KS3 handler registration
- **Files modified:** UltimateCompliancePlugin.cs
- **Commit:** 548a742e

## Verification

- All 6 plugins compile with zero errors, zero warnings
- No direct `StartAsync`/`StopAsync` overrides remain in the 6 target plugins
- UltimateEdgeComputing now auto-initializes via `OnStartCoreAsync` (no hidden `InitializeAsync` requirement)
- UltimateDataFabric handshake properly chains through base

## Commits

| Hash | Description |
|------|-------------|
| 548a742e | feat(65.5-03): fix lifecycle bypasses in 6 Feature-branch plugins |
