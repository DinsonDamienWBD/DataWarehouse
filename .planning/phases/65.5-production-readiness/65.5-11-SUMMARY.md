---
phase: 65.5-production-readiness
plan: 11
subsystem: plugin-consolidation
tags: [filesystem, compute, wasm, fuse, winfsp, self-emulating, consolidation]
dependency-graph:
  requires: [65.5-09, 65.5-10]
  provides: [consolidated-filesystem-strategies, consolidated-compute-strategies]
  affects: [UltimateFilesystem, UltimateCompute, solution-structure]
tech-stack:
  added: []
  patterns: [strategy-consolidation, assembly-scanning-discovery]
key-files:
  created:
    - Plugins/DataWarehouse.Plugins.UltimateFilesystem/Strategies/UnixFuseFilesystemStrategy.cs
    - Plugins/DataWarehouse.Plugins.UltimateFilesystem/Strategies/WindowsWinFspFilesystemStrategy.cs
    - Plugins/DataWarehouse.Plugins.UltimateCompute/Strategies/Wasm/WasmInterpreterStrategy.cs
    - Plugins/DataWarehouse.Plugins.UltimateCompute/Strategies/SelfEmulatingComputeStrategy.cs
  modified:
    - DataWarehouse.slnx
    - DataWarehouse.Tests/DataWarehouse.Tests.csproj
    - DataWarehouse.Tests/Plugins/FuseDriverTests.cs
    - DataWarehouse.Tests/Plugins/WinFspDriverTests.cs
    - DataWarehouse.Tests/Plugins/ComputeWasmTests.cs
    - DataWarehouse.Tests/Plugins/SelfEmulatingObjectsTests.cs
    - DataWarehouse.Tests/Plugins/PluginSmokeTests.cs
    - DataWarehouse.Tests/Integration/StrategyRegistryTests.cs
  deleted:
    - Plugins/DataWarehouse.Plugins.FuseDriver/ (entire directory)
    - Plugins/DataWarehouse.Plugins.WinFspDriver/ (entire directory)
    - Plugins/DataWarehouse.Plugins.Compute.Wasm/ (entire directory)
    - Plugins/DataWarehouse.Plugins.SelfEmulatingObjects/ (entire directory)
decisions:
  - FuseDriver consolidated as UnixFuseFilesystemStrategy with FUSE mount detection
  - WinFspDriver consolidated as WindowsWinFspFilesystemStrategy with WinFSP mount detection
  - Compute.Wasm consolidated as WasmInterpreterStrategy (built-in interpreter, no CLI dependency)
  - SelfEmulatingObjects consolidated as SelfEmulatingComputeStrategy (format detection + viewer bundling)
  - All strategies use assembly scanning auto-discovery (no manual registration needed)
metrics:
  duration: 20min
  completed: 2026-02-23T08:47:00Z
---

# Phase 65.5 Plan 11: Consolidate Filesystem Drivers + Compute Plugins Summary

Merged 4 standalone plugins into 2 existing Ultimate plugins, reducing plugin count by 4. Each source plugin became a strategy in the target plugin, leveraging assembly scanning for automatic discovery.

## What Was Done

### Task 1: Merge FuseDriver + WinFspDriver into UltimateFilesystem

Created two new filesystem strategies:

1. **UnixFuseFilesystemStrategy** (`driver-unix-fuse`): Virtual filesystem strategy for FUSE on Linux/macOS. Detects FUSE mounts via `/proc/mounts`, provides POSIX I/O for FUSE-mounted paths.

2. **WindowsWinFspFilesystemStrategy** (`driver-windows-winfsp`): Virtual filesystem strategy for WinFSP on Windows. Detects WinFSP mounts via DriveInfo network-type detection, provides Windows I/O for WinFSP-mounted paths.

Both extend `FilesystemStrategyBase` and are auto-discovered by `FilesystemStrategyRegistry.AutoDiscover()`.

Deleted 14 source files from FuseDriver (FuseDriverPlugin.cs, FuseFileSystem.cs, FuseOperations.cs, LinuxSpecific.cs, MacOsSpecific.cs, etc.) and 16 source files from WinFspDriver (WinFspDriverPlugin.cs, WinFspFileSystem.cs, VssProvider.cs, BitLockerIntegration.cs, etc.).

### Task 2: Merge Compute.Wasm + SelfEmulatingObjects into UltimateCompute

Created two new compute strategies:

1. **WasmInterpreterStrategy** (`compute.wasm.interpreter`): Built-in stack-based WASM interpreter that requires no external CLI runtimes. Ideal for air-gapped or embedded environments. Validates WASM magic numbers, parses sections, and executes modules.

2. **SelfEmulatingComputeStrategy** (`compute.self-emulating`): Bundles data with WASM viewers for long-term format preservation. Auto-detects 12+ formats via magic numbers (PDF, PNG, JPEG, GIF, ZIP, BMP, TIFF, WebP, MP4, HTML, JSON, binary).

Both extend `ComputeRuntimeStrategyBase` and are auto-discovered by `ComputeRuntimeStrategyRegistry.DiscoverStrategies()`.

Deleted 3 source files from Compute.Wasm (WasmComputePlugin.cs, WasmInterpreter.cs, WasmTypes.cs) and 3 source files from SelfEmulatingObjects (SelfEmulatingObjectsPlugin.cs, ViewerBundler.cs, ViewerRuntime.cs).

## Net Effect

| Metric | Before | After | Delta |
|--------|--------|-------|-------|
| Plugin projects in .slnx | N+4 | N | -4 |
| UltimateFilesystem strategies | 8 files | 10 files | +2 |
| UltimateCompute strategies | ~51 | ~53 | +2 |
| Lines deleted | ~28,800 | 0 | -28,800 |
| Lines added | ~720 | 720 | +720 |

## Test Updates

- FuseDriverTests: Rewired to test UnixFuseFilesystemStrategy
- WinFspDriverTests: Rewired to test WindowsWinFspFilesystemStrategy
- ComputeWasmTests: Rewired to test WasmInterpreterStrategy via registry discovery
- SelfEmulatingObjectsTests: Rewired to test SelfEmulatingComputeStrategy via registry discovery
- PluginSmokeTests: Removed entries for deleted plugins with consolidation comments
- StrategyRegistryTests: Removed deleted plugins from infrastructure exception list

## Deviations from Plan

### Auto-fixed Issues

**1. [Rule 3 - Blocking] Test project references to deleted plugins**
- **Found during:** Tasks 1 and 2
- **Issue:** DataWarehouse.Tests.csproj had ProjectReference entries for all 4 deleted plugins
- **Fix:** Removed all 4 references from .csproj
- **Files modified:** DataWarehouse.Tests/DataWarehouse.Tests.csproj

**2. [Rule 1 - Bug] PluginSmokeTests and StrategyRegistryTests referenced deleted plugins**
- **Found during:** Task 2
- **Issue:** Smoke tests instantiated deleted plugin classes; strategy registry tests listed them in infrastructure set
- **Fix:** Removed instantiation lines, added consolidation comments, removed from infrastructure list
- **Files modified:** PluginSmokeTests.cs, StrategyRegistryTests.cs

**3. [Rule 1 - Bug] ComputeCapabilities uses positional record parameters, not object initializer**
- **Found during:** Task 2 build verify
- **Issue:** Initial strategy code used `new() { ... }` syntax but ComputeCapabilities is a positional record
- **Fix:** Changed to `new(param: value, ...)` syntax matching existing strategies
- **Files modified:** WasmInterpreterStrategy.cs, SelfEmulatingComputeStrategy.cs

## Build Verification

- UltimateFilesystem: BUILD SUCCEEDED (0 errors, 0 warnings)
- UltimateCompute: BUILD SUCCEEDED (0 errors, 0 warnings)
- Pre-existing errors in UltimateStorage and UltimateDatabaseProtocol (KubernetesCsiStorageStrategy, SqlOverObjectProtocolStrategy) are unrelated to this plan

## Self-Check: PASSED

All created files exist and both commits verified.
