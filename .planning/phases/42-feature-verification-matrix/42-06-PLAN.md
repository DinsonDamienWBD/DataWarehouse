---
phase: 42
plan: 06
title: "Gap Closure — Significant Items (50-79% features)"
depends_on: ["42-01", "42-02", "42-03", "42-04"]
wave: 2
---

# Plan 42-06: Gap Closure — Significant Items (50-79% features)

## Goal

Take features scored 50-79% from Plans 42-01 through 42-04 and either:
1. Implement core logic to bring them to 100% (if feasible in v4.0)
2. Defer to v5.0+ with documented rationale (if too large/complex)

## Scope

**Input**: All verification reports from Plans 42-01, 42-02, 42-03, 42-04

**Target**: Features scored 50-79% (partial implementation, significant work remaining)

**Expected count**: ~300-600 features (estimate based on 3,808 total features × ~15% in 50-79% range)

**Typical gaps**:
- Core logic partially implemented (basic case works, advanced cases missing)
- Strategy scaffolding exists, but algorithms not fully implemented
- Protocol handlers exist, but some protocol features missing
- Storage backends have basic operations, advanced features missing
- AI features have infrastructure, but no real model integration

## Tasks

### Task 1: Extract Significant Items from Verification Reports
- Read all domain verification reports (17 files total)
- Extract all features scored 50-79%
- Group by domain and plugin
- Estimate effort for each feature (S/M/L/XL)
  - **S (Small)**: 1-4 hours — implement in v4.0
  - **M (Medium)**: 4-16 hours — implement in v4.0
  - **L (Large)**: 16-40 hours — defer to v5.0 (with exceptions)
  - **XL (Extra Large)**: 40+ hours — defer to v5.0
- Prioritize by customer tier impact:
  1. Tier 6 (Military/Government) features — critical for air-gap, zero-trust
  2. Tier 5 (High-Stakes/Regulated) features — critical for compliance
  3. Tier 7 (Hyperscale) features — critical for distributed consensus
  4. Tier 4 (Real-Time) features — critical for streaming, async pipeline
  5. Tier 3 (Enterprise) features — important for multi-tenant
  6. Tier 2 (SMB) features — nice-to-have
  7. Tier 1 (Developer) features — low priority

### Task 2: Triage and Create Implementation Plan
- For each 50-79% feature:
  - Determine effort (S/M/L/XL)
  - Determine customer tier impact (1-7)
  - Decision:
    - **Implement in v4.0**: Tier 5-7 features + S/M effort
    - **Defer to v5.0**: Tier 1-4 features OR L/XL effort
- Create implementation plan for v4.0 features
- Create deferral plan for v5.0 features (with rationale)
- Record to `.planning/phases/42-feature-verification-matrix/significant-items-triage.md`

### Task 3: Implement High-Priority Significant Items (Tier 5-7, S/M effort)
- For each high-priority feature:
  - Read current implementation (partial logic exists at 50-79%)
  - Implement missing core logic
  - Add error handling, validation
  - Add XML documentation
  - Add unit tests
  - Verify feature is now 100%
- Record completion to `.planning/phases/42-feature-verification-matrix/significant-items-tier-5-7-closure.md`

### Task 4: Implement Medium-Priority Significant Items (Tier 3-4, S effort)
- For each medium-priority, small-effort feature:
  - Same implementation approach as Task 3
- Record completion to `.planning/phases/42-feature-verification-matrix/significant-items-tier-3-4-closure.md`

### Task 5: Document Deferred Items (v5.0+)
- For each deferred feature:
  - Document current state (what exists at 50-79%)
  - Document what's missing
  - Document why deferred (effort vs value)
  - Document recommended v5.0 implementation approach
- Record to `.planning/phases/42-feature-verification-matrix/significant-items-deferred-v5.md`

### Task 6: Verification Pass
- Re-run verification for all implemented features
- Confirm all are now 100%
- Update Feature Verification Matrix with new scores
- Generate final significant items report

## Implementation Prioritization Matrix

| Tier | S (1-4h) | M (4-16h) | L (16-40h) | XL (40+h) |
|------|:--------:|:---------:|:----------:|:---------:|
| **Tier 7 (Hyperscale)** | ✅ Implement | ✅ Implement | ⚠️ Case-by-case | ❌ Defer v5.0 |
| **Tier 6 (Military)** | ✅ Implement | ✅ Implement | ⚠️ Case-by-case | ❌ Defer v5.0 |
| **Tier 5 (High-Stakes)** | ✅ Implement | ✅ Implement | ⚠️ Case-by-case | ❌ Defer v5.0 |
| **Tier 4 (Real-Time)** | ✅ Implement | ⚠️ Case-by-case | ❌ Defer v5.0 | ❌ Defer v5.0 |
| **Tier 3 (Enterprise)** | ✅ Implement | ⚠️ Case-by-case | ❌ Defer v5.0 | ❌ Defer v5.0 |
| **Tier 2 (SMB)** | ⚠️ Case-by-case | ❌ Defer v5.0 | ❌ Defer v5.0 | ❌ Defer v5.0 |
| **Tier 1 (Developer)** | ⚠️ Case-by-case | ❌ Defer v5.0 | ❌ Defer v5.0 | ❌ Defer v5.0 |

**Legend:**
- ✅ Implement — Implement in v4.0
- ⚠️ Case-by-case — Evaluate individually
- ❌ Defer v5.0 — Defer to v5.0+

## Example Implementation: 50-79% Feature

**Before (60% complete)**:
```csharp
public class AesGcmEncryptionStrategy : EncryptionStrategyBase
{
    public override async Task<byte[]> EncryptAsync(byte[] data, EncryptionKey key, CancellationToken ct)
    {
        // Basic encryption works
        using var aes = new AesGcm(key.KeyMaterial.Span);
        var nonce = new byte[12];
        RandomNumberGenerator.Fill(nonce);
        var ciphertext = new byte[data.Length];
        var tag = new byte[16];
        aes.Encrypt(nonce, data, ciphertext, tag);

        // Missing: key validation, nonce handling, tag concatenation, error handling
        return ciphertext;
    }
}
```

**After (100% complete)**:
```csharp
/// <summary>
/// AES-256-GCM authenticated encryption strategy.
/// </summary>
/// <remarks>
/// Uses 12-byte nonce (recommended for GCM), 16-byte authentication tag.
/// Format: [nonce (12 bytes)][ciphertext (N bytes)][tag (16 bytes)]
/// </remarks>
public class AesGcmEncryptionStrategy : EncryptionStrategyBase
{
    protected override int KeySizeBytes => 32; // AES-256
    protected override int NonceSize => 12;
    protected override int TagSize => 16;

    /// <summary>
    /// Encrypts data using AES-256-GCM.
    /// </summary>
    /// <param name="data">Plaintext data to encrypt.</param>
    /// <param name="key">256-bit encryption key.</param>
    /// <param name="ct">Cancellation token.</param>
    /// <returns>Encrypted data (nonce + ciphertext + tag).</returns>
    /// <exception cref="ArgumentNullException">Thrown when data or key is null.</exception>
    /// <exception cref="ArgumentException">Thrown when key size is invalid.</exception>
    public override async Task<byte[]> EncryptAsync(byte[] data, EncryptionKey key, CancellationToken ct)
    {
        if (data == null)
            throw new ArgumentNullException(nameof(data));
        if (key?.KeyMaterial == null)
            throw new ArgumentNullException(nameof(key));
        if (key.KeyMaterial.Length != KeySizeBytes)
            throw new ArgumentException($"Key must be {KeySizeBytes} bytes for AES-256.", nameof(key));

        ct.ThrowIfCancellationRequested();

        try
        {
            using var aes = new AesGcm(key.KeyMaterial.Span);

            // Generate nonce
            var nonce = new byte[NonceSize];
            RandomNumberGenerator.Fill(nonce);

            // Allocate output buffer
            var ciphertext = new byte[data.Length];
            var tag = new byte[TagSize];

            // Encrypt
            aes.Encrypt(nonce, data, ciphertext, tag);

            // Concatenate: nonce + ciphertext + tag
            var result = new byte[NonceSize + data.Length + TagSize];
            Buffer.BlockCopy(nonce, 0, result, 0, NonceSize);
            Buffer.BlockCopy(ciphertext, 0, result, NonceSize, data.Length);
            Buffer.BlockCopy(tag, 0, result, NonceSize + data.Length, TagSize);

            _logger.LogDebug("AES-GCM encryption completed: {DataSize} bytes -> {CiphertextSize} bytes",
                data.Length, result.Length);

            return result;
        }
        catch (Exception ex)
        {
            _logger.LogError(ex, "AES-GCM encryption failed");
            throw new CryptographicException("AES-GCM encryption failed", ex);
        }
    }

    public override async Task<byte[]> DecryptAsync(byte[] data, EncryptionKey key, CancellationToken ct)
    {
        // Similar full implementation for decryption
        // ...
    }
}
```

## Success Criteria

- [ ] All 50-79% features extracted and triaged
- [ ] Implementation plan created (v4.0 features)
- [ ] Deferral plan created (v5.0 features with rationale)
- [ ] All Tier 5-7, S/M effort features brought to 100%
- [ ] All Tier 3-4, S effort features brought to 100%
- [ ] Deferred features documented with v5.0 roadmap
- [ ] Verification pass confirms all implemented features are 100%
- [ ] Feature Verification Matrix updated with new scores

## Output

**Triage Report**:
- `.planning/phases/42-feature-verification-matrix/significant-items-triage.md`

**Closure Reports** (2 files):
- `.planning/phases/42-feature-verification-matrix/significant-items-tier-5-7-closure.md`
- `.planning/phases/42-feature-verification-matrix/significant-items-tier-3-4-closure.md`

**Deferral Report**:
- `.planning/phases/42-feature-verification-matrix/significant-items-deferred-v5.md`

**Final Report**:
- `.planning/phases/42-feature-verification-matrix/significant-items-final-report.md`

**Format** (triage report):
```markdown
# Significant Items Triage Report

## Summary
- Total Significant Items: NNN
- Implement in v4.0: NNN
- Defer to v5.0: NNN

## v4.0 Implementation Plan (by tier and effort)

### Tier 7 (Hyperscale)
#### Small Effort (1-4h)
- [ ] Feature Name — (Source: Plugin X, Current: 60%)
  - **What exists**: Basic logic for simple case
  - **What's missing**: Advanced case, error handling, tests
  - **Effort**: 2 hours

[... for each v4.0 feature ...]

## v5.0 Deferral Plan

### Deferred: Large Effort Features
- Feature Name — (Source: Plugin X, Current: 55%)
  - **What exists**: Strategy scaffolding, basic case
  - **What's missing**: Core algorithm implementation, optimization
  - **Why deferred**: 30 hours effort, low customer impact (Tier 2)
  - **v5.0 approach**: Implement full algorithm with performance tuning

[... for each deferred feature ...]
```

## Dependencies

- **42-01**: Domain 1-4 verification (must complete first)
- **42-02**: Domain 5-8 verification (must complete first)
- **42-03**: Domain 9-13 verification (must complete first)
- **42-04**: Domain 14-17 verification (must complete first)

## Notes

- This plan is more selective than 42-05 (not all 50-79% features will be implemented in v4.0)
- Focus on high-value, reasonable-effort features
- Be realistic about effort estimates (better to defer than rush and create technical debt)
- Document deferred features thoroughly (v5.0 team needs context)
- Customer tier impact is PRIMARY driver (Tier 5-7 features are critical)
- When in doubt, consult `.planning/v4.0-MILESTONE-DRAFT.md` for customer tier requirements
