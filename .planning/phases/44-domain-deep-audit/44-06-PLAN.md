---
phase: 44
plan: 44-06
title: "Domain Audit: AEDS + Service + Air-Gap + Filesystem (Domains 8-10)"
depends_on: []
---

# Plan 44-06: Domain Audit: AEDS + Service + Air-Gap + Filesystem (Domains 8-10)

## Goal
Conduct hostile review of AEDS service infrastructure, air-gap security, and filesystem integration. Verify service daemon Launcher profiles, Server→Client flow, air-gap has zero external network calls, USB installer end-to-end, and VDE/FUSE mount cycle.

## Approach
1. **Read Actual Plugin Code**:
   - `Plugins/DataWarehouse.Plugins.AedsCore/` — service daemon, launcher, profiles
   - `Plugins/DataWarehouse.Plugins.AirGapBridge/` — air-gap mode, USB installer
   - `Plugins/DataWarehouse.Plugins.UltimateFilesystem/` — VDE, FUSE/WinFsp mount

2. **Service Daemon Launcher Profile Verification**:
   - Read Launcher code
   - Verify 3 operating modes:
     - **Live Mode**: kernel + all plugins in-memory (no service daemon)
     - **Install Mode**: service daemon runs as system service (Windows: SYSTEM, Linux: root)
     - **Configure Mode**: configuration UI, no data access
   - Verify profile configuration:
     - Server profile: opens server ports (gRPC, MQTT, WebSocket), accepts client connections
     - Client profile: connects to remote server, no server ports
     - Standalone profile: no network, local-only
   - Verify security boundaries:
     - Server profile: requires admin privileges (bind to ports <1024)
     - Client profile: runs as normal user, no admin required
     - Profile cannot be switched at runtime (requires restart)

3. **Server→Client Flow Verification (ServerDispatcher → ControlPlane → ClientCourier)**:
   - Trace AEDS command flow:
     - Client sends command via gRPC/MQTT/WebSocket
     - ServerDispatcher receives, validates, routes to ControlPlane
     - ControlPlane executes command (calls plugin via message bus)
     - Plugin returns result
     - ControlPlane sends result to ServerDispatcher
     - ServerDispatcher sends result to ClientCourier
     - ClientCourier delivers to client
   - Verify authentication at each boundary:
     - Client → ServerDispatcher: mTLS, JWT, or API key
     - ServerDispatcher → ControlPlane: internal (trusted)
     - ControlPlane → Plugin: message bus (trusted)
   - Verify authorization (client cannot execute admin commands)
   - Verify audit logging (all commands logged with timestamp, user, action)

4. **Air-Gap Mode Verification (zero external network calls)**:
   - Grep entire codebase for network calls:
     - HTTP client: HttpClient, WebClient, RestClient
     - DNS: Dns.GetHostEntry, DnsClient
     - External APIs: AWS SDK, Azure SDK, Google Cloud SDK
     - NTP: time sync
     - Certificate revocation: OCSP, CRL
   - Verify air-gap mode disables all external calls:
     - Time sync: use local clock or manual setting
     - Certificate validation: use local trust store, no OCSP/CRL
     - Cloud storage: disabled
     - Telemetry: disabled
   - Verify USB installer:
     - Create bootable USB (ISO → USB)
     - Install on air-gapped machine (no network)
     - Verify all features work (no network dependency)

5. **USB Installer E2E Verification**:
   - Read USB installer code
   - Verify installer workflow:
     - Build installer package (bundle kernel + plugins + dependencies)
     - Create bootable USB (ISO image → USB drive)
     - Boot from USB
     - Install to target machine (copy files, register service, configure)
     - First run: create initial admin user, configure storage
   - Verify offline operation (no network required)
   - Verify post-install: service starts, dashboard accessible

6. **VDE/FUSE Mount Cycle Verification**:
   - VDE (Virtual Disk Engine):
     - Read VDE code
     - Verify mount: create virtual disk, attach to OS (appears as /dev/vdeX or E:\)
     - Verify I/O: read/write operations forwarded to VDE backend
     - Verify unmount: detach virtual disk, flush pending writes
     - Verify crash recovery: replay WAL, restore consistent state
   - FUSE/WinFsp:
     - Read FUSE integration code
     - Verify mount: register FUSE filesystem, mount point appears in OS
     - Verify I/O: file operations (open, read, write, close, stat, readdir) forwarded to DataWarehouse
     - Verify unmount: flush pending writes, unregister FUSE filesystem
     - Verify error handling (permission denied, disk full)

## Scope
**In Scope:**
- Domain 8: AEDS Service Infrastructure
- Domain 9: Air-Gap Security
- Domain 10: Filesystem Integration
- AedsCore, AirGapBridge, UltimateFilesystem
- Service daemon Launcher, 3 operating modes, 3 profiles
- Server→Client flow (ServerDispatcher → ControlPlane → ClientCourier)
- Air-gap zero external network calls, USB installer
- VDE/FUSE mount cycle, crash recovery

**Out of Scope:**
- Domains 1-7 — Plans 44-01 through 44-05
- Domains 11-17 — Plans 44-07 through 44-09

## Success Criteria
- [ ] 3 operating modes verified (Live, Install, Configure)
- [ ] 3 profiles verified (Server, Client, Standalone)
- [ ] Server profile verified (opens ports, accepts connections, requires admin)
- [ ] Client profile verified (connects to server, no server ports, no admin)
- [ ] Profile switch requires restart (cannot change at runtime)
- [ ] Server→Client flow traced E2E (ServerDispatcher → ControlPlane → ClientCourier)
- [ ] Authentication verified at each boundary (mTLS, JWT, API key)
- [ ] Authorization verified (client cannot execute admin commands)
- [ ] Audit logging verified (all commands logged)
- [ ] Air-gap mode verified (zero external network calls: no HTTP, DNS, cloud APIs, NTP, OCSP/CRL)
- [ ] USB installer verified E2E (build → create USB → boot → install → first run)
- [ ] VDE mount cycle verified (mount → I/O → unmount → crash recovery)
- [ ] FUSE mount cycle verified (mount → I/O → unmount → error handling)
- [ ] All findings documented with file path, line number, severity

## Output
- `AUDIT-FINDINGS-02-domains-8-10.md`: Findings for AEDS, air-gap, and filesystem domains
  - Service daemon verification results (3 modes, 3 profiles)
  - Server→Client flow verification results
  - Authentication/authorization verification results
  - Air-gap verification results (grep for network calls)
  - USB installer verification results
  - VDE/FUSE mount cycle verification results
  - All gaps, stubs, placeholders, incomplete implementations
  - Severity: CRITICAL (air-gap breach, privilege escalation), HIGH (auth bypass), MEDIUM (feature gaps), LOW (minor)
