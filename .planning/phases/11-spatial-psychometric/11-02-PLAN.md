---
phase: 11-spatial-psychometric
plan: 02
type: execute
wave: 1
depends_on: []
files_modified:
  - DataWarehouse.SDK/Contracts/Intelligence/PsychometricAnalysis.cs
  - DataWarehouse.SDK/Contracts/Intelligence/DeceptionSignals.cs
  - Plugins/DataWarehouse.Plugins.UltimateIntelligence/Strategies/Features/PsychometricIndexingStrategy.cs
autonomous: true

must_haves:
  truths:
    - "Content can be analyzed for sentiment, emotion, and deception signals"
    - "Deception detection extracts linguistic distance, temporal inconsistency, emotional incongruence, overspecification, and hedging language scores"
    - "Psychometric analysis includes overall deception probability (0-1 composite score)"
    - "Emotion-based vector search works with updated analysis including deception signals"
  artifacts:
    - path: "DataWarehouse.SDK/Contracts/Intelligence/DeceptionSignals.cs"
      provides: "Deception detection signal model"
      min_lines: 40
    - path: "Plugins/DataWarehouse.Plugins.UltimateIntelligence/Strategies/Features/PsychometricIndexingStrategy.cs"
      provides: "Enhanced psychometric analysis with deception detection"
      contains: "DeceptionSignals"
  key_links:
    - from: "PsychometricIndexingStrategy.cs"
      to: "AIProvider"
      via: "AI prompt for deception analysis"
      pattern: "BuildAnalysisPrompt.*deception|CompleteAsync"
    - from: "PsychometricAnalysis"
      to: "DeceptionSignals"
      via: "property inclusion"
      pattern: "DeceptionSignals.*DeceptionIndicators"
---

<objective>
Enhance psychometric indexing with deception detection signals.

Purpose: Enable advanced content analysis with sentiment, emotion, and deception detection capabilities (requirement ADV-02, task T88).

Output: Production-ready deception detection integrated into existing PsychometricIndexingStrategy with SDK contracts.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/11-spatial-psychometric/11-RESEARCH.md

# Existing psychometric infrastructure
@Plugins/DataWarehouse.Plugins.UltimateIntelligence/Strategies/Features/PsychometricIndexingStrategy.cs

# SDK intelligence contracts
@DataWarehouse.SDK/Contracts/Intelligence/IntelligenceStrategyInfo.cs
@DataWarehouse.SDK/AI/FeatureStrategyBase.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create SDK deception detection contracts</name>
  <files>
    DataWarehouse.SDK/Contracts/Intelligence/DeceptionSignals.cs
    DataWarehouse.SDK/Contracts/Intelligence/PsychometricAnalysis.cs
  </files>
  <action>
Create/update SDK contracts for deception detection:

1. **DeceptionSignals.cs**: New deception signal model (create in `DataWarehouse.SDK/Contracts/Intelligence/`):
   ```csharp
   /// <summary>
   /// Deception detection signals extracted from content analysis.
   /// </summary>
   /// <remarks>
   /// Based on linguistic and psychometric research into deception indicators.
   /// Scores are 0-1 normalized values where higher = stronger signal.
   /// NOT a definitive lie detector - use as risk indicator requiring human review.
   /// </remarks>
   public sealed class DeceptionSignals
   {
       /// <summary>
       /// Linguistic distance score - unusual word choice, unnatural phrasing.
       /// </summary>
       /// <remarks>
       /// Measures deviation from author's typical writing style.
       /// Range: 0 (normal) to 1 (highly unusual).
       /// </remarks>
       public float LinguisticDistanceScore { get; init; }

       /// <summary>
       /// Temporal inconsistency score - conflicting time references, timeline gaps.
       /// </summary>
       /// <remarks>
       /// Detects contradictions in when events occurred.
       /// Range: 0 (consistent) to 1 (conflicting).
       /// </remarks>
       public float TemporalInconsistencyScore { get; init; }

       /// <summary>
       /// Emotional incongruence score - sentiment mismatch with topic.
       /// </summary>
       /// <remarks>
       /// E.g., positive sentiment when discussing negative event.
       /// Range: 0 (congruent) to 1 (incongruent).
       /// </remarks>
       public float EmotionalIncongruenceScore { get; init; }

       /// <summary>
       /// Overspecification score - excessive unnecessary detail.
       /// </summary>
       /// <remarks>
       /// Deceptive content often includes excessive detail to appear credible.
       /// Range: 0 (appropriate) to 1 (excessive).
       /// </remarks>
       public float OverspecificationScore { get; init; }

       /// <summary>
       /// Hedging language score - use of qualifiers ("maybe", "possibly", "sort of").
       /// </summary>
       /// <remarks>
       /// Frequent hedging may indicate uncertainty or deception.
       /// Range: 0 (direct) to 1 (heavily hedged).
       /// </remarks>
       public float HedgingLanguageScore { get; init; }

       /// <summary>
       /// Overall deception probability - composite score.
       /// </summary>
       /// <remarks>
       /// Weighted combination of all signals.
       /// Range: 0 (likely truthful) to 1 (likely deceptive).
       /// Threshold recommendation: 0.7+ warrants human review.
       /// </remarks>
       public float OverallDeceptionProbability { get; init; }

       /// <summary>
       /// Confidence in deception assessment.
       /// </summary>
       /// <remarks>
       /// Affected by content length, clarity, language complexity.
       /// Range: 0 (low confidence) to 1 (high confidence).
       /// </remarks>
       public float AssessmentConfidence { get; init; }

       /// <summary>
       /// Explanation of primary deception indicators detected.
       /// </summary>
       public string? PrimaryIndicators { get; init; }
   }
   ```

2. **PsychometricAnalysis.cs**: Update existing model (already exists, add DeceptionIndicators property):
   - Locate existing `PsychometricAnalysis` class
   - Add property: `public DeceptionSignals? DeceptionIndicators { get; init; }`
   - Add XML doc: "Deception detection signals (null if not requested in analysis)"
   - Ensure record/class remains immutable (init-only properties)

All types use XML docs with remarks explaining research basis, score interpretation, and ethical usage guidelines.
  </action>
  <verify>
Build SDK project: `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj`

Check DeceptionSignals type exists:
```bash
grep -n "public sealed class DeceptionSignals" DataWarehouse.SDK/Contracts/Intelligence/DeceptionSignals.cs
```

Check PsychometricAnalysis includes deception property:
```bash
grep -n "DeceptionSignals.*DeceptionIndicators" DataWarehouse.SDK/Contracts/Intelligence/PsychometricAnalysis.cs
```

Expected: Zero build errors, both types in DataWarehouse.SDK.Contracts.Intelligence namespace.
  </verify>
  <done>
SDK deception detection contracts exist and compile. DeceptionSignals model defines 6 signal scores with XML documentation and ethical usage guidance. PsychometricAnalysis includes optional DeceptionIndicators property.
  </done>
</task>

<task type="auto">
  <name>Task 2: Enhance PsychometricIndexingStrategy with deception detection</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateIntelligence/Strategies/Features/PsychometricIndexingStrategy.cs
  </files>
  <action>
Enhance existing PsychometricIndexingStrategy to include deception detection:

1. **Configuration**: Add deception detection config options to `Info.ConfigurationRequirements`:
   ```csharp
   new ConfigurationRequirement
   {
       Key = "EnableDeception",
       Description = "Enable deception detection analysis",
       Required = false,
       DefaultValue = "false"
   }
   ```

2. **BuildAnalysisPrompt method**: Extend existing prompt builder to include deception analysis when enabled:
   ```csharp
   // Existing prompt sections: sentiment, emotion, personality...

   // ADD: Deception detection section
   if (enableDeception)
   {
       prompt.AppendLine("5. Deception Detection Analysis:");
       prompt.AppendLine("   Analyze for deception signals:");
       prompt.AppendLine("   - Linguistic distance: unusual word choice or phrasing");
       prompt.AppendLine("   - Temporal inconsistency: conflicting time references");
       prompt.AppendLine("   - Emotional incongruence: sentiment mismatch with topic");
       prompt.AppendLine("   - Overspecification: excessive unnecessary detail");
       prompt.AppendLine("   - Hedging language: qualifiers (maybe, possibly, sort of)");
       prompt.AppendLine("   Provide scores 0-1 for each signal and overall deception probability.");
   }
   ```

3. **ParsePsychometricAnalysis method**: Enhance existing parser to extract deception signals:
   ```csharp
   // Existing parsing: sentiment, emotions, writing style...

   // ADD: Deception signals parsing
   DeceptionSignals? deceptionSignals = null;
   if (enableDeception && content.Contains("deception", StringComparison.OrdinalIgnoreCase))
   {
       deceptionSignals = new DeceptionSignals
       {
           LinguisticDistanceScore = ExtractScore(content, "linguistic distance"),
           TemporalInconsistencyScore = ExtractScore(content, "temporal inconsistency"),
           EmotionalIncongruenceScore = ExtractScore(content, "emotional incongruence"),
           OverspecificationScore = ExtractScore(content, "overspecification"),
           HedgingLanguageScore = ExtractScore(content, "hedging language"),
           OverallDeceptionProbability = ExtractScore(content, "overall deception probability"),
           AssessmentConfidence = ExtractScore(content, "confidence"),
           PrimaryIndicators = ExtractPrimaryIndicators(content)
       };
   }

   analysis.DeceptionIndicators = deceptionSignals;
   ```

4. **Helper methods**: Add private helper methods for score extraction:
   ```csharp
   private float ExtractScore(string content, string signalName)
   {
       // Regex pattern to find "signal_name: 0.75" or similar
       // Return 0.0 if not found
       // Clamp to 0-1 range
   }

   private string? ExtractPrimaryIndicators(string content)
   {
       // Extract bullet points or summary of main indicators
       // Return null if not found
   }
   ```

5. **AnalyzeAsync method**: Update to pass `enableDeception` flag:
   ```csharp
   var enableDeception = bool.Parse(GetConfig("EnableDeception") ?? "false");
   var prompt = BuildAnalysisPrompt(content, depth, emotionModel, enablePersonality, enableDeception);
   ```

6. **Vector store metadata**: Add deception score to stored metadata for searchability:
   ```csharp
   if (VectorStore != null)
   {
       var metadata = new Dictionary<string, object>
       {
           // Existing metadata: sentiment, emotion...
           ["deception_probability"] = analysis.DeceptionIndicators?.OverallDeceptionProbability ?? 0.0f,
           ["deception_enabled"] = enableDeception
       };
   }
   ```

7. **XML documentation**: Update class-level XML docs to mention deception detection capability (T88 complete).

**No simulations**: All deception signals are extracted from real AI provider responses. If AI provider returns incomplete data, scores default to 0.0 (conservative fallback, not a simulation). The prompt instructs AI to perform real linguistic analysis.

**Graceful degradation**: If `EnableDeception = false` (default), deception analysis is skipped entirely - existing sentiment/emotion analysis continues to work unchanged. Backward compatible.
  </action>
  <verify>
Build plugin: `dotnet build Plugins/DataWarehouse.Plugins.UltimateIntelligence/`

Check deception config exists:
```bash
grep -n "EnableDeception" Plugins/DataWarehouse.Plugins.UltimateIntelligence/Strategies/Features/PsychometricIndexingStrategy.cs
```

Check deception prompt section:
```bash
grep -n "Deception Detection Analysis" Plugins/DataWarehouse.Plugins.UltimateIntelligence/Strategies/Features/PsychometricIndexingStrategy.cs
```

Check deception parsing:
```bash
grep -n "DeceptionSignals" Plugins/DataWarehouse.Plugins.UltimateIntelligence/Strategies/Features/PsychometricIndexingStrategy.cs | wc -l
```
Expected: 3+ references (type usage, instantiation, assignment).

Verify no NotImplementedException:
```bash
grep -n "NotImplementedException" Plugins/DataWarehouse.Plugins.UltimateIntelligence/Strategies/Features/PsychometricIndexingStrategy.cs
```
Expected: No matches (zero forbidden patterns).
  </verify>
  <done>
PsychometricIndexingStrategy enhanced with deception detection. Configuration option `EnableDeception` controls feature activation. AI prompt includes deception analysis instructions. Parser extracts 6 deception signal scores. Vector store metadata includes deception probability for searchability. Zero forbidden patterns. Backward compatible (disabled by default).
  </done>
</task>

</tasks>

<verification>
**Build verification:**
```bash
dotnet build DataWarehouse.sln
```
Expected: Zero errors, deception detection types compile.

**Strategy info verification:**
```bash
dotnet run --project DataWarehouse.CLI/ -- strategy info feature-psychometric-indexing
```
Expected: "EnableDeception" configuration requirement listed.

**Must-have verification:**

1. **Truth 1 - Sentiment, emotion, deception analysis:**
   ```bash
   grep -n "AnalyzeAsync" Plugins/DataWarehouse.Plugins.UltimateIntelligence/Strategies/Features/PsychometricIndexingStrategy.cs
   ```
   Expected: Method performs comprehensive analysis including optional deception.

2. **Truth 2 - Deception signal extraction:**
   ```bash
   grep -n "LinguisticDistanceScore\|TemporalInconsistencyScore\|EmotionalIncongruenceScore\|OverspecificationScore\|HedgingLanguageScore" DataWarehouse.SDK/Contracts/Intelligence/DeceptionSignals.cs
   ```
   Expected: All 5 signal scores defined.

3. **Truth 3 - Overall deception probability:**
   ```bash
   grep -n "OverallDeceptionProbability" DataWarehouse.SDK/Contracts/Intelligence/DeceptionSignals.cs
   ```
   Expected: Composite score property exists.

4. **Truth 4 - Vector search integration:**
   ```bash
   grep -n "deception_probability" Plugins/DataWarehouse.Plugins.UltimateIntelligence/Strategies/Features/PsychometricIndexingStrategy.cs
   ```
   Expected: Deception score added to vector store metadata.

**Key link verification:**
```bash
grep -n "BuildAnalysisPrompt.*enableDeception" Plugins/DataWarehouse.Plugins.UltimateIntelligence/Strategies/Features/PsychometricIndexingStrategy.cs
```
Expected: Prompt builder accepts deception flag parameter.
</verification>

<success_criteria>
1. DeceptionSignals SDK contract exists with 6 signal scores + overall probability + confidence + indicators
2. PsychometricAnalysis includes optional DeceptionIndicators property
3. PsychometricIndexingStrategy has EnableDeception configuration option
4. AI prompt includes deception analysis instructions when enabled
5. Parser extracts all deception signals from AI response
6. Vector store metadata includes deception_probability for searchability
7. Zero build errors, zero NotImplementedException
8. Backward compatible (deception disabled by default)
9. Ethical usage guidance in XML documentation
10. Conservative fallback (0.0 scores) if AI response incomplete
</success_criteria>

<output>
After completion, create `.planning/phases/11-spatial-psychometric/11-02-SUMMARY.md` documenting:
- DeceptionSignals SDK contract with 6 signal types
- PsychometricIndexingStrategy enhancements for deception detection
- AI prompt structure for deception analysis
- Score extraction and parsing approach
- Ethical considerations and usage guidelines
- Configuration options and backward compatibility
</output>
