---
phase: 47-penetration-testing
plan: 47-v4.5-06
title: "Network & Transport Layer Attacks"
type: execute
wave: 2
depends_on: ["47-v4.5-01"]
files_modified: [".planning/phases/47-penetration-testing/47-v4.5-06-NETWORK-FINDINGS.md"]
autonomous: true
must_haves:
  truths:
    - "TLS configuration tested for downgrade, weak cipher, and certificate bypass on ALL transport strategies"
    - "QUIC/HTTP3 data plane tested for protocol confusion and connection migration attacks"
    - "gRPC, MQTT, WebSocket control planes tested for injection and authentication bypass"
    - "Protocol-specific attacks tested (MQTT topic hijack, WebSocket origin bypass, gRPC metadata injection)"
  artifacts:
    - path: ".planning/phases/47-penetration-testing/47-v4.5-06-NETWORK-FINDINGS.md"
      provides: "Network and transport layer vulnerability findings"
  key_links:
    - from: "network findings"
      to: "v4.3 CRIT-01 (TLS bypass)"
      via: "TLS validation is the #1 historical weakness"
      pattern: "tls.*downgrade|quic.*attack|protocol.*confus"
---

# Plan 47-v4.5-06: Network & Transport Layer Attacks

<objective>
Attack every network transport in DataWarehouse: TLS, QUIC/HTTP3, gRPC, MQTT, WebSocket, CoAP, raw TCP. The v4.3 pentest found TLS bypass in 15 files -- the single largest vulnerability class. This plan goes deeper: not just "is cert validated?" but "can the entire TLS handshake be subverted?"

Purpose: DataWarehouse operates across network boundaries (cloud, edge, federated, air-gapped). Every network protocol is an attack surface. TLS bypass was the #1 finding in v4.3/v4.4/v4.5 -- we need to confirm this class of vulnerability is truly eradicated and test for more sophisticated network attacks.
Output: Network and transport vulnerability report with protocol-specific findings.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/PLUGIN-CATALOG.md
@.planning/phases/47-penetration-testing/47-CONTEXT.md
@.planning/phases/47-penetration-testing/47-v4.5-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: TLS & Certificate Attacks</name>
  <files>.planning/phases/47-penetration-testing/47-v4.5-06-NETWORK-FINDINGS.md</files>
  <action>
Comprehensive TLS security assessment beyond simple "is cert validated?" checks.

**Attack 1: Complete TLS Bypass Audit**
- v4.3 found 15 files with `=> true` cert callbacks. v4.4 fixed 13. v4.5 found 1 remaining (GrpcStorageStrategy).
- Do a FRESH scan: Search ALL .cs files for:
  - `RemoteCertificateValidationCallback` (any assignment)
  - `ServerCertificateCustomValidationCallback` (any assignment)
  - `HttpClientHandler` with `ServerCertificateCustomValidationCallback`
  - `SslClientAuthenticationOptions` with cert callbacks
  - `DangerousAcceptAnyServerCertificateValidator` (.NET built-in bypass)
- For EACH: Classify as SECURE (validates properly), CONFIGURABLE (has toggle), or BYPASS (always accepts)
- Check: Are the "configurable" instances defaulting to secure? Or insecure?
- Count: How many BYPASS instances remain vs v4.3 (was 15)?

**Attack 2: TLS Version Downgrade**
- Can an attacker force TLS 1.0/1.1 connections?
- Search for: `SslProtocols`, `SecurityProtocolType` settings
- Check: Is TLS 1.2 the minimum? Or can older protocols be negotiated?
- Check: Are there any `SslProtocols.None` (let OS decide) that might allow downgrades on older systems?

**Attack 3: Weak Cipher Suite Negotiation**
- Search for `CipherSuitesPolicy`, cipher configuration
- Are weak ciphers (RC4, 3DES, NULL, EXPORT) explicitly excluded?
- Can an attacker negotiate a cipher suite with no forward secrecy?
- Check: Is there explicit cipher suite ordering? (Server preference vs client preference)

**Attack 4: Certificate Pinning Bypass**
- For strategies that do validate certificates: Is it standard CA validation only?
- Can an attacker with a rogue CA cert (e.g., compromised enterprise CA) MITM the connection?
- Is certificate pinning (public key pinning) used anywhere?
- Check: ZeroTrustConnectionMeshStrategy and QuantumSafeConnectionStrategy -- these have proper validation. Do they pin?

**Attack 5: mTLS Client Certificate Attacks**
- v4.3 MED-05 noted mTLS not universally enforced
- For connections that DO use mTLS: Is the client certificate validated against a CA?
- Can an attacker present a self-signed client cert and be accepted?
- Check: `ValidateClientCertificate` in TcpP2PNetwork -- what does it actually validate?

**Attack 6: TLS Session Resumption Attacks**
- Can TLS session tickets be captured and replayed?
- If 0-RTT is enabled (TLS 1.3): Can replay attacks against early data succeed?
- Check: Is session ticket rotation configured? Are tickets encrypted with rotating keys?
  </action>
  <verify>
Report must contain:
1. Complete census of ALL TLS certificate validation points (expect 20+) with status
2. TLS version enforcement analysis
3. Cipher suite configuration analysis
4. Certificate pinning assessment
5. mTLS enforcement scope and validation quality
6. Comparison table: v4.3 (15 bypass) vs v4.4 (2 bypass) vs v4.5 (current count)
  </verify>
  <done>Complete TLS security assessment. Every cert validation callback classified. TLS version/cipher enforcement verified. mTLS scope documented.</done>
</task>

<task type="auto">
  <name>Task 2: Application Protocol Attacks</name>
  <files>.planning/phases/47-penetration-testing/47-v4.5-06-NETWORK-FINDINGS.md</files>
  <action>
Attack the application-layer protocols that DataWarehouse uses: AEDS (gRPC + MQTT + WebSocket control planes, QUIC/HTTP3 data plane), REST, GraphQL, and CoAP.

**Attack 7: QUIC/HTTP3 Data Plane Exploitation**
- Read `QuicDataPlanePlugin.cs` and `AdaptiveTransportPlugin.cs`
- QUIC uses UDP -- can it be spoofed more easily than TCP?
- QUIC connection migration: Can an attacker hijack a migrated connection?
- Can a malformed QUIC frame cause a crash or buffer overflow in the .NET QUIC stack?
- Check: Is connection ID validation enforced during migration?
- Check: Are QUIC retry tokens validated to prevent amplification attacks?

**Attack 8: gRPC Service Attacks**
- Search for all gRPC service definitions and implementations
- Can gRPC metadata headers be injected to bypass authentication?
- Can oversized gRPC messages cause OOM? Is there message size limiting?
- Can gRPC reflection be used to enumerate all services and methods? (Information disclosure)
- Check: Is gRPC health service exposed? Does it leak sensitive information?
- Check: GrpcStorageStrategy -- this had TLS bypass. Is the gRPC channel itself authenticated?

**Attack 9: MQTT Control Plane Attacks**
- Read `MqttControlPlanePlugin.cs`
- Can an attacker subscribe to MQTT topics they shouldn't access?
- Is MQTT authentication enforced? (Username/password, client certificates)
- Can MQTT topic wildcards (`#`, `+`) be abused to subscribe to all topics?
- Can MQTT retained messages be used to inject persistent commands?
- Check: Is the MQTT broker in-process or external? If in-process, can it be overwhelmed?

**Attack 10: WebSocket Control Plane Attacks**
- Search for WebSocket endpoints in AEDS and Dashboard
- Is there Origin validation on WebSocket connections?
- Can WebSocket messages be injected from a cross-origin page? (CSRF-like via WebSocket)
- Is there message framing validation? Can oversized frames cause issues?
- Check: Is WebSocket authentication per-connection or per-message?

**Attack 11: REST/GraphQL API Attacks**
- Beyond OWASP basics (tested in v4.3), focus on:
  - GraphQL introspection: Can the full schema be queried? Does it expose internal types?
  - GraphQL depth/complexity: Can deeply nested queries cause exponential processing?
  - REST mass assignment: Can extra fields in JSON body modify protected attributes?
  - HTTP verb tampering: Can GET with body bypass POST-only auth checks?
  - HTTP request smuggling: If behind a reverse proxy, can CL/TE desync be exploited?
- Check: Apollo Federation strategy -- does it expose the service graph to external queries?

**Attack 12: CoAP/IoT Protocol Attacks**
- CoAP uses UDP and is typically unencrypted (DTLS optional)
- Is DTLS enforced for CoAP connections?
- Can CoAP observe tokens be predicted or replayed?
- Can CoAP block-wise transfer be abused for resource exhaustion?
- Check: ZigBee, LoRaWAN, BLE strategies -- are IoT protocols secured or assumed trusted?
  </action>
  <verify>
Report must contain:
1. QUIC/HTTP3 security assessment (connection migration, amplification)
2. gRPC security assessment (metadata injection, size limits, reflection)
3. MQTT security assessment (topic authorization, wildcard abuse)
4. WebSocket security assessment (origin validation, auth model)
5. REST/GraphQL advanced attack results
6. CoAP/IoT protocol security assessment
7. All findings with CVSS scores
  </verify>
  <done>All 6 application protocol attack vectors tested. AEDS attack surface fully analyzed. IoT protocol security assessed. All findings include attack narratives and CVSS scores.</done>
</task>

</tasks>

<verification>
- All 12 network/transport attack vectors tested
- Complete TLS validation census (every callback in the codebase)
- Every application protocol (gRPC, MQTT, WebSocket, QUIC, REST, GraphQL, CoAP) assessed
- v4.3 TLS bypass regression fully tracked
</verification>

<success_criteria>
- Exact count of remaining TLS bypass instances (was 15 in v4.3, target: 0)
- TLS version enforcement confirmed (minimum TLS 1.2)
- Every application protocol assessed for auth, injection, and DoS
- All findings include CVSS scores and protocol-specific attack narratives
</success_criteria>

<output>
After completion, create `.planning/phases/47-penetration-testing/47-v4.5-06-SUMMARY.md`
</output>
