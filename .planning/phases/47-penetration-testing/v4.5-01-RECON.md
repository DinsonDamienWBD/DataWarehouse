# v4.5 Penetration Test: Attack Surface Mapping & Reconnaissance Report

**Date:** 2026-02-19
**Tester:** Ethical Hacker (Automated Red Team)
**Scope:** Full white-box source code analysis of DataWarehouse codebase
**Methodology:** Systematic entry point enumeration, trust boundary analysis, deserialization sink catalog, sensitive data flow tracing, and v4.3/v4.4 regression verification

---

## Executive Summary

The DataWarehouse system exposes a significant attack surface across 72+ projects with 30+ network-facing entry points, 60+ message bus topics, and 80+ deserialization sinks. While v4.4 remediation fixed many v4.3 findings, **1 CRITICAL vulnerability remains** (GrpcStorageStrategy unconditional TLS bypass), and **3 new findings** were discovered during this reconnaissance.

**Key Risk Areas for Subsequent Plans:**
1. TLS certificate validation - 1 unconditional bypass remaining + 12 configurable bypasses (default-safe but attackable via config)
2. Launcher API - now authenticated but uses non-constant-time API key comparison (timing attack)
3. Plugin loading - DataWarehouseKernel bypasses PluginLoader security validation entirely
4. XDocument.Load without XmlReaderSettings - 10+ instances in UltimateDataFormat (XXE risk)
5. API key logged to console in plaintext on startup

---

## Section 1: Network-Facing Entry Points

### 1.1 HTTP/HTTPS Endpoints

| # | Component | Binding | Port | Auth | Protocol | Entry Point |
|---|-----------|---------|------|------|----------|-------------|
| EP-01 | Dashboard (ASP.NET Core) | Kestrel | 5000/5001 | JWT Bearer | HTTP/HTTPS | `DataWarehouse.Dashboard/Program.cs:237` |
| EP-02 | Dashboard API Controllers | via Kestrel | 5000/5001 | JWT + [Authorize] | REST API | `Program.cs:234` (MapControllers) |
| EP-03 | Dashboard Auth Login | via Kestrel | 5000/5001 | [AllowAnonymous] | POST | `AuthController.cs:46` (POST /api/auth/login) |
| EP-04 | Dashboard Auth Refresh | via Kestrel | 5000/5001 | [AllowAnonymous] | POST | `AuthController.cs:113` (POST /api/auth/refresh) |
| EP-05 | Dashboard SignalR Hubs | via Kestrel | 5000/5001 | JWT query string | WebSocket | `Program.cs:71-78` (/hubs/*) |
| EP-06 | Launcher HTTP API | 0.0.0.0:{port} | dynamic | API Key (Bearer) | HTTP | `LauncherHttpServer.cs:97-98` |
| EP-07 | Launcher /api/v1/info | 0.0.0.0 | dynamic | API Key | GET | `LauncherHttpServer.cs:175` |
| EP-08 | Launcher /api/v1/capabilities | 0.0.0.0 | dynamic | API Key | GET | `LauncherHttpServer.cs:188` |
| EP-09 | Launcher /api/v1/message | 0.0.0.0 | dynamic | API Key | POST | `LauncherHttpServer.cs:226` |
| EP-10 | Launcher /api/v1/execute | 0.0.0.0 | dynamic | API Key | POST | `LauncherHttpServer.cs:243` |
| EP-11 | Launcher /api/v1/health | 0.0.0.0 | dynamic | **NONE** | GET | `LauncherHttpServer.cs:259` |
| EP-12 | Kubernetes Probes | http://+:8080/ | 8080 | **NONE** | HTTP | `KubernetesProbesStrategy.cs:46-48` |
| EP-13 | K8s /livez | +8080 | 8080 | **NONE** | GET | `KubernetesProbesStrategy.cs:85` |
| EP-14 | K8s /readyz | +8080 | 8080 | **NONE** | GET | `KubernetesProbesStrategy.cs:86` |
| EP-15 | K8s /startupz | +8080 | 8080 | **NONE** | GET | `KubernetesProbesStrategy.cs:87` |
| EP-16 | K8s /healthz | +8080 | 8080 | **NONE** | GET | `KubernetesProbesStrategy.cs:88` |

### 1.2 Raw TCP Listeners

| # | Component | Binding | Port | Auth | Protocol | Entry Point |
|---|-----------|---------|------|------|----------|-------------|
| EP-17 | TcpP2PNetwork | IPAddress.Any | config | TLS (optional) | Custom binary | `TcpP2PNetwork.cs:79` |
| EP-18 | Raft Consensus | IPAddress.Any | config.BasePort | **NONE** | Custom TCP | `RaftConsensusPlugin.cs:1199` |
| EP-19 | ChameleonProtocolEmulator | configurable | configurable | **NONE** | Multi-protocol proxy | `ChameleonProtocolEmulatorStrategy.cs:87` |

### 1.3 UDP/mDNS/QUIC Listeners

| # | Component | Binding | Port | Auth | Protocol | Entry Point |
|---|-----------|---------|------|------|----------|-------------|
| EP-20 | mDNS Service Discovery | Multicast 224.0.0.251 | 5353 | **NONE** | mDNS/UDP | `MdnsServiceDiscovery.cs:185` |
| EP-21 | QUIC Data Plane (AEDS) | configurable | configurable | TLS (configurable) | QUIC | `QuicDataPlanePlugin.cs:488` |
| EP-22 | Adaptive Transport QUIC | configurable | configurable | TLS (configurable) | QUIC | `AdaptiveTransportPlugin.cs:553` |

### 1.4 Unix Domain Sockets / Named Pipes

| # | Component | Binding | Path | Auth | Entry Point |
|---|-----------|---------|------|------|-------------|
| EP-23 | FUSE SystemdIntegration | Unix socket path | configurable | **NONE** | `SystemdIntegration.cs:354` |
| EP-24 | Systemd Journal Socket | /run/systemd/journal/socket | fixed | **NONE** | `SystemdIntegration.cs:486` |
| EP-25 | Docker Secrets Socket | /var/run/docker.sock | **NONE** | Unix socket perms | `DockerSecretsStrategy.cs:119` |

### 1.5 WebSocket/SignalR Endpoints

| # | Component | Binding | Auth | Entry Point |
|---|-----------|---------|------|-------------|
| EP-26 | Dashboard SignalR | /hubs/* | JWT query param | `Program.cs:70-78` |
| EP-27 | AEDS WebSocket Control Plane | configurable | configurable | `WebSocketControlPlanePlugin.cs` |

### 1.6 Outbound Connections (SSRF Surface)

| # | Component | Target | TLS Bypass? | Entry Point |
|---|-----------|--------|-------------|-------------|
| EP-28 | REST Storage | user-configured URL | configurable (default safe) | `RestStorageStrategy.cs:247` |
| EP-29 | gRPC Storage | user-configured URL | **UNCONDITIONAL BYPASS** | `GrpcStorageStrategy.cs:160-163` |
| EP-30 | Federation System | inter-node URLs | configurable (default safe) | `FederationSystem.cs:606-608` |
| EP-31 | DynamoDB Connector | AWS endpoint | configurable (default safe) | `DynamoDbConnectionStrategy.cs:44-46` |
| EP-32 | CosmosDB Connector | Azure endpoint | configurable (default safe) | `CosmosDbConnectionStrategy.cs:44-46` |
| EP-33 | Elasticsearch (x2) | user-configured URL | configurable (default safe) | `ElasticsearchProtocolStrategy.cs:80,748` |
| EP-34 | Icinga Monitoring | monitoring URL | configurable (default safe) | `IcingaStrategy.cs:45-47` |
| EP-35 | Enterprise Storage (5) | vendor APIs | configurable (default safe) | HpeStoreOnce, WekaIo, PureStorage, VastData, NetAppOntap |
| EP-36 | WebDAV | network storage | configurable (default safe) | `WebDavStrategy.cs:162-164` |
| EP-37 | Dashboard strategies | various | configurable (default safe) | `DashboardStrategyBase.cs:450-452` |

**Total Entry Points: 37+**

---

## Section 2: Message Bus Topic Graph

### 2.1 System/Lifecycle Topics (Bypass enforcement)

These topics bypass the AccessEnforcementInterceptor:
```
system.startup          - Kernel startup notification
system.shutdown         - Kernel shutdown notification
system.healthcheck      - Health status check
plugin.loaded           - Plugin lifecycle
plugin.unloaded         - Plugin lifecycle
```
**Risk:** Any plugin can publish to these bypass topics without CommandIdentity validation.

### 2.2 Capability Management Topics

```
capability.register     -> PluginCapabilityRegistry (handles registration)
capability.unregister   -> PluginCapabilityRegistry
capability.query        -> PluginCapabilityRegistry
```

### 2.3 Intelligence Topics (Sensitive - carry AI decisions)

```
intelligence.request.*               -> Various plugins (recommendation requests)
intelligence.knowledge.request.{id}  -> PluginBase (knowledge queries)
intelligence.knowledge.query.broadcast -> PluginBase (broadcast queries)
intelligence.knowledge.updated       -> IntelligenceTestSuites
intelligence.model.register          -> ModelScoping
intelligence.model.query             -> ModelScoping
intelligence.expertise.updated       -> ModelScoping (x2)
intelligence.connector.detect-anomaly.response -> SchemaEvolutionEngine
intelligence.request.observability-recommendation -> UniversalObservability
intelligence.request.data-management -> UltimateDataManagement
intelligence.request.dashboard-recommendation -> UniversalDashboards
intelligence.request.deployment-recommendation -> UltimateDeployment
intelligence.request.data-quality    -> UltimateDataQuality
intelligence.request.resilience-recommendation -> UltimateResilience
intelligence.request.key-rotation-prediction -> UltimateKeyManagement
intelligence.request.interface       -> UltimateInterface
```

### 2.4 Workflow/Execution Topics (Privileged - trigger operations)

```
workflow.execute        -> UltimateWorkflow (TRIGGERS CODE EXECUTION)
workflow.define         -> UltimateWorkflow
workflow.strategy.select -> UltimateWorkflow
workflow.optimize       -> UltimateWorkflow
sdkports.invoke         -> UltimateSDKPorts (TRIGGERS CODE EXECUTION)
sdkports.generate       -> UltimateSDKPorts
sdkports.strategy.select -> UltimateSDKPorts
```

### 2.5 Security/Compliance Topics (Critical)

```
compliance.report.generate    -> UltimateCompliance
compliance.custody.export     -> UltimateCompliance
compliance.status.request     -> UltimateCompliance
compliance.tamper.detected    -> UltimateCompliance (ALERT TOPIC)
compliance.alert.send         -> UltimateCompliance
compliance.geofence.check     -> UltimateCompliance
compliance.geofence.check.batch -> UltimateCompliance
aeds.manifest.sign            -> IntentManifestSigner (CRYPTO OPERATION)
aeds.manifest.verify          -> CodeSigning
```

### 2.6 Data/Storage Topics

```
filesystem.*            -> FuseDriver (filesystem operations)
selfemulating.bundle    -> SelfEmulatingObjects
selfemulating.view      -> SelfEmulatingObjects
composition.provenance.request-certificate -> ProvenanceCertificate
composition.schema.data-ingested -> SchemaEvolutionEngine
composition.schema.evolution-approved -> SchemaEvolutionEngine
sustainability.recommendation.request -> UltimateSustainability
knowledge.query.{id}    -> PluginBase
```

### 2.7 Message Bus Security Analysis

**AccessEnforcementInterceptor** wraps the message bus and enforces CommandIdentity on every message (fail-closed). However:

1. **5 bypass topics exist** (`system.startup`, `system.shutdown`, `system.healthcheck`, `plugin.loaded`, `plugin.unloaded`) - any plugin can publish to these without identity.
2. **The interceptor is optional** - `DataWarehouseKernel` constructs the raw message bus. The interceptor must be explicitly wired. If a component uses the raw bus, enforcement is absent.
3. **Wildcard subscriptions** exist (e.g., `filesystem.*`, `anomaly.*`) - these could receive messages from unexpected topics.

---

## Section 3: Trust Boundary Analysis

```
+------------------------------------------------------------------+
|                    EXTERNAL (UNTRUSTED)                           |
|  Users, HTTP clients, network peers, AI providers, config files  |
+------------------------------------------------------------------+
        |              |              |            |           |
        v              v              v            v           v
+-------------+  +-----------+  +----------+  +--------+  +-------+
| Dashboard   |  | Launcher  |  | P2P/QUIC |  | mDNS   |  | K8s   |
| JWT Auth    |  | API Key   |  | TLS(opt) |  | NONE   |  | NONE  |
| VALIDATED   |  | PARTIALLY |  | PARTIAL  |  | UNVAL  |  | UNVAL |
+------+------+  +-----+-----+  +----+-----+  +---+----+  +---+---+
       |                |             |            |           |
       v                v             v            v           v
+------------------------------------------------------------------+
|                      KERNEL BOUNDARY                             |
|  PluginRegistry, MessageBus, KernelStorageService                |
|  AccessEnforcementInterceptor (if wired)                         |
+------------------------------------------------------------------+
        |              |              |
        v              v              v
+-------------+  +-----------+  +----------+
| Plugin A    |  | Plugin B  |  | Plugin C |
| In-process  |  | In-process|  | In-proc  |
| SAME AppDom |  | Type-only |  | isolation |
+------+------+  +-----+-----+  +----+-----+
       |                |             |
       v                v             v
+------------------------------------------------------------------+
|                    EXTERNAL SERVICES                             |
|  AWS, Azure, Enterprise Storage, AI Providers                    |
|  TLS: Configurable (mostly default-safe, 1 unconditional bypass) |
+------------------------------------------------------------------+
```

### Trust Boundary Classification

| Boundary | Location | Validation Status | Risk |
|----------|----------|-------------------|------|
| **User -> Dashboard** | JWT authentication | **VALIDATED** | Proper JWT with PBKDF2 passwords |
| **User -> Launcher API** | API Key (Bearer) | **PARTIALLY VALIDATED** | Non-constant-time comparison (timing attack) |
| **User -> K8s Probes** | None | **UNVALIDATED** | By design (health probes), but info disclosure |
| **Peer -> TcpP2PNetwork** | TLS optional | **PARTIALLY VALIDATED** | TLS can be disabled; messages authenticated but 100MB max |
| **Peer -> Raft** | None visible | **UNVALIDATED** | No auth on consensus TCP listener |
| **Peer -> mDNS** | None | **UNVALIDATED** | UDP multicast, spoofable |
| **Plugin -> Kernel** | CommandIdentity via AccessEnforcementInterceptor | **VALIDATED** (if wired) | Bypass topics exist; interceptor is optional |
| **Kernel -> Plugin DLL** | PluginLoader security validation (hash, signature) | **PARTIALLY VALIDATED** | DataWarehouseKernel.LoadPluginsFromAssemblyAsync BYPASSES PluginLoader entirely |
| **Config -> System** | Configuration files | **UNVALIDATED** | Config values control security decisions (TLS bypass, ports, passwords) |
| **AI Provider -> System** | AI model responses | **UNVALIDATED** | AI responses deserialized and acted upon without validation |
| **External Service -> Plugin** | HTTP responses | **PARTIALLY VALIDATED** | JSON deserialization of remote responses |

---

## Section 4: Deserialization Sink Catalog

### 4.1 JSON Deserialization (System.Text.Json)

| # | Location | Input Source | Type Safety | Hardened? |
|---|----------|-------------|-------------|-----------|
| DS-01 | `TcpP2PNetwork.cs:437` | **Network (peer TCP)** | P2PMessage | No type discrimination |
| DS-02 | `QuicDataPlanePlugin.cs:395` | **Network (QUIC)** | PayloadDescriptor | No type discrimination |
| DS-03 | `Http2DataPlanePlugin.cs:194` | **Network (HTTP)** | UploadResult | No type discrimination |
| DS-04 | `Http2DataPlanePlugin.cs:252` | **Network (HTTP)** | PayloadDescriptor | No type discrimination |
| DS-05 | `InstanceConnection.cs:209,323,342,355,387,415` | **Network (Launcher)** | Various Dict/InstanceCapabilities | No type discrimination |
| DS-06 | `MessageBridge.cs:426` | **Network (HTTP)** | Message | PropertyNameCaseInsensitive |
| DS-07 | `InstanceManager.cs:76,229` | **Network/Disk** | InstanceCapabilities, ConnectionProfile | PropertyNameCaseInsensitive |
| DS-08 | `UserCredentialVault.cs:688` | **Disk (encrypted)** | AICredential | Post-decryption |
| DS-09 | `SecurityManager.cs:377,429,663,873` | **Disk** | DeviceAuthInfo | Multiple paths |
| DS-10 | `PipelineProcessor.cs:453,477` | **Internal** | Generic T | Type-safe generics |
| DS-11 | `KernelStorageService.cs:212` | **Disk** | Dict<string,string> | Simple types |
| DS-12 | `KernelInfrastructure.cs:1421,1472` | **Disk/Config** | Generic T, Dict | Config deserialization |
| DS-13 | `DeveloperToolsService.cs:81-559` | **Network (API responses)** | Various (ApiEndpoint, SchemaDefinition, etc.) | 12+ deserialization points |
| DS-14 | `ComplianceReportService.cs:84-371` | **Network (API responses)** | Various compliance types | 13+ deserialization points |
| DS-15 | `UptimeRobotStrategy.cs:111-222` | **Network (API)** | Dict<string,object> | Untyped dictionary |
| DS-16 | `StatusCakeStrategy.cs:115-174` | **Network (API)** | Dict<string,object> | Untyped dictionary |
| DS-17 | `InodeTable.cs:686` | **Disk** | Dict<string,byte[]> | Filesystem metadata |
| DS-18 | `AirGapTypes.cs:348` | **Removable media** | DwPackage | Untrusted physical media |
| DS-19 | `DataWarehouseHost.cs:423` | **Disk** | SavedProfile | Config file |
| DS-20 | `CLILearningStore.cs:402,500` | **Disk** | Generic T, LearningData | Local storage |
| DS-21 | `CommandHistory.cs:251` | **Disk** | List<HistoryEntry> | Local storage |
| DS-22 | `CommandRecorder.cs:363,405` | **Disk** | RecordedSession | Local storage |
| DS-23 | `ThemeManager.cs:198` | **Disk** | ThemeSettings | Config file |
| DS-24 | `MulePlugin.cs:116` | **Disk** | Dict<string,object> | Index file |
| DS-25 | `UndoManager.cs:660` | **Disk** | List<UndoableOperation> | Local storage |

**Total: 80+ deserialization sinks across 25+ categories**

All use System.Text.Json (no BinaryFormatter, no TypeNameHandling). System.Text.Json is safe against type-confusion RCE by default. However, untyped Dict<string,object> deserialization from network sources (DS-15, DS-16) could allow unexpected data injection.

### 4.2 XML Parsing

| # | Location | Input Source | DtdProcessing | XXE Risk |
|---|----------|-------------|---------------|----------|
| XP-01 | `XmlDocumentRegenerationStrategy.cs:346` | AI/disk | **Prohibit** | **FIXED** (was v4.3 HIGH-01) |
| XP-02 | `SamlStrategy.cs:95` | Network (IdP) | **Prohibit** | **FIXED** (was v4.3 HIGH-02) |
| XP-03 | `ConfigurationSerializer.cs:46` | Disk/config | **Prohibit** | Safe |
| XP-04 | `XmlStrategy.cs:62` | **User input (stream)** | **DEFAULT (Load)** | **VULNERABLE** |
| XP-05 | `XmlStrategy.cs:113` | **User input (stream)** | **DEFAULT (Load)** | **VULNERABLE** |
| XP-06 | `PmmlStrategy.cs:58,91,155` | **User input (stream)** | **DEFAULT (Load)** | **VULNERABLE** |
| XP-07 | `GraphMlStrategy.cs:58,231` | **User input (stream)** | **DEFAULT (Load)** | **VULNERABLE** |
| XP-08 | `KmlStrategy.cs:60,95,199` | **User input (stream)** | **DEFAULT (LoadAsync)** | **VULNERABLE** |

**NEW FINDING:** XP-04 through XP-08 use `XDocument.Load(stream)` without `XmlReaderSettings`. While `XDocument.Load` defaults to `DtdProcessing.Parse` in .NET Framework but `Prohibit` in .NET 6+, the explicit hardening is missing. On any .NET Framework host or if behavior changes, these become XXE vectors.

### 4.3 Process Execution (Command Injection Surface)

**66 occurrences across 30 files.** Key risk areas:

| Component | Count | Risk Level | Notes |
|-----------|-------|------------|-------|
| Media Transcoding (ffmpeg) | 8 | MEDIUM | Arguments from user-specified formats |
| Key Management (pass, sops, age, git-crypt, ssh-agent) | 10 | LOW | Arguments are programmatic |
| FUSE Driver (mount, umount, fusermount) | 6 | LOW | System commands with controlled args |
| Sustainability (cpufreq, powertop, nvidia-smi) | 6 | LOW | System monitoring commands |
| Platform Service Manager | 2 | LOW | Service registration |
| DataWarehouseHost | 2 | LOW | Service operations |

All use `UseShellExecute = false` (no shell injection). Risk is limited to argument injection where user-controlled data enters ProcessStartInfo.Arguments.

---

## Section 5: Sensitive Data Flow Map

### 5.1 Cryptographic Keys

```
Key Generation (UltimateKeyManagement)
  |
  v
Message Bus (integrity.hash.compute/verify, encryption.*)
  |
  +--> In-memory storage (ConcurrentDictionary)
  |      Risk: Plugin crash = key in dump
  |
  +--> Disk storage (FileKeyStoreStrategy)
  |      Risk: File.WriteAllText with no restrictive permissions
  |
  +--> External HSM (AwsCloudHsm, Azure KeyVault)
  |      Risk: TLS configurable, API credentials in config
  |
  +--> Platform keystores (MacOS Keychain, Linux SecretService, SSH Agent)
         Risk: CLI tool output not zeroed (LOW-05 from v4.3)
```

### 5.2 User Credentials

```
User Input (password)
  |
  +--> Dashboard AuthController.Login
  |      HashPassword: PBKDF2-SHA256, 100K iterations, 32-byte salt
  |      VerifyPassword: PBKDF2 + FixedTimeEquals (constant-time)
  |      Storage: In-memory ConcurrentDictionary (ephemeral)
  |
  +--> UserAuthenticationService.HashPassword
  |      PBKDF2-SHA256, 100K iterations, 16-byte salt
  |      VerifyPassword: PBKDF2 + CryptographicOperations.FixedTimeEquals
  |      Storage: In-memory
  |
  +--> DataWarehouseHost.CreateAdminUserAsync
         PBKDF2-SHA256, 100K iterations, 32-byte salt
         Password bytes: CryptographicOperations.ZeroMemory (GOOD)
         Storage: security.json on disk (NO restrictive file permissions)
```

### 5.3 API Keys / Tokens

```
Launcher API Key
  |
  +--> Generated: Guid.NewGuid() (cryptographically random on .NET 6+)
  |      LOGGED TO CONSOLE IN PLAINTEXT: LauncherHttpServer.cs:80
  |      "Generated API key for LauncherHttpServer: {ApiKey}"
  |
  +--> Comparison: String equality (NOT constant-time)
  |      LauncherHttpServer.cs:164: authHeader.ToString().Substring(7) != _apiKey
  |      TIMING ATTACK VECTOR
  |
  +--> Storage: In-memory field (_apiKey)

Dashboard JWT
  |
  +--> Secret Key: From configuration (env var / appsettings.json)
  |      Dev fallback: "DataWarehouse_Development_Secret_Key_At_Least_32_Chars!"
  |      RISK: If environment detection wrong, dev key in production
  |
  +--> Token: HS256 signed, 8-hour expiry
  |      Refresh: 7-day expiry, stored in-memory ConcurrentDictionary
  |
  +--> SignalR: JWT in query string (?access_token=...)
         RISK: Token in URL = logged in web server access logs, browser history, referrer headers
```

### 5.4 Log Sanitization

```
ErrorHandling.cs:82 - Regex pattern to detect and redact secrets:
  (password|secret|key|token|credential|apikey|api_key|auth|bearer|jwt|session|private)

ErrorHandling.cs:702 - Connection string sanitization:
  (secret|key)\s*=\s*[^;]+ -> $1=********

EXCEPTION: LauncherHttpServer.cs:80 LOGS THE API KEY DIRECTLY:
  _logger.LogWarning("Generated API key for LauncherHttpServer: {ApiKey}", _apiKey)
```

---

## Section 6: v4.3/v4.4 Fix Regression Verification

### CRIT-01: TLS Certificate Validation (was 15 files)

| File | v4.3 Status | v4.5 Status | Evidence |
|------|-------------|-------------|----------|
| AdaptiveTransportPlugin.cs:553 | BYPASS | **FIXED** - Configurable via `_config.VerifySslCertificates` (default true) | Line 555: `if (!_config.VerifySslCertificates)` |
| QuicDataPlanePlugin.cs:488 | BYPASS | **FIXED** - Configurable via config options (default true) | Line 469-472: `var verifySsl = true; if (config.Options?.TryGetValue...)` |
| FederationSystem.cs:608 | BYPASS | **FIXED** - Configurable via `config.ValidateServerCertificate` (default true) | Line 176: `public bool ValidateServerCertificate { get; init; } = true;` |
| DynamoDbConnectionStrategy.cs:46 | BYPASS | **FIXED** - Configurable via `_verifySsl` (default true) | Line 17: `private bool _verifySsl = true;` |
| CosmosDbConnectionStrategy.cs:46 | BYPASS | **FIXED** - Configurable via `_verifySsl` (default true) | Line 17: `private bool _verifySsl = true;` |
| ElasticsearchProtocolStrategy.cs:82 | BYPASS | **FIXED** - Conditional on `!_verifySsl && parameters.UseSsl` | Line 27: `private bool _verifySsl = true;` |
| ElasticsearchProtocolStrategy.cs:750 | BYPASS | **FIXED** - Same pattern | Line 694: `private bool _verifySsl = true;` |
| RestStorageStrategy.cs:247 | BYPASS | **FIXED** - Configurable via `_validateServerCertificate` (default true) | Line 198 |
| **GrpcStorageStrategy.cs:160-163** | **BYPASS** | **STILL VULNERABLE** | Comment: "In production, implement proper certificate validation" + `return true;` |
| DashboardStrategyBase.cs:452 | BYPASS | **FIXED** - Configurable via `Config.VerifySsl` (default true) | Line 74: `public bool VerifySsl { get; init; } = true;` |
| WekaIoStrategy.cs:173 | BYPASS | **FIXED** - Configurable via `_validateCertificate` | Line 171: `if (!_validateCertificate)` |
| VastDataStrategy.cs:224 | BYPASS | **FIXED** - Configurable via `_validateCertificate` | Line 222: `if (!_validateCertificate)` |
| PureStorageStrategy.cs:163 | BYPASS | **FIXED** - Configurable via `_validateCertificate` | Line 161: `if (!_validateCertificate)` |
| NetAppOntapStrategy.cs:156 | BYPASS | **FIXED** - Configurable via `_validateCertificate` | Line 154: `if (!_validateCertificate)` |
| HpeStoreOnceStrategy.cs:166 | BYPASS | **FIXED** - Configurable via `_validateCertificate` | Line 164: `if (!_validateCertificate)` |
| WebDavStrategy.cs:164 | BYPASS | **FIXED** - Configurable via `_validateServerCertificate` (default true) | Line 162: `if (!_validateServerCertificate)` |
| IcingaStrategy.cs:47 | BYPASS | **FIXED** - Configurable via `_verifySsl` (default true) | Line 23: `private bool _verifySsl = true;` |
| AdditionalSearchStrategies.cs:73 | (new) | **FIXED** - Configurable via `_verifySsl` (default true) | Line 71: `if (parameters.UseSsl && !_verifySsl)` |

**Result: 16 of 17 FIXED (configurable, default-safe). 1 STILL VULNERABLE (GrpcStorageStrategy).**

### HIGH-01: XXE in XmlDocumentRegenerationStrategy

**VERIFIED FIXED.** `XmlDocumentRegenerationStrategy.cs:346` now has `DtdProcessing = DtdProcessing.Prohibit`. Line 372 uses `XmlReader.Create(new StringReader(xml), settings)`.

### HIGH-02: XXE in SamlStrategy

**VERIFIED FIXED.** `SamlStrategy.cs:95` now has `DtdProcessing = DtdProcessing.Prohibit`. Line 98 uses `XmlReader.Create(new System.IO.StringReader(assertionXml), settings)`.

### HIGH-03: Unauthenticated Launcher HTTP API

**VERIFIED FIXED.** `LauncherHttpServer.cs:151-171` now has API Key authentication middleware. All endpoints except `/api/v1/health` require `Authorization: Bearer {apiKey}` header.

**However, new issues found:**
1. API key comparison is NOT constant-time (line 164: `!= _apiKey`) - timing attack possible
2. API key is logged in plaintext on startup (line 80)
3. Server binds to 0.0.0.0 (all interfaces, line 98) - exposes to network

### HIGH-04: SHA256 for Password Hashing

**VERIFIED FIXED.** All three password hashing locations now use PBKDF2:
- `UserAuthenticationService.cs:518`: `Rfc2898DeriveBytes.Pbkdf2(..., 100000, HashAlgorithmName.SHA256, 32)`
- `AuthController.cs:273`: `Rfc2898DeriveBytes.Pbkdf2(..., 100_000, HashAlgorithmName.SHA256, 32)`
- `DataWarehouseHost.cs:622`: `Rfc2898DeriveBytes.Pbkdf2(..., 100000, HashAlgorithmName.SHA256, 32)`

**Note:** 100K iterations meets OWASP minimum (2023 recommendation: 600K for SHA256). The iteration count should be raised to 600K+ for NIST SP 800-63B compliance.

### HIGH-05: Default Admin Password

**VERIFIED FIXED.**
- `DataWarehouseHost.cs:448-449`: `if (config.CreateDefaultAdmin && string.IsNullOrEmpty(config.AdminPassword)) throw new ArgumentException(...)`
- `DataWarehouseHost.cs:609-611`: `if (string.IsNullOrWhiteSpace(config.AdminPassword)) throw new ArgumentException(...)`
- `AuthController.cs:25-29`: Static constructor explicitly does NOT create default users.
- `UserAuthenticationService.cs:68`: Comment: "Security: Do NOT create default admin user with hardcoded password."

### MED-01: No Secure Deletion

**STILL PRESENT.** `File.Delete()` used across 193 occurrences in 126 files. No secure overwrite before deletion.

### MED-02: Security.json Permissions

**STILL PRESENT.** `DataWarehouseHost.cs:653`: `await File.WriteAllTextAsync(securityPath, json, ct)` - no `File.SetAccessControl()` or Unix `chmod` equivalent.

### MED-04: No Rate Limiting on Launcher API

**VERIFIED FIXED.** `LauncherHttpServer.cs:117-148` implements rate limiting middleware: 100 requests/minute per IP with 429 response and Retry-After header.

### MED-06: Exception Swallowing

**NOT RE-VERIFIED** (spot check - would need targeted scan of CanaryStrategy.cs and PolicyBasedAccessControlStrategy.cs).

### LOW-03: Plugin Assembly Integrity Not Verified

**PARTIALLY FIXED.** `PluginLoader.cs:119-249` now has comprehensive security validation (hash verification, strong name checks, size limits, trusted publisher whitelist).

**HOWEVER:** `DataWarehouseKernel.cs:423` uses `Assembly.LoadFrom(assemblyPath)` directly, BYPASSING the PluginLoader entirely. This is the kernel's own plugin loading path.

### LOW-06: XDocument.Load on Untrusted Input

**STILL PRESENT.** 10+ instances in UltimateDataFormat strategies (XmlStrategy, PmmlStrategy, GraphMlStrategy, KmlStrategy) use `XDocument.Load(stream)` without explicit `XmlReaderSettings`. On .NET 6+ the default is safe, but explicit hardening is missing.

### LOW-07: No CORS on Launcher API

**STILL PRESENT.** No CORS headers configured on Launcher HTTP server. Dashboard has proper CORS configuration.

---

## Section 7: New Findings

### FINDING-01: GrpcStorageStrategy Unconditional TLS Certificate Bypass
**CVSS: 9.1** (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:H/I:H/A:N)
**CWE:** CWE-295 (Improper Certificate Validation)
**Evidence:** `GrpcStorageStrategy.cs:160-163`
```csharp
RemoteCertificateValidationCallback = (sender, certificate, chain, errors) =>
{
    // In production, implement proper certificate validation
    return true;
}
```
This is the LAST remaining unconditional TLS bypass. All 16 other instances were fixed in v4.4 to be configurable with default-safe behavior. This one was missed.

### FINDING-02: Launcher API Key Timing Attack
**CVSS: 5.9** (CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:N/A:N)
**CWE:** CWE-208 (Observable Timing Discrepancy)
**Evidence:** `LauncherHttpServer.cs:164`
```csharp
authHeader.ToString().Substring(7) != _apiKey
```
String inequality uses short-circuit comparison. An attacker can guess the API key character-by-character by measuring response time differences. Should use `CryptographicOperations.FixedTimeEquals()`.

### FINDING-03: API Key Logged in Plaintext
**CVSS: 5.5** (CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:N/A:N)
**CWE:** CWE-532 (Insertion of Sensitive Information into Log File)
**Evidence:** `LauncherHttpServer.cs:80`
```csharp
_logger.LogWarning("Generated API key for LauncherHttpServer: {ApiKey}", _apiKey);
```
The API key is written to logs in plaintext. Any log aggregation system, log file reader, or SIEM that ingests these logs gains full API access to the Launcher.

### FINDING-04: Kernel Plugin Loading Bypasses Security Validation
**CVSS: 7.2** (CVSS:3.1/AV:L/AC:L/PR:H/UI:N/S:C/C:H/I:H/A:H)
**CWE:** CWE-829 (Inclusion of Functionality from Untrusted Control Sphere)
**Evidence:** `DataWarehouseKernel.cs:421-423`
```csharp
private async Task LoadPluginsFromAssemblyAsync(string assemblyPath, CancellationToken ct)
{
    var assembly = Assembly.LoadFrom(assemblyPath);
```
The kernel loads plugins via `Assembly.LoadFrom()` without calling `PluginLoader.ValidateAssemblySecurity()`. The PluginLoader class (with hash verification, strong name checks, size limits) exists but is not used in this code path. An attacker who can place a DLL in the plugins directory gets arbitrary code execution in the kernel process.

### FINDING-05: JWT Token in SignalR Query String
**CVSS: 4.3** (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N)
**CWE:** CWE-598 (Use of GET Request Method With Sensitive Query Strings)
**Evidence:** `Program.cs:71-78`
```csharp
options.Events.OnMessageReceived = context =>
{
    var accessToken = context.Request.Query["access_token"];
    if (!string.IsNullOrEmpty(accessToken) && path.StartsWithSegments("/hubs"))
    {
        context.Token = accessToken;
    }
```
JWT tokens passed as query parameters appear in server access logs, browser history, and HTTP Referer headers. This is a standard pattern for SignalR/WebSocket (which cannot set custom headers during handshake), but the token should have minimal scope/short TTL.

### FINDING-06: P2P Network Allows 100MB Messages
**CVSS: 4.3** (CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:N/A:L)
**CWE:** CWE-770 (Allocation of Resources Without Limits or Throttling)
**Evidence:** `TcpP2PNetwork.cs:420`
```csharp
if (length <= 0 || length > 100 * 1024 * 1024) // Max 100 MB
```
A peer can send a 4-byte length prefix claiming 100MB, forcing allocation of 100MB from ArrayPool. Multiple peers sending large messages simultaneously could exhaust memory (DoS).

### FINDING-07: Raft Consensus TCP Listener Without Authentication
**CVSS: 7.5** (CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:H/A:H)
**CWE:** CWE-306 (Missing Authentication for Critical Function)
**Evidence:** `RaftConsensusPlugin.cs:1199`
```csharp
_listener = new TcpListener(IPAddress.Any, _config.BasePort);
```
The Raft consensus listener binds to all interfaces with no TLS and no authentication. An attacker on the network can inject Raft messages to manipulate leader election, log replication, or cluster membership.

### FINDING-08: mDNS Discovery Unsecured
**CVSS: 4.3** (CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:N)
**CWE:** CWE-346 (Origin Validation Error)
**Evidence:** `MdnsServiceDiscovery.cs:183-185`
```csharp
var client = new UdpClient();
```
mDNS uses UDP multicast (224.0.0.251:5353) without authentication. An attacker on the same network segment can spoof service announcements to redirect DataWarehouse nodes to attacker-controlled endpoints.

### FINDING-09: PBKDF2 Iteration Count Below NIST Recommendation
**CVSS: 3.7** (CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:N/A:N)
**CWE:** CWE-916 (Use of Password Hash With Insufficient Computational Effort)
**Evidence:** `UserAuthenticationService.cs:520`, `AuthController.cs:276`, `DataWarehouseHost.cs:625`
All use 100,000 iterations. NIST SP 800-63B (2023) recommends 600,000+ iterations for PBKDF2-SHA256. While 100K is above the OWASP minimum, it is below the NIST recommended threshold.

---

## Section 8: Prioritized Target List for Plans 02-07

### Plan 02: Injection & Input Validation
- **P1:** XDocument.Load without XmlReaderSettings (XP-04 through XP-08) - 10+ files
- **P1:** 66 Process.Start invocations - check for argument injection
- **P2:** Message bus topic injection - can a plugin publish to arbitrary topics?
- **P2:** Path traversal testing on storage operations (PathStorageAdapter has checks, verify completeness)

### Plan 03: Authentication & Authorization
- **P1:** Launcher API key timing attack (FINDING-02)
- **P1:** API key logged in plaintext (FINDING-03)
- **P1:** Raft consensus no authentication (FINDING-07)
- **P2:** JWT token in query string exposure (FINDING-05)
- **P2:** SignalR hub authorization verification
- **P3:** mDNS service discovery spoofing (FINDING-08)

### Plan 04: Cryptographic Assessment
- **P1:** GrpcStorageStrategy unconditional TLS bypass (FINDING-01)
- **P2:** PBKDF2 iteration count (FINDING-09)
- **P2:** API key generation entropy (Guid.NewGuid on .NET 6+)
- **P3:** TLS version enforcement across all connections

### Plan 05: Data Protection & Privacy
- **P1:** security.json file permissions (MED-02)
- **P1:** Credential vault encryption key storage
- **P2:** Log sanitization completeness (API key logging gap)
- **P2:** No secure file deletion (MED-01)
- **P3:** Memory wiping completeness for sensitive data

### Plan 06: Plugin & Assembly Security
- **P1:** Kernel bypasses PluginLoader validation (FINDING-04)
- **P1:** Plugin-level code execution via message bus (workflow.execute, sdkports.invoke)
- **P2:** ChameleonProtocolEmulator as open proxy (EP-19)
- **P3:** AccessEnforcementInterceptor bypass topics

### Plan 07: Network & Infrastructure
- **P1:** Launcher HTTP on 0.0.0.0 without TLS
- **P1:** P2P 100MB message allocation (FINDING-06)
- **P2:** mDNS spoofing for cluster poisoning
- **P2:** Kubernetes probes information disclosure
- **P3:** CORS on Launcher API

---

## Appendix A: File Count Summary

| Category | Count |
|----------|-------|
| Network entry points | 37+ |
| Message bus topics | 60+ |
| JSON deserialization sinks | 80+ |
| XML parsing points | 8 |
| Process.Start invocations | 66 across 30 files |
| TLS cert validation callbacks | 24 across 18 files |
| File.Delete (no secure wipe) | 193 across 126 files |

## Appendix B: Tools and Methodology

- Static analysis via regex pattern matching across full codebase
- Manual code review of all security-critical paths
- Trust boundary mapping from entry points to data sinks
- Regression testing of all 27 v4.3 findings
- CVSS 3.1 scoring per FIRST.org calculator
