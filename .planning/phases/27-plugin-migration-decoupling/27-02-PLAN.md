---
phase: 27-plugin-migration-decoupling
plan: 02
type: execute
wave: 2
depends_on: ["27-01"]
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateEncryption/UltimateEncryptionPlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateCompression/UltimateCompressionPlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateStorage/UltimateStoragePlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateDatabaseStorage/UltimateDatabaseStoragePlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateDatabaseProtocol/UltimateDatabaseProtocolPlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateStorageProcessing/UltimateStorageProcessingPlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateReplication/UltimateReplicationPlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateRAID/UltimateRaidPlugin.cs
  - Plugins/DataWarehouse.Plugins.UltimateDataTransit/UltimateDataTransitPlugin.cs
  - Plugins/DataWarehouse.Plugins.TamperProof/TamperProofPlugin.cs
autonomous: true

must_haves:
  truths:
    - "All DataPipeline-branch Ultimate plugins inherit from their respective Hierarchy domain bases (EncryptionPluginBase, CompressionPluginBase, StoragePluginBase, ReplicationPluginBase, DataTransitPluginBase, IntegrityPluginBase)"
    - "TamperProofPlugin migrated from bare PluginBase to IntegrityPluginBase (DataPipeline branch)"
    - "All migrated plugins implement any new abstract methods required by Hierarchy bases"
    - "All plugins build with zero new errors"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateEncryption/UltimateEncryptionPlugin.cs"
      provides: "Encryption plugin on EncryptionPluginBase"
      contains: "EncryptionPluginBase"
    - path: "Plugins/DataWarehouse.Plugins.UltimateStorage/UltimateStoragePlugin.cs"
      provides: "Storage plugin on StoragePluginBase (Hierarchy)"
      contains: "Hierarchy"
    - path: "Plugins/DataWarehouse.Plugins.TamperProof/TamperProofPlugin.cs"
      provides: "TamperProof on IntegrityPluginBase"
      contains: "IntegrityPluginBase"
  key_links:
    - from: "Ultimate DataPipeline plugins"
      to: "Hierarchy.DataPipeline bases"
      via: "inheritance"
      pattern: ":\\s*(EncryptionPluginBase|CompressionPluginBase|StoragePluginBase|ReplicationPluginBase|DataTransitPluginBase|IntegrityPluginBase)"
---

<objective>
Migrate all DataPipeline-branch Ultimate plugins from obsolete IntelligenceAware* specialized bases (or bare PluginBase) to the new Hierarchy DataPipeline domain bases.

Purpose: These 10 plugins handle the core data pipeline (encryption, compression, storage, replication, transit, integrity). Migrating them to the proper Hierarchy bases gives them standardized pipeline semantics (ordering, back-pressure, throughput tracking) and proper domain-specific contracts.

Output: 10 plugin files updated with correct Hierarchy base classes and all abstract methods implemented.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/27-plugin-migration-decoupling/27-RESEARCH.md
@.planning/phases/27-plugin-migration-decoupling/27-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Migrate Category A DataPipeline plugins (IntelligenceAware* specialized bases to Hierarchy)</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateEncryption/UltimateEncryptionPlugin.cs
    Plugins/DataWarehouse.Plugins.UltimateCompression/UltimateCompressionPlugin.cs
    Plugins/DataWarehouse.Plugins.UltimateStorage/UltimateStoragePlugin.cs
  </files>
  <action>
    Migrate 3 plugins from their obsolete `IntelligenceAware*PluginBase` to new Hierarchy DataPipeline bases.

    **UltimateEncryptionPlugin:**
    - FROM: `IntelligenceAwareEncryptionPluginBase` (Obsolete)
    - TO: `EncryptionPluginBase` (DataWarehouse.SDK.Contracts.Hierarchy)
    - EncryptionPluginBase inherits DataTransformationPluginBase -> DataPipelinePluginBase -> IntelligenceAwarePluginBase
    - EncryptionPluginBase has NO new abstract methods (only virtual Transform methods)
    - Change using directive from `DataWarehouse.SDK.Contracts.IntelligenceAware` to `DataWarehouse.SDK.Contracts.Hierarchy`
    - If the old IntelligenceAwareEncryptionPluginBase had abstract methods that the plugin overrides, verify those methods still exist on EncryptionPluginBase or its parents. If not, convert overrides to regular methods.

    **UltimateCompressionPlugin:**
    - FROM: `IntelligenceAwareCompressionPluginBase` (Obsolete)
    - TO: `CompressionPluginBase` (DataWarehouse.SDK.Contracts.Hierarchy)
    - CompressionPluginBase inherits DataTransformationPluginBase -> DataPipelinePluginBase -> IntelligenceAwarePluginBase
    - CompressionPluginBase has NO new abstract methods (only virtual Transform methods)
    - Same using directive change
    - NOTE: UltimateCompression has pre-existing CS1729 build errors (SharpCompress API). Do NOT attempt to fix those. Only change the base class.

    **UltimateStoragePlugin:**
    - FROM: `IntelligenceAwareStoragePluginBase` (Obsolete)
    - TO: `StoragePluginBase` (DataWarehouse.SDK.Contracts.Hierarchy) -- BUT this is the NEW key-based StoragePluginBase, which requires 7 abstract methods: StoreAsync, RetrieveAsync, DeleteAsync, ExistsAsync, ListAsync, GetMetadataAsync, GetHealthAsync
    - The plugin likely already has equivalent methods from IntelligenceAwareStoragePluginBase. Map existing implementations to the new abstract method signatures.
    - If method signatures differ, create bridge implementations that delegate to existing methods.
    - Add `using DataWarehouse.SDK.Contracts.Hierarchy;`

    After each plugin migration, verify it compiles: `dotnet build Plugins/DataWarehouse.Plugins.UltimateEncryption/`
  </action>
  <verify>
    `dotnet build Plugins/DataWarehouse.Plugins.UltimateEncryption/` -- zero new errors
    `dotnet build Plugins/DataWarehouse.Plugins.UltimateStorage/` -- zero new errors
    UltimateCompression has pre-existing errors; verify no NEW errors added by grepping build output
  </verify>
  <done>UltimateEncryption, UltimateCompression, and UltimateStorage inherit from their respective Hierarchy DataPipeline bases with all abstract methods implemented.</done>
</task>

<task type="auto">
  <name>Task 2: Migrate Category B DataPipeline plugins (bare IntelligenceAwarePluginBase to specific domain) and TamperProof special case</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateDatabaseStorage/UltimateDatabaseStoragePlugin.cs
    Plugins/DataWarehouse.Plugins.UltimateDatabaseProtocol/UltimateDatabaseProtocolPlugin.cs
    Plugins/DataWarehouse.Plugins.UltimateStorageProcessing/UltimateStorageProcessingPlugin.cs
    Plugins/DataWarehouse.Plugins.UltimateReplication/UltimateReplicationPlugin.cs
    Plugins/DataWarehouse.Plugins.UltimateRAID/UltimateRaidPlugin.cs
    Plugins/DataWarehouse.Plugins.UltimateDataTransit/UltimateDataTransitPlugin.cs
    Plugins/DataWarehouse.Plugins.TamperProof/TamperProofPlugin.cs
  </files>
  <action>
    Migrate 6 plugins from bare `IntelligenceAwarePluginBase` and 1 from bare `PluginBase` to specific Hierarchy DataPipeline bases.

    **Storage domain (3 plugins -> StoragePluginBase):**
    - `UltimateDatabaseStoragePlugin : IntelligenceAwarePluginBase` -> `: StoragePluginBase` (Hierarchy)
    - `UltimateDatabaseProtocolPlugin : IntelligenceAwarePluginBase` -> `: StoragePluginBase` (Hierarchy)
    - `UltimateStorageProcessingPlugin : IntelligenceAwarePluginBase` -> `: StoragePluginBase` (Hierarchy)
    - StoragePluginBase requires 7 abstract methods. For each plugin:
      - If the plugin already has methods matching the signatures, add `override` keyword
      - If the plugin has differently-named equivalent methods, create override bridge methods that delegate
      - If the plugin has no equivalent, implement with `throw new NotSupportedException($"{nameof(MethodName)} not supported by this storage plugin")` -- but this should be rare since these ARE storage plugins

    **Replication domain (2 plugins -> ReplicationPluginBase):**
    - `UltimateReplicationPlugin : IntelligenceAwarePluginBase` -> `: ReplicationPluginBase` (Hierarchy)
    - `UltimateRaidPlugin : IntelligenceAwarePluginBase` -> `: ReplicationPluginBase` (Hierarchy)
    - ReplicationPluginBase requires: `abstract Task<Dictionary<string, object>> ReplicateAsync(string key, string[] targetNodes, CancellationToken ct)` and `abstract Task<Dictionary<string, object>> GetSyncStatusAsync(string key, CancellationToken ct)`
    - These plugins likely have replication methods already. Map to the new signatures.

    **Transit domain (1 plugin -> DataTransitPluginBase):**
    - Find UltimateDataTransitPlugin's current base class. If it's on LegacyFeaturePluginBase (research says so), change to `DataTransitPluginBase` (Hierarchy.DataPipeline).
    - DataTransitPluginBase -- read the file to check its abstract requirements. Implement any required abstract methods.

    **Integrity domain - TamperProof special case (1 plugin -> IntegrityPluginBase):**
    - `TamperProofPlugin : PluginBase` -> `: IntegrityPluginBase` (Hierarchy.DataPipeline)
    - This is a Category E special case: bare PluginBase, so it skips IntelligenceAwarePluginBase entirely
    - IntegrityPluginBase -- read to check requirements. Implement abstract methods.
    - TamperProofPlugin has a `new ShutdownAsync` from Phase 24. After moving to IntegrityPluginBase (which has ShutdownAsync through PluginBase), verify the `new` keyword is still needed or can be removed.
    - Must implement Id, Name, Version if not already present (PluginBase requires them)

    For each plugin, add `using DataWarehouse.SDK.Contracts.Hierarchy;` and remove obsolete using directives.

    Build each plugin after migration.
  </action>
  <verify>
    `dotnet build DataWarehouse.slnx` -- verify all DataPipeline plugins compile (only pre-existing errors acceptable).
    Grep all 10 plugin files for the correct Hierarchy base class name.
  </verify>
  <done>All 7 DataPipeline plugins migrated to correct Hierarchy bases. TamperProofPlugin on IntegrityPluginBase. All compile.</done>
</task>

</tasks>

<verification>
- All 10 DataPipeline-branch plugins use Hierarchy bases (grep confirms)
- Zero references to IntelligenceAwareEncryptionPluginBase, IntelligenceAwareCompressionPluginBase, IntelligenceAwareStoragePluginBase in plugin code
- `dotnet build DataWarehouse.slnx` shows zero new errors
</verification>

<success_criteria>
1. UltimateEncryption -> EncryptionPluginBase, UltimateCompression -> CompressionPluginBase, UltimateStorage -> StoragePluginBase (Hierarchy)
2. UltimateDatabaseStorage/DatabaseProtocol/StorageProcessing -> StoragePluginBase (Hierarchy)
3. UltimateReplication/UltimateRAID -> ReplicationPluginBase (Hierarchy)
4. UltimateDataTransit -> DataTransitPluginBase (Hierarchy)
5. TamperProofPlugin -> IntegrityPluginBase (Hierarchy) -- special case from bare PluginBase
6. All plugins build successfully
</success_criteria>

<output>
After completion, create `.planning/phases/27-plugin-migration-decoupling/27-02-SUMMARY.md`
</output>
