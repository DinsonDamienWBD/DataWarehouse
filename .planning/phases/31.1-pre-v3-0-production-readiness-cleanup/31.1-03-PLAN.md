# Plan 31.1-03: Interface Bus Calls + Format Strategies + Scattered Fixes

## Goal
Replace UltimateInterface placeholder bus calls with real message bus integration, handle UltimateDataFormat stub strategies, and fix all remaining scattered placeholders.

## Tasks

### Task 1: UltimateInterface Message Bus Integration (30+ methods)

**Pattern:** Replace `await Task.CompletedTask; // Placeholder for actual bus call` + mock data return with real `MessageBus.RequestAsync<TRequest, TResponse>()` calls.

**REST Strategies (5 strategies, ~23 bus calls):**
1. RestInterfaceStrategy — 6 placeholder bus calls → real CRUD via message bus
2. ODataStrategy — 5 placeholder bus calls → real query/filter via message bus
3. JsonApiStrategy — 4 placeholder bus calls → real resource operations
4. HateoasStrategy — 5 placeholder bus calls → real hypermedia operations
5. FalcorStrategy — 3 placeholder bus calls → real JSON graph operations

**RealTime Strategies (5 strategies, ~14 bus calls):**
6. WebSocketInterfaceStrategy — 3 placeholder bus calls
7. SocketIoStrategy — 3 placeholder bus calls
8. SignalRStrategy — 4 placeholder bus calls
9. ServerSentEventsStrategy — 2 placeholder bus calls
10. LongPollingStrategy — 2 placeholder bus calls

**Security Strategies (3 strategies):**
11. EdgeCachedApiStrategy — 1 placeholder service call
12. CostAwareApiStrategy — 1 placeholder service call

**Query Strategy:**
13. GraphQLInterfaceStrategy — mock data structure

**Implementation Pattern:**
```csharp
// Before (placeholder):
await Task.CompletedTask; // Placeholder for actual bus call
return new { id = 1, name = "Sample Resource" };

// After (real):
var response = await MessageBus.RequestAsync<StorageRequest, StorageResponse>(
    "storage.read", new StorageRequest { Key = key }, cancellationToken);
return response?.Data ?? throw new InvalidOperationException("No storage response");
```

### Task 2: UltimateDataFormat Strategy Decision (14 strategies)

For strategies requiring external NuGet packages that aren't available:

**Option A — Implement with available .NET APIs (preferred where possible):**
- Protobuf: Implement basic protobuf wire format parsing (varint + length-delimited)
- MessagePack: Already have System.Text.Json, implement basic msgpack binary parsing
- Avro: Implement basic Avro container format reading (sync markers + schema header)

**Option B — Convert to "driver required" pattern (for native/Java libraries):**
For formats that genuinely need native libraries (HDF5, NetCDF, VTK, CGNS, GeoTIFF):
- Keep detection working (magic bytes)
- Replace `return DataFormatResult.Fail("requires X library")` with proper `DataFormatResult.Fail(DataFormatErrorCode.DriverRequired, "Format detected as X. Install NuGet package Y to enable parsing.")`
- This is a LEGITIMATE production pattern — format detection works, parsing requires driver installation

**Option C — Implement basic parsing for common formats:**
- **[SKIP Parquet — Phase 40-05 uses Parquet.Net NuGet]** Use "driver required" pattern instead.
- **[SKIP Arrow — Phase 40-05 uses Apache.Arrow NuGet]** Use "driver required" pattern instead.
- **[SKIP HDF5 — Phase 40-05 builds managed binary parser]** Use "driver required" pattern instead.
- Shapefile: Read .shp header + record structure (simple binary format) — **[KEEP, no v3.0 overlap]**

### Task 3: Scattered Fixes (~10 methods across 7 plugins)

1. **UltimateKeyManagement** (3 fixes)
   - ThresholdEcdsaStrategy: Real MtA protocol scalar computation
   - ZeroDowntimeRotation: Real rotation work (not Task.Delay)
   - SoloKeyStrategy: Real FIDO2 key generation pattern

2. **UltimateSustainability** (4 fixes)
   - WorkloadConsolidation, SleepStates, PowerCapping: Use real OS power APIs
   - UpsIntegration: Real UPS status query via WMI/ACPI

3. **UltimateCompliance** (3 fixes)
   - DataRetentionPolicy: Real deletion via message bus
   - GeolocationService: Real geo lookup (IP-based, no external API needed)
   - Attestation: Real TPM query via TBS API on Windows

4. **Others** (1 each)
   - AirGapBridge: Load real blob from storage
   - UltimateIntelligence AutoML: Schema extraction implementations
   - UltimateDatabaseProtocol: Fix compression providers (use System.IO.Compression APIs)
   - DataMarketplace: Real deployment (message bus)
   - Transcoding.Media: Real file length calculation
   - UltimateServerless: Real invocation via message bus

### Task 4: Update PLUGIN-CATALOG.md

Update completeness status for all 17 affected plugins to reflect post-fix state.

## Success Criteria
- [ ] UltimateInterface strategies use real MessageBus for all data operations
- [ ] UltimateDataFormat: common formats implemented, rare formats have clear driver-required messages
- [ ] All scattered placeholders replaced with real implementations
- [ ] PLUGIN-CATALOG.md reflects current state
- [ ] Full solution builds with 0 new errors
- [ ] Zero instances of "Placeholder", "Simulated", "mock data" in strategy method bodies
