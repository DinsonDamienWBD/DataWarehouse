# Plan 31.1-01: Security Fixes + Build Errors + Wiring

## Goal
Fix all P0 security-critical fakes, P1 build-breaking errors, and P2 wiring gaps. This is the highest-priority, smallest-scope work.

## Tasks

### Task 1: P0 Security Fixes (4 methods)

1. **QuantumSafeApiStrategy** — Replace Base64 encode/decode with real AES-256-GCM encryption using SDK's cryptographic utilities
   - File: `Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Security/QuantumSafeApiStrategy.cs`
   - Lines 264, 295: Replace Base64 with Aes.Create() + GCM mode

2. **AirGappedBackupStrategy** — Implement real encryption delegation
   - File: `Plugins/DataWarehouse.Plugins.UltimateDataProtection/Strategies/Advanced/AirGappedBackupStrategy.cs`
   - Line 523: Use AES-256-GCM to actually encrypt backup data

3. **BreakGlassRecoveryStrategy** — Implement real encrypt/decrypt
   - File: `Plugins/DataWarehouse.Plugins.UltimateDataProtection/Strategies/Advanced/BreakGlassRecoveryStrategy.cs`
   - Lines 613, 619: Use AES-256-GCM for backup encryption/decryption

4. **SneakernetOrchestratorStrategy** — Implement real SHA-256 integrity verification
   - File: `Plugins/DataWarehouse.Plugins.UltimateDataProtection/Strategies/Innovations/SneakernetOrchestratorStrategy.cs`
   - Line 997: Replace `return true` with SHA-256 hash comparison

### Task 2: P1 Build Error Fixes (13 errors)

1. **UltimateCompression** — Fix SharpCompress v0.45.1 API changes (12 errors)
   - Update LzmaStream constructor calls (3→2 args) in: XzStrategy.cs, SevenZipStrategy.cs, LzmaStrategy.cs, Lzma2Strategy.cs
   - Update BZip2Stream constructor calls in: Bzip2Strategy.cs
   - Research exact SharpCompress v0.45.1 API before fixing

2. **AedsCore** — Fix MQTTnet v5.x namespace (1 error)
   - File: `Plugins/DataWarehouse.Plugins.AedsCore/ControlPlane/MqttControlPlanePlugin.cs`
   - Update `using MQTTnet.Client` to correct v5.x namespace

### Task 3: P2 Wiring Fixes (8 issues)

1. **TamperProof message bus wiring**
   - Remove custom `IMessageBusClient` interface from Services/MessageBusIntegration.cs
   - Use SDK's `IMessageBus` from base class `MessageBus` property
   - Instantiate `MessageBusIntegrationService` in plugin constructor
   - Uncomment `PublishAsync` calls for violation/alert events
   - Fix RecoveryService placeholder hash → real content hash
   - Fix ComplianceReportingService GUID hash → real block hash

2. **FuseDriver message bus fix**
   - Replace `GetMessageBus()` with base class `MessageBus` property
   - Remove null-check bailouts at lines 680, 691

3. **UltimateInterface webhook wiring**
   - Uncomment `MessageBus.PublishAsync(topic, payload, ct)` in GenericWebhookStrategy.cs:144

4. **UltimateAccessControl AI integration**
   - UebaStrategy: Replace `null` with real `MessageBus.RequestAsync<AnalysisRequest, AnalysisResponse>()` call
   - ThreatIntelStrategy: Replace `null` with real `MessageBus.RequestAsync<EnrichmentRequest, EnrichmentResponse>()` call

## Success Criteria
- [ ] Zero fake encryption (QuantumSafe, AirGapped, BreakGlass use real AES-256-GCM)
- [ ] SneakernetOrchestrator verifies actual SHA-256 hashes
- [ ] UltimateCompression builds (0 CS1729 errors)
- [ ] AedsCore builds (0 CS0234 errors)
- [ ] TamperProof publishes events to message bus
- [ ] FuseDriver uses base class MessageBus
- [ ] UltimateInterface webhook forwards events
- [ ] UltimateAccessControl UEBA/ThreatIntel use message bus request-response
- [ ] Full solution builds with 0 new errors
