---
phase: 64-moonshot-wiring
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - DataWarehouse.SDK/Moonshots/IMoonshotOrchestrator.cs
  - DataWarehouse.SDK/Moonshots/MoonshotPipelineTypes.cs
  - DataWarehouse.SDK/Moonshots/MoonshotRegistry.cs
  - DataWarehouse.SDK/Moonshots/IMoonshotHealthProbe.cs
  - DataWarehouse.SDK/Moonshots/MoonshotDashboardTypes.cs
autonomous: true

must_haves:
  truths:
    - "SDK defines a cross-moonshot orchestration pipeline contract (ingest to lifecycle)"
    - "Each moonshot is addressable by MoonshotId enum with feature flags and readiness status"
    - "MoonshotRegistry tracks all 10 moonshots with current status, configuration, and health"
    - "Health probe interface defines per-moonshot independent readiness checks"
    - "Dashboard model types exist for unified metrics aggregation across all moonshots"
  artifacts:
    - path: "DataWarehouse.SDK/Moonshots/IMoonshotOrchestrator.cs"
      provides: "IMoonshotOrchestrator, IMoonshotPipelineStage, MoonshotPipelineContext"
      min_lines: 120
    - path: "DataWarehouse.SDK/Moonshots/MoonshotPipelineTypes.cs"
      provides: "MoonshotId enum, MoonshotStageResult, MoonshotPipelineResult, MoonshotFeatureFlag"
      min_lines: 150
    - path: "DataWarehouse.SDK/Moonshots/MoonshotRegistry.cs"
      provides: "IMoonshotRegistry, MoonshotRegistration, MoonshotStatus records"
      min_lines: 80
    - path: "DataWarehouse.SDK/Moonshots/IMoonshotHealthProbe.cs"
      provides: "IMoonshotHealthProbe, MoonshotHealthReport, MoonshotReadiness"
      min_lines: 60
    - path: "DataWarehouse.SDK/Moonshots/MoonshotDashboardTypes.cs"
      provides: "MoonshotMetrics, MoonshotDashboardSnapshot, MoonshotTrendPoint"
      min_lines: 100
  key_links:
    - from: "IMoonshotOrchestrator"
      to: "MoonshotPipelineTypes"
      via: "MoonshotId enum and MoonshotPipelineContext"
      pattern: "MoonshotId|MoonshotPipelineContext"
    - from: "MoonshotRegistry"
      to: "IMoonshotHealthProbe"
      via: "registry queries health probes for status"
      pattern: "IMoonshotHealthProbe|MoonshotHealthReport"
    - from: "MoonshotDashboardTypes"
      to: "MoonshotRegistry"
      via: "dashboard snapshot built from registry state"
      pattern: "IMoonshotRegistry|MoonshotRegistration"
---

<objective>
Define all SDK-level types for cross-moonshot orchestration: the pipeline contract, moonshot registry, health probes, and dashboard models.

Purpose: Phase 64 wires 10 independently-built moonshot features (Phases 55-63) into a coherent system. All cross-moonshot coordination types must live in the SDK so plugins can reference them without circular dependencies. This plan establishes the type foundation every subsequent plan depends on.

Output: Five files in DataWarehouse.SDK/Moonshots/ defining the complete cross-moonshot type surface.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/PLUGIN-CATALOG.md
@DataWarehouse.SDK/Contracts/PluginBase.cs
@DataWarehouse.SDK/Contracts/StrategyBase.cs
@DataWarehouse.SDK/Contracts/Observability/IObservabilityStrategy.cs
@DataWarehouse.SDK/Primitives/Configuration/ConfigurationItem.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Moonshot pipeline types and orchestrator contract</name>
  <files>DataWarehouse.SDK/Moonshots/MoonshotPipelineTypes.cs, DataWarehouse.SDK/Moonshots/IMoonshotOrchestrator.cs</files>
  <action>
Create `DataWarehouse.SDK/Moonshots/` directory.

**MoonshotPipelineTypes.cs** -- Define:
- `MoonshotId` enum: `UniversalTags = 1, DataConsciousness = 2, CompliancePassports = 3, SovereigntyMesh = 4, ZeroGravityStorage = 5, CryptoTimeLocks = 6, SemanticSync = 7, ChaosVaccination = 8, CarbonAwareLifecycle = 9, UniversalFabric = 10`
- `MoonshotFeatureFlag` record: `MoonshotId Id, bool Enabled, string? DisabledReason`
- `MoonshotStageResult` record: `MoonshotId Stage, bool Success, TimeSpan Duration, string? Error, IReadOnlyDictionary<string, object>? Metadata`
- `MoonshotPipelineResult` record: `IReadOnlyList<MoonshotStageResult> StageResults, bool AllSucceeded, TimeSpan TotalDuration, DateTimeOffset CompletedAt`
- `MoonshotPipelineContext` class: Mutable context flowing through the pipeline. Properties: `string ObjectId, StorageObjectMetadata? ObjectMetadata, IReadOnlyDictionary<string, object> Properties` (a bag that each stage can read/write via `SetProperty<T>/GetProperty<T>`). Also: `CancellationToken CancellationToken, ILogger Logger, IMessageBus MessageBus`. Include `AddStageResult(MoonshotStageResult result)` method.
- `MoonshotPipelineDefinition` record: `string Name, IReadOnlyList<MoonshotId> StageOrder, IReadOnlyDictionary<MoonshotId, MoonshotFeatureFlag> FeatureFlags`

**IMoonshotOrchestrator.cs** -- Define:
- `IMoonshotPipelineStage` interface: `MoonshotId Id { get; }`, `Task<MoonshotStageResult> ExecuteAsync(MoonshotPipelineContext context, CancellationToken ct)`, `Task<bool> CanExecuteAsync(MoonshotPipelineContext context, CancellationToken ct)` (precondition check)
- `IMoonshotOrchestrator` interface: `Task<MoonshotPipelineResult> ExecutePipelineAsync(MoonshotPipelineContext context, MoonshotPipelineDefinition pipeline, CancellationToken ct)`, `void RegisterStage(IMoonshotPipelineStage stage)`, `IReadOnlyList<MoonshotId> GetRegisteredStages()`, `Task<MoonshotPipelineResult> ExecuteDefaultPipelineAsync(MoonshotPipelineContext context, CancellationToken ct)` (uses the standard ingest-to-lifecycle order)

Follow existing SDK patterns: records are immutable with init-only setters, interfaces have XML doc comments, use `IReadOnlyList`/`IReadOnlyDictionary` for public API.
  </action>
  <verify>
`dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` compiles with zero errors. Both files exist and contain the types listed.
  </verify>
  <done>MoonshotId enum has all 10 entries. IMoonshotOrchestrator and IMoonshotPipelineStage contracts are defined. MoonshotPipelineContext flows through the pipeline with typed property bag.</done>
</task>

<task type="auto">
  <name>Task 2: Moonshot registry, health probes, and dashboard types</name>
  <files>DataWarehouse.SDK/Moonshots/MoonshotRegistry.cs, DataWarehouse.SDK/Moonshots/IMoonshotHealthProbe.cs, DataWarehouse.SDK/Moonshots/MoonshotDashboardTypes.cs</files>
  <action>
**MoonshotRegistry.cs** -- Define:
- `MoonshotStatus` enum: `NotInstalled, Disabled, Initializing, Ready, Degraded, Faulted`
- `MoonshotRegistration` record: `MoonshotId Id, string DisplayName, string Description, MoonshotStatus Status, DateTimeOffset? LastHealthCheck, MoonshotHealthReport? LastHealthReport, IReadOnlyList<MoonshotId> DependsOn` (list of moonshots this one requires)
- `IMoonshotRegistry` interface: `void Register(MoonshotRegistration registration)`, `MoonshotRegistration? Get(MoonshotId id)`, `IReadOnlyList<MoonshotRegistration> GetAll()`, `MoonshotStatus GetStatus(MoonshotId id)`, `void UpdateStatus(MoonshotId id, MoonshotStatus status)`, `void UpdateHealthReport(MoonshotId id, MoonshotHealthReport report)`, `IReadOnlyList<MoonshotRegistration> GetByStatus(MoonshotStatus status)`, `event EventHandler<MoonshotStatusChangedEventArgs>? StatusChanged`
- `MoonshotStatusChangedEventArgs` class: `MoonshotId Id, MoonshotStatus OldStatus, MoonshotStatus NewStatus, DateTimeOffset Timestamp`

**IMoonshotHealthProbe.cs** -- Define:
- `MoonshotReadiness` enum: `Ready, NotReady, Degraded, Unknown`
- `MoonshotHealthReport` record: `MoonshotId Id, MoonshotReadiness Readiness, string Summary, IReadOnlyDictionary<string, MoonshotComponentHealth> Components, DateTimeOffset CheckedAt, TimeSpan CheckDuration`
- `MoonshotComponentHealth` record: `string Name, MoonshotReadiness Readiness, string? Message, IReadOnlyDictionary<string, string>? Details`
- `IMoonshotHealthProbe` interface: `MoonshotId MoonshotId { get; }`, `Task<MoonshotHealthReport> CheckHealthAsync(CancellationToken ct)`, `TimeSpan HealthCheckInterval { get; }` (suggested check frequency)

**MoonshotDashboardTypes.cs** -- Define:
- `MoonshotMetrics` record: `MoonshotId Id, long TotalInvocations, long SuccessCount, long FailureCount, double AverageLatencyMs, double P99LatencyMs, DateTimeOffset WindowStart, DateTimeOffset WindowEnd`
- `MoonshotTrendPoint` record: `DateTimeOffset Timestamp, double Value, string MetricName`
- `MoonshotDashboardSnapshot` record: `IReadOnlyList<MoonshotRegistration> Registrations, IReadOnlyList<MoonshotMetrics> Metrics, IReadOnlyList<MoonshotHealthReport> HealthReports, DateTimeOffset GeneratedAt, int TotalMoonshots, int ReadyCount, int DegradedCount, int FaultedCount`
- `IMoonshotDashboardProvider` interface: `Task<MoonshotDashboardSnapshot> GetSnapshotAsync(CancellationToken ct)`, `Task<IReadOnlyList<MoonshotTrendPoint>> GetTrendsAsync(MoonshotId id, string metricName, DateTimeOffset from, DateTimeOffset to, CancellationToken ct)`, `Task<MoonshotMetrics> GetMetricsAsync(MoonshotId id, CancellationToken ct)`

Use `System.Collections.Concurrent.ConcurrentDictionary` for any mutable internal state. All records immutable. Follow existing SDK naming conventions.
  </action>
  <verify>
`dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` compiles with zero errors. `IMoonshotRegistry`, `IMoonshotHealthProbe`, `IMoonshotDashboardProvider` all exist.
  </verify>
  <done>Moonshot registry tracks all 10 moonshots. Health probe interface supports per-moonshot readiness checks. Dashboard types provide unified metrics and trend data.</done>
</task>

</tasks>

<verification>
- `dotnet build DataWarehouse.SDK/DataWarehouse.SDK.csproj` -- zero errors
- All 5 files exist in `DataWarehouse.SDK/Moonshots/`
- `MoonshotId` enum has exactly 10 values
- `IMoonshotOrchestrator`, `IMoonshotRegistry`, `IMoonshotHealthProbe`, `IMoonshotDashboardProvider` interfaces defined
</verification>

<success_criteria>
SDK defines the complete cross-moonshot type surface: pipeline orchestration, moonshot registry, health probes, and dashboard models. No plugin code yet -- pure SDK contracts.
</success_criteria>

<output>
After completion, create `.planning/phases/64-moonshot-wiring/64-01-SUMMARY.md`
</output>
