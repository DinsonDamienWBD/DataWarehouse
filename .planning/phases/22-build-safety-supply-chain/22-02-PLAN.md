---
phase: 22-build-safety-supply-chain
plan: 02
type: execute
wave: 2
depends_on: ["22-01"]
files_modified:
  - Directory.Build.props
  - Plugins/DataWarehouse.Plugins.AdaptiveTransport/DataWarehouse.Plugins.AdaptiveTransport.csproj
  - Plugins/DataWarehouse.Plugins.AppPlatform/DataWarehouse.Plugins.AppPlatform.csproj
  - Plugins/DataWarehouse.Plugins.DataMarketplace/DataWarehouse.Plugins.DataMarketplace.csproj
  - Plugins/DataWarehouse.Plugins.KubernetesCsi/DataWarehouse.Plugins.KubernetesCsi.csproj
  - Plugins/DataWarehouse.Plugins.PluginMarketplace/DataWarehouse.Plugins.PluginMarketplace.csproj
  - Plugins/DataWarehouse.Plugins.UltimateDataCatalog/DataWarehouse.Plugins.UltimateDataCatalog.csproj
  - Plugins/DataWarehouse.Plugins.UltimateDataFabric/DataWarehouse.Plugins.UltimateDataFabric.csproj
  - Plugins/DataWarehouse.Plugins.UltimateDataTransit/DataWarehouse.Plugins.UltimateDataTransit.csproj
  - Plugins/DataWarehouse.Plugins.UltimateDocGen/DataWarehouse.Plugins.UltimateDocGen.csproj
  - Plugins/DataWarehouse.Plugins.UltimateReplication/DataWarehouse.Plugins.UltimateReplication.csproj
  - Plugins/DataWarehouse.Plugins.UltimateSDKPorts/DataWarehouse.Plugins.UltimateSDKPorts.csproj
  - Plugins/DataWarehouse.Plugins.UltimateWorkflow/DataWarehouse.Plugins.UltimateWorkflow.csproj
autonomous: true

must_haves:
  truths:
    - "TreatWarningsAsErrors is enabled globally via Directory.Build.props so ALL 69 projects treat warnings as errors"
    - "The full solution builds with ZERO warnings and ZERO errors after all analyzer warnings are fixed or properly suppressed"
    - "The 12 plugin .csproj files that previously had per-project TreatWarningsAsErrors have that line removed (now redundant)"
    - "Any suppressions added have documented justification (not blanket suppression)"
    - "NuGet-sourced warnings (NU1608, NU1603, NU1510) are either fixed at root cause or suppressed in NoWarn"
  artifacts:
    - path: "Directory.Build.props"
      provides: "TreatWarningsAsErrors=true globally and NU-prefixed suppressions for unfixable NuGet warnings"
      contains: "TreatWarningsAsErrors"
  key_links:
    - from: "Directory.Build.props TreatWarningsAsErrors"
      to: "All 69 .csproj projects"
      via: "MSBuild automatic import -- every project inherits this setting"
      pattern: "<TreatWarningsAsErrors>true</TreatWarningsAsErrors>"
---

<objective>
Enable TreatWarningsAsErrors across all 69 projects with zero remaining warnings, fixing or suppressing all analyzer diagnostics discovered in Plan 22-01.

Purpose: Every warning is an error (BUILD-01, BUILD-05) -- no new code quality regressions can slip in. Zero-warning builds become the enforced standard.
Output: Directory.Build.props with TreatWarningsAsErrors=true, all analyzer warnings resolved, 12 redundant per-project TWAE removed.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/22-build-safety-supply-chain/22-RESEARCH.md
@.planning/phases/22-build-safety-supply-chain/22-01-SUMMARY.md

# Build configuration
@Directory.Build.props
</context>

<tasks>

<task type="auto">
  <name>Task 1: Discovery build -- capture all analyzer warnings, then fix or suppress each one</name>
  <files>
    Directory.Build.props
  </files>
  <action>
This task has two phases: discovery and remediation.

**Phase A: Discovery Build**

First, do NOT enable TreatWarningsAsErrors yet. Run a full solution build to capture the current warning landscape AFTER Plan 22-01 added analyzers:

```bash
dotnet build DataWarehouse.slnx 2>&1
```

Parse the output and categorize ALL warnings by:
- Diagnostic code (e.g., S1135, RCS1003, SCS0005, RS0030, CA*, CS*)
- Source file
- Whether it is fixable (code change) or must be suppressed (false positive / architectural choice)

Expected warning sources:
1. **SonarAnalyzer (S-prefixed)**: Code quality findings (likely 50-200 across 1.1M LOC)
2. **Roslynator (RCS-prefixed)**: Style and quality findings
3. **SecurityCodeScan (SCS-prefixed)**: Security findings (if analyzer loaded)
4. **BannedApiAnalyzers (RS0030)**: Any banned symbol usage
5. **NuGet (NU-prefixed)**: NU1608, NU1603, NU1510 (10 known from research)
6. **CA-prefixed**: Additional .NET analyzers from AnalysisLevel upgrade to latest-recommended

**Phase B: NuGet Warning Resolution**

NOTE: NU1510 (unnecessary packages) and NU1603 (version pinning) root-cause fixes have been moved to Plan 22-03 to consolidate all package-level .csproj modifications in one plan and avoid file conflicts during parallel execution.

For NU1608 (dependency constraint violation): These are caused by upstream packages (Nethereum, AWSSDK) requiring older M.E.L.Abstractions/AWSSDK.Core. Add `NU1608` to the NoWarn line in Directory.Build.props since we cannot control upstream constraints.

**Phase C: Fix or Suppress Analyzer Warnings**

For each new analyzer warning category:

1. **Fixable code issues** (wrong patterns, missing null checks, etc.): Fix the code. Common Sonar/Roslynator fixes include:
   - Remove empty catch blocks or add logging
   - Fix unused parameter warnings
   - Fix potential null dereference
   - Remove redundant casts/checks

2. **Architecture-appropriate suppressions**: For warnings that conflict with the plugin architecture pattern (e.g., unused event handlers that are bound at runtime, fields initialized by reflection), add to the `<NoWarn>` in Directory.Build.props with a comment explaining WHY.

3. **Severity downgrades via .globalconfig**: If a specific analyzer rule produces too many false positives across the codebase, create a `.globalconfig` file at solution root to downgrade that rule to `suggestion` or `none` with justification. Format:
```ini
is_global = true
# Rule: [description]
# Justification: [why downgraded]
dotnet_diagnostic.SXXXX.severity = suggestion
```

CRITICAL: Do NOT blanket-suppress analyzer categories. Each suppression must be individually justified. The goal is to FIX warnings, not hide them.

CRITICAL: Do NOT modify any business logic to fix warnings. Only safe mechanical fixes (null checks, using statements, unused variable removal, type annotations). If a warning requires business logic change, suppress it with justification and defer to a later phase.
  </action>
  <verify>
Run `dotnet build DataWarehouse.slnx` and count warnings. The target is ZERO warnings before enabling TreatWarningsAsErrors. If any remain, document them with justification for suppression.
  </verify>
  <done>
Full solution build produces zero warnings after all analyzer diagnostics are fixed or properly suppressed with documented justification. NuGet NU1510 warnings fixed by removing unnecessary packages. NU1603 fixed by pinning versions. NU1608 suppressed in NoWarn (upstream dependency constraint, unfixable).
  </done>
</task>

<task type="auto">
  <name>Task 2: Enable TreatWarningsAsErrors globally and remove redundant per-project settings</name>
  <files>
    Directory.Build.props
    Plugins/DataWarehouse.Plugins.AdaptiveTransport/DataWarehouse.Plugins.AdaptiveTransport.csproj
    Plugins/DataWarehouse.Plugins.AppPlatform/DataWarehouse.Plugins.AppPlatform.csproj
    Plugins/DataWarehouse.Plugins.DataMarketplace/DataWarehouse.Plugins.DataMarketplace.csproj
    Plugins/DataWarehouse.Plugins.KubernetesCsi/DataWarehouse.Plugins.KubernetesCsi.csproj
    Plugins/DataWarehouse.Plugins.PluginMarketplace/DataWarehouse.Plugins.PluginMarketplace.csproj
    Plugins/DataWarehouse.Plugins.UltimateDataCatalog/DataWarehouse.Plugins.UltimateDataCatalog.csproj
    Plugins/DataWarehouse.Plugins.UltimateDataFabric/DataWarehouse.Plugins.UltimateDataFabric.csproj
    Plugins/DataWarehouse.Plugins.UltimateDataTransit/DataWarehouse.Plugins.UltimateDataTransit.csproj
    Plugins/DataWarehouse.Plugins.UltimateDocGen/DataWarehouse.Plugins.UltimateDocGen.csproj
    Plugins/DataWarehouse.Plugins.UltimateReplication/DataWarehouse.Plugins.UltimateReplication.csproj
    Plugins/DataWarehouse.Plugins.UltimateSDKPorts/DataWarehouse.Plugins.UltimateSDKPorts.csproj
    Plugins/DataWarehouse.Plugins.UltimateWorkflow/DataWarehouse.Plugins.UltimateWorkflow.csproj
  </files>
  <action>
**Step 1: Enable TreatWarningsAsErrors in Directory.Build.props**

Add `<TreatWarningsAsErrors>true</TreatWarningsAsErrors>` to the `<PropertyGroup>` in Directory.Build.props. Place it after the `<EnforceCodeStyleInBuild>` line. The existing `<WarningsAsErrors>nullable</WarningsAsErrors>` line is now REDUNDANT (TreatWarningsAsErrors=true subsumes it) -- remove it to avoid confusion.

**Step 2: Remove per-project TreatWarningsAsErrors from 12 plugins**

These 12 plugin .csproj files already have `<TreatWarningsAsErrors>true</TreatWarningsAsErrors>` set individually (now redundant since Directory.Build.props provides it):

1. `Plugins/DataWarehouse.Plugins.AdaptiveTransport/DataWarehouse.Plugins.AdaptiveTransport.csproj`
2. `Plugins/DataWarehouse.Plugins.AppPlatform/DataWarehouse.Plugins.AppPlatform.csproj`
3. `Plugins/DataWarehouse.Plugins.DataMarketplace/DataWarehouse.Plugins.DataMarketplace.csproj`
4. `Plugins/DataWarehouse.Plugins.KubernetesCsi/DataWarehouse.Plugins.KubernetesCsi.csproj`
5. `Plugins/DataWarehouse.Plugins.PluginMarketplace/DataWarehouse.Plugins.PluginMarketplace.csproj`
6. `Plugins/DataWarehouse.Plugins.UltimateDataCatalog/DataWarehouse.Plugins.UltimateDataCatalog.csproj`
7. `Plugins/DataWarehouse.Plugins.UltimateDataFabric/DataWarehouse.Plugins.UltimateDataFabric.csproj`
8. `Plugins/DataWarehouse.Plugins.UltimateDataTransit/DataWarehouse.Plugins.UltimateDataTransit.csproj`
9. `Plugins/DataWarehouse.Plugins.UltimateDocGen/DataWarehouse.Plugins.UltimateDocGen.csproj`
10. `Plugins/DataWarehouse.Plugins.UltimateReplication/DataWarehouse.Plugins.UltimateReplication.csproj`
11. `Plugins/DataWarehouse.Plugins.UltimateSDKPorts/DataWarehouse.Plugins.UltimateSDKPorts.csproj`
12. `Plugins/DataWarehouse.Plugins.UltimateWorkflow/DataWarehouse.Plugins.UltimateWorkflow.csproj`

For each, remove the `<TreatWarningsAsErrors>true</TreatWarningsAsErrors>` line. Keep all other settings (GenerateDocumentationFile, NoWarn, etc.) as-is.

**Step 3: Full solution build**

Run `dotnet build DataWarehouse.slnx` and verify ZERO errors. Since TreatWarningsAsErrors is now true, any remaining warnings will become errors. If any appear:
1. Fix the code (preferred)
2. Or suppress with justification in .globalconfig / NoWarn
3. Re-build until clean

Do NOT revert TreatWarningsAsErrors to fix build -- fix the warnings instead.
  </action>
  <verify>
Run `dotnet build DataWarehouse.slnx` and confirm:
1. Exit code 0 (success)
2. Zero warnings in output
3. Zero errors in output
4. `TreatWarningsAsErrors` appears in Directory.Build.props
5. Grep all .csproj files for TreatWarningsAsErrors -- should find ZERO matches (all removed)
  </verify>
  <done>
TreatWarningsAsErrors is enabled globally in Directory.Build.props. All 12 redundant per-project TreatWarningsAsErrors lines removed. Full solution builds with zero warnings and zero errors (BUILD-01, BUILD-05 satisfied).
  </done>
</task>

</tasks>

<verification>
- [ ] `<TreatWarningsAsErrors>true</TreatWarningsAsErrors>` in Directory.Build.props
- [ ] `<WarningsAsErrors>nullable</WarningsAsErrors>` removed from Directory.Build.props (subsumed)
- [ ] Zero .csproj files contain `<TreatWarningsAsErrors>` (all removed, inherited from Directory.Build.props)
- [ ] `dotnet build DataWarehouse.slnx` exits 0 with zero warnings and zero errors
- [ ] NU1510 warnings fixed (unnecessary PackageReferences removed from 3 projects)
- [ ] NU1603 warnings fixed (versions pinned)
- [ ] NU1608 warnings either fixed or suppressed in NoWarn with justification
- [ ] All analyzer warning suppressions documented with justification
- [ ] No business logic changes -- only mechanical safe fixes
</verification>

<success_criteria>
Plan 22-02 succeeds when:
1. TreatWarningsAsErrors is globally enabled via Directory.Build.props (BUILD-01)
2. Full solution `dotnet build DataWarehouse.slnx` produces ZERO warnings, ZERO errors (BUILD-05)
3. All 12 per-project TreatWarningsAsErrors removed (centralized config)
4. NuGet root-cause warnings (NU1510, NU1603) fixed; NU1608 suppressed with justification
5. Every suppression has documented justification (no blanket suppressions)
</success_criteria>

<output>
After completion, create `.planning/phases/22-build-safety-supply-chain/22-02-SUMMARY.md`
</output>
