---
phase: 06-interface-layer
plan: 05
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/RealTime/WebSocketInterfaceStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/RealTime/ServerSentEventsStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/RealTime/LongPollingStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/RealTime/SocketIoStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/RealTime/SignalRStrategy.cs
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "5 real-time strategies exist and compile with production-ready event handling"
    - "WebSocket strategy supports bidirectional message passing"
    - "SSE strategy supports server-to-client event streaming"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/RealTime/"
      provides: "5 real-time protocol strategy implementations"
  key_links:
    - from: "Strategies/RealTime/*.cs"
      to: "InterfaceStrategyBase"
      via: "class inheritance"
      pattern: "InterfaceStrategyBase"
---

<objective>
Implement 5 real-time protocol strategies (T109.B5)

Purpose: Provide production-ready real-time communication strategies for push updates and live data streaming via WebSocket, Server-Sent Events, Long Polling, Socket.IO, and SignalR.

Output: 5 strategy files in Strategies/RealTime/ directory, all compiling cleanly.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-interface-layer/06-RESEARCH.md
@.planning/phases/06-interface-layer/06-01-SUMMARY.md
@DataWarehouse.SDK/Contracts/Interface/IInterfaceStrategy.cs
@DataWarehouse.SDK/Contracts/Interface/InterfaceStrategyBase.cs
@DataWarehouse.SDK/Contracts/Interface/InterfaceCapabilities.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement 5 real-time strategies in Strategies/RealTime/ directory</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/RealTime/WebSocketInterfaceStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/RealTime/ServerSentEventsStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/RealTime/LongPollingStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/RealTime/SocketIoStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/RealTime/SignalRStrategy.cs
  </files>
  <action>
Create 5 real-time strategy files. Each extends InterfaceStrategyBase and implements IPluginInterfaceStrategy.

**WebSocketInterfaceStrategy** (StrategyId: "websocket"):
- Protocol: InterfaceProtocol.WebSocket
- Use InterfaceCapabilities.CreateWebSocketDefaults()
- HandleRequestAsync: Accept WebSocket upgrade request, manage connection lifecycle, route incoming messages via message bus, push outgoing events to connected clients
- Support text and binary frames
- Track connected clients via ConcurrentDictionary
- Implement ping/pong heartbeat for connection health
- Support rooms/groups for targeted message delivery
- JSON message format: { "type": "subscribe|publish|rpc", "channel": "...", "data": {...} }

**ServerSentEventsStrategy** (StrategyId: "sse"):
- Protocol: InterfaceProtocol.ServerSentEvents
- HandleRequestAsync: Set Content-Type: text/event-stream, keep connection open, push events in SSE format (event: type\ndata: json\nid: seq\n\n)
- Support Last-Event-ID for reconnection
- Subscribe to message bus topics based on request path/params
- Support event filtering and transformation
- Implement retry directive for client reconnection

**LongPollingStrategy** (StrategyId: "long-polling"):
- Protocol: InterfaceProtocol.REST (long polling is HTTP-based)
- HandleRequestAsync: Hold request open until data is available or timeout (configurable, default 30s), return new data immediately if available, return 204 No Content on timeout
- Support If-None-Match / ETag for change detection
- Support timeout parameter in query string
- Track pending requests per client for ordered delivery

**SocketIoStrategy** (StrategyId: "socket-io"):
- Protocol: InterfaceProtocol.WebSocket
- Implements Socket.IO protocol: namespace separation, room support, acknowledgement callbacks, auto-reconnection
- HandleRequestAsync: Parse Socket.IO packet format (type + namespace + data), support connect/disconnect/event/ack packet types
- Support binary attachments
- Implement Engine.IO transport negotiation (WebSocket preferred, long-polling fallback)

**SignalRStrategy** (StrategyId: "signalr"):
- Protocol: InterfaceProtocol.WebSocket
- Implements SignalR hub protocol: negotiate endpoint, hub method invocation, streaming, groups
- HandleRequestAsync: Parse SignalR handshake, route hub method calls via message bus, support server-to-client streaming (IAsyncEnumerable), client-to-server streaming
- Support JSON and MessagePack hub protocols
- Implement connection state management (Connected, Reconnecting, Disconnected)

All strategies use message bus for event routing, handle disconnection gracefully, include XML docs.
  </action>
  <verify>
`dotnet build Plugins/DataWarehouse.Plugins.UltimateInterface/DataWarehouse.Plugins.UltimateInterface.csproj` -- zero errors.
Verify 5 .cs files exist in Strategies/RealTime/.
  </verify>
  <done>5 real-time strategies implemented with bidirectional/streaming communication and connection management.</done>
</task>

<task type="auto">
  <name>Task 2: Mark T109.B5 complete in TODO.md</name>
  <files>Metadata/TODO.md</files>
  <action>Find lines `| 109.B5.1 |` through `| 109.B5.5 |` and change `[ ]` to `[x]`.</action>
  <verify>Grep TODO.md for `109.B5` -- all 5 should show `[x]`.</verify>
  <done>T109.B5.1-B5.5 marked [x] in TODO.md.</done>
</task>

</tasks>

<verification>
- `dotnet build` passes with zero errors
- 5 real-time strategy files exist and extend InterfaceStrategyBase
- T109.B5.1-B5.5 marked [x]
</verification>

<success_criteria>
5 real-time strategies are production-ready with WebSocket management, SSE streaming, and hub protocol support.
</success_criteria>

<output>
After completion, create `.planning/phases/06-interface-layer/06-05-SUMMARY.md`
</output>
