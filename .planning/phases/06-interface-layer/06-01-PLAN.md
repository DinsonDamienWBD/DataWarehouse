---
phase: 06-interface-layer
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateInterface/UltimateInterfacePlugin.cs
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "Plugin orchestrator uses SDK IInterfaceStrategy (not a duplicate local definition)"
    - "Strategy registry auto-discovers all strategies implementing SDK IInterfaceStrategy"
    - "Plugin compiles with zero errors after refactoring"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateInterface/UltimateInterfacePlugin.cs"
      provides: "Refactored orchestrator using SDK types exclusively"
      contains: "using DataWarehouse.SDK.Contracts.Interface"
  key_links:
    - from: "UltimateInterfacePlugin.cs"
      to: "SDK/Contracts/Interface/IInterfaceStrategy.cs"
      via: "using directive and type references"
      pattern: "SDK\.Contracts\.Interface"
---

<objective>
Verify and refactor UltimateInterface orchestrator to align with SDK contracts (T109.B1)

Purpose: The existing UltimateInterfacePlugin defines its own IInterfaceStrategy, InterfaceCapabilities, and InterfaceCategory types that conflict with the SDK's canonical types in DataWarehouse.SDK/Contracts/Interface/. The SDK has InterfaceStrategyBase (with lifecycle, request handling, disposal), InterfaceCapabilities record (SupportsStreaming, SupportsBidirectionalStreaming, SupportedContentTypes, MaxRequestSize, etc.), and InterfaceProtocol enum. The plugin must use SDK types exclusively so all strategies are interoperable.

Output: Refactored UltimateInterfacePlugin.cs with no duplicate type definitions, clean compilation, and auto-discovery working with SDK IInterfaceStrategy.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-interface-layer/06-RESEARCH.md
@Plugins/DataWarehouse.Plugins.UltimateInterface/UltimateInterfacePlugin.cs
@DataWarehouse.SDK/Contracts/Interface/IInterfaceStrategy.cs
@DataWarehouse.SDK/Contracts/Interface/InterfaceStrategyBase.cs
@DataWarehouse.SDK/Contracts/Interface/InterfaceCapabilities.cs
@DataWarehouse.SDK/Contracts/Interface/InterfaceTypes.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Refactor UltimateInterfacePlugin to use SDK interface types exclusively</name>
  <files>Plugins/DataWarehouse.Plugins.UltimateInterface/UltimateInterfacePlugin.cs</files>
  <action>
Refactor UltimateInterfacePlugin.cs to eliminate ALL locally-defined duplicate types and use the SDK versions exclusively:

1. REMOVE the local definitions of: IInterfaceStrategy (public interface), InterfaceCapabilities (public sealed class), InterfaceCategory (public enum). Keep InterfaceHealthStatus as internal helper.
2. ADD `using DataWarehouse.SDK.Contracts.Interface;` at the top. Use alias if needed: `using SdkInterface = DataWarehouse.SDK.Contracts.Interface;`
3. The SDK IInterfaceStrategy has: Protocol (InterfaceProtocol), Capabilities (InterfaceCapabilities record), StartAsync(ct), StopAsync(ct), HandleRequestAsync(request, ct). It does NOT have: StrategyId, DisplayName, SemanticDescription, Category, Tags.
4. Create an internal interface `IPluginInterfaceStrategy` that extends SDK's IInterfaceStrategy and adds the metadata properties the orchestrator needs:
   - string StrategyId
   - string DisplayName
   - string SemanticDescription
   - InterfaceCategory Category (keep this as a local enum for grouping -- Http, Rpc, RealTime, Query, Messaging, Conversational, AiNative, Innovation)
   - string[] Tags
5. Update InterfaceStrategyRegistry to use IPluginInterfaceStrategy for internal storage and discovery, while accepting SDK IInterfaceStrategy for external compatibility.
6. Update InterfaceCapabilities usage -- the local version has SupportsStreaming, SupportsBidirectional, SupportsAuthentication, SupportsCompression, SupportsEncryption (all bool). The SDK version is a record with many more fields. Update the 5 built-in strategies to use SDK InterfaceCapabilities record constructor or factory methods (CreateRestDefaults, CreateGrpcDefaults, etc.).
7. Update the 5 built-in strategies (RestInterfaceStrategy, GrpcInterfaceStrategy, WebSocketInterfaceStrategy, GraphQLInterfaceStrategy, McpInterfaceStrategy) to:
   - Extend InterfaceStrategyBase from SDK (which provides lifecycle, request handling, disposal)
   - Implement HandleRequestAsyncCore returning a JSON capabilities description
   - Implement StartAsyncCore and StopAsyncCore as no-ops for now
   - Also implement IPluginInterfaceStrategy for the metadata fields
8. Ensure `dotnet build` passes for the plugin project.

Keep: UltimateInterfacePlugin orchestrator logic (message handlers, intelligence integration, health tracking, usage stats). These are production-ready.
Keep: InterfaceStrategyRegistry with auto-discovery (update type references).
Keep: InterfaceHealthStatus as internal type.
  </action>
  <verify>
Run `dotnet build Plugins/DataWarehouse.Plugins.UltimateInterface/DataWarehouse.Plugins.UltimateInterface.csproj` -- zero errors.
Grep for `public interface IInterfaceStrategy` in the plugin file -- should NOT exist (only IPluginInterfaceStrategy should be defined locally).
Grep for `InterfaceStrategyBase` -- should appear in the built-in strategies.
  </verify>
  <done>
UltimateInterfacePlugin uses SDK IInterfaceStrategy/InterfaceStrategyBase/InterfaceCapabilities exclusively; local IPluginInterfaceStrategy extends SDK interface with metadata; 5 built-in strategies extend InterfaceStrategyBase; plugin builds cleanly.
  </done>
</task>

<task type="auto">
  <name>Task 2: Mark T109.B1 sub-tasks complete in TODO.md</name>
  <files>Metadata/TODO.md</files>
  <action>
After Task 1 succeeds, update TODO.md:
- Find line containing `| 109.B1.1 |` and change `[ ]` to `[x]` (project already exists)
- Find line containing `| 109.B1.2 |` and change `[ ]` to `[x]` (orchestrator is production-ready)
- Find line containing `| 109.B1.3 |` and change `[ ]` to `[x]` (reflection-based auto-discovery works)
- Find line containing `| 109.B1.4 |` and change `[ ]` to `[x]` (message handler dispatches by strategyId)
  </action>
  <verify>
Grep TODO.md for lines containing `109.B1` -- all 4 should show `[x]`.
  </verify>
  <done>
T109.B1.1-B1.4 marked [x] in TODO.md reflecting verified orchestrator and auto-discovery.
  </done>
</task>

</tasks>

<verification>
- `dotnet build` passes for UltimateInterface plugin with zero errors
- No duplicate IInterfaceStrategy definition in plugin (only SDK version used)
- Built-in strategies extend InterfaceStrategyBase
- T109.B1.1-B1.4 marked [x] in TODO.md
</verification>

<success_criteria>
UltimateInterface orchestrator is production-ready, uses SDK types exclusively, auto-discovers strategies, handles messages via message bus, and compiles cleanly. Foundation is ready for strategy implementation in subsequent plans.
</success_criteria>

<output>
After completion, create `.planning/phases/06-interface-layer/06-01-SUMMARY.md`
</output>
