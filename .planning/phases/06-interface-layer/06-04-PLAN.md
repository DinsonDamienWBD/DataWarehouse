---
phase: 06-interface-layer
plan: 04
type: execute
wave: 2
depends_on: ["06-01"]
files_modified:
  - Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/GraphQLInterfaceStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/SqlInterfaceStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/RelayStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/ApolloFederationStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/HasuraStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/PostGraphileStrategy.cs
  - Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/PrismaStrategy.cs
  - Metadata/TODO.md
autonomous: true

must_haves:
  truths:
    - "7 query strategies exist and compile with production-ready request handling"
    - "GraphQL strategy supports queries, mutations, and subscription declarations"
    - "SQL strategy parses SQL statements and routes via message bus"
  artifacts:
    - path: "Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/"
      provides: "7 query language strategy implementations"
  key_links:
    - from: "Strategies/Query/*.cs"
      to: "InterfaceStrategyBase"
      via: "class inheritance"
      pattern: "InterfaceStrategyBase"
---

<objective>
Implement 7 query language strategies (T109.B4)

Purpose: Provide production-ready query interface strategies enabling flexible data access via GraphQL, SQL, Relay, Apollo Federation, Hasura-style, PostGraphile-style, and Prisma-style APIs.

Output: 7 strategy files in Strategies/Query/ directory, all compiling cleanly.
</objective>

<execution_context>
@C:/Users/ddamien/.claude/get-shit-done/workflows/execute-plan.md
@C:/Users/ddamien/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/phases/06-interface-layer/06-RESEARCH.md
@.planning/phases/06-interface-layer/06-01-SUMMARY.md
@DataWarehouse.SDK/Contracts/Interface/IInterfaceStrategy.cs
@DataWarehouse.SDK/Contracts/Interface/InterfaceStrategyBase.cs
@DataWarehouse.SDK/Contracts/Interface/InterfaceCapabilities.cs
</context>

<tasks>

<task type="auto">
  <name>Task 1: Implement 7 query strategies in Strategies/Query/ directory</name>
  <files>
    Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/GraphQLInterfaceStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/SqlInterfaceStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/RelayStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/ApolloFederationStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/HasuraStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/PostGraphileStrategy.cs
    Plugins/DataWarehouse.Plugins.UltimateInterface/Strategies/Query/PrismaStrategy.cs
  </files>
  <action>
Create 7 query strategy files. Each must extend InterfaceStrategyBase and implement IPluginInterfaceStrategy.

**GraphQLInterfaceStrategy** (StrategyId: "graphql"):
- Protocol: InterfaceProtocol.GraphQL
- Use InterfaceCapabilities.CreateGraphQLDefaults()
- HandleRequestAsync: Parse GraphQL query/mutation/subscription from JSON body, extract operation name, variables, resolve via message bus query dispatch, return JSON { "data": ..., "errors": [...] }
- Support introspection queries (__schema, __type)
- Support query depth limiting and complexity analysis
- Content-Type: application/json, application/graphql

**SqlInterfaceStrategy** (StrategyId: "sql"):
- Protocol: InterfaceProtocol.Custom (SQL is not a standard protocol enum value)
- HandleRequestAsync: Parse SQL statement from request body, classify (SELECT/INSERT/UPDATE/DELETE/CREATE), route via message bus to wire protocol plugins (per research recommendation), return result set as JSON array
- Support parameterized queries to prevent SQL injection
- Return column metadata in response headers

**RelayStrategy** (StrategyId: "relay"):
- Protocol: InterfaceProtocol.GraphQL
- Implements Relay specification on top of GraphQL: Node interface (global IDs), Connection pattern (edges/nodes/pageInfo with cursor-based pagination), mutations with clientMutationId
- HandleRequestAsync: Parse Relay-compliant query, enforce node() root field, paginate via first/after/last/before, return Connection type

**ApolloFederationStrategy** (StrategyId: "apollo-federation"):
- Protocol: InterfaceProtocol.GraphQL
- Implements Apollo Federation v2 subgraph spec: @key, @external, @requires, @provides directives
- HandleRequestAsync: Handle _service { sdl } introspection, _entities(representations) resolution, reference resolvers
- Support @shareable, @inaccessible, @override directives

**HasuraStrategy** (StrategyId: "hasura"):
- Protocol: InterfaceProtocol.GraphQL
- Implements Hasura-style instant API: auto-generate GraphQL schema from data model, support aggregation queries, real-time subscriptions via message bus
- HandleRequestAsync: Parse query, auto-generate resolvers from metadata, support where/order_by/limit/offset/distinct_on

**PostGraphileStrategy** (StrategyId: "postgraphile"):
- Protocol: InterfaceProtocol.GraphQL
- Implements PostGraphile-style API: auto-introspect schema from database metadata, generate CRUD operations, support computed columns
- HandleRequestAsync: Schema generation from metadata, support allItems/itemById/createItem/updateItem/deleteItem patterns

**PrismaStrategy** (StrategyId: "prisma"):
- Protocol: InterfaceProtocol.GraphQL
- Implements Prisma-style API: findMany, findUnique, create, update, delete, upsert operations
- HandleRequestAsync: Parse Prisma-style queries with where/select/include/orderBy/take/skip, route to data layer

All strategies use message bus for data operations, handle errors with protocol-appropriate responses, include XML docs.
  </action>
  <verify>
`dotnet build Plugins/DataWarehouse.Plugins.UltimateInterface/DataWarehouse.Plugins.UltimateInterface.csproj` -- zero errors.
Verify 7 .cs files exist in Strategies/Query/.
  </verify>
  <done>7 query strategies implemented with production-ready query parsing and response formatting.</done>
</task>

<task type="auto">
  <name>Task 2: Mark T109.B4 complete in TODO.md</name>
  <files>Metadata/TODO.md</files>
  <action>Find lines `| 109.B4.1 |` through `| 109.B4.7 |` and change `[ ]` to `[x]`.</action>
  <verify>Grep TODO.md for `109.B4` -- all 7 should show `[x]`.</verify>
  <done>T109.B4.1-B4.7 marked [x] in TODO.md.</done>
</task>

</tasks>

<verification>
- `dotnet build` passes with zero errors
- 7 query strategy files exist and extend InterfaceStrategyBase
- T109.B4.1-B4.7 marked [x]
</verification>

<success_criteria>
7 query language strategies are production-ready with correct query parsing, result formatting, and pagination support.
</success_criteria>

<output>
After completion, create `.planning/phases/06-interface-layer/06-04-SUMMARY.md`
</output>
