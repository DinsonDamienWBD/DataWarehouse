apiVersion: apiextensions.k8s.io/v1
kind: CustomResourceDefinition
metadata:
  name: datawarehousereplications.datawarehouse.io
  annotations:
    controller-gen.kubebuilder.io/version: v0.14.0
  labels:
    app.kubernetes.io/name: datawarehouse-operator
    app.kubernetes.io/managed-by: datawarehouse
spec:
  group: datawarehouse.io
  names:
    kind: DataWarehouseReplication
    listKind: DataWarehouseReplicationList
    plural: datawarehousereplications
    singular: datawarehousereplication
    shortNames:
      - dwr
      - dwrepl
    categories:
      - all
      - datawarehouse
  scope: Namespaced
  versions:
    - name: v1
      served: true
      storage: true
      schema:
        openAPIV3Schema:
          type: object
          required:
            - spec
          properties:
            apiVersion:
              type: string
            kind:
              type: string
            metadata:
              type: object
            spec:
              type: object
              required:
                - sourceCluster
                - targetCluster
              properties:
                sourceCluster:
                  type: object
                  required:
                    - name
                  properties:
                    name:
                      type: string
                      description: Name of the source DataWarehouseCluster
                    namespace:
                      type: string
                      description: Namespace of the source cluster (defaults to same namespace)
                    endpoint:
                      type: string
                      description: Override endpoint for cross-cluster replication
                targetCluster:
                  type: object
                  required:
                    - name
                  properties:
                    name:
                      type: string
                      description: Name of the target DataWarehouseCluster
                    namespace:
                      type: string
                      description: Namespace of the target cluster
                    endpoint:
                      type: string
                      description: Override endpoint for cross-cluster replication
                mode:
                  type: string
                  enum:
                    - sync
                    - async
                    - semi-sync
                  default: async
                  description: Replication mode
                direction:
                  type: string
                  enum:
                    - one-way
                    - bidirectional
                  default: one-way
                  description: Replication direction
                conflictResolution:
                  type: string
                  enum:
                    - source-wins
                    - target-wins
                    - latest-wins
                    - manual
                  default: latest-wins
                  description: Conflict resolution strategy
                filters:
                  type: object
                  properties:
                    includePaths:
                      type: array
                      items:
                        type: string
                      description: Paths to include in replication
                    excludePaths:
                      type: array
                      items:
                        type: string
                      description: Paths to exclude from replication
                    includeMetadata:
                      type: boolean
                      default: true
                      description: Replicate metadata
                    includeVersions:
                      type: boolean
                      default: false
                      description: Replicate version history
                schedule:
                  type: object
                  properties:
                    continuous:
                      type: boolean
                      default: true
                      description: Enable continuous replication
                    interval:
                      type: string
                      pattern: '^[0-9]+(s|m|h)$'
                      description: Sync interval for non-continuous mode (e.g., 5m, 1h)
                    bandwidth:
                      type: object
                      properties:
                        limit:
                          type: string
                          pattern: '^[0-9]+(Ki|Mi|Gi)$'
                          description: Bandwidth limit (e.g., 100Mi)
                        schedule:
                          type: string
                          description: Cron expression for bandwidth scheduling
                encryption:
                  type: object
                  properties:
                    enabled:
                      type: boolean
                      default: true
                      description: Encrypt data in transit
                    certificateSecret:
                      type: string
                      description: Secret containing TLS certificates
                compression:
                  type: object
                  properties:
                    enabled:
                      type: boolean
                      default: true
                      description: Compress data during transfer
                    algorithm:
                      type: string
                      enum:
                        - zstd
                        - lz4
                        - gzip
                        - snappy
                      default: zstd
                      description: Compression algorithm
                paused:
                  type: boolean
                  default: false
                  description: Pause replication
            status:
              type: object
              properties:
                phase:
                  type: string
                  enum:
                    - Pending
                    - Initializing
                    - Syncing
                    - InSync
                    - Degraded
                    - Failed
                    - Paused
                lastSyncTime:
                  type: string
                  format: date-time
                bytesTransferred:
                  type: integer
                  format: int64
                objectsReplicated:
                  type: integer
                  format: int64
                lag:
                  type: string
                  description: Replication lag duration
                conflicts:
                  type: integer
                  description: Number of unresolved conflicts
                conditions:
                  type: array
                  items:
                    type: object
                    properties:
                      type:
                        type: string
                      status:
                        type: string
                      lastTransitionTime:
                        type: string
                        format: date-time
                      reason:
                        type: string
                      message:
                        type: string
      subresources:
        status: {}
      additionalPrinterColumns:
        - name: Source
          type: string
          jsonPath: .spec.sourceCluster.name
        - name: Target
          type: string
          jsonPath: .spec.targetCluster.name
        - name: Mode
          type: string
          jsonPath: .spec.mode
        - name: Phase
          type: string
          jsonPath: .status.phase
        - name: Lag
          type: string
          jsonPath: .status.lag
        - name: Age
          type: date
          jsonPath: .metadata.creationTimestamp
